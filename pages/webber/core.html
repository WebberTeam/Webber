<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 16.0.0"/>
    <title>webber.core API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:.75rem center;margin-bottom:1rem;}.pdoc .alert > em{display:none;}.pdoc .alert > *:last-child{margin-bottom:0;}.pdoc .alert.note{color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .alert.tip{color:#0a3622;background-color:#d1e7dd;border-color:#a3cfbb;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%230a3622%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%206a6%206%200%201%201%2010.174%204.31c-.203.196-.359.4-.453.619l-.762%201.769A.5.5%200%200%201%2010.5%2013a.5.5%200%200%201%200%201%20.5.5%200%200%201%200%201l-.224.447a1%201%200%200%201-.894.553H6.618a1%201%200%200%201-.894-.553L5.5%2015a.5.5%200%200%201%200-1%20.5.5%200%200%201%200-1%20.5.5%200%200%201-.46-.302l-.761-1.77a2%202%200%200%200-.453-.618A5.98%205.98%200%200%201%202%206m6-5a5%205%200%200%200-3.479%208.592c.263.254.514.564.676.941L5.83%2012h4.342l.632-1.467c.162-.377.413-.687.676-.941A5%205%200%200%200%208%201%22/%3E%3C/svg%3E");}.pdoc .alert.important{color:#055160;background-color:#cff4fc;border-color:#9eeaf9;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23055160%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%200a2%202%200%200%200-2%202v12a2%202%200%200%200%202%202h12a2%202%200%200%200%202-2V2a2%202%200%200%200-2-2zm6%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .alert.caution{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M11.46.146A.5.5%200%200%200%2011.107%200H4.893a.5.5%200%200%200-.353.146L.146%204.54A.5.5%200%200%200%200%204.893v6.214a.5.5%200%200%200%20.146.353l4.394%204.394a.5.5%200%200%200%20.353.146h6.214a.5.5%200%200%200%20.353-.146l4.394-4.394a.5.5%200%200%200%20.146-.353V4.893a.5.5%200%200%200-.146-.353zM8%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .decorator-deprecated{color:#842029;}.pdoc .decorator-deprecated ~ span{filter:grayscale(1) opacity(0.8);}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:27px;vertical-align:bottom;width:50px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../webber.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;webber</a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#DAG">DAG</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#DAG.__init__">DAG</a>
                        </li>
                        <li>
                                <a class="variable" href="#DAG.graph">graph</a>
                        </li>
                        <li>
                                <a class="function" href="#DAG.add_node">add_node</a>
                        </li>
                        <li>
                                <a class="function" href="#DAG.add_edge">add_edge</a>
                        </li>
                        <li>
                                <a class="function" href="#DAG.remove_node">remove_node</a>
                        </li>
                        <li>
                                <a class="function" href="#DAG.remove_edge">remove_edge</a>
                        </li>
                        <li>
                                <a class="function" href="#DAG.update_edges">update_edges</a>
                        </li>
                        <li>
                                <a class="function" href="#DAG.relabel_node">relabel_node</a>
                        </li>
                        <li>
                                <a class="function" href="#DAG.update_nodes">update_nodes</a>
                        </li>
                        <li>
                                <a class="function" href="#DAG.get_edges">get_edges</a>
                        </li>
                        <li>
                                <a class="function" href="#DAG.get_edge">get_edge</a>
                        </li>
                        <li>
                                <a class="function" href="#DAG.get_node">get_node</a>
                        </li>
                        <li>
                                <a class="function" href="#DAG.get_nodes">get_nodes</a>
                        </li>
                        <li>
                                <a class="function" href="#DAG.filter_nodes">filter_nodes</a>
                        </li>
                        <li>
                                <a class="function" href="#DAG.filter_edges">filter_edges</a>
                        </li>
                        <li>
                                <a class="function" href="#DAG.retry_node">retry_node</a>
                        </li>
                        <li>
                                <a class="function" href="#DAG.skip_node">skip_node</a>
                        </li>
                        <li>
                                <a class="function" href="#DAG.critical_path">critical_path</a>
                        </li>
                        <li>
                                <a class="function" href="#DAG.execute">execute</a>
                        </li>
                        <li>
                                <a class="function" href="#DAG.visualize">visualize</a>
                        </li>
                        <li>
                                <a class="variable" href="#DAG.root">root</a>
                        </li>
                        <li>
                                <a class="variable" href="#DAG.nodes">nodes</a>
                        </li>
                        <li>
                                <a class="function" href="#DAG.node_id">node_id</a>
                        </li>
                        <li>
                                <a class="function" href="#DAG.resolve_promise">resolve_promise</a>
                        </li>
                        <li>
                                <a class="class" href="#DAG.DAGExecutor">DAG.DAGExecutor</a>
                                        <ul class="memberlist">
                                    <li>
                                            <a class="function" href="#DAG.DAGExecutor.__init__">DAGExecutor</a>
                                    </li>
                            </ul>

                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Condition">Condition</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#Condition.Success">Success</a>
                        </li>
                        <li>
                                <a class="variable" href="#Condition.Failure">Failure</a>
                        </li>
                        <li>
                                <a class="variable" href="#Condition.AnyCase">AnyCase</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#QueueDAG">QueueDAG</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#QueueDAG.conditions">conditions</a>
                        </li>
                        <li>
                                <a class="function" href="#QueueDAG.add_node">add_node</a>
                        </li>
                        <li>
                                <a class="function" href="#QueueDAG.add_edge">add_edge</a>
                        </li>
                        <li>
                                <a class="function" href="#QueueDAG.execute">execute</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22160%22%20viewBox%3D%220%200%20150%2080%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M132.316%2048.886c.276-4.679%202.342-6.698%204.409-7.982s4.27-1.165%206.751-1.055c1.586.07%203.044.156%204.222-.482%201.142-.619%202.026-1.932%202.162-3.739.268-3.576-1.929-5.368-5.006-5.551s-7.599.524-10.517%201.606c-4.455%201.652-8.588%206.606-9.552%208.992s-2.342%206.193-1.745%2010.873%202.664%209.221%205.878%2011.79%205.878%203.808%2010.103%204.312%203.444.229%206.062.229%205.006-2.202%204.914-4.909-2.296-5.001-4.501-4.863-3.077.505-5.281.229-7.715-2.064-7.899-9.451z%22%20fill%3D%22%23198754%22/%3E%3Ccircle%20cx%3D%22101.504%22%20cy%3D%2248.943%22%20r%3D%2214.208%22%20fill%3D%22none%22%20stroke%3D%22%23198754%22%20stroke-width%3D%229.354%22/%3E%3Cpath%20d%3D%22M87.81.002c-3.637.065-5.001.454-7.014%201.232s-3.443%201.363-6.3%204.282c-1.723%201.76-3.148%205.019-3.776%207.329-.413%201.521-.316%202.63-.316%202.63l-.195%2034.612c.065%205.774-6.755%208.305-9.612%208.37s-9.678-1.038-9.743-9.408%207.128-9.521%208.362-9.521c1.413-.13%202.526-.021%203.718-.016%202.071.009%204.157-.778%204.092-4.671s-4.157-4.736-4.157-4.736c-6.3-.843-11.43%202.206-11.43%202.206S40.917%2038.15%2041.372%2049.634%2051.568%2068.19%2061.311%2068.125s18.316-7.007%2018.445-17.193l.13-22.772c.046-2.291%202.683-3.644%204.476-4.203.745-.232%201.694-.274%201.694-.274l10.457-.13s4.871-.324%207.729-3.114%204.352-6.294%204.352-6.294.974-3.049.13-4.606-.195-1.233-2.792-3.309-8.573-4.477-8.573-4.477S91.447-.063%2087.81.002zM0%2047.169l.065%2028.417S0%2080.127%204.481%2079.997s5.072-3.866%205.049-4.152l-.113-28.482s1.624-7.656%209.937-7.721%2010.002%206.942%2010.002%208.499-.909%2010.51-9.093%2010.51c-.948%200-2.99-.567-4.145-.272-3.919%201-3.194%204.554-3.194%204.554s.065%205.061%207.404%204.996%2018.575-6.034%2018.575-19.074S26.953%2030.04%2019.549%2029.91%201.234%2035.296%200%2047.169z%22%20fill%3D%22%23198754%22/%3E%3Cg%20transform%3D%22matrix%28.325601%200%200%20.325256%20-10.32669%20-45.802786%29%22%3E%3Ccircle%20cx%3D%22297.554%22%20cy%3D%22172.286%22%20r%3D%2216.5%22%20fill%3D%22%23fff%22/%3E%3Cellipse%20cx%3D%22297.709%22%20cy%3D%22172.642%22%20rx%3D%2211.071%22%20ry%3D%2210.871%22%20fill%3D%22%23105a48%22/%3E%3Ccircle%20cx%3D%22304.104%22%20cy%3D%22167.667%22%20r%3D%224.5%22%20fill%3D%22%23fff%22/%3E%3C/g%3E%3Cpath%20d%3D%22M94.661%2017.032l.893-1.476s.99.714%201.916.925%201.575.114%202.955.114l14.565-.162c1.283-.032%203.085-.762%203.02-3.293s-.373-3.503-.373-3.503l1.283-.487s.52.503.877%201.573.309%201.995.292%202.66-.227%201.541-.227%201.541%201.564-.308%202.359-1.038.823-.779%201.489-1.508.812-.86.812-.86.552-.13.877.26.341.957.065%201.46-1.672%202.206-3.247%203.066-2.76%201.427-3.929%201.768-3.848.73-7.063.714l-10.944-.114s-2.143-.081-3.02-.373-2.241-.973-2.598-1.265z%22%20fill%3D%22%23d36d49%22/%3E%3Cg%20fill%3D%22%23105a48%22%3E%3Cellipse%20cx%3D%2293.052%22%20cy%3D%2243.567%22%20rx%3D%22.869%22%20ry%3D%221.014%22%20transform%3D%22rotate%28341.022%29%22/%3E%3Cellipse%20cx%3D%22104.3%22%20cy%3D%22-16.184%22%20rx%3D%22.865%22%20ry%3D%221.009%22%20transform%3D%22rotate%2814.786%29%22/%3E%3C/g%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../webber.html">webber</a><wbr>.core    </h1>

                        <div class="docstring"><p>Base module for abstract multiprocessing system - a directed acyclic graph.</p>
</div>

                        <input id="mod-core-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-core-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">   1</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">   2</span></a><span class="sd">Base module for abstract multiprocessing system - a directed acyclic graph.</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">   3</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">   4</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">_sys</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">   5</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">_T</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">   6</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">types</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">_types</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">   7</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">traceback</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">_traceback</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">   8</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">collections.abc</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">_abc</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">   9</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">concurrent.futures</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">_futures</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos">  10</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">queue</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">_q</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos">  11</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">itertools</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">_it</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos">  12</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">threading</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">_threading</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos">  13</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span> <span class="k">as</span> <span class="n">_datetime</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos">  14</span></a>
</span><span id="L-15"><a href="#L-15"><span class="linenos">  15</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">networkx</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">_nx</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos">  16</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">webber.edges</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">_edges</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos">  17</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">webber.xcoms</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">_xcoms</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos">  18</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">webber.queue</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">_queue</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos">  19</span></a>
</span><span id="L-20"><a href="#L-20"><span class="linenos">  20</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">webber.edges</span><span class="w"> </span><span class="kn">import</span> <span class="n">Condition</span><span class="p">,</span> <span class="n">dotdict</span><span class="p">,</span> <span class="n">edgedict</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos">  21</span></a>
</span><span id="L-22"><a href="#L-22"><span class="linenos">  22</span></a><span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;DAG&quot;</span><span class="p">,</span> <span class="s2">&quot;Condition&quot;</span><span class="p">,</span> <span class="s2">&quot;QueueDAG&quot;</span><span class="p">]</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos">  23</span></a>
</span><span id="L-24"><a href="#L-24"><span class="linenos">  24</span></a><span class="k">def</span><span class="w"> </span><span class="nf">_iscallable</span><span class="p">(</span><span class="n">function</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos">  25</span></a>    <span class="k">return</span> <span class="nb">callable</span><span class="p">(</span><span class="n">function</span><span class="p">)</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos">  26</span></a>
</span><span id="L-27"><a href="#L-27"><span class="linenos">  27</span></a>
</span><span id="L-28"><a href="#L-28"><span class="linenos">  28</span></a><span class="k">class</span><span class="w"> </span><span class="nc">_OutputLogger</span><span class="p">:</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos">  29</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos">  30</span></a><span class="sd">    Thread-safe logger that uses a queue to serialize stdout writes.</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos">  31</span></a><span class="sd">    All threads put messages into a queue, a single consumer writes to stdout.</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos">  32</span></a><span class="sd">    This avoids race conditions from concurrent redirect_stdout calls.</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos">  33</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos">  34</span></a>    <span class="n">_instance</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="s1">&#39;_OutputLogger&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos">  35</span></a>    <span class="n">_lock</span> <span class="o">=</span> <span class="n">_threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos">  36</span></a>
</span><span id="L-37"><a href="#L-37"><span class="linenos">  37</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;_OutputLogger&#39;</span><span class="p">:</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos">  38</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Singleton pattern - one logger for all threads.&quot;&quot;&quot;</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos">  39</span></a>        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_instance</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos">  40</span></a>            <span class="k">with</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos">  41</span></a>                <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_instance</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos">  42</span></a>                    <span class="bp">cls</span><span class="o">.</span><span class="n">_instance</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos">  43</span></a>                    <span class="bp">cls</span><span class="o">.</span><span class="n">_instance</span><span class="o">.</span><span class="n">_initialized</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos">  44</span></a>        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_instance</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos">  45</span></a>
</span><span id="L-46"><a href="#L-46"><span class="linenos">  46</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">TextIO</span> <span class="o">=</span> <span class="n">_sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos">  47</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_initialized</span><span class="p">:</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos">  48</span></a>            <span class="k">return</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos">  49</span></a>
</span><span id="L-50"><a href="#L-50"><span class="linenos">  50</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_queue</span><span class="p">:</span> <span class="n">_q</span><span class="o">.</span><span class="n">Queue</span><span class="p">[</span><span class="n">_T</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="n">_q</span><span class="o">.</span><span class="n">Queue</span><span class="p">()</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos">  51</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_file</span> <span class="o">=</span> <span class="n">file</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos">  52</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_running</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos">  53</span></a>
</span><span id="L-54"><a href="#L-54"><span class="linenos">  54</span></a>        <span class="c1"># Start consumer thread</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos">  55</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_consumer</span> <span class="o">=</span> <span class="n">_threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_consume</span><span class="p">,</span> <span class="n">daemon</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos">  56</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_consumer</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos">  57</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_initialized</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos">  58</span></a>
</span><span id="L-59"><a href="#L-59"><span class="linenos">  59</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_consume</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos">  60</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Consumer thread - reads from queue and writes to stdout.&quot;&quot;&quot;</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos">  61</span></a>        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">_running</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_queue</span><span class="o">.</span><span class="n">empty</span><span class="p">():</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos">  62</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos">  63</span></a>                <span class="n">record</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_queue</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos">  64</span></a>                <span class="k">if</span> <span class="n">record</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># Shutdown signal</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos">  65</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_queue</span><span class="o">.</span><span class="n">task_done</span><span class="p">()</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos">  66</span></a>                    <span class="k">break</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos">  67</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">record</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos">  68</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_file</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos">  69</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_queue</span><span class="o">.</span><span class="n">task_done</span><span class="p">()</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos">  70</span></a>            <span class="k">except</span> <span class="n">_q</span><span class="o">.</span><span class="n">Empty</span><span class="p">:</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos">  71</span></a>                <span class="k">continue</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos">  72</span></a>
</span><span id="L-73"><a href="#L-73"><span class="linenos">  73</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos">  74</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Thread-safe log - puts message on queue.&quot;&quot;&quot;</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos">  75</span></a>        <span class="k">if</span> <span class="n">message</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">message</span><span class="o">.</span><span class="n">isspace</span><span class="p">():</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos">  76</span></a>            <span class="n">timestamp</span> <span class="o">=</span> <span class="n">_datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S,</span><span class="si">%f</span><span class="s2">&quot;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos">  77</span></a>            <span class="n">formatted</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">name</span><span class="si">:</span><span class="s2">&gt;15</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos">  78</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">formatted</span><span class="p">)</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos">  79</span></a>
</span><span id="L-80"><a href="#L-80"><span class="linenos">  80</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">shutdown</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos">  81</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Wait for queue to drain and stop consumer.&quot;&quot;&quot;</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos">  82</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_queue</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos">  83</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_running</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos">  84</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos">  85</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_consumer</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos">  86</span></a>
</span><span id="L-87"><a href="#L-87"><span class="linenos">  87</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos">  88</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">reset</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos">  89</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Reset singleton instance (useful for testing).&quot;&quot;&quot;</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos">  90</span></a>        <span class="k">with</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos">  91</span></a>            <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_instance</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos">  92</span></a>                <span class="bp">cls</span><span class="o">.</span><span class="n">_instance</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos">  93</span></a>                <span class="bp">cls</span><span class="o">.</span><span class="n">_instance</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos">  94</span></a>
</span><span id="L-95"><a href="#L-95"><span class="linenos">  95</span></a>
</span><span id="L-96"><a href="#L-96"><span class="linenos">  96</span></a><span class="k">class</span><span class="w"> </span><span class="nc">_PrefixedStdout</span><span class="p">:</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos">  97</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos">  98</span></a><span class="sd">    Stdout wrapper that prefixes each line with timestamp and task name.</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos">  99</span></a><span class="sd">    Thread-safe via thread-local task name storage.</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos"> 100</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos"> 101</span></a>    <span class="n">_local</span> <span class="o">=</span> <span class="n">_threading</span><span class="o">.</span><span class="n">local</span><span class="p">()</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos"> 102</span></a>
</span><span id="L-103"><a href="#L-103"><span class="linenos"> 103</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">original_stdout</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">TextIO</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos"> 104</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_original</span> <span class="o">=</span> <span class="n">original_stdout</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos"> 105</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span> <span class="o">=</span> <span class="n">_threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos"> 106</span></a>
</span><span id="L-107"><a href="#L-107"><span class="linenos"> 107</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos"> 108</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_task_name</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos"> 109</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the task name for the current thread.&quot;&quot;&quot;</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos"> 110</span></a>        <span class="bp">cls</span><span class="o">.</span><span class="n">_local</span><span class="o">.</span><span class="n">task_name</span> <span class="o">=</span> <span class="n">name</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos"> 111</span></a>
</span><span id="L-112"><a href="#L-112"><span class="linenos"> 112</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos"> 113</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_task_name</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos"> 114</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the task name for the current thread.&quot;&quot;&quot;</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos"> 115</span></a>        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">_local</span><span class="p">,</span> <span class="s1">&#39;task_name&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos"> 116</span></a>
</span><span id="L-117"><a href="#L-117"><span class="linenos"> 117</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos"> 118</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Write with timestamp/task prefix if task is set.&quot;&quot;&quot;</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos"> 119</span></a>        <span class="n">task_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_task_name</span><span class="p">()</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos"> 120</span></a>        <span class="k">if</span> <span class="n">task_name</span><span class="p">:</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos"> 121</span></a>            <span class="c1"># When in a task context, suppress standalone newlines/whitespace</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos"> 122</span></a>            <span class="c1"># (print() sends content and newline as separate write calls)</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos"> 123</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">msg</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">msg</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos"> 124</span></a>                <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="k">if</span> <span class="n">msg</span> <span class="k">else</span> <span class="mi">0</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos"> 125</span></a>            <span class="n">timestamp</span> <span class="o">=</span> <span class="n">_datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S,</span><span class="si">%f</span><span class="s2">&quot;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos"> 126</span></a>            <span class="c1"># Handle multi-line messages</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos"> 127</span></a>            <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">msg</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos"> 128</span></a>            <span class="k">if</span> <span class="n">lines</span><span class="p">:</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos"> 129</span></a>                <span class="n">formatted_lines</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">task_name</span><span class="si">:</span><span class="s2">&gt;15</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">line</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">]</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos"> 130</span></a>                <span class="n">formatted</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">formatted_lines</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos"> 131</span></a>                <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos"> 132</span></a>                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_original</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">formatted</span><span class="p">)</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos"> 133</span></a>            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos"> 134</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos"> 135</span></a>            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos"> 136</span></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_original</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos"> 137</span></a>
</span><span id="L-138"><a href="#L-138"><span class="linenos"> 138</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">flush</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos"> 139</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_original</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos"> 140</span></a>
</span><span id="L-141"><a href="#L-141"><span class="linenos"> 141</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">:</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos"> 142</span></a>        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_original</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos"> 143</span></a>
</span><span id="L-144"><a href="#L-144"><span class="linenos"> 144</span></a>
</span><span id="L-145"><a href="#L-145"><span class="linenos"> 145</span></a><span class="c1"># Install prefixed stdout globally (once)</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos"> 146</span></a><span class="n">_original_stdout</span> <span class="o">=</span> <span class="n">_sys</span><span class="o">.</span><span class="n">stdout</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos"> 147</span></a><span class="n">_prefixed_stdout</span> <span class="o">=</span> <span class="n">_PrefixedStdout</span><span class="p">(</span><span class="n">_original_stdout</span><span class="p">)</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos"> 148</span></a>
</span><span id="L-149"><a href="#L-149"><span class="linenos"> 149</span></a>
</span><span id="L-150"><a href="#L-150"><span class="linenos"> 150</span></a><span class="k">class</span><span class="w"> </span><span class="nc">_TaskLogger</span><span class="p">:</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos"> 151</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos"> 152</span></a><span class="sd">    Per-task logger context manager that sets up stdout prefixing.</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos"> 153</span></a><span class="sd">    Used as a context manager for each task execution.</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos"> 154</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos"> 155</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos"> 156</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">task_name</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos"> 157</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_prev_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos"> 158</span></a>
</span><span id="L-159"><a href="#L-159"><span class="linenos"> 159</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;_TaskLogger&#39;</span><span class="p">:</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos"> 160</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_prev_name</span> <span class="o">=</span> <span class="n">_PrefixedStdout</span><span class="o">.</span><span class="n">get_task_name</span><span class="p">()</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos"> 161</span></a>        <span class="n">_PrefixedStdout</span><span class="o">.</span><span class="n">set_task_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">)</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos"> 162</span></a>        <span class="n">_sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">_prefixed_stdout</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos"> 163</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos"> 164</span></a>
</span><span id="L-165"><a href="#L-165"><span class="linenos"> 165</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__exit__</span><span class="p">(</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos"> 166</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos"> 167</span></a>        <span class="n">exc_type</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="ne">BaseException</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos"> 168</span></a>        <span class="n">exc_value</span><span class="p">:</span> <span class="ne">BaseException</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos"> 169</span></a>        <span class="n">traceback</span><span class="p">:</span> <span class="n">_types</span><span class="o">.</span><span class="n">TracebackType</span> <span class="o">|</span> <span class="kc">None</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos"> 170</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos"> 171</span></a>        <span class="n">_PrefixedStdout</span><span class="o">.</span><span class="n">set_task_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_prev_name</span><span class="p">)</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos"> 172</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prev_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos"> 173</span></a>            <span class="n">_sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">_original_stdout</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos"> 174</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos"> 175</span></a>
</span><span id="L-176"><a href="#L-176"><span class="linenos"> 176</span></a>
</span><span id="L-177"><a href="#L-177"><span class="linenos"> 177</span></a><span class="k">def</span><span class="w"> </span><span class="nf">_event_wrapper</span><span class="p">(</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos"> 178</span></a>    <span class="n">_callable</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Callable</span><span class="p">,</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos"> 179</span></a>    <span class="n">_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos"> 180</span></a>    <span class="n">_args</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">],</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos"> 181</span></a>    <span class="n">_kwargs</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">],</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos"> 182</span></a>    <span class="n">_verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos"> 183</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">:</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos"> 184</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Wrapper used by Webber DAGs to log and execute Python callables as a unit of work.&quot;&quot;&quot;</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos"> 185</span></a>    <span class="k">if</span> <span class="n">_verbose</span><span class="p">:</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos"> 186</span></a>        <span class="k">with</span> <span class="n">_TaskLogger</span><span class="p">(</span><span class="n">_name</span><span class="p">):</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos"> 187</span></a>            <span class="c1"># print(f&quot;Starting {_name}&quot;, flush=True)</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos"> 188</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="n">_callable</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kwargs</span><span class="p">)</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos"> 189</span></a>            <span class="c1"># print(f&quot;Completed {_name}&quot;, flush=True)</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos"> 190</span></a>            <span class="k">return</span> <span class="n">result</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos"> 191</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos"> 192</span></a>        <span class="k">return</span> <span class="n">_callable</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kwargs</span><span class="p">)</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos"> 193</span></a>
</span><span id="L-194"><a href="#L-194"><span class="linenos"> 194</span></a><span class="k">class</span><span class="w"> </span><span class="nc">DAG</span><span class="p">:</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos"> 195</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos"> 196</span></a><span class="sd">    Directed Acyclic Graph used to represent Pythonic tasks in parallel.</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos"> 197</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos"> 198</span></a>    <span class="n">graph</span><span class="p">:</span> <span class="n">_nx</span><span class="o">.</span><span class="n">DiGraph</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos"> 199</span></a>    <span class="n">_callable_to_id</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="n">_T</span><span class="o">.</span><span class="n">Callable</span><span class="p">,</span> <span class="n">_T</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span>  <span class="c1"># O(1) callable-&gt;node_id lookup cache (None = duplicates)</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos"> 200</span></a>
</span><span id="L-201"><a href="#L-201"><span class="linenos"> 201</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_callable_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Callable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_T</span><span class="o">.</span><span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;many&#39;</span><span class="p">]:</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos"> 202</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns &#39;none&#39; if not in DAG, &#39;one&#39; if unique, &#39;many&#39; if duplicated.</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos"> 203</span></a><span class="sd">        O(1) lookup using _callable_to_id cache.&quot;&quot;&quot;</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos"> 204</span></a>        <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_callable_to_id</span><span class="p">:</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos"> 205</span></a>            <span class="k">return</span> <span class="s1">&#39;none&#39;</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos"> 206</span></a>        <span class="k">return</span> <span class="s1">&#39;one&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_callable_to_id</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s1">&#39;many&#39;</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos"> 207</span></a>
</span><span id="L-208"><a href="#L-208"><span class="linenos"> 208</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_assign_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">,</span> <span class="n">new_callables</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="n">_T</span><span class="o">.</span><span class="n">Callable</span><span class="p">,</span> <span class="n">_T</span><span class="o">.</span><span class="n">Callable</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos"> 209</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Helper to resolve node to its ID, adding to new_callables dict if needed.&quot;&quot;&quot;</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos"> 210</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">_iscallable</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos"> 211</span></a>            <span class="k">return</span> <span class="n">n</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos"> 212</span></a>        <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_callable_status</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos"> 213</span></a>        <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="s1">&#39;many&#39;</span><span class="p">:</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos"> 214</span></a>            <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Callable </span><span class="si">{</span><span class="n">n</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> &quot;</span> \
</span><span id="L-215"><a href="#L-215"><span class="linenos"> 215</span></a>                <span class="o">+</span> <span class="s2">&quot;exists more than once in this DAG. &quot;</span> \
</span><span id="L-216"><a href="#L-216"><span class="linenos"> 216</span></a>                <span class="o">+</span> <span class="s2">&quot;Use the unique string identifier of the required node.&quot;</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos"> 217</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos"> 218</span></a>        <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="s1">&#39;one&#39;</span><span class="p">:</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos"> 219</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_callable_to_id</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>  <span class="c1"># type: ignore[return-value]</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos"> 220</span></a>        <span class="n">new_callables</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">n</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos"> 221</span></a>        <span class="k">return</span> <span class="n">_edges</span><span class="o">.</span><span class="n">label_node</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos"> 222</span></a>
</span><span id="L-223"><a href="#L-223"><span class="linenos"> 223</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos"> 224</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos"> 225</span></a><span class="sd">        Adds a callable with positional and keyword arguments to the DAG&#39;s underlying graph.</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos"> 226</span></a><span class="sd">        On success, return unique identifier for the new node.</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos"> 227</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos"> 228</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">_iscallable</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos"> 229</span></a>            <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">: requested node is not a callable Python function.&quot;</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos"> 230</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos"> 231</span></a>
</span><span id="L-232"><a href="#L-232"><span class="linenos"> 232</span></a>        <span class="n">node_name</span> <span class="o">=</span> <span class="n">_edges</span><span class="o">.</span><span class="n">label_node</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos"> 233</span></a>
</span><span id="L-234"><a href="#L-234"><span class="linenos"> 234</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos"> 235</span></a>            <span class="n">arg</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">_xcoms</span><span class="o">.</span><span class="n">Promise</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolve_promise</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos"> 236</span></a>            <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos"> 237</span></a>        <span class="p">)</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos"> 238</span></a>
</span><span id="L-239"><a href="#L-239"><span class="linenos"> 239</span></a>        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos"> 240</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">_xcoms</span><span class="o">.</span><span class="n">Promise</span><span class="p">):</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos"> 241</span></a>                <span class="n">kwargs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolve_promise</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos"> 242</span></a>
</span><span id="L-243"><a href="#L-243"><span class="linenos"> 243</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos"> 244</span></a>            <span class="n">node_for_adding</span><span class="o">=</span><span class="n">node_name</span><span class="p">,</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos"> 245</span></a>            <span class="nb">callable</span><span class="o">=</span><span class="n">node</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos"> 246</span></a>            <span class="n">name</span><span class="o">=</span><span class="n">node</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos"> 247</span></a>            <span class="nb">id</span><span class="o">=</span><span class="n">node_name</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos"> 248</span></a>        <span class="p">)</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos"> 249</span></a>
</span><span id="L-250"><a href="#L-250"><span class="linenos"> 250</span></a>        <span class="c1"># Populate callable-&gt;id cache for O(1) lookup</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos"> 251</span></a>        <span class="c1"># If callable already exists, mark as None to indicate duplicates</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos"> 252</span></a>        <span class="k">if</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_callable_to_id</span><span class="p">:</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos"> 253</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_callable_to_id</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Multiple occurrences - must use string ID</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos"> 254</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos"> 255</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_callable_to_id</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">node_name</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos"> 256</span></a>
</span><span id="L-257"><a href="#L-257"><span class="linenos"> 257</span></a>        <span class="k">return</span> <span class="n">node_name</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos"> 258</span></a>
</span><span id="L-259"><a href="#L-259"><span class="linenos"> 259</span></a>
</span><span id="L-260"><a href="#L-260"><span class="linenos"> 260</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_edge</span><span class="p">(</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos"> 261</span></a>            <span class="bp">self</span><span class="p">,</span> 
</span><span id="L-262"><a href="#L-262"><span class="linenos"> 262</span></a>            <span class="n">u_of_edge</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_T</span><span class="o">.</span><span class="n">Callable</span><span class="p">],</span> <span class="n">v_of_edge</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_T</span><span class="o">.</span><span class="n">Callable</span><span class="p">],</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos"> 263</span></a>            <span class="n">continue_on</span><span class="p">:</span> <span class="n">Condition</span> <span class="o">=</span> <span class="n">Condition</span><span class="o">.</span><span class="n">Success</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos"> 264</span></a>        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_T</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos"> 265</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos"> 266</span></a><span class="sd">        Adds an edge between nodes in the DAG&#39;s underlying graph,</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos"> 267</span></a><span class="sd">        so long as the requested edge is unique and has not been added previously.</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos"> 268</span></a>
</span><span id="L-269"><a href="#L-269"><span class="linenos"> 269</span></a><span class="sd">        On success, returns Tuple of the new edge&#39;s unique identifiers.</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos"> 270</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos"> 271</span></a>        <span class="c1"># Validate inputs prior to execution</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos"> 272</span></a>        <span class="c1"># - Nodes must be identifiers or callables</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos"> 273</span></a>        <span class="c1"># - Conditions must belong to the webber.edges.Condition class</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos"> 274</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">u_of_edge</span><span class="p">,</span><span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="n">_iscallable</span><span class="p">(</span><span class="n">u_of_edge</span><span class="p">)):</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos"> 275</span></a>            <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Outgoing node </span><span class="si">{</span><span class="n">u_of_edge</span><span class="si">}</span><span class="s2"> must be a string or a Python callable&quot;</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos"> 276</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos"> 277</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">v_of_edge</span><span class="p">,</span><span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="n">_iscallable</span><span class="p">(</span><span class="n">v_of_edge</span><span class="p">)):</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos"> 278</span></a>            <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Outgoing node </span><span class="si">{</span><span class="n">v_of_edge</span><span class="si">}</span><span class="s2"> must be a string or a Python callable&quot;</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos"> 279</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos"> 280</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">continue_on</span><span class="p">,</span> <span class="n">Condition</span><span class="p">):</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos"> 281</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Edge conditions must use the webber.edges.Condition class.&quot;</span><span class="p">)</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos"> 282</span></a>
</span><span id="L-283"><a href="#L-283"><span class="linenos"> 283</span></a>        <span class="c1"># Base Case 0: No nodes are present in the DAG:</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos"> 284</span></a>        <span class="c1"># Ensure that both nodes are callables, then add both to the graph and</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos"> 285</span></a>        <span class="c1"># assign the outgoing node as a root.</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos"> 286</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos"> 287</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">_iscallable</span><span class="p">(</span><span class="n">u_of_edge</span><span class="p">):</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos"> 288</span></a>                <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Outgoing node </span><span class="si">{</span><span class="n">u_of_edge</span><span class="si">}</span><span class="s2"> is not defined in this DAG&#39;s scope.&quot;</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos"> 289</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos"> 290</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">_iscallable</span><span class="p">(</span><span class="n">v_of_edge</span><span class="p">):</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos"> 291</span></a>                <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Incoming node </span><span class="si">{</span><span class="n">v_of_edge</span><span class="si">}</span><span class="s2"> is not defined in this DAG&#39;s scope.&quot;</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos"> 292</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos"> 293</span></a>            <span class="n">outgoing_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">u_of_edge</span><span class="p">)</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos"> 294</span></a>            <span class="n">incoming_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">v_of_edge</span><span class="p">)</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos"> 295</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">outgoing_node</span><span class="p">,</span> <span class="n">incoming_node</span><span class="p">,</span> <span class="n">Condition</span> <span class="o">=</span> <span class="n">continue_on</span><span class="p">)</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos"> 296</span></a>            <span class="k">return</span> <span class="p">(</span><span class="n">outgoing_node</span><span class="p">,</span> <span class="n">incoming_node</span><span class="p">)</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos"> 297</span></a>
</span><span id="L-298"><a href="#L-298"><span class="linenos"> 298</span></a>        <span class="n">new_callables</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="n">_T</span><span class="o">.</span><span class="n">Callable</span><span class="p">,</span> <span class="n">_T</span><span class="o">.</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos"> 299</span></a>
</span><span id="L-300"><a href="#L-300"><span class="linenos"> 300</span></a>        <span class="k">if</span> <span class="n">_iscallable</span><span class="p">(</span><span class="n">u_of_edge</span><span class="p">)</span> <span class="ow">and</span> <span class="n">_iscallable</span><span class="p">(</span><span class="n">v_of_edge</span><span class="p">):</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos"> 301</span></a>            <span class="c1"># Type narrowing: we&#39;ve verified both are callables</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos"> 302</span></a>            <span class="n">u_callable</span> <span class="o">=</span> <span class="n">_T</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">_T</span><span class="o">.</span><span class="n">Callable</span><span class="p">,</span> <span class="n">u_of_edge</span><span class="p">)</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos"> 303</span></a>            <span class="n">v_callable</span> <span class="o">=</span> <span class="n">_T</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">_T</span><span class="o">.</span><span class="n">Callable</span><span class="p">,</span> <span class="n">v_of_edge</span><span class="p">)</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos"> 304</span></a>
</span><span id="L-305"><a href="#L-305"><span class="linenos"> 305</span></a>            <span class="c1"># Error Cases 0, 1: Either of the callables appear more than once in the DAG.</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos"> 306</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_callable_status</span><span class="p">(</span><span class="n">u_callable</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;many&#39;</span><span class="p">:</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos"> 307</span></a>                <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Callable </span><span class="si">{</span><span class="n">u_callable</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> &quot;</span> \
</span><span id="L-308"><a href="#L-308"><span class="linenos"> 308</span></a>                        <span class="o">+</span> <span class="s2">&quot;exists more than once in this DAG. &quot;</span> \
</span><span id="L-309"><a href="#L-309"><span class="linenos"> 309</span></a>                        <span class="o">+</span> <span class="s2">&quot;Use the unique string identifier of the required node.&quot;</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos"> 310</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos"> 311</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_callable_status</span><span class="p">(</span><span class="n">v_callable</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;many&#39;</span><span class="p">:</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos"> 312</span></a>                <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Callable </span><span class="si">{</span><span class="n">v_callable</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> &quot;</span> \
</span><span id="L-313"><a href="#L-313"><span class="linenos"> 313</span></a>                        <span class="o">+</span> <span class="s2">&quot;exists more than once in this DAG. &quot;</span> \
</span><span id="L-314"><a href="#L-314"><span class="linenos"> 314</span></a>                        <span class="o">+</span> <span class="s2">&quot;Use the unique string identifier of the required node.&quot;</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos"> 315</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos"> 316</span></a>
</span><span id="L-317"><a href="#L-317"><span class="linenos"> 317</span></a>            <span class="c1"># Base Case 1: Both args are callables and will be present in the DAG scope no more than once.</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos"> 318</span></a>            <span class="c1"># We will create new nodes if necessary, after validation, and get the unique string identifiers of the nodes.</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos"> 319</span></a>            <span class="n">cached_u</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_callable_to_id</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">u_callable</span><span class="p">)</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos"> 320</span></a>            <span class="k">if</span> <span class="n">cached_u</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos"> 321</span></a>                <span class="n">outgoing_node</span> <span class="o">=</span> <span class="n">cached_u</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos"> 322</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos"> 323</span></a>                <span class="n">new_callables</span><span class="p">[</span><span class="n">u_callable</span><span class="p">]</span> <span class="o">=</span> <span class="n">u_callable</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos"> 324</span></a>                <span class="n">outgoing_node</span> <span class="o">=</span> <span class="n">_edges</span><span class="o">.</span><span class="n">label_node</span><span class="p">(</span><span class="n">u_callable</span><span class="p">)</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos"> 325</span></a>
</span><span id="L-326"><a href="#L-326"><span class="linenos"> 326</span></a>            <span class="n">cached_v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_callable_to_id</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">v_callable</span><span class="p">)</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos"> 327</span></a>            <span class="k">if</span> <span class="n">cached_v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos"> 328</span></a>                <span class="n">incoming_node</span> <span class="o">=</span> <span class="n">cached_v</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos"> 329</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos"> 330</span></a>                <span class="n">new_callables</span><span class="p">[</span><span class="n">v_callable</span><span class="p">]</span> <span class="o">=</span> <span class="n">v_callable</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos"> 331</span></a>                <span class="n">incoming_node</span> <span class="o">=</span> <span class="n">_edges</span><span class="o">.</span><span class="n">label_node</span><span class="p">(</span><span class="n">v_callable</span><span class="p">)</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos"> 332</span></a>
</span><span id="L-333"><a href="#L-333"><span class="linenos"> 333</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos"> 334</span></a>
</span><span id="L-335"><a href="#L-335"><span class="linenos"> 335</span></a>            <span class="c1"># Error Cases 2, 3: Either of the requested IDs are not in the DAG&#39;s current scope.</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos"> 336</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">u_of_edge</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">u_of_edge</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos"> 337</span></a>                <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Outgoing node </span><span class="si">{</span><span class="n">u_of_edge</span><span class="si">}</span><span class="s2"> not in DAG&#39;s current scope.&quot;</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos"> 338</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos"> 339</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v_of_edge</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">v_of_edge</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos"> 340</span></a>                <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Incoming node </span><span class="si">{</span><span class="n">v_of_edge</span><span class="si">}</span><span class="s2"> not in DAG&#39;s current scope.&quot;</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos"> 341</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos"> 342</span></a>
</span><span id="L-343"><a href="#L-343"><span class="linenos"> 343</span></a>            <span class="c1"># Both nodes&#39; unique identifiers are present in the DAG</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos"> 344</span></a>            <span class="c1"># and should be evaluated for a valid edge.</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos"> 345</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">u_of_edge</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v_of_edge</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos"> 346</span></a>                <span class="n">outgoing_node</span> <span class="o">=</span> <span class="n">u_of_edge</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos"> 347</span></a>                <span class="n">incoming_node</span> <span class="o">=</span> <span class="n">v_of_edge</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos"> 348</span></a>
</span><span id="L-349"><a href="#L-349"><span class="linenos"> 349</span></a>            <span class="c1"># Otherwise, one of the nodes is a callable, and the other is a valid unique identifier.</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos"> 350</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos"> 351</span></a>                <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="p">(</span><span class="n">u_of_edge</span><span class="p">,</span> <span class="n">v_of_edge</span><span class="p">):</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos"> 352</span></a>                    <span class="k">if</span> <span class="n">node</span> <span class="o">==</span> <span class="n">u_of_edge</span><span class="p">:</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos"> 353</span></a>                        <span class="n">outgoing_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_assign_node</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">new_callables</span><span class="p">)</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos"> 354</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos"> 355</span></a>                        <span class="n">incoming_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_assign_node</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">new_callables</span><span class="p">)</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos"> 356</span></a>
</span><span id="L-357"><a href="#L-357"><span class="linenos"> 357</span></a>        <span class="c1"># Error Case 5: Both callables exist only once in the DAG,</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos"> 358</span></a>        <span class="c1"># but an edge already exists between them. O(1) lookup with has_edge().</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos"> 359</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">has_edge</span><span class="p">(</span><span class="n">outgoing_node</span><span class="p">,</span> <span class="n">incoming_node</span><span class="p">):</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos"> 360</span></a>            <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Requested edge (</span><span class="si">{</span><span class="n">outgoing_node</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">incoming_node</span><span class="si">}</span><span class="s2">) already has &quot;</span> \
</span><span id="L-361"><a href="#L-361"><span class="linenos"> 361</span></a>                    <span class="o">+</span> <span class="s2">&quot;a definition in this DAG.&quot;</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos"> 362</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos"> 363</span></a>
</span><span id="L-364"><a href="#L-364"><span class="linenos"> 364</span></a>        <span class="c1"># Error Case 6: Adding an edge would create circular dependencies.</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos"> 365</span></a>        <span class="c1"># Use has_path() for O(V+E) incremental check instead of rebuilding entire graph.</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos"> 366</span></a>        <span class="k">if</span> <span class="n">incoming_node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="ow">and</span> <span class="n">_nx</span><span class="o">.</span><span class="n">has_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="p">,</span> <span class="n">incoming_node</span><span class="p">,</span> <span class="n">outgoing_node</span><span class="p">):</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos"> 367</span></a>            <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Requested edge (</span><span class="si">{</span><span class="n">outgoing_node</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">incoming_node</span><span class="si">}</span><span class="s2">) &quot;</span> \
</span><span id="L-368"><a href="#L-368"><span class="linenos"> 368</span></a>                    <span class="o">+</span> <span class="s2">&quot;results in circular dependencies.&quot;</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos"> 369</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos"> 370</span></a>
</span><span id="L-371"><a href="#L-371"><span class="linenos"> 371</span></a>        <span class="c1"># We can now add the edge to the DAG, since we are certain it will not result in</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos"> 372</span></a>        <span class="c1"># illegal dependencies/behavior.</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos"> 373</span></a>        <span class="c1"># First, we should account for potential new nodes. This also handles</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos"> 374</span></a>        <span class="c1"># duplicates on first entry to the DAG (e.g.: edge == (print, print))</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos"> 375</span></a>        <span class="k">if</span> <span class="n">_iscallable</span><span class="p">(</span><span class="n">u_of_edge</span><span class="p">)</span> <span class="ow">and</span> <span class="n">new_callables</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">_T</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">_T</span><span class="o">.</span><span class="n">Callable</span><span class="p">,</span> <span class="n">u_of_edge</span><span class="p">))</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos"> 376</span></a>            <span class="n">outgoing_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">new_callables</span><span class="p">[</span><span class="n">_T</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">_T</span><span class="o">.</span><span class="n">Callable</span><span class="p">,</span> <span class="n">u_of_edge</span><span class="p">)])</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos"> 377</span></a>        <span class="k">if</span> <span class="n">_iscallable</span><span class="p">(</span><span class="n">v_of_edge</span><span class="p">)</span> <span class="ow">and</span> <span class="n">new_callables</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">_T</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">_T</span><span class="o">.</span><span class="n">Callable</span><span class="p">,</span> <span class="n">v_of_edge</span><span class="p">))</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos"> 378</span></a>            <span class="n">incoming_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">new_callables</span><span class="p">[</span><span class="n">_T</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">_T</span><span class="o">.</span><span class="n">Callable</span><span class="p">,</span> <span class="n">v_of_edge</span><span class="p">)])</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos"> 379</span></a>
</span><span id="L-380"><a href="#L-380"><span class="linenos"> 380</span></a>        <span class="c1"># Then we can add the new edge.</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos"> 381</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">outgoing_node</span><span class="p">,</span> <span class="n">incoming_node</span><span class="p">,</span> <span class="n">Condition</span> <span class="o">=</span> <span class="n">continue_on</span><span class="p">)</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos"> 382</span></a>        <span class="k">return</span> <span class="p">(</span><span class="n">outgoing_node</span><span class="p">,</span> <span class="n">incoming_node</span><span class="p">)</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos"> 383</span></a>    
</span><span id="L-384"><a href="#L-384"><span class="linenos"> 384</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">remove_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">posargs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos"> 385</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos"> 386</span></a><span class="sd">        Currently out-of-scope. Node-removal can lead to unexpected behavior in a DAG.</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos"> 387</span></a><span class="sd">        Throws error message and recommends safer methods.</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos"> 388</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos"> 389</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Node removals can lead to unexpected behavior in a DAG without special care. Please consider using the skip_node operation or define a new DAG to achieve the same effect.&quot;</span><span class="p">)</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos"> 390</span></a>
</span><span id="L-391"><a href="#L-391"><span class="linenos"> 391</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">remove_edge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">u_of_edge</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span><span class="n">_T</span><span class="o">.</span><span class="n">Callable</span><span class="p">],</span> <span class="n">v_of_edge</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span><span class="n">_T</span><span class="o">.</span><span class="n">Callable</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">_T</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos"> 392</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos"> 393</span></a><span class="sd">        Removes an directed edge between nodes in the DAG&#39;s underlying graph.</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos"> 394</span></a><span class="sd">        Throws error if the edge does not exist.</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos"> 395</span></a><span class="sd">        On success, returns Tuple of the removed edge&#39;s unique identifiers.</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos"> 396</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos"> 397</span></a>        <span class="n">edge_id</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node_id</span><span class="p">(</span><span class="n">u_of_edge</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_id</span><span class="p">(</span><span class="n">v_of_edge</span><span class="p">))</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos"> 398</span></a>        <span class="k">if</span> <span class="n">edge_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos"> 399</span></a>            <span class="n">err_msg</span> <span class="o">=</span> <span class="s2">&quot;Requested edge does not exist in the DAG&#39;s scope&quot;</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos"> 400</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos"> 401</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">remove_edge</span><span class="p">(</span><span class="n">edge_id</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">edge_id</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos"> 402</span></a>        <span class="k">return</span> <span class="n">edge_id</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos"> 403</span></a>
</span><span id="L-404"><a href="#L-404"><span class="linenos"> 404</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">update_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">E</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">,</span> <span class="n">continue_on</span><span class="p">:</span> <span class="n">Condition</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">filter</span><span class="p">:</span> <span class="n">_types</span><span class="o">.</span><span class="n">LambdaType</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="n">edgedict</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos"> 405</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos"> 406</span></a><span class="sd">        Flexible function to update properties of edges in the DAG&#39;s scope, </span>
</span><span id="L-407"><a href="#L-407"><span class="linenos"> 407</span></a><span class="sd">        based on unique identifier(s) (e.g.: string IDs or unique callables) or a</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos"> 408</span></a><span class="sd">        lambda filter using the edgedict syntax.</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos"> 409</span></a><span class="sd">        </span>
</span><span id="L-410"><a href="#L-410"><span class="linenos"> 410</span></a><span class="sd">        List of nodes to update or filter argument is expected. Valid edge lists include:</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos"> 411</span></a>
</span><span id="L-412"><a href="#L-412"><span class="linenos"> 412</span></a><span class="sd">        \t update_edges((node1, node2), ...)       or update_edges([(node1, node2)], ...)</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos"> 413</span></a>
</span><span id="L-414"><a href="#L-414"><span class="linenos"> 414</span></a><span class="sd">        \t update_edges((node1, callable2), ...)   or update_edges([(node1, callable2)], ...)</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos"> 415</span></a><span class="sd">        </span>
</span><span id="L-416"><a href="#L-416"><span class="linenos"> 416</span></a><span class="sd">        \t update_edges(edgedict),                 where isinstance(edgedict, webber.edges.edgedict) == True</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos"> 417</span></a>
</span><span id="L-418"><a href="#L-418"><span class="linenos"> 418</span></a><span class="sd">        Parameters:</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos"> 419</span></a>
</span><span id="L-420"><a href="#L-420"><span class="linenos"> 420</span></a><span class="sd">        &gt; continue_on: webber.edges.Condition value to update matching edges with, </span>
</span><span id="L-421"><a href="#L-421"><span class="linenos"> 421</span></a><span class="sd">        </span>
</span><span id="L-422"><a href="#L-422"><span class="linenos"> 422</span></a><span class="sd">        \t Execute child on success, failure, or any exit state, of the parent node</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos"> 423</span></a>
</span><span id="L-424"><a href="#L-424"><span class="linenos"> 424</span></a><span class="sd">        &gt; filter: lambda property that can be used instead of a list of edges to be updated.</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos"> 425</span></a><span class="sd">        </span>
</span><span id="L-426"><a href="#L-426"><span class="linenos"> 426</span></a><span class="sd">        \t filter = (lambda e: n.parent == print or e.child == print)</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos"> 427</span></a>
</span><span id="L-428"><a href="#L-428"><span class="linenos"> 428</span></a><span class="sd">        &gt; data: If given, expects a dictionary or edgedict to update edge properties. Currently, only continue_on property should be set.</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos"> 429</span></a>
</span><span id="L-430"><a href="#L-430"><span class="linenos"> 430</span></a><span class="sd">        \t data = { &#39;continue_on&#39;: webber.edges.Condition }</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos"> 431</span></a>
</span><span id="L-432"><a href="#L-432"><span class="linenos"> 432</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos"> 433</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">E</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">filter</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos"> 434</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Either an array of edge IDs / edgedicts (E) or a filter must be passed to this function.&quot;</span><span class="p">)</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos"> 435</span></a>
</span><span id="L-436"><a href="#L-436"><span class="linenos"> 436</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="n">edgedict</span><span class="p">):</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos"> 437</span></a>            <span class="n">E</span> <span class="o">=</span> <span class="p">[</span><span class="n">E</span><span class="p">]</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos"> 438</span></a>
</span><span id="L-439"><a href="#L-439"><span class="linenos"> 439</span></a>        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">E</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">E</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">_abc</span><span class="o">.</span><span class="n">Iterable</span><span class="p">):</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos"> 440</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos"> 441</span></a>                <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_edges</span><span class="p">(</span><span class="n">E</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos"> 442</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos"> 443</span></a>                <span class="n">E</span> <span class="o">=</span> <span class="n">E</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos"> 444</span></a>
</span><span id="L-445"><a href="#L-445"><span class="linenos"> 445</span></a>        <span class="k">if</span> <span class="nb">filter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos"> 446</span></a>            <span class="n">edge_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_edges</span><span class="p">(</span><span class="nb">filter</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos"> 447</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos"> 448</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">E</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">E</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">edgedict</span><span class="p">):</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos"> 449</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos"> 450</span></a>                    <span class="n">ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">E</span><span class="p">]</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos"> 451</span></a>                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos"> 452</span></a>                    <span class="n">err_msg</span> <span class="o">=</span> <span class="s1">&#39;In dictionary form, all given edges must be follow edgedict standards.&#39;</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos"> 453</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos"> 454</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos"> 455</span></a>                <span class="n">ids</span> <span class="o">=</span> <span class="n">E</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos"> 456</span></a>            <span class="n">edge_ids</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_edge</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">data</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ids</span><span class="p">]</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos"> 457</span></a>
</span><span id="L-458"><a href="#L-458"><span class="linenos"> 458</span></a>        <span class="n">std_update</span> <span class="o">=</span> <span class="p">(</span><span class="n">continue_on</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos"> 459</span></a>
</span><span id="L-460"><a href="#L-460"><span class="linenos"> 460</span></a>        <span class="k">if</span> <span class="n">std_update</span><span class="p">:</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos"> 461</span></a>            <span class="k">for</span> <span class="n">edge_id</span><span class="p">,</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">edge_ids</span><span class="p">,</span> <span class="n">E</span><span class="p">):</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos"> 462</span></a>                <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos"> 463</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_update_edge</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">id</span> <span class="o">=</span> <span class="n">edge_id</span><span class="p">)</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos"> 464</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos"> 465</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_update_edge</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="nb">id</span> <span class="o">=</span> <span class="n">edge_id</span><span class="p">)</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos"> 466</span></a>        
</span><span id="L-467"><a href="#L-467"><span class="linenos"> 467</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos"> 468</span></a>            <span class="k">if</span> <span class="n">continue_on</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos"> 469</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">continue_on</span><span class="p">,</span> <span class="n">Condition</span><span class="p">):</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos"> 470</span></a>                    <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Condition assignment must use webber.edges.Condition&quot;</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos"> 471</span></a>                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos"> 472</span></a>                <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">edge_ids</span><span class="p">:</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos"> 473</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;Condition&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">continue_on</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos"> 474</span></a>
</span><span id="L-475"><a href="#L-475"><span class="linenos"> 475</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_update_edge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edgedict</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">],</span> <span class="nb">id</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos"> 476</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos"> 477</span></a><span class="sd">        Internal only. Update properties of an individual edge within a DAG&#39;s scope, </span>
</span><span id="L-478"><a href="#L-478"><span class="linenos"> 478</span></a><span class="sd">        given a well-structured dictionary and the tuple identifier of the network edge. </span>
</span><span id="L-479"><a href="#L-479"><span class="linenos"> 479</span></a><span class="sd">        Force argument bypasses validation, and should only be used internally.</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos"> 480</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos"> 481</span></a>        <span class="k">if</span> <span class="nb">id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos"> 482</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-483"><a href="#L-483"><span class="linenos"> 483</span></a>                <span class="k">if</span> <span class="n">edgedict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">id</span> <span class="o">!=</span> <span class="n">edgedict</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]:</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos"> 484</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Given ID </span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s2"> inconsistent with dictionary identifier: </span><span class="si">{</span><span class="n">edgedict</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos"> 485</span></a>            <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos"> 486</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">force</span><span class="p">:</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos"> 487</span></a>                    <span class="k">raise</span> <span class="n">e</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos"> 488</span></a>            <span class="n">edgedict</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">id</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos"> 489</span></a>
</span><span id="L-490"><a href="#L-490"><span class="linenos"> 490</span></a>        <span class="n">expected_keys</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;parent&#39;</span><span class="p">,</span> <span class="s1">&#39;child&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;continue_on&#39;</span><span class="p">)</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos"> 491</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">set</span><span class="p">(</span><span class="n">expected_keys</span><span class="p">)</span><span class="o">.</span><span class="n">issuperset</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">edgedict</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos"> 492</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Expecting keys: </span><span class="si">{</span><span class="n">expected_keys</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos"> 493</span></a>
</span><span id="L-494"><a href="#L-494"><span class="linenos"> 494</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">force</span><span class="p">:</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos"> 495</span></a>            
</span><span id="L-496"><a href="#L-496"><span class="linenos"> 496</span></a>            <span class="n">e1</span><span class="p">,</span> <span class="n">e2</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos"> 497</span></a>
</span><span id="L-498"><a href="#L-498"><span class="linenos"> 498</span></a>            <span class="k">if</span> <span class="n">edgedict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">):</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos"> 499</span></a>                <span class="n">e1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_edge</span><span class="p">(</span><span class="n">edgedict</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span> <span class="n">data</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos"> 500</span></a>
</span><span id="L-501"><a href="#L-501"><span class="linenos"> 501</span></a>            <span class="k">if</span> <span class="n">edgedict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;parent&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">edgedict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;child&#39;</span><span class="p">):</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos"> 502</span></a>                <span class="n">e2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_edge</span><span class="p">(</span><span class="n">edgedict</span><span class="p">[</span><span class="s1">&#39;parent&#39;</span><span class="p">],</span> <span class="n">edgedict</span><span class="p">[</span><span class="s1">&#39;child&#39;</span><span class="p">],</span> <span class="n">data</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos"> 503</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos"> 504</span></a>                <span class="n">e2</span> <span class="o">=</span> <span class="n">e1</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos"> 505</span></a>
</span><span id="L-506"><a href="#L-506"><span class="linenos"> 506</span></a>            <span class="k">if</span> <span class="n">e1</span> <span class="o">!=</span> <span class="n">e2</span><span class="p">:</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos"> 507</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Edge vertices should not be changed using update functions.&#39;</span><span class="p">)</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos"> 508</span></a>            
</span><span id="L-509"><a href="#L-509"><span class="linenos"> 509</span></a>            <span class="k">elif</span> <span class="n">e1</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos"> 510</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Requested edge was not given an identifier.&#39;</span><span class="p">)</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos"> 511</span></a>
</span><span id="L-512"><a href="#L-512"><span class="linenos"> 512</span></a>            <span class="k">if</span> <span class="n">edgedict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;continue_on&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">edgedict</span><span class="p">[</span><span class="s1">&#39;continue_on&#39;</span><span class="p">],</span> <span class="n">Condition</span><span class="p">):</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos"> 513</span></a>                <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Condition assignment must use webber.edges.Condition&quot;</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos"> 514</span></a>                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos"> 515</span></a>                       
</span><span id="L-516"><a href="#L-516"><span class="linenos"> 516</span></a>        <span class="n">edge_id</span> <span class="o">=</span> <span class="n">edgedict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos"> 517</span></a>        <span class="n">edge</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">edgedict</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;parent&#39;</span><span class="p">,</span> <span class="s1">&#39;child&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">)}</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos"> 518</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">[(</span><span class="n">edge_id</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">edge_id</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">edge</span><span class="p">)</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos"> 519</span></a>
</span><span id="L-520"><a href="#L-520"><span class="linenos"> 520</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">relabel_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_T</span><span class="o">.</span><span class="n">Callable</span><span class="p">],</span> <span class="n">label</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos"> 521</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos"> 522</span></a><span class="sd">        Update the label, or name, given to a node in the DAG&#39;s scope, </span>
</span><span id="L-523"><a href="#L-523"><span class="linenos"> 523</span></a><span class="sd">        given a Python string and a node identifier. </span>
</span><span id="L-524"><a href="#L-524"><span class="linenos"> 524</span></a><span class="sd">        Well-structured wrapper for a common use-case of DAG.update_nodes.</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos"> 525</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-526"><a href="#L-526"><span class="linenos"> 526</span></a>        <span class="n">node_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_id</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos"> 527</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">label</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos"> 528</span></a>            <span class="n">err_msg</span> <span class="o">=</span> <span class="s2">&quot;Node label must be a Python string with one or more characters.&quot;</span>
</span><span id="L-529"><a href="#L-529"><span class="linenos"> 529</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos"> 530</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">update_nodes</span><span class="p">(</span><span class="n">node_id</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">label</span><span class="p">})</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos"> 531</span></a>        <span class="k">return</span> <span class="n">label</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos"> 532</span></a>
</span><span id="L-533"><a href="#L-533"><span class="linenos"> 533</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">update_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">N</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">,</span> <span class="nb">filter</span><span class="p">:</span> <span class="n">_types</span><span class="o">.</span><span class="n">LambdaType</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="n">dotdict</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">callable</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Callable</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">args</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Iterable</span><span class="p">[</span><span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-534"><a href="#L-534"><span class="linenos"> 534</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos"> 535</span></a><span class="sd">        Flexible function to update properties of nodes in the DAG&#39;s scope, </span>
</span><span id="L-536"><a href="#L-536"><span class="linenos"> 536</span></a><span class="sd">        based on unique identifier(s) (e.g.: string IDs or unique callables) or a</span>
</span><span id="L-537"><a href="#L-537"><span class="linenos"> 537</span></a><span class="sd">        lambda filter using the dotdict syntax.</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos"> 538</span></a><span class="sd">        </span>
</span><span id="L-539"><a href="#L-539"><span class="linenos"> 539</span></a><span class="sd">        List of nodes to update or filter argument is expected. Valid node lists include:</span>
</span><span id="L-540"><a href="#L-540"><span class="linenos"> 540</span></a>
</span><span id="L-541"><a href="#L-541"><span class="linenos"> 541</span></a><span class="sd">        \t update_nodes(node_id, ...)           or update_nodes([node_id], ...)</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos"> 542</span></a>
</span><span id="L-543"><a href="#L-543"><span class="linenos"> 543</span></a><span class="sd">        \t update_nodes(callable, ...)          or update_nodes([callable], ...)</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos"> 544</span></a><span class="sd">        </span>
</span><span id="L-545"><a href="#L-545"><span class="linenos"> 545</span></a><span class="sd">        \t update_nodes(node1, node2, ...)      or update_nodes([node1, node2], ...)</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos"> 546</span></a><span class="sd">        </span>
</span><span id="L-547"><a href="#L-547"><span class="linenos"> 547</span></a><span class="sd">        \t update_nodes(node1, callable2, ...)  or update_nodes([node1, callable2], ...)</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos"> 548</span></a>
</span><span id="L-549"><a href="#L-549"><span class="linenos"> 549</span></a><span class="sd">        &gt; update_nodes(node_id, ...) is equivalent to update_nodes(filter = lambda n: n.id == node_id)</span>
</span><span id="L-550"><a href="#L-550"><span class="linenos"> 550</span></a>
</span><span id="L-551"><a href="#L-551"><span class="linenos"> 551</span></a><span class="sd">        Parameters:</span>
</span><span id="L-552"><a href="#L-552"><span class="linenos"> 552</span></a>
</span><span id="L-553"><a href="#L-553"><span class="linenos"> 553</span></a><span class="sd">        &gt; filter: lambda property that can be used instead of a list of nodes to be updated.</span>
</span><span id="L-554"><a href="#L-554"><span class="linenos"> 554</span></a><span class="sd">        </span>
</span><span id="L-555"><a href="#L-555"><span class="linenos"> 555</span></a><span class="sd">        \t filter = (lambda n: n.callable == print or &#39;Hello, World&#39; in n.args)</span>
</span><span id="L-556"><a href="#L-556"><span class="linenos"> 556</span></a>
</span><span id="L-557"><a href="#L-557"><span class="linenos"> 557</span></a><span class="sd">        &gt; data: If given, expects a dictionary or dotdict to update node properties. At least one property should be defined if data argument is set.</span>
</span><span id="L-558"><a href="#L-558"><span class="linenos"> 558</span></a><span class="sd">            Any value given to the id key will be ignored. Allowed for ease of use with DAG.get nodes method.</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos"> 559</span></a><span class="sd">            </span>
</span><span id="L-560"><a href="#L-560"><span class="linenos"> 560</span></a><span class="sd">        \t data = {</span>
</span><span id="L-561"><a href="#L-561"><span class="linenos"> 561</span></a><span class="sd">            \t &#39;callable&#39;: print,</span>
</span><span id="L-562"><a href="#L-562"><span class="linenos"> 562</span></a><span class="sd">            \t &#39;args&#39;: [&#39;Hello&#39;, &#39;World&#39;],</span>
</span><span id="L-563"><a href="#L-563"><span class="linenos"> 563</span></a><span class="sd">            \t &#39;kwargs&#39;: {&#39;sep&#39;: &#39;, &#39;},</span>
</span><span id="L-564"><a href="#L-564"><span class="linenos"> 564</span></a><span class="sd">            \t &#39;name&#39;: &#39;custom_label&#39;,</span>
</span><span id="L-565"><a href="#L-565"><span class="linenos"> 565</span></a><span class="sd">            \t &#39;id&#39;: &#39;unique-identifier&#39;</span>
</span><span id="L-566"><a href="#L-566"><span class="linenos"> 566</span></a><span class="sd">            \t}</span>
</span><span id="L-567"><a href="#L-567"><span class="linenos"> 567</span></a>
</span><span id="L-568"><a href="#L-568"><span class="linenos"> 568</span></a><span class="sd">        &gt; args: Positional arguments to be passed to matching callables in the DAG&#39;s scope, using a Python iterable (e.g.: Tuple or List).</span>
</span><span id="L-569"><a href="#L-569"><span class="linenos"> 569</span></a>
</span><span id="L-570"><a href="#L-570"><span class="linenos"> 570</span></a><span class="sd">        &gt; kwargs: Keyword arguments to be passed to matching callables in the DAG&#39;s scope, using a Python dictionary.</span>
</span><span id="L-571"><a href="#L-571"><span class="linenos"> 571</span></a>
</span><span id="L-572"><a href="#L-572"><span class="linenos"> 572</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-573"><a href="#L-573"><span class="linenos"> 573</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">filter</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-574"><a href="#L-574"><span class="linenos"> 574</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Either an array of node IDs or node data (N) or a filter must be passed to this function.&quot;</span><span class="p">)</span>
</span><span id="L-575"><a href="#L-575"><span class="linenos"> 575</span></a>
</span><span id="L-576"><a href="#L-576"><span class="linenos"> 576</span></a>        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">filter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-577"><a href="#L-577"><span class="linenos"> 577</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Node data array (N) and filter argument are mutually exclusive, and cannot both be defined to identify nodes to update DAG&#39;s scope.&quot;</span><span class="p">)</span>
</span><span id="L-578"><a href="#L-578"><span class="linenos"> 578</span></a>
</span><span id="L-579"><a href="#L-579"><span class="linenos"> 579</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-580"><a href="#L-580"><span class="linenos"> 580</span></a>            <span class="n">N</span> <span class="o">=</span> <span class="p">[</span><span class="n">N</span><span class="p">]</span>
</span><span id="L-581"><a href="#L-581"><span class="linenos"> 581</span></a>
</span><span id="L-582"><a href="#L-582"><span class="linenos"> 582</span></a>        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">N</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">_abc</span><span class="o">.</span><span class="n">Iterable</span><span class="p">):</span>
</span><span id="L-583"><a href="#L-583"><span class="linenos"> 583</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">N</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="L-584"><a href="#L-584"><span class="linenos"> 584</span></a>                <span class="n">N</span> <span class="o">=</span> <span class="n">N</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-585"><a href="#L-585"><span class="linenos"> 585</span></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">N</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-586"><a href="#L-586"><span class="linenos"> 586</span></a>                <span class="c1"># BUG: A list of all single character IDs will fail to be updated. Please try another call method (i.e.: nested iterator).</span>
</span><span id="L-587"><a href="#L-587"><span class="linenos"> 587</span></a>                <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">n</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">N</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">N</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span> 
</span><span id="L-588"><a href="#L-588"><span class="linenos"> 588</span></a>                    <span class="n">N</span> <span class="o">=</span> <span class="n">N</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-589"><a href="#L-589"><span class="linenos"> 589</span></a>
</span><span id="L-590"><a href="#L-590"><span class="linenos"> 590</span></a>
</span><span id="L-591"><a href="#L-591"><span class="linenos"> 591</span></a>        <span class="k">if</span> <span class="nb">filter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-592"><a href="#L-592"><span class="linenos"> 592</span></a>            <span class="n">node_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_nodes</span><span class="p">(</span><span class="nb">filter</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="L-593"><a href="#L-593"><span class="linenos"> 593</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-594"><a href="#L-594"><span class="linenos"> 594</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">N</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="L-595"><a href="#L-595"><span class="linenos"> 595</span></a>                <span class="n">ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">N</span><span class="p">]</span>
</span><span id="L-596"><a href="#L-596"><span class="linenos"> 596</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-597"><a href="#L-597"><span class="linenos"> 597</span></a>                <span class="n">ids</span> <span class="o">=</span> <span class="n">N</span>
</span><span id="L-598"><a href="#L-598"><span class="linenos"> 598</span></a>            <span class="n">node_ids</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">node_id</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ids</span><span class="p">]</span>
</span><span id="L-599"><a href="#L-599"><span class="linenos"> 599</span></a>        
</span><span id="L-600"><a href="#L-600"><span class="linenos"> 600</span></a>        <span class="n">std_update</span> <span class="o">=</span> <span class="p">(</span><span class="nb">callable</span> <span class="o">==</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">args</span> <span class="o">==</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">kwargs</span> <span class="o">==</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="L-601"><a href="#L-601"><span class="linenos"> 601</span></a>
</span><span id="L-602"><a href="#L-602"><span class="linenos"> 602</span></a>        <span class="k">if</span> <span class="n">std_update</span><span class="p">:</span>
</span><span id="L-603"><a href="#L-603"><span class="linenos"> 603</span></a>            <span class="k">for</span> <span class="n">node_id</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">node_ids</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
</span><span id="L-604"><a href="#L-604"><span class="linenos"> 604</span></a>                <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-605"><a href="#L-605"><span class="linenos"> 605</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_update_node</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">id</span> <span class="o">=</span> <span class="n">node_id</span><span class="p">)</span>
</span><span id="L-606"><a href="#L-606"><span class="linenos"> 606</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-607"><a href="#L-607"><span class="linenos"> 607</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_update_node</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="nb">id</span> <span class="o">=</span> <span class="n">node_id</span><span class="p">)</span>
</span><span id="L-608"><a href="#L-608"><span class="linenos"> 608</span></a>        
</span><span id="L-609"><a href="#L-609"><span class="linenos"> 609</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-610"><a href="#L-610"><span class="linenos"> 610</span></a>            <span class="k">if</span> <span class="nb">callable</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-611"><a href="#L-611"><span class="linenos"> 611</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">_iscallable</span><span class="p">(</span><span class="nb">callable</span><span class="p">):</span>
</span><span id="L-612"><a href="#L-612"><span class="linenos"> 612</span></a>                    <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Requested node is not assigned a callable Python function.&quot;</span>
</span><span id="L-613"><a href="#L-613"><span class="linenos"> 613</span></a>                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="L-614"><a href="#L-614"><span class="linenos"> 614</span></a>                <span class="k">for</span> <span class="n">node_id</span> <span class="ow">in</span> <span class="n">node_ids</span><span class="p">:</span>
</span><span id="L-615"><a href="#L-615"><span class="linenos"> 615</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node_id</span><span class="p">][</span><span class="s1">&#39;callable&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">callable</span>
</span><span id="L-616"><a href="#L-616"><span class="linenos"> 616</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node_id</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">callable</span><span class="o">.</span><span class="vm">__name__</span>
</span><span id="L-617"><a href="#L-617"><span class="linenos"> 617</span></a>            
</span><span id="L-618"><a href="#L-618"><span class="linenos"> 618</span></a>            <span class="k">if</span> <span class="n">args</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-619"><a href="#L-619"><span class="linenos"> 619</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">_abc</span><span class="o">.</span><span class="n">Iterable</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="nb">str</span><span class="p">)):</span>
</span><span id="L-620"><a href="#L-620"><span class="linenos"> 620</span></a>                    <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Requested node is not assigned a tuple of pos args.&quot;</span>
</span><span id="L-621"><a href="#L-621"><span class="linenos"> 621</span></a>                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="L-622"><a href="#L-622"><span class="linenos"> 622</span></a>                <span class="n">args</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
</span><span id="L-623"><a href="#L-623"><span class="linenos"> 623</span></a>                <span class="k">for</span> <span class="n">node_id</span> <span class="ow">in</span> <span class="n">node_ids</span><span class="p">:</span>
</span><span id="L-624"><a href="#L-624"><span class="linenos"> 624</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node_id</span><span class="p">][</span><span class="s1">&#39;args&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">args</span>
</span><span id="L-625"><a href="#L-625"><span class="linenos"> 625</span></a>            
</span><span id="L-626"><a href="#L-626"><span class="linenos"> 626</span></a>            <span class="k">if</span> <span class="n">kwargs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-627"><a href="#L-627"><span class="linenos"> 627</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="L-628"><a href="#L-628"><span class="linenos"> 628</span></a>                    <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Requested node is not assigned a dictionary of kw args.&quot;</span>
</span><span id="L-629"><a href="#L-629"><span class="linenos"> 629</span></a>                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="L-630"><a href="#L-630"><span class="linenos"> 630</span></a>                <span class="k">for</span> <span class="n">node_id</span> <span class="ow">in</span> <span class="n">node_ids</span><span class="p">:</span>
</span><span id="L-631"><a href="#L-631"><span class="linenos"> 631</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node_id</span><span class="p">][</span><span class="s1">&#39;kwargs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span>
</span><span id="L-632"><a href="#L-632"><span class="linenos"> 632</span></a>
</span><span id="L-633"><a href="#L-633"><span class="linenos"> 633</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">N</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_T</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">_T</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">edgedict</span><span class="p">],</span> <span class="n">_T</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">_T</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]]:</span>
</span><span id="L-634"><a href="#L-634"><span class="linenos"> 634</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-635"><a href="#L-635"><span class="linenos"> 635</span></a><span class="sd">        Retrieval function for DAG edge data, based on tuple identifiers.</span>
</span><span id="L-636"><a href="#L-636"><span class="linenos"> 636</span></a><span class="sd">        Use filter_edges for more flexible controls (e.g.: filter_edges(in=[&#39;node_1&#39;, &#39;node_2&#39;]))</span>
</span><span id="L-637"><a href="#L-637"><span class="linenos"> 637</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-638"><a href="#L-638"><span class="linenos"> 638</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-639"><a href="#L-639"><span class="linenos"> 639</span></a>            <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
</span><span id="L-640"><a href="#L-640"><span class="linenos"> 640</span></a>                <span class="k">return</span> <span class="p">[</span><span class="n">edgedict</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="o">**</span><span class="n">d</span><span class="p">)</span> <span class="k">for</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">data</span><span class="p">()]</span>
</span><span id="L-641"><a href="#L-641"><span class="linenos"> 641</span></a>            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
</span><span id="L-642"><a href="#L-642"><span class="linenos"> 642</span></a>            
</span><span id="L-643"><a href="#L-643"><span class="linenos"> 643</span></a>        <span class="c1"># elif len(N) == 1:</span>
</span><span id="L-644"><a href="#L-644"><span class="linenos"> 644</span></a>        <span class="c1">#     if isinstance(N[0], _abc.Iterable) and not isinstance(N[0], tuple):</span>
</span><span id="L-645"><a href="#L-645"><span class="linenos"> 645</span></a>        <span class="c1">#         N = N[0]</span>
</span><span id="L-646"><a href="#L-646"><span class="linenos"> 646</span></a>
</span><span id="L-647"><a href="#L-647"><span class="linenos"> 647</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">N</span><span class="p">))</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">_abc</span><span class="o">.</span><span class="n">Iterable</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">N</span><span class="p">):</span>
</span><span id="L-648"><a href="#L-648"><span class="linenos"> 648</span></a>            <span class="n">err_msg</span> <span class="o">=</span> <span class="s1">&#39;All requested edges must be unique tuples of size 2.&#39;</span>
</span><span id="L-649"><a href="#L-649"><span class="linenos"> 649</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="L-650"><a href="#L-650"><span class="linenos"> 650</span></a>    
</span><span id="L-651"><a href="#L-651"><span class="linenos"> 651</span></a>        <span class="n">edge_data</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_edge</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="ow">in</span> <span class="n">N</span><span class="p">]</span>
</span><span id="L-652"><a href="#L-652"><span class="linenos"> 652</span></a>        <span class="k">return</span> <span class="n">edge_data</span>
</span><span id="L-653"><a href="#L-653"><span class="linenos"> 653</span></a>    
</span><span id="L-654"><a href="#L-654"><span class="linenos"> 654</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_edge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outgoing_node</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_T</span><span class="o">.</span><span class="n">Callable</span><span class="p">],</span> <span class="n">incoming_node</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_T</span><span class="o">.</span><span class="n">Callable</span><span class="p">],</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_T</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">edgedict</span><span class="p">,</span> <span class="n">_T</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
</span><span id="L-655"><a href="#L-655"><span class="linenos"> 655</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-656"><a href="#L-656"><span class="linenos"> 656</span></a><span class="sd">        Retrieval function for a single directed edge between nodes in a DAG&#39;s scope. </span>
</span><span id="L-657"><a href="#L-657"><span class="linenos"> 657</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-658"><a href="#L-658"><span class="linenos"> 658</span></a>        <span class="nb">id</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node_id</span><span class="p">(</span><span class="n">outgoing_node</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_id</span><span class="p">(</span><span class="n">incoming_node</span><span class="p">))</span>
</span><span id="L-659"><a href="#L-659"><span class="linenos"> 659</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
</span><span id="L-660"><a href="#L-660"><span class="linenos"> 660</span></a>            <span class="k">return</span> <span class="nb">id</span>
</span><span id="L-661"><a href="#L-661"><span class="linenos"> 661</span></a>        <span class="n">edge_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">get_edge_data</span><span class="p">(</span><span class="n">u</span> <span class="o">=</span> <span class="nb">id</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">v</span> <span class="o">=</span> <span class="nb">id</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="L-662"><a href="#L-662"><span class="linenos"> 662</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">edge_data</span><span class="p">:</span>
</span><span id="L-663"><a href="#L-663"><span class="linenos"> 663</span></a>            <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;No match found for the directed edge requested: </span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="L-664"><a href="#L-664"><span class="linenos"> 664</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="L-665"><a href="#L-665"><span class="linenos"> 665</span></a>        <span class="k">assert</span> <span class="n">edge_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>  <span class="c1"># Type narrowing for Pylance</span>
</span><span id="L-666"><a href="#L-666"><span class="linenos"> 666</span></a>        <span class="k">return</span> <span class="n">edgedict</span><span class="p">(</span><span class="o">*</span><span class="nb">id</span><span class="p">,</span> <span class="o">**</span><span class="n">edge_data</span><span class="p">)</span>
</span><span id="L-667"><a href="#L-667"><span class="linenos"> 667</span></a>
</span><span id="L-668"><a href="#L-668"><span class="linenos"> 668</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_T</span><span class="o">.</span><span class="n">Callable</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">dotdict</span><span class="p">:</span>
</span><span id="L-669"><a href="#L-669"><span class="linenos"> 669</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-670"><a href="#L-670"><span class="linenos"> 670</span></a><span class="sd">        Given a unique identifier, returns a dictionary of node metadata</span>
</span><span id="L-671"><a href="#L-671"><span class="linenos"> 671</span></a><span class="sd">        for a single node in the DAG&#39;s scope.</span>
</span><span id="L-672"><a href="#L-672"><span class="linenos"> 672</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-673"><a href="#L-673"><span class="linenos"> 673</span></a>        <span class="n">node_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_id</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</span><span id="L-674"><a href="#L-674"><span class="linenos"> 674</span></a>        <span class="k">return</span> <span class="n">dotdict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node_id</span><span class="p">])</span>
</span><span id="L-675"><a href="#L-675"><span class="linenos"> 675</span></a>
</span><span id="L-676"><a href="#L-676"><span class="linenos"> 676</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">N</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_T</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">dotdict</span><span class="p">]:</span>
</span><span id="L-677"><a href="#L-677"><span class="linenos"> 677</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-678"><a href="#L-678"><span class="linenos"> 678</span></a><span class="sd">        Flexible function to retrieve DAG node data, based on node identifiers </span>
</span><span id="L-679"><a href="#L-679"><span class="linenos"> 679</span></a><span class="sd">        (e.g.: string IDs or unique callables).</span>
</span><span id="L-680"><a href="#L-680"><span class="linenos"> 680</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-681"><a href="#L-681"><span class="linenos"> 681</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-682"><a href="#L-682"><span class="linenos"> 682</span></a>            <span class="n">node_data</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</span><span id="L-683"><a href="#L-683"><span class="linenos"> 683</span></a>            <span class="k">return</span> <span class="p">[</span><span class="n">dotdict</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">node_data</span><span class="p">]</span>
</span><span id="L-684"><a href="#L-684"><span class="linenos"> 684</span></a>
</span><span id="L-685"><a href="#L-685"><span class="linenos"> 685</span></a>        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-686"><a href="#L-686"><span class="linenos"> 686</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">N</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">_abc</span><span class="o">.</span><span class="n">Iterable</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">N</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-687"><a href="#L-687"><span class="linenos"> 687</span></a>                <span class="n">N</span> <span class="o">=</span> <span class="n">N</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-688"><a href="#L-688"><span class="linenos"> 688</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-689"><a href="#L-689"><span class="linenos"> 689</span></a>                <span class="n">node_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_id</span><span class="p">(</span><span class="n">N</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-690"><a href="#L-690"><span class="linenos"> 690</span></a>                <span class="n">node_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">dotdict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node_id</span><span class="p">])]</span>
</span><span id="L-691"><a href="#L-691"><span class="linenos"> 691</span></a>                <span class="k">return</span> <span class="n">node_data</span>
</span><span id="L-692"><a href="#L-692"><span class="linenos"> 692</span></a>            
</span><span id="L-693"><a href="#L-693"><span class="linenos"> 693</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">N</span><span class="p">)):</span>
</span><span id="L-694"><a href="#L-694"><span class="linenos"> 694</span></a>            <span class="n">err_msg</span> <span class="o">=</span> <span class="s1">&#39;All requested nodes must be unique identifiers.&#39;</span>
</span><span id="L-695"><a href="#L-695"><span class="linenos"> 695</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="L-696"><a href="#L-696"><span class="linenos"> 696</span></a>        
</span><span id="L-697"><a href="#L-697"><span class="linenos"> 697</span></a>        <span class="n">node_ids</span>  <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">node_id</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">N</span><span class="p">]</span>
</span><span id="L-698"><a href="#L-698"><span class="linenos"> 698</span></a>        <span class="n">node_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">dotdict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">n</span><span class="p">])</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">node_ids</span><span class="p">]</span>
</span><span id="L-699"><a href="#L-699"><span class="linenos"> 699</span></a>        <span class="k">return</span> <span class="n">node_data</span>
</span><span id="L-700"><a href="#L-700"><span class="linenos"> 700</span></a>
</span><span id="L-701"><a href="#L-701"><span class="linenos"> 701</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">filter_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">filter</span><span class="p">:</span> <span class="n">_types</span><span class="o">.</span><span class="n">LambdaType</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_T</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="n">_T</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">dotdict</span><span class="p">]:</span>
</span><span id="L-702"><a href="#L-702"><span class="linenos"> 702</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-703"><a href="#L-703"><span class="linenos"> 703</span></a><span class="sd">        Given a lambda function, filter nodes in a DAG&#39;s scope based on its attributes.</span>
</span><span id="L-704"><a href="#L-704"><span class="linenos"> 704</span></a><span class="sd">        Current limitation: Filters must use node identifier strings when referencing nodes.</span>
</span><span id="L-705"><a href="#L-705"><span class="linenos"> 705</span></a><span class="sd">        Use get_nodes for more flexible controls.</span>
</span><span id="L-706"><a href="#L-706"><span class="linenos"> 706</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-707"><a href="#L-707"><span class="linenos"> 707</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
</span><span id="L-708"><a href="#L-708"><span class="linenos"> 708</span></a>            <span class="k">return</span> <span class="p">[</span><span class="n">node</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span> <span class="nb">filter</span><span class="p">(</span><span class="n">dotdict</span><span class="p">(</span><span class="n">node</span><span class="p">))]</span>
</span><span id="L-709"><a href="#L-709"><span class="linenos"> 709</span></a>        <span class="k">return</span> <span class="p">[</span><span class="n">dotdict</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span> <span class="nb">filter</span><span class="p">(</span><span class="n">dotdict</span><span class="p">(</span><span class="n">node</span><span class="p">))]</span>
</span><span id="L-710"><a href="#L-710"><span class="linenos"> 710</span></a>    
</span><span id="L-711"><a href="#L-711"><span class="linenos"> 711</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">filter_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">filter</span><span class="p">:</span> <span class="n">_types</span><span class="o">.</span><span class="n">LambdaType</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_T</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">_T</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">|</span> <span class="n">_T</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">edgedict</span><span class="p">]:</span>
</span><span id="L-712"><a href="#L-712"><span class="linenos"> 712</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-713"><a href="#L-713"><span class="linenos"> 713</span></a><span class="sd">        Given a lambda function, filter edges in a DAG&#39;s scope based on its attributes.</span>
</span><span id="L-714"><a href="#L-714"><span class="linenos"> 714</span></a><span class="sd">        Current limitation: Filters must use node identifier strings when referencing nodes.</span>
</span><span id="L-715"><a href="#L-715"><span class="linenos"> 715</span></a><span class="sd">        Use get_edges for more flexible controls.</span>
</span><span id="L-716"><a href="#L-716"><span class="linenos"> 716</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-717"><a href="#L-717"><span class="linenos"> 717</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
</span><span id="L-718"><a href="#L-718"><span class="linenos"> 718</span></a>            <span class="k">return</span> <span class="p">[</span><span class="n">e</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">data</span><span class="p">())</span> <span class="k">if</span> <span class="nb">filter</span><span class="p">(</span><span class="n">edgedict</span><span class="p">(</span><span class="o">*</span><span class="n">e</span><span class="p">))]</span>
</span><span id="L-719"><a href="#L-719"><span class="linenos"> 719</span></a>        <span class="k">return</span> <span class="p">[</span><span class="n">edgedict</span><span class="p">(</span><span class="o">*</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">data</span><span class="p">())</span> <span class="k">if</span> <span class="nb">filter</span><span class="p">(</span><span class="n">edgedict</span><span class="p">(</span><span class="o">*</span><span class="n">e</span><span class="p">))]</span>
</span><span id="L-720"><a href="#L-720"><span class="linenos"> 720</span></a>
</span><span id="L-721"><a href="#L-721"><span class="linenos"> 721</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">retry_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">identifier</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span><span class="n">_T</span><span class="o">.</span><span class="n">Callable</span><span class="p">],</span> <span class="n">count</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-722"><a href="#L-722"><span class="linenos"> 722</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-723"><a href="#L-723"><span class="linenos"> 723</span></a><span class="sd">        Given a node identifier, set number of automatic retries in case of failure.</span>
</span><span id="L-724"><a href="#L-724"><span class="linenos"> 724</span></a><span class="sd">        Re-attempts will begin as soon as possible.</span>
</span><span id="L-725"><a href="#L-725"><span class="linenos"> 725</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-726"><a href="#L-726"><span class="linenos"> 726</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">count</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-727"><a href="#L-727"><span class="linenos"> 727</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Retry count must be a non-negative integer.&quot;</span><span class="p">)</span>
</span><span id="L-728"><a href="#L-728"><span class="linenos"> 728</span></a>        <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_id</span><span class="p">(</span><span class="n">identifier</span><span class="p">)</span>
</span><span id="L-729"><a href="#L-729"><span class="linenos"> 729</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s1">&#39;retry&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">count</span>
</span><span id="L-730"><a href="#L-730"><span class="linenos"> 730</span></a>
</span><span id="L-731"><a href="#L-731"><span class="linenos"> 731</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">skip_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">identifier</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_T</span><span class="o">.</span><span class="n">Callable</span><span class="p">],</span> <span class="n">skip</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">as_failure</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-732"><a href="#L-732"><span class="linenos"> 732</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-733"><a href="#L-733"><span class="linenos"> 733</span></a><span class="sd">        Given a node identifier, set DAG to skip node execution as a success (stdout print) or a failure (exception error).</span>
</span><span id="L-734"><a href="#L-734"><span class="linenos"> 734</span></a><span class="sd">        Allows conditional control and testing over DAG&#39;s order of operations.</span>
</span><span id="L-735"><a href="#L-735"><span class="linenos"> 735</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-736"><a href="#L-736"><span class="linenos"> 736</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">skip</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
</span><span id="L-737"><a href="#L-737"><span class="linenos"> 737</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Skip argument must be a boolean value.&quot;</span><span class="p">)</span>
</span><span id="L-738"><a href="#L-738"><span class="linenos"> 738</span></a>        <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_id</span><span class="p">(</span><span class="n">identifier</span><span class="p">)</span>
</span><span id="L-739"><a href="#L-739"><span class="linenos"> 739</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s1">&#39;skip&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">skip</span><span class="p">,</span> <span class="n">as_failure</span><span class="p">)</span>
</span><span id="L-740"><a href="#L-740"><span class="linenos"> 740</span></a>      
</span><span id="L-741"><a href="#L-741"><span class="linenos"> 741</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">critical_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nodes</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_T</span><span class="o">.</span><span class="n">Callable</span><span class="p">,</span> <span class="n">_T</span><span class="o">.</span><span class="n">Iterable</span><span class="p">[</span><span class="n">_T</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_T</span><span class="o">.</span><span class="n">Callable</span><span class="p">]]])</span> <span class="o">-&gt;</span> <span class="s1">&#39;DAG&#39;</span><span class="p">:</span>
</span><span id="L-742"><a href="#L-742"><span class="linenos"> 742</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-743"><a href="#L-743"><span class="linenos"> 743</span></a><span class="sd">        Given a set of nodes, returns a subset of the DAG containing</span>
</span><span id="L-744"><a href="#L-744"><span class="linenos"> 744</span></a><span class="sd">        only the node(s) and its parents, or upstream dependencies.</span>
</span><span id="L-745"><a href="#L-745"><span class="linenos"> 745</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-746"><a href="#L-746"><span class="linenos"> 746</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="n">_abc</span><span class="o">.</span><span class="n">Iterable</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-747"><a href="#L-747"><span class="linenos"> 747</span></a>            <span class="n">node_ids</span> <span class="o">=</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">node_id</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">}</span>
</span><span id="L-748"><a href="#L-748"><span class="linenos"> 748</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-749"><a href="#L-749"><span class="linenos"> 749</span></a>            <span class="n">node_ids</span> <span class="o">=</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">node_id</span><span class="p">(</span><span class="n">nodes</span><span class="p">)}</span>
</span><span id="L-750"><a href="#L-750"><span class="linenos"> 750</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_subgraph</span><span class="p">(</span><span class="n">node_ids</span><span class="p">)</span>
</span><span id="L-751"><a href="#L-751"><span class="linenos"> 751</span></a>
</span><span id="L-752"><a href="#L-752"><span class="linenos"> 752</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span>
</span><span id="L-753"><a href="#L-753"><span class="linenos"> 753</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-754"><a href="#L-754"><span class="linenos"> 754</span></a>        <span class="n">return_ref</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-755"><a href="#L-755"><span class="linenos"> 755</span></a>        <span class="n">print_exc</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-756"><a href="#L-756"><span class="linenos"> 756</span></a>        <span class="n">max_workers</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-757"><a href="#L-757"><span class="linenos"> 757</span></a>        <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-758"><a href="#L-758"><span class="linenos"> 758</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_T</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="s1">&#39;DAG.DAGExecutor&#39;</span><span class="p">]:</span>
</span><span id="L-759"><a href="#L-759"><span class="linenos"> 759</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-760"><a href="#L-760"><span class="linenos"> 760</span></a><span class="sd">        Basic wrapper for execution of the DAG&#39;s underlying callables.</span>
</span><span id="L-761"><a href="#L-761"><span class="linenos"> 761</span></a>
</span><span id="L-762"><a href="#L-762"><span class="linenos"> 762</span></a><span class="sd">        Args:</span>
</span><span id="L-763"><a href="#L-763"><span class="linenos"> 763</span></a><span class="sd">            return_ref: If True, return the DAGExecutor instance.</span>
</span><span id="L-764"><a href="#L-764"><span class="linenos"> 764</span></a><span class="sd">            print_exc: If True, print full exception tracebacks.</span>
</span><span id="L-765"><a href="#L-765"><span class="linenos"> 765</span></a><span class="sd">            max_workers: Maximum number of worker threads. Defaults to None (auto).</span>
</span><span id="L-766"><a href="#L-766"><span class="linenos"> 766</span></a><span class="sd">            verbose: If True, log task start/completion messages. Defaults to True.</span>
</span><span id="L-767"><a href="#L-767"><span class="linenos"> 767</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-768"><a href="#L-768"><span class="linenos"> 768</span></a>        <span class="n">executor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DAGExecutor</span><span class="p">(</span>
</span><span id="L-769"><a href="#L-769"><span class="linenos"> 769</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="n">print_exc</span><span class="p">,</span>
</span><span id="L-770"><a href="#L-770"><span class="linenos"> 770</span></a>            <span class="n">max_workers</span><span class="o">=</span><span class="n">max_workers</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span>
</span><span id="L-771"><a href="#L-771"><span class="linenos"> 771</span></a>        <span class="p">)</span>
</span><span id="L-772"><a href="#L-772"><span class="linenos"> 772</span></a>        <span class="k">return</span> <span class="n">executor</span> <span class="k">if</span> <span class="n">return_ref</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="L-773"><a href="#L-773"><span class="linenos"> 773</span></a>
</span><span id="L-774"><a href="#L-774"><span class="linenos"> 774</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">visualize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;gui&#39;</span><span class="p">,</span> <span class="s1">&#39;browser&#39;</span><span class="p">,</span> <span class="s1">&#39;plt&#39;</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">:</span>
</span><span id="L-775"><a href="#L-775"><span class="linenos"> 775</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-776"><a href="#L-776"><span class="linenos"> 776</span></a><span class="sd">        Basic wrapper to visualize DAG using Vis.js and NetGraph libraries.</span>
</span><span id="L-777"><a href="#L-777"><span class="linenos"> 777</span></a><span class="sd">        By default, visualization library only loaded in after DAG.visualize() is called, halving import times.</span>
</span><span id="L-778"><a href="#L-778"><span class="linenos"> 778</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-779"><a href="#L-779"><span class="linenos"> 779</span></a>        <span class="kn">import</span><span class="w"> </span><span class="nn">webber.viz</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">_viz</span>
</span><span id="L-780"><a href="#L-780"><span class="linenos"> 780</span></a>
</span><span id="L-781"><a href="#L-781"><span class="linenos"> 781</span></a>        <span class="k">match</span> <span class="nb">type</span><span class="p">:</span>
</span><span id="L-782"><a href="#L-782"><span class="linenos"> 782</span></a>            <span class="k">case</span> <span class="s1">&#39;browser&#39;</span><span class="p">:</span>
</span><span id="L-783"><a href="#L-783"><span class="linenos"> 783</span></a>                <span class="n">_viz</span><span class="o">.</span><span class="n">visualize_browser</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="p">)</span>
</span><span id="L-784"><a href="#L-784"><span class="linenos"> 784</span></a>
</span><span id="L-785"><a href="#L-785"><span class="linenos"> 785</span></a>            <span class="k">case</span> <span class="s1">&#39;plt&#39;</span><span class="p">:</span>
</span><span id="L-786"><a href="#L-786"><span class="linenos"> 786</span></a>                <span class="k">return</span> <span class="n">_viz</span><span class="o">.</span><span class="n">visualize_plt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="p">)</span>
</span><span id="L-787"><a href="#L-787"><span class="linenos"> 787</span></a>
</span><span id="L-788"><a href="#L-788"><span class="linenos"> 788</span></a>            <span class="k">case</span> <span class="s1">&#39;gui&#39;</span><span class="p">:</span>
</span><span id="L-789"><a href="#L-789"><span class="linenos"> 789</span></a>                <span class="c1"># _visualize_gui(self.graph)</span>
</span><span id="L-790"><a href="#L-790"><span class="linenos"> 790</span></a>                <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span><span id="L-791"><a href="#L-791"><span class="linenos"> 791</span></a>
</span><span id="L-792"><a href="#L-792"><span class="linenos"> 792</span></a>            <span class="k">case</span> <span class="kc">None</span><span class="p">:</span> 
</span><span id="L-793"><a href="#L-793"><span class="linenos"> 793</span></a>                <span class="k">if</span> <span class="n">_viz</span><span class="o">.</span><span class="n">_in_notebook</span><span class="p">():</span>
</span><span id="L-794"><a href="#L-794"><span class="linenos"> 794</span></a>                    <span class="k">return</span> <span class="n">_viz</span><span class="o">.</span><span class="n">visualize_plt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="p">)</span>
</span><span id="L-795"><a href="#L-795"><span class="linenos"> 795</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-796"><a href="#L-796"><span class="linenos"> 796</span></a>                    <span class="n">_viz</span><span class="o">.</span><span class="n">visualize_browser</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="p">)</span>
</span><span id="L-797"><a href="#L-797"><span class="linenos"> 797</span></a>
</span><span id="L-798"><a href="#L-798"><span class="linenos"> 798</span></a>            <span class="k">case</span><span class="w"> </span><span class="k">_</span><span class="p">:</span>
</span><span id="L-799"><a href="#L-799"><span class="linenos"> 799</span></a>                <span class="n">err_msg</span> <span class="o">=</span> <span class="s2">&quot;Unknown visualization type requested.&quot;</span>
</span><span id="L-800"><a href="#L-800"><span class="linenos"> 800</span></a>                <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="L-801"><a href="#L-801"><span class="linenos"> 801</span></a>
</span><span id="L-802"><a href="#L-802"><span class="linenos"> 802</span></a>    <span class="nd">@property</span>
</span><span id="L-803"><a href="#L-803"><span class="linenos"> 803</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">root</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_T</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="L-804"><a href="#L-804"><span class="linenos"> 804</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-805"><a href="#L-805"><span class="linenos"> 805</span></a><span class="sd">        Return list of nodes with no dependencies.</span>
</span><span id="L-806"><a href="#L-806"><span class="linenos"> 806</span></a><span class="sd">        Root nodes will occur first in DAG&#39;s order of operations.</span>
</span><span id="L-807"><a href="#L-807"><span class="linenos"> 807</span></a><span class="sd">        Uses O(1) in_degree() instead of O(k) predecessors list creation.</span>
</span><span id="L-808"><a href="#L-808"><span class="linenos"> 808</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-809"><a href="#L-809"><span class="linenos"> 809</span></a>        <span class="k">return</span> <span class="p">[</span><span class="n">node</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">in_degree</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="L-810"><a href="#L-810"><span class="linenos"> 810</span></a>
</span><span id="L-811"><a href="#L-811"><span class="linenos"> 811</span></a>    <span class="nd">@property</span>
</span><span id="L-812"><a href="#L-812"><span class="linenos"> 812</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">:</span>
</span><span id="L-813"><a href="#L-813"><span class="linenos"> 813</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the NodeView of the underlying NetworkX graph containing all DAG nodes.&quot;&quot;&quot;</span>
</span><span id="L-814"><a href="#L-814"><span class="linenos"> 814</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span>
</span><span id="L-815"><a href="#L-815"><span class="linenos"> 815</span></a>
</span><span id="L-816"><a href="#L-816"><span class="linenos"> 816</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">node_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">identifier</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span><span class="n">_T</span><span class="o">.</span><span class="n">Callable</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-817"><a href="#L-817"><span class="linenos"> 817</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-818"><a href="#L-818"><span class="linenos"> 818</span></a><span class="sd">        Validate whether identifier given is a valid node within the DAG&#39;s scope.</span>
</span><span id="L-819"><a href="#L-819"><span class="linenos"> 819</span></a><span class="sd">        Primarily for internal use, but useful for retrieving string identifiers</span>
</span><span id="L-820"><a href="#L-820"><span class="linenos"> 820</span></a><span class="sd">        for a unique callable in a DAG.</span>
</span><span id="L-821"><a href="#L-821"><span class="linenos"> 821</span></a><span class="sd">        Uses O(1) cache lookup for callables instead of O(n) linear search.</span>
</span><span id="L-822"><a href="#L-822"><span class="linenos"> 822</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-823"><a href="#L-823"><span class="linenos"> 823</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">identifier</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-824"><a href="#L-824"><span class="linenos"> 824</span></a>            <span class="c1"># O(1) lookup using graph.nodes dict</span>
</span><span id="L-825"><a href="#L-825"><span class="linenos"> 825</span></a>            <span class="k">if</span> <span class="n">identifier</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
</span><span id="L-826"><a href="#L-826"><span class="linenos"> 826</span></a>                <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Node </span><span class="si">{</span><span class="n">identifier</span><span class="si">}</span><span class="s2"> is not defined in this DAG&#39;s scope.&quot;</span>
</span><span id="L-827"><a href="#L-827"><span class="linenos"> 827</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="L-828"><a href="#L-828"><span class="linenos"> 828</span></a>            <span class="k">return</span> <span class="n">identifier</span>
</span><span id="L-829"><a href="#L-829"><span class="linenos"> 829</span></a>        <span class="k">elif</span> <span class="n">_iscallable</span><span class="p">(</span><span class="n">identifier</span><span class="p">):</span>
</span><span id="L-830"><a href="#L-830"><span class="linenos"> 830</span></a>            <span class="c1"># O(1) lookup using _callable_to_id cache</span>
</span><span id="L-831"><a href="#L-831"><span class="linenos"> 831</span></a>            <span class="k">if</span> <span class="n">identifier</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_callable_to_id</span><span class="p">:</span>
</span><span id="L-832"><a href="#L-832"><span class="linenos"> 832</span></a>                <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Callable </span><span class="si">{</span><span class="n">identifier</span><span class="si">}</span><span class="s2"> is not defined in this DAG&#39;s scope.&quot;</span>
</span><span id="L-833"><a href="#L-833"><span class="linenos"> 833</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="L-834"><a href="#L-834"><span class="linenos"> 834</span></a>            <span class="n">cached_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_callable_to_id</span><span class="p">[</span><span class="n">identifier</span><span class="p">]</span>
</span><span id="L-835"><a href="#L-835"><span class="linenos"> 835</span></a>            <span class="k">if</span> <span class="n">cached_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-836"><a href="#L-836"><span class="linenos"> 836</span></a>                <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Callable </span><span class="si">{</span><span class="n">identifier</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> &quot;</span> \
</span><span id="L-837"><a href="#L-837"><span class="linenos"> 837</span></a>                        <span class="o">+</span> <span class="s2">&quot;exists more than once in this DAG. &quot;</span> \
</span><span id="L-838"><a href="#L-838"><span class="linenos"> 838</span></a>                        <span class="o">+</span> <span class="s2">&quot;Use the unique string identifier of the required node.&quot;</span>
</span><span id="L-839"><a href="#L-839"><span class="linenos"> 839</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="L-840"><a href="#L-840"><span class="linenos"> 840</span></a>            <span class="k">return</span> <span class="n">cached_id</span>
</span><span id="L-841"><a href="#L-841"><span class="linenos"> 841</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-842"><a href="#L-842"><span class="linenos"> 842</span></a>            <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Node </span><span class="si">{</span><span class="n">identifier</span><span class="si">}</span><span class="s2"> must be a string or a Python callable&quot;</span>
</span><span id="L-843"><a href="#L-843"><span class="linenos"> 843</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="L-844"><a href="#L-844"><span class="linenos"> 844</span></a>    
</span><span id="L-845"><a href="#L-845"><span class="linenos"> 845</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_update_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nodedict</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">],</span> <span class="nb">id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-846"><a href="#L-846"><span class="linenos"> 846</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-847"><a href="#L-847"><span class="linenos"> 847</span></a><span class="sd">        Internal only. Update properties of single node within a DAG&#39;s scope, </span>
</span><span id="L-848"><a href="#L-848"><span class="linenos"> 848</span></a><span class="sd">        given a well-structured dictionary and the tuple identifier of the network edge. </span>
</span><span id="L-849"><a href="#L-849"><span class="linenos"> 849</span></a><span class="sd">        Force argument bypasses dictionary validation, and should only be used internally.</span>
</span><span id="L-850"><a href="#L-850"><span class="linenos"> 850</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-851"><a href="#L-851"><span class="linenos"> 851</span></a>        <span class="k">if</span> <span class="nb">id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-852"><a href="#L-852"><span class="linenos"> 852</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-853"><a href="#L-853"><span class="linenos"> 853</span></a>                <span class="k">if</span> <span class="n">nodedict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">id</span> <span class="o">!=</span> <span class="n">nodedict</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]:</span>
</span><span id="L-854"><a href="#L-854"><span class="linenos"> 854</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Given ID </span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s2"> inconsistent with dictionary identifier: </span><span class="si">{</span><span class="n">nodedict</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-855"><a href="#L-855"><span class="linenos"> 855</span></a>            <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-856"><a href="#L-856"><span class="linenos"> 856</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">force</span><span class="p">:</span>
</span><span id="L-857"><a href="#L-857"><span class="linenos"> 857</span></a>                    <span class="k">raise</span> <span class="n">e</span>
</span><span id="L-858"><a href="#L-858"><span class="linenos"> 858</span></a>            <span class="n">nodedict</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">id</span>
</span><span id="L-859"><a href="#L-859"><span class="linenos"> 859</span></a>        
</span><span id="L-860"><a href="#L-860"><span class="linenos"> 860</span></a>        <span class="n">expected_keys</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;callable&#39;</span><span class="p">,</span> <span class="s1">&#39;args&#39;</span><span class="p">,</span> <span class="s1">&#39;kwargs&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">)</span>
</span><span id="L-861"><a href="#L-861"><span class="linenos"> 861</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">set</span><span class="p">(</span><span class="n">expected_keys</span><span class="p">)</span><span class="o">.</span><span class="n">issuperset</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">nodedict</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span>
</span><span id="L-862"><a href="#L-862"><span class="linenos"> 862</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Expecting keys: </span><span class="si">{</span><span class="n">expected_keys</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-863"><a href="#L-863"><span class="linenos"> 863</span></a>        
</span><span id="L-864"><a href="#L-864"><span class="linenos"> 864</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">force</span><span class="p">:</span>
</span><span id="L-865"><a href="#L-865"><span class="linenos"> 865</span></a>            <span class="k">if</span> <span class="n">nodedict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;callable&#39;</span><span class="p">):</span>
</span><span id="L-866"><a href="#L-866"><span class="linenos"> 866</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">_iscallable</span><span class="p">(</span><span class="n">nodedict</span><span class="p">[</span><span class="s1">&#39;callable&#39;</span><span class="p">]):</span>
</span><span id="L-867"><a href="#L-867"><span class="linenos"> 867</span></a>                    <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Requested node is not assigned a callable Python function.&quot;</span>
</span><span id="L-868"><a href="#L-868"><span class="linenos"> 868</span></a>                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="L-869"><a href="#L-869"><span class="linenos"> 869</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">nodedict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">):</span>
</span><span id="L-870"><a href="#L-870"><span class="linenos"> 870</span></a>                    <span class="n">nodedict</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nodedict</span><span class="p">[</span><span class="s1">&#39;callable&#39;</span><span class="p">]</span><span class="o">.</span><span class="vm">__name__</span>
</span><span id="L-871"><a href="#L-871"><span class="linenos"> 871</span></a>
</span><span id="L-872"><a href="#L-872"><span class="linenos"> 872</span></a>            <span class="k">if</span> <span class="n">nodedict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nodedict</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">nodedict</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span> 
</span><span id="L-873"><a href="#L-873"><span class="linenos"> 873</span></a>                <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Requested node name must be a non-null Python string, will default to callable when not set.&quot;</span>
</span><span id="L-874"><a href="#L-874"><span class="linenos"> 874</span></a>                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="L-875"><a href="#L-875"><span class="linenos"> 875</span></a>
</span><span id="L-876"><a href="#L-876"><span class="linenos"> 876</span></a>            <span class="k">if</span> <span class="n">nodedict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;args&#39;</span><span class="p">):</span>
</span><span id="L-877"><a href="#L-877"><span class="linenos"> 877</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">nodedict</span><span class="p">[</span><span class="s1">&#39;args&#39;</span><span class="p">],</span> <span class="n">_abc</span><span class="o">.</span><span class="n">Iterable</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nodedict</span><span class="p">[</span><span class="s1">&#39;args&#39;</span><span class="p">],</span> <span class="nb">str</span><span class="p">)):</span>
</span><span id="L-878"><a href="#L-878"><span class="linenos"> 878</span></a>                    <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Requested node is not assigned a tuple of pos args.&quot;</span>
</span><span id="L-879"><a href="#L-879"><span class="linenos"> 879</span></a>                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="L-880"><a href="#L-880"><span class="linenos"> 880</span></a>                <span class="n">nodedict</span><span class="p">[</span><span class="s1">&#39;args&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">nodedict</span><span class="p">[</span><span class="s1">&#39;args&#39;</span><span class="p">])</span>
</span><span id="L-881"><a href="#L-881"><span class="linenos"> 881</span></a>            
</span><span id="L-882"><a href="#L-882"><span class="linenos"> 882</span></a>            <span class="k">if</span> <span class="n">nodedict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;kwargs&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nodedict</span><span class="p">[</span><span class="s1">&#39;kwargs&#39;</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="L-883"><a href="#L-883"><span class="linenos"> 883</span></a>                <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Requested node is not assigned a dictionary of kw args.&quot;</span>
</span><span id="L-884"><a href="#L-884"><span class="linenos"> 884</span></a>                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>                    
</span><span id="L-885"><a href="#L-885"><span class="linenos"> 885</span></a>        
</span><span id="L-886"><a href="#L-886"><span class="linenos"> 886</span></a>        <span class="n">node_id</span> <span class="o">=</span> <span class="n">nodedict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>
</span><span id="L-887"><a href="#L-887"><span class="linenos"> 887</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node_id</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">nodedict</span><span class="p">)</span>
</span><span id="L-888"><a href="#L-888"><span class="linenos"> 888</span></a>
</span><span id="L-889"><a href="#L-889"><span class="linenos"> 889</span></a>        <span class="c1"># Reset node name if implicitly requested.</span>
</span><span id="L-890"><a href="#L-890"><span class="linenos"> 890</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">nodedict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">):</span>
</span><span id="L-891"><a href="#L-891"><span class="linenos"> 891</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node_id</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node_id</span><span class="p">][</span><span class="s1">&#39;callable&#39;</span><span class="p">]</span><span class="o">.</span><span class="vm">__name__</span>
</span><span id="L-892"><a href="#L-892"><span class="linenos"> 892</span></a>
</span><span id="L-893"><a href="#L-893"><span class="linenos"> 893</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_subgraph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_ids</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s1">&#39;DAG&#39;</span><span class="p">:</span>
</span><span id="L-894"><a href="#L-894"><span class="linenos"> 894</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-895"><a href="#L-895"><span class="linenos"> 895</span></a><span class="sd">        Internal only. Given a set of nodes, returns a subset of the DAG containing</span>
</span><span id="L-896"><a href="#L-896"><span class="linenos"> 896</span></a><span class="sd">        only the node(s) and upstream dependencies.</span>
</span><span id="L-897"><a href="#L-897"><span class="linenos"> 897</span></a><span class="sd">        Uses nx.ancestors() for O(V+E) performance instead of manual traversal.</span>
</span><span id="L-898"><a href="#L-898"><span class="linenos"> 898</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-899"><a href="#L-899"><span class="linenos"> 899</span></a>        <span class="n">all_nodes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">node_ids</span><span class="p">)</span>
</span><span id="L-900"><a href="#L-900"><span class="linenos"> 900</span></a>        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">node_ids</span><span class="p">:</span>
</span><span id="L-901"><a href="#L-901"><span class="linenos"> 901</span></a>            <span class="n">all_nodes</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">_nx</span><span class="o">.</span><span class="n">ancestors</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="p">,</span> <span class="n">node</span><span class="p">))</span>
</span><span id="L-902"><a href="#L-902"><span class="linenos"> 902</span></a>        <span class="n">subgraph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">subgraph</span><span class="p">(</span><span class="n">all_nodes</span><span class="p">)</span>
</span><span id="L-903"><a href="#L-903"><span class="linenos"> 903</span></a>        <span class="k">return</span> <span class="n">DAG</span><span class="p">(</span><span class="n">subgraph</span><span class="p">,</span> <span class="n">__force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-904"><a href="#L-904"><span class="linenos"> 904</span></a>
</span><span id="L-905"><a href="#L-905"><span class="linenos"> 905</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">resolve_promise</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">promise</span><span class="p">:</span> <span class="n">_xcoms</span><span class="o">.</span><span class="n">Promise</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_xcoms</span><span class="o">.</span><span class="n">Promise</span><span class="p">:</span>
</span><span id="L-906"><a href="#L-906"><span class="linenos"> 906</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-907"><a href="#L-907"><span class="linenos"> 907</span></a><span class="sd">        Returns a Promise with a unique string identifier, if a given Promise is valid, based on the DAG&#39;s current scope.</span>
</span><span id="L-908"><a href="#L-908"><span class="linenos"> 908</span></a><span class="sd">        Raises `webber.xcoms.InvalidCallable` if Promise requests a callable that is out of scope.</span>
</span><span id="L-909"><a href="#L-909"><span class="linenos"> 909</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-910"><a href="#L-910"><span class="linenos"> 910</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-911"><a href="#L-911"><span class="linenos"> 911</span></a>            <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_id</span><span class="p">(</span><span class="n">promise</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>
</span><span id="L-912"><a href="#L-912"><span class="linenos"> 912</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-913"><a href="#L-913"><span class="linenos"> 913</span></a>            <span class="k">raise</span> <span class="n">_xcoms</span><span class="o">.</span><span class="n">InvalidCallable</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span id="L-914"><a href="#L-914"><span class="linenos"> 914</span></a>        <span class="k">return</span> <span class="n">_xcoms</span><span class="o">.</span><span class="n">Promise</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span id="L-915"><a href="#L-915"><span class="linenos"> 915</span></a>
</span><span id="L-916"><a href="#L-916"><span class="linenos"> 916</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">_nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">,</span> <span class="n">_nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-917"><a href="#L-917"><span class="linenos"> 917</span></a>
</span><span id="L-918"><a href="#L-918"><span class="linenos"> 918</span></a>        <span class="k">if</span> <span class="n">graph</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-919"><a href="#L-919"><span class="linenos"> 919</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="o">=</span> <span class="n">_nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">()</span>
</span><span id="L-920"><a href="#L-920"><span class="linenos"> 920</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_callable_to_id</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-921"><a href="#L-921"><span class="linenos"> 921</span></a>            <span class="k">return</span>
</span><span id="L-922"><a href="#L-922"><span class="linenos"> 922</span></a>
</span><span id="L-923"><a href="#L-923"><span class="linenos"> 923</span></a>        <span class="c1"># Meant for internal use only, creating DAGs from subgraphs.</span>
</span><span id="L-924"><a href="#L-924"><span class="linenos"> 924</span></a>        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;__force&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="L-925"><a href="#L-925"><span class="linenos"> 925</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="o">=</span> <span class="n">_T</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">_nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">,</span> <span class="n">graph</span><span class="p">)</span>
</span><span id="L-926"><a href="#L-926"><span class="linenos"> 926</span></a>            <span class="c1"># Build cache from existing subgraph</span>
</span><span id="L-927"><a href="#L-927"><span class="linenos"> 927</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_callable_to_id</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-928"><a href="#L-928"><span class="linenos"> 928</span></a>            <span class="k">for</span> <span class="n">node_id</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="L-929"><a href="#L-929"><span class="linenos"> 929</span></a>                <span class="n">callable_fn</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;callable&#39;</span><span class="p">)</span>
</span><span id="L-930"><a href="#L-930"><span class="linenos"> 930</span></a>                <span class="k">if</span> <span class="n">callable_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-931"><a href="#L-931"><span class="linenos"> 931</span></a>                    <span class="k">if</span> <span class="n">callable_fn</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_callable_to_id</span><span class="p">:</span>
</span><span id="L-932"><a href="#L-932"><span class="linenos"> 932</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">_callable_to_id</span><span class="p">[</span><span class="n">callable_fn</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Duplicate</span>
</span><span id="L-933"><a href="#L-933"><span class="linenos"> 933</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="L-934"><a href="#L-934"><span class="linenos"> 934</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">_callable_to_id</span><span class="p">[</span><span class="n">callable_fn</span><span class="p">]</span> <span class="o">=</span> <span class="n">node_id</span>
</span><span id="L-935"><a href="#L-935"><span class="linenos"> 935</span></a>            <span class="k">return</span>
</span><span id="L-936"><a href="#L-936"><span class="linenos"> 936</span></a>
</span><span id="L-937"><a href="#L-937"><span class="linenos"> 937</span></a>        <span class="n">_edges</span><span class="o">.</span><span class="n">validate_dag</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
</span><span id="L-938"><a href="#L-938"><span class="linenos"> 938</span></a>        <span class="c1"># Type narrowing: validate_dag ensures graph is a DiGraph</span>
</span><span id="L-939"><a href="#L-939"><span class="linenos"> 939</span></a>        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">_nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">)</span>
</span><span id="L-940"><a href="#L-940"><span class="linenos"> 940</span></a>
</span><span id="L-941"><a href="#L-941"><span class="linenos"> 941</span></a>        <span class="c1"># Define framework specific logic as nested dictionaries.</span>
</span><span id="L-942"><a href="#L-942"><span class="linenos"> 942</span></a>        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="L-943"><a href="#L-943"><span class="linenos"> 943</span></a>            <span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s1">&#39;callable&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">node</span>
</span><span id="L-944"><a href="#L-944"><span class="linenos"> 944</span></a>            <span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="vm">__name__</span>
</span><span id="L-945"><a href="#L-945"><span class="linenos"> 945</span></a>            <span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s1">&#39;args&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-946"><a href="#L-946"><span class="linenos"> 946</span></a>            <span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s1">&#39;kwargs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-947"><a href="#L-947"><span class="linenos"> 947</span></a>
</span><span id="L-948"><a href="#L-948"><span class="linenos"> 948</span></a>        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">:</span>
</span><span id="L-949"><a href="#L-949"><span class="linenos"> 949</span></a>            <span class="n">condition</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">e</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Condition&#39;</span><span class="p">)</span>
</span><span id="L-950"><a href="#L-950"><span class="linenos"> 950</span></a>            <span class="k">if</span> <span class="n">condition</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-951"><a href="#L-951"><span class="linenos"> 951</span></a>                <span class="k">if</span> <span class="n">condition</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">Condition</span><span class="p">:</span>
</span><span id="L-952"><a href="#L-952"><span class="linenos"> 952</span></a>                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="s1">&#39;Edge conditions must belong to IntEnum type Webber.Condition.&#39;</span><span class="p">)</span>
</span><span id="L-953"><a href="#L-953"><span class="linenos"> 953</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-954"><a href="#L-954"><span class="linenos"> 954</span></a>                <span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;Condition&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Condition</span><span class="o">.</span><span class="n">Success</span>
</span><span id="L-955"><a href="#L-955"><span class="linenos"> 955</span></a>
</span><span id="L-956"><a href="#L-956"><span class="linenos"> 956</span></a>        <span class="n">graph</span> <span class="o">=</span> <span class="n">_nx</span><span class="o">.</span><span class="n">relabel_nodes</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">node</span><span class="p">:</span> <span class="n">_edges</span><span class="o">.</span><span class="n">label_node</span><span class="p">(</span><span class="n">node</span><span class="p">))</span>
</span><span id="L-957"><a href="#L-957"><span class="linenos"> 957</span></a>        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
</span><span id="L-958"><a href="#L-958"><span class="linenos"> 958</span></a>            <span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">n</span>
</span><span id="L-959"><a href="#L-959"><span class="linenos"> 959</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="o">=</span> <span class="n">_nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
</span><span id="L-960"><a href="#L-960"><span class="linenos"> 960</span></a>
</span><span id="L-961"><a href="#L-961"><span class="linenos"> 961</span></a>        <span class="c1"># Build callable-&gt;id cache after relabeling</span>
</span><span id="L-962"><a href="#L-962"><span class="linenos"> 962</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_callable_to_id</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-963"><a href="#L-963"><span class="linenos"> 963</span></a>        <span class="k">for</span> <span class="n">node_id</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="L-964"><a href="#L-964"><span class="linenos"> 964</span></a>            <span class="n">callable_fn</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;callable&#39;</span><span class="p">)</span>
</span><span id="L-965"><a href="#L-965"><span class="linenos"> 965</span></a>            <span class="k">if</span> <span class="n">callable_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-966"><a href="#L-966"><span class="linenos"> 966</span></a>                <span class="k">if</span> <span class="n">callable_fn</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_callable_to_id</span><span class="p">:</span>
</span><span id="L-967"><a href="#L-967"><span class="linenos"> 967</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_callable_to_id</span><span class="p">[</span><span class="n">callable_fn</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Duplicate</span>
</span><span id="L-968"><a href="#L-968"><span class="linenos"> 968</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-969"><a href="#L-969"><span class="linenos"> 969</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_callable_to_id</span><span class="p">[</span><span class="n">callable_fn</span><span class="p">]</span> <span class="o">=</span> <span class="n">node_id</span>
</span><span id="L-970"><a href="#L-970"><span class="linenos"> 970</span></a>
</span><span id="L-971"><a href="#L-971"><span class="linenos"> 971</span></a>    <span class="k">class</span><span class="w"> </span><span class="nc">DAGExecutor</span><span class="p">:</span>
</span><span id="L-972"><a href="#L-972"><span class="linenos"> 972</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-973"><a href="#L-973"><span class="linenos"> 973</span></a><span class="sd">        Base class used to execute DAG in embarrassingly parallel.</span>
</span><span id="L-974"><a href="#L-974"><span class="linenos"> 974</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-975"><a href="#L-975"><span class="linenos"> 975</span></a>        <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="L-976"><a href="#L-976"><span class="linenos"> 976</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="L-977"><a href="#L-977"><span class="linenos"> 977</span></a>            <span class="n">graph</span><span class="p">:</span> <span class="n">_nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">,</span>
</span><span id="L-978"><a href="#L-978"><span class="linenos"> 978</span></a>            <span class="n">roots</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="L-979"><a href="#L-979"><span class="linenos"> 979</span></a>            <span class="n">print_exc</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-980"><a href="#L-980"><span class="linenos"> 980</span></a>            <span class="n">max_workers</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-981"><a href="#L-981"><span class="linenos"> 981</span></a>            <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-982"><a href="#L-982"><span class="linenos"> 982</span></a>        <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-983"><a href="#L-983"><span class="linenos"> 983</span></a>
</span><span id="L-984"><a href="#L-984"><span class="linenos"> 984</span></a>            <span class="c1"># Skip execution if there are no callables in scope.</span>
</span><span id="L-985"><a href="#L-985"><span class="linenos"> 985</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-986"><a href="#L-986"><span class="linenos"> 986</span></a>                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="L-987"><a href="#L-987"><span class="linenos"> 987</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Given DAG has no callables in scope. Skipping execution...&#39;</span><span class="p">)</span>
</span><span id="L-988"><a href="#L-988"><span class="linenos"> 988</span></a>                <span class="k">return</span>
</span><span id="L-989"><a href="#L-989"><span class="linenos"> 989</span></a>
</span><span id="L-990"><a href="#L-990"><span class="linenos"> 990</span></a>            <span class="c1"># Initialize local variables for execution.</span>
</span><span id="L-991"><a href="#L-991"><span class="linenos"> 991</span></a>            <span class="n">complete</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="L-992"><a href="#L-992"><span class="linenos"> 992</span></a>            <span class="n">started</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="L-993"><a href="#L-993"><span class="linenos"> 993</span></a>            <span class="n">failed</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="L-994"><a href="#L-994"><span class="linenos"> 994</span></a>            <span class="n">skipped</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="L-995"><a href="#L-995"><span class="linenos"> 995</span></a>            <span class="n">refs</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_futures</span><span class="o">.</span><span class="n">Future</span><span class="p">[</span><span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-996"><a href="#L-996"><span class="linenos"> 996</span></a>
</span><span id="L-997"><a href="#L-997"><span class="linenos"> 997</span></a>            <span class="k">def</span><span class="w"> </span><span class="nf">raise_exc</span><span class="p">(</span><span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-998"><a href="#L-998"><span class="linenos"> 998</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</span><span id="L-999"><a href="#L-999"><span class="linenos"> 999</span></a>
</span><span id="L-1000"><a href="#L-1000"><span class="linenos">1000</span></a>            <span class="k">def</span><span class="w"> </span><span class="nf">run_conditions_met</span><span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-1001"><a href="#L-1001"><span class="linenos">1001</span></a>                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">predecessors</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
</span><span id="L-1002"><a href="#L-1002"><span class="linenos">1002</span></a>                    <span class="k">match</span> <span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">[(</span><span class="n">p</span><span class="p">,</span> <span class="n">n</span><span class="p">)][</span><span class="s1">&#39;Condition&#39;</span><span class="p">]:</span>
</span><span id="L-1003"><a href="#L-1003"><span class="linenos">1003</span></a>                        <span class="k">case</span> <span class="n">Condition</span><span class="o">.</span><span class="n">Success</span><span class="p">:</span>
</span><span id="L-1004"><a href="#L-1004"><span class="linenos">1004</span></a>                            <span class="k">if</span> <span class="n">p</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">complete</span><span class="p">:</span>
</span><span id="L-1005"><a href="#L-1005"><span class="linenos">1005</span></a>                                <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-1006"><a href="#L-1006"><span class="linenos">1006</span></a>                        <span class="k">case</span> <span class="n">Condition</span><span class="o">.</span><span class="n">Failure</span><span class="p">:</span>
</span><span id="L-1007"><a href="#L-1007"><span class="linenos">1007</span></a>                            <span class="k">if</span> <span class="n">p</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">failed</span><span class="p">:</span>
</span><span id="L-1008"><a href="#L-1008"><span class="linenos">1008</span></a>                                <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-1009"><a href="#L-1009"><span class="linenos">1009</span></a>                        <span class="k">case</span> <span class="n">Condition</span><span class="o">.</span><span class="n">AnyCase</span><span class="p">:</span>
</span><span id="L-1010"><a href="#L-1010"><span class="linenos">1010</span></a>                            <span class="k">if</span> <span class="n">p</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">failed</span> <span class="ow">and</span> <span class="n">p</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">complete</span><span class="p">:</span>
</span><span id="L-1011"><a href="#L-1011"><span class="linenos">1011</span></a>                                <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-1012"><a href="#L-1012"><span class="linenos">1012</span></a>                <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-1013"><a href="#L-1013"><span class="linenos">1013</span></a>
</span><span id="L-1014"><a href="#L-1014"><span class="linenos">1014</span></a>            <span class="n">skip</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="s2">&quot;skip&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
</span><span id="L-1015"><a href="#L-1015"><span class="linenos">1015</span></a>            <span class="n">retry</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_T</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-1016"><a href="#L-1016"><span class="linenos">1016</span></a>                <span class="n">n</span><span class="p">:</span> <span class="p">[</span><span class="n">c</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="p">{}]</span> <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="s2">&quot;retry&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-1017"><a href="#L-1017"><span class="linenos">1017</span></a>            <span class="p">}</span>
</span><span id="L-1018"><a href="#L-1018"><span class="linenos">1018</span></a>
</span><span id="L-1019"><a href="#L-1019"><span class="linenos">1019</span></a>            <span class="c1"># Start execution of root node functions.</span>
</span><span id="L-1020"><a href="#L-1020"><span class="linenos">1020</span></a>            <span class="k">with</span> <span class="n">_futures</span><span class="o">.</span><span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="n">max_workers</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
</span><span id="L-1021"><a href="#L-1021"><span class="linenos">1021</span></a>
</span><span id="L-1022"><a href="#L-1022"><span class="linenos">1022</span></a>                <span class="k">def</span><span class="w"> </span><span class="nf">Submit</span><span class="p">(</span>
</span><span id="L-1023"><a href="#L-1023"><span class="linenos">1023</span></a>                    <span class="n">event</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-1024"><a href="#L-1024"><span class="linenos">1024</span></a>                    <span class="nb">callable</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">],</span>
</span><span id="L-1025"><a href="#L-1025"><span class="linenos">1025</span></a>                    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-1026"><a href="#L-1026"><span class="linenos">1026</span></a>                    <span class="n">args</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="nb">list</span><span class="p">[</span><span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">]],</span>
</span><span id="L-1027"><a href="#L-1027"><span class="linenos">1027</span></a>                    <span class="n">kwargs</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span>
</span><span id="L-1028"><a href="#L-1028"><span class="linenos">1028</span></a>                <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_futures</span><span class="o">.</span><span class="n">Future</span><span class="p">[</span><span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">]:</span>
</span><span id="L-1029"><a href="#L-1029"><span class="linenos">1029</span></a>                    <span class="k">if</span> <span class="n">skip</span><span class="p">[</span><span class="n">event</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
</span><span id="L-1030"><a href="#L-1030"><span class="linenos">1030</span></a>                        <span class="n">retry</span><span class="p">[</span><span class="n">event</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-1031"><a href="#L-1031"><span class="linenos">1031</span></a>                        <span class="n">skip_callable</span> <span class="o">=</span> <span class="n">raise_exc</span> <span class="k">if</span> <span class="n">skip</span><span class="p">[</span><span class="n">event</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="k">else</span> <span class="nb">print</span>
</span><span id="L-1032"><a href="#L-1032"><span class="linenos">1032</span></a>                        <span class="k">return</span> <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span>
</span><span id="L-1033"><a href="#L-1033"><span class="linenos">1033</span></a>                            <span class="n">_event_wrapper</span><span class="p">,</span>
</span><span id="L-1034"><a href="#L-1034"><span class="linenos">1034</span></a>                            <span class="n">_callable</span><span class="o">=</span><span class="n">skip_callable</span><span class="p">,</span>
</span><span id="L-1035"><a href="#L-1035"><span class="linenos">1035</span></a>                            <span class="n">_name</span><span class="o">=</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">event</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
</span><span id="L-1036"><a href="#L-1036"><span class="linenos">1036</span></a>                            <span class="n">_args</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Event </span><span class="si">{</span><span class="n">event</span><span class="si">}</span><span class="s2"> skipped...&quot;</span><span class="p">],</span>
</span><span id="L-1037"><a href="#L-1037"><span class="linenos">1037</span></a>                            <span class="n">_kwargs</span><span class="o">=</span><span class="p">{},</span>
</span><span id="L-1038"><a href="#L-1038"><span class="linenos">1038</span></a>                            <span class="n">_verbose</span><span class="o">=</span><span class="n">verbose</span>
</span><span id="L-1039"><a href="#L-1039"><span class="linenos">1039</span></a>                        <span class="p">)</span>
</span><span id="L-1040"><a href="#L-1040"><span class="linenos">1040</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="L-1041"><a href="#L-1041"><span class="linenos">1041</span></a>                        <span class="n">retry</span><span class="p">[</span><span class="n">event</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>
</span><span id="L-1042"><a href="#L-1042"><span class="linenos">1042</span></a>                        <span class="k">if</span> <span class="p">(</span><span class="n">retry</span><span class="p">[</span><span class="n">event</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">retry</span><span class="p">[</span><span class="n">event</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="p">{}):</span>
</span><span id="L-1043"><a href="#L-1043"><span class="linenos">1043</span></a>                            <span class="n">retry</span><span class="p">[</span><span class="n">event</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-1044"><a href="#L-1044"><span class="linenos">1044</span></a>                                <span class="s1">&#39;callable&#39;</span><span class="p">:</span> <span class="nb">callable</span><span class="p">,</span>
</span><span id="L-1045"><a href="#L-1045"><span class="linenos">1045</span></a>                                <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
</span><span id="L-1046"><a href="#L-1046"><span class="linenos">1046</span></a>                                <span class="s1">&#39;args&#39;</span><span class="p">:</span> <span class="n">args</span><span class="p">,</span>
</span><span id="L-1047"><a href="#L-1047"><span class="linenos">1047</span></a>                                <span class="s1">&#39;kwargs&#39;</span><span class="p">:</span> <span class="n">kwargs</span>
</span><span id="L-1048"><a href="#L-1048"><span class="linenos">1048</span></a>                            <span class="p">}</span>
</span><span id="L-1049"><a href="#L-1049"><span class="linenos">1049</span></a>                        <span class="k">return</span> <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span>
</span><span id="L-1050"><a href="#L-1050"><span class="linenos">1050</span></a>                            <span class="n">_event_wrapper</span><span class="p">,</span>
</span><span id="L-1051"><a href="#L-1051"><span class="linenos">1051</span></a>                            <span class="n">_callable</span><span class="o">=</span><span class="nb">callable</span><span class="p">,</span>
</span><span id="L-1052"><a href="#L-1052"><span class="linenos">1052</span></a>                            <span class="n">_name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span id="L-1053"><a href="#L-1053"><span class="linenos">1053</span></a>                            <span class="n">_args</span><span class="o">=</span><span class="n">args</span><span class="p">,</span>
</span><span id="L-1054"><a href="#L-1054"><span class="linenos">1054</span></a>                            <span class="n">_kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="L-1055"><a href="#L-1055"><span class="linenos">1055</span></a>                            <span class="n">_verbose</span><span class="o">=</span><span class="n">verbose</span>
</span><span id="L-1056"><a href="#L-1056"><span class="linenos">1056</span></a>                        <span class="p">)</span>
</span><span id="L-1057"><a href="#L-1057"><span class="linenos">1057</span></a>
</span><span id="L-1058"><a href="#L-1058"><span class="linenos">1058</span></a>                <span class="c1"># Submit root nodes</span>
</span><span id="L-1059"><a href="#L-1059"><span class="linenos">1059</span></a>                <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">roots</span><span class="p">:</span>
</span><span id="L-1060"><a href="#L-1060"><span class="linenos">1060</span></a>                    <span class="n">refs</span><span class="p">[</span><span class="n">event</span><span class="p">]</span> <span class="o">=</span> <span class="n">Submit</span><span class="p">(</span>
</span><span id="L-1061"><a href="#L-1061"><span class="linenos">1061</span></a>                        <span class="n">event</span><span class="p">,</span>
</span><span id="L-1062"><a href="#L-1062"><span class="linenos">1062</span></a>                        <span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">event</span><span class="p">][</span><span class="s1">&#39;callable&#39;</span><span class="p">],</span>
</span><span id="L-1063"><a href="#L-1063"><span class="linenos">1063</span></a>                        <span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">event</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
</span><span id="L-1064"><a href="#L-1064"><span class="linenos">1064</span></a>                        <span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">event</span><span class="p">][</span><span class="s1">&#39;args&#39;</span><span class="p">],</span>
</span><span id="L-1065"><a href="#L-1065"><span class="linenos">1065</span></a>                        <span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">event</span><span class="p">][</span><span class="s1">&#39;kwargs&#39;</span><span class="p">]</span>
</span><span id="L-1066"><a href="#L-1066"><span class="linenos">1066</span></a>                    <span class="p">)</span>
</span><span id="L-1067"><a href="#L-1067"><span class="linenos">1067</span></a>                    <span class="n">started</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
</span><span id="L-1068"><a href="#L-1068"><span class="linenos">1068</span></a>
</span><span id="L-1069"><a href="#L-1069"><span class="linenos">1069</span></a>                <span class="c1"># Process futures as they complete (no busy-wait)</span>
</span><span id="L-1070"><a href="#L-1070"><span class="linenos">1070</span></a>                <span class="n">pending</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">refs</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</span><span id="L-1071"><a href="#L-1071"><span class="linenos">1071</span></a>                <span class="n">future_to_event</span> <span class="o">=</span> <span class="p">{</span><span class="n">v</span><span class="p">:</span> <span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">refs</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
</span><span id="L-1072"><a href="#L-1072"><span class="linenos">1072</span></a>
</span><span id="L-1073"><a href="#L-1073"><span class="linenos">1073</span></a>                <span class="k">while</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">complete</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">failed</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">skipped</span><span class="p">))</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">graph</span><span class="p">):</span>
</span><span id="L-1074"><a href="#L-1074"><span class="linenos">1074</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="n">pending</span><span class="p">:</span>
</span><span id="L-1075"><a href="#L-1075"><span class="linenos">1075</span></a>                        <span class="k">break</span>
</span><span id="L-1076"><a href="#L-1076"><span class="linenos">1076</span></a>
</span><span id="L-1077"><a href="#L-1077"><span class="linenos">1077</span></a>                    <span class="c1"># Wait for at least one future to complete</span>
</span><span id="L-1078"><a href="#L-1078"><span class="linenos">1078</span></a>                    <span class="n">done</span><span class="p">,</span> <span class="n">pending</span> <span class="o">=</span> <span class="n">_futures</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="n">pending</span><span class="p">,</span> <span class="n">return_when</span><span class="o">=</span><span class="n">_futures</span><span class="o">.</span><span class="n">FIRST_COMPLETED</span><span class="p">)</span>
</span><span id="L-1079"><a href="#L-1079"><span class="linenos">1079</span></a>
</span><span id="L-1080"><a href="#L-1080"><span class="linenos">1080</span></a>                    <span class="k">for</span> <span class="n">future</span> <span class="ow">in</span> <span class="n">done</span><span class="p">:</span>
</span><span id="L-1081"><a href="#L-1081"><span class="linenos">1081</span></a>                        <span class="n">event</span> <span class="o">=</span> <span class="n">future_to_event</span><span class="p">[</span><span class="n">future</span><span class="p">]</span>
</span><span id="L-1082"><a href="#L-1082"><span class="linenos">1082</span></a>
</span><span id="L-1083"><a href="#L-1083"><span class="linenos">1083</span></a>                        <span class="k">if</span> <span class="n">future</span><span class="o">.</span><span class="n">exception</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1084"><a href="#L-1084"><span class="linenos">1084</span></a>                            <span class="k">try</span><span class="p">:</span>
</span><span id="L-1085"><a href="#L-1085"><span class="linenos">1085</span></a>                                <span class="k">raise</span> <span class="n">future</span><span class="o">.</span><span class="n">exception</span><span class="p">()</span>  <span class="c1"># type: ignore</span>
</span><span id="L-1086"><a href="#L-1086"><span class="linenos">1086</span></a>                            <span class="k">except</span><span class="p">:</span>
</span><span id="L-1087"><a href="#L-1087"><span class="linenos">1087</span></a>                                <span class="k">if</span> <span class="n">print_exc</span><span class="p">:</span>
</span><span id="L-1088"><a href="#L-1088"><span class="linenos">1088</span></a>                                    <span class="n">_traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
</span><span id="L-1089"><a href="#L-1089"><span class="linenos">1089</span></a>
</span><span id="L-1090"><a href="#L-1090"><span class="linenos">1090</span></a>                                <span class="k">if</span> <span class="n">retry</span><span class="p">[</span><span class="n">event</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1091"><a href="#L-1091"><span class="linenos">1091</span></a>                                    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="L-1092"><a href="#L-1092"><span class="linenos">1092</span></a>                                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Event </span><span class="si">{</span><span class="n">event</span><span class="si">}</span><span class="s2"> exited with exception, retrying...&quot;</span><span class="p">)</span>
</span><span id="L-1093"><a href="#L-1093"><span class="linenos">1093</span></a>                                    <span class="n">new_future</span> <span class="o">=</span> <span class="n">Submit</span><span class="p">(</span>
</span><span id="L-1094"><a href="#L-1094"><span class="linenos">1094</span></a>                                        <span class="n">event</span><span class="p">,</span>
</span><span id="L-1095"><a href="#L-1095"><span class="linenos">1095</span></a>                                        <span class="nb">callable</span><span class="o">=</span><span class="n">retry</span><span class="p">[</span><span class="n">event</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;callable&#39;</span><span class="p">],</span>
</span><span id="L-1096"><a href="#L-1096"><span class="linenos">1096</span></a>                                        <span class="n">name</span><span class="o">=</span><span class="n">retry</span><span class="p">[</span><span class="n">event</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
</span><span id="L-1097"><a href="#L-1097"><span class="linenos">1097</span></a>                                        <span class="n">args</span><span class="o">=</span><span class="n">retry</span><span class="p">[</span><span class="n">event</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;args&#39;</span><span class="p">],</span>
</span><span id="L-1098"><a href="#L-1098"><span class="linenos">1098</span></a>                                        <span class="n">kwargs</span><span class="o">=</span><span class="n">retry</span><span class="p">[</span><span class="n">event</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;kwargs&#39;</span><span class="p">]</span>
</span><span id="L-1099"><a href="#L-1099"><span class="linenos">1099</span></a>                                    <span class="p">)</span>
</span><span id="L-1100"><a href="#L-1100"><span class="linenos">1100</span></a>                                    <span class="n">refs</span><span class="p">[</span><span class="n">event</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_future</span>
</span><span id="L-1101"><a href="#L-1101"><span class="linenos">1101</span></a>                                    <span class="n">pending</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">new_future</span><span class="p">)</span>
</span><span id="L-1102"><a href="#L-1102"><span class="linenos">1102</span></a>                                    <span class="n">future_to_event</span><span class="p">[</span><span class="n">new_future</span><span class="p">]</span> <span class="o">=</span> <span class="n">event</span>
</span><span id="L-1103"><a href="#L-1103"><span class="linenos">1103</span></a>                                    <span class="k">continue</span>
</span><span id="L-1104"><a href="#L-1104"><span class="linenos">1104</span></a>
</span><span id="L-1105"><a href="#L-1105"><span class="linenos">1105</span></a>                                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="L-1106"><a href="#L-1106"><span class="linenos">1106</span></a>                                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Event </span><span class="si">{</span><span class="n">event</span><span class="si">}</span><span class="s2"> exited with exception...&quot;</span><span class="p">)</span>
</span><span id="L-1107"><a href="#L-1107"><span class="linenos">1107</span></a>                                <span class="n">failed</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
</span><span id="L-1108"><a href="#L-1108"><span class="linenos">1108</span></a>                                <span class="n">skipping</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-1109"><a href="#L-1109"><span class="linenos">1109</span></a>                                    <span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">out_edges</span><span class="p">(</span><span class="n">event</span><span class="p">))</span>
</span><span id="L-1110"><a href="#L-1110"><span class="linenos">1110</span></a>                                    <span class="k">if</span> <span class="ow">not</span> <span class="n">_edges</span><span class="o">.</span><span class="n">continue_on_failure</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">e</span><span class="p">])</span>
</span><span id="L-1111"><a href="#L-1111"><span class="linenos">1111</span></a>                                <span class="p">]</span>
</span><span id="L-1112"><a href="#L-1112"><span class="linenos">1112</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1113"><a href="#L-1113"><span class="linenos">1113</span></a>                            <span class="n">complete</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
</span><span id="L-1114"><a href="#L-1114"><span class="linenos">1114</span></a>                            <span class="n">skipping</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-1115"><a href="#L-1115"><span class="linenos">1115</span></a>                                <span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">out_edges</span><span class="p">(</span><span class="n">event</span><span class="p">))</span>
</span><span id="L-1116"><a href="#L-1116"><span class="linenos">1116</span></a>                                <span class="k">if</span> <span class="ow">not</span> <span class="n">_edges</span><span class="o">.</span><span class="n">continue_on_success</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">e</span><span class="p">])</span>
</span><span id="L-1117"><a href="#L-1117"><span class="linenos">1117</span></a>                            <span class="p">]</span>
</span><span id="L-1118"><a href="#L-1118"><span class="linenos">1118</span></a>
</span><span id="L-1119"><a href="#L-1119"><span class="linenos">1119</span></a>                        <span class="n">skipped</span> <span class="o">=</span> <span class="n">skipped</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">skipping</span><span class="p">)</span>
</span><span id="L-1120"><a href="#L-1120"><span class="linenos">1120</span></a>                        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">skipping</span><span class="p">:</span>
</span><span id="L-1121"><a href="#L-1121"><span class="linenos">1121</span></a>                            <span class="n">skipped</span> <span class="o">=</span> <span class="n">skipped</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">_nx</span><span class="o">.</span><span class="n">descendants</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
</span><span id="L-1122"><a href="#L-1122"><span class="linenos">1122</span></a>
</span><span id="L-1123"><a href="#L-1123"><span class="linenos">1123</span></a>                        <span class="n">carryon</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">successors</span><span class="p">(</span><span class="n">event</span><span class="p">))</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">skipped</span><span class="p">)</span>
</span><span id="L-1124"><a href="#L-1124"><span class="linenos">1124</span></a>                        <span class="n">starting</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-1125"><a href="#L-1125"><span class="linenos">1125</span></a>                            <span class="n">successor</span> <span class="k">for</span> <span class="n">successor</span> <span class="ow">in</span> <span class="n">carryon</span>
</span><span id="L-1126"><a href="#L-1126"><span class="linenos">1126</span></a>                            <span class="k">if</span> <span class="n">run_conditions_met</span><span class="p">(</span><span class="n">successor</span><span class="p">)</span>
</span><span id="L-1127"><a href="#L-1127"><span class="linenos">1127</span></a>                        <span class="p">]</span>
</span><span id="L-1128"><a href="#L-1128"><span class="linenos">1128</span></a>
</span><span id="L-1129"><a href="#L-1129"><span class="linenos">1129</span></a>                        <span class="k">for</span> <span class="n">successor</span> <span class="ow">in</span> <span class="n">starting</span><span class="p">:</span>
</span><span id="L-1130"><a href="#L-1130"><span class="linenos">1130</span></a>                            <span class="n">_args</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-1131"><a href="#L-1131"><span class="linenos">1131</span></a>                                <span class="n">a</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">_xcoms</span><span class="o">.</span><span class="n">Promise</span><span class="p">)</span> <span class="k">else</span> <span class="n">refs</span><span class="p">[</span><span class="n">_T</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">key</span><span class="p">)]</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
</span><span id="L-1132"><a href="#L-1132"><span class="linenos">1132</span></a>                                <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">successor</span><span class="p">][</span><span class="s1">&#39;args&#39;</span><span class="p">]</span>
</span><span id="L-1133"><a href="#L-1133"><span class="linenos">1133</span></a>                            <span class="p">]</span>
</span><span id="L-1134"><a href="#L-1134"><span class="linenos">1134</span></a>                            <span class="n">_kwargs</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-1135"><a href="#L-1135"><span class="linenos">1135</span></a>                                <span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">_xcoms</span><span class="o">.</span><span class="n">Promise</span><span class="p">)</span> <span class="k">else</span> <span class="n">refs</span><span class="p">[</span><span class="n">_T</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">key</span><span class="p">)]</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
</span><span id="L-1136"><a href="#L-1136"><span class="linenos">1136</span></a>                                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">successor</span><span class="p">][</span><span class="s1">&#39;kwargs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="L-1137"><a href="#L-1137"><span class="linenos">1137</span></a>                            <span class="p">}</span>
</span><span id="L-1138"><a href="#L-1138"><span class="linenos">1138</span></a>                            <span class="n">new_future</span> <span class="o">=</span> <span class="n">Submit</span><span class="p">(</span>
</span><span id="L-1139"><a href="#L-1139"><span class="linenos">1139</span></a>                                <span class="n">successor</span><span class="p">,</span>
</span><span id="L-1140"><a href="#L-1140"><span class="linenos">1140</span></a>                                <span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">successor</span><span class="p">][</span><span class="s1">&#39;callable&#39;</span><span class="p">],</span>
</span><span id="L-1141"><a href="#L-1141"><span class="linenos">1141</span></a>                                <span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">successor</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
</span><span id="L-1142"><a href="#L-1142"><span class="linenos">1142</span></a>                                <span class="n">_args</span><span class="p">,</span>
</span><span id="L-1143"><a href="#L-1143"><span class="linenos">1143</span></a>                                <span class="n">_kwargs</span>
</span><span id="L-1144"><a href="#L-1144"><span class="linenos">1144</span></a>                            <span class="p">)</span>
</span><span id="L-1145"><a href="#L-1145"><span class="linenos">1145</span></a>                            <span class="n">refs</span><span class="p">[</span><span class="n">successor</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_future</span>
</span><span id="L-1146"><a href="#L-1146"><span class="linenos">1146</span></a>                            <span class="n">pending</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">new_future</span><span class="p">)</span>
</span><span id="L-1147"><a href="#L-1147"><span class="linenos">1147</span></a>                            <span class="n">future_to_event</span><span class="p">[</span><span class="n">new_future</span><span class="p">]</span> <span class="o">=</span> <span class="n">successor</span>
</span><span id="L-1148"><a href="#L-1148"><span class="linenos">1148</span></a>                            <span class="n">started</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">successor</span><span class="p">)</span>
</span><span id="L-1149"><a href="#L-1149"><span class="linenos">1149</span></a>
</span><span id="L-1150"><a href="#L-1150"><span class="linenos">1150</span></a><span class="k">class</span><span class="w"> </span><span class="nc">QueueDAG</span><span class="p">(</span><span class="n">DAG</span><span class="p">):</span>
</span><span id="L-1151"><a href="#L-1151"><span class="linenos">1151</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1152"><a href="#L-1152"><span class="linenos">1152</span></a><span class="sd">    Directed Acyclic Graph used to queue and execute Pythonic callables in parallel,</span>
</span><span id="L-1153"><a href="#L-1153"><span class="linenos">1153</span></a><span class="sd">    while stringing the outputs of those callables in linear sequences.</span>
</span><span id="L-1154"><a href="#L-1154"><span class="linenos">1154</span></a>
</span><span id="L-1155"><a href="#L-1155"><span class="linenos">1155</span></a><span class="sd">    Queue DAG nodes are repeated until the DAG executor completes or is killed, depending on the</span>
</span><span id="L-1156"><a href="#L-1156"><span class="linenos">1156</span></a><span class="sd">    behavior of root nodes to determine if and/or when the DAG run has been completed.</span>
</span><span id="L-1157"><a href="#L-1157"><span class="linenos">1157</span></a>
</span><span id="L-1158"><a href="#L-1158"><span class="linenos">1158</span></a><span class="sd">    Root nodes will be re-executed until culled by one of two conditions:</span>
</span><span id="L-1159"><a href="#L-1159"><span class="linenos">1159</span></a><span class="sd">    1. A max number of iterations has been completed, or</span>
</span><span id="L-1160"><a href="#L-1160"><span class="linenos">1160</span></a><span class="sd">    2. The output of the root node&#39;s callable matches a lambda halt_condition.</span>
</span><span id="L-1161"><a href="#L-1161"><span class="linenos">1161</span></a>
</span><span id="L-1162"><a href="#L-1162"><span class="linenos">1162</span></a><span class="sd">    Both conditions can be set at run-time.</span>
</span><span id="L-1163"><a href="#L-1163"><span class="linenos">1163</span></a>
</span><span id="L-1164"><a href="#L-1164"><span class="linenos">1164</span></a><span class="sd">    QueueDAG can be nested inside a standard webber.DAG by passing qdag.execute as a callable.</span>
</span><span id="L-1165"><a href="#L-1165"><span class="linenos">1165</span></a><span class="sd">    Benchmarks show moderate overhead of 1.3-2.5x (~1-2ms fixed cost) when nested, due to the</span>
</span><span id="L-1166"><a href="#L-1166"><span class="linenos">1166</span></a><span class="sd">    outer DAG&#39;s ThreadPoolExecutor setup and task wrapper infrastructure. This is well within</span>
</span><span id="L-1167"><a href="#L-1167"><span class="linenos">1167</span></a><span class="sd">    acceptable millisecond-scale latency for most real-time applications.</span>
</span><span id="L-1168"><a href="#L-1168"><span class="linenos">1168</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1169"><a href="#L-1169"><span class="linenos">1169</span></a>
</span><span id="L-1170"><a href="#L-1170"><span class="linenos">1170</span></a>    <span class="n">conditions</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_T</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-1171"><a href="#L-1171"><span class="linenos">1171</span></a>
</span><span id="L-1172"><a href="#L-1172"><span class="linenos">1172</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1173"><a href="#L-1173"><span class="linenos">1173</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="L-1174"><a href="#L-1174"><span class="linenos">1174</span></a>
</span><span id="L-1175"><a href="#L-1175"><span class="linenos">1175</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-1176"><a href="#L-1176"><span class="linenos">1176</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1177"><a href="#L-1177"><span class="linenos">1177</span></a><span class="sd">        Adds a callable with positional and keyword arguments to the DAG&#39;s underlying graph.</span>
</span><span id="L-1178"><a href="#L-1178"><span class="linenos">1178</span></a><span class="sd">        On success, return unique identifier for the new node.</span>
</span><span id="L-1179"><a href="#L-1179"><span class="linenos">1179</span></a><span class="sd">        </span>
</span><span id="L-1180"><a href="#L-1180"><span class="linenos">1180</span></a><span class="sd">        Reserved key-words are used for Queue DAG definitions:</span>
</span><span id="L-1181"><a href="#L-1181"><span class="linenos">1181</span></a><span class="sd">        </span>
</span><span id="L-1182"><a href="#L-1182"><span class="linenos">1182</span></a><span class="sd">        - halt_condition: Lambda function used to halt repeated execution of a Queue DAG node that is independent of other callables.</span>
</span><span id="L-1183"><a href="#L-1183"><span class="linenos">1183</span></a>
</span><span id="L-1184"><a href="#L-1184"><span class="linenos">1184</span></a><span class="sd">        \t halt_condition = (lambda output: output == None) </span>
</span><span id="L-1185"><a href="#L-1185"><span class="linenos">1185</span></a>
</span><span id="L-1186"><a href="#L-1186"><span class="linenos">1186</span></a><span class="sd">        - iterator: Discrete number of times that Queue DAG node should be executed. Meant to be mutually-exclusive of halt_condition argument.</span>
</span><span id="L-1187"><a href="#L-1187"><span class="linenos">1187</span></a>
</span><span id="L-1188"><a href="#L-1188"><span class="linenos">1188</span></a><span class="sd">        - max_iter: Maximum number of times that Queue DAG node should be executed. Meant for use with halt_condition in order to prevent forever loop.</span>
</span><span id="L-1189"><a href="#L-1189"><span class="linenos">1189</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1190"><a href="#L-1190"><span class="linenos">1190</span></a>        <span class="n">halt_condition</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;halt_condition&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="L-1191"><a href="#L-1191"><span class="linenos">1191</span></a>        <span class="n">iterator</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;iterator&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="L-1192"><a href="#L-1192"><span class="linenos">1192</span></a>        <span class="n">max_iter</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;max_iter&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="L-1193"><a href="#L-1193"><span class="linenos">1193</span></a>
</span><span id="L-1194"><a href="#L-1194"><span class="linenos">1194</span></a>        <span class="n">return_val</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-1195"><a href="#L-1195"><span class="linenos">1195</span></a>        
</span><span id="L-1196"><a href="#L-1196"><span class="linenos">1196</span></a>        <span class="k">if</span> <span class="n">max_iter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1197"><a href="#L-1197"><span class="linenos">1197</span></a>            <span class="n">iter_limit</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">max_iter</span><span class="p">)</span>
</span><span id="L-1198"><a href="#L-1198"><span class="linenos">1198</span></a>        <span class="k">elif</span> <span class="n">iterator</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1199"><a href="#L-1199"><span class="linenos">1199</span></a>            <span class="n">iter_limit</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">iterator</span><span class="p">)</span>
</span><span id="L-1200"><a href="#L-1200"><span class="linenos">1200</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1201"><a href="#L-1201"><span class="linenos">1201</span></a>            <span class="n">iter_limit</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-1202"><a href="#L-1202"><span class="linenos">1202</span></a>        
</span><span id="L-1203"><a href="#L-1203"><span class="linenos">1203</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">conditions</span><span class="p">[</span><span class="n">return_val</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-1204"><a href="#L-1204"><span class="linenos">1204</span></a>            <span class="s1">&#39;halt_condition&#39;</span><span class="p">:</span> <span class="n">halt_condition</span><span class="p">,</span>
</span><span id="L-1205"><a href="#L-1205"><span class="linenos">1205</span></a>            <span class="s1">&#39;iter_limit&#39;</span><span class="p">:</span> <span class="n">iter_limit</span>
</span><span id="L-1206"><a href="#L-1206"><span class="linenos">1206</span></a>        <span class="p">}</span>
</span><span id="L-1207"><a href="#L-1207"><span class="linenos">1207</span></a>
</span><span id="L-1208"><a href="#L-1208"><span class="linenos">1208</span></a>        <span class="k">return</span> <span class="n">return_val</span>
</span><span id="L-1209"><a href="#L-1209"><span class="linenos">1209</span></a>        
</span><span id="L-1210"><a href="#L-1210"><span class="linenos">1210</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_edge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">u_of_edge</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_T</span><span class="o">.</span><span class="n">Callable</span><span class="p">],</span> <span class="n">v_of_edge</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_T</span><span class="o">.</span><span class="n">Callable</span><span class="p">],</span> <span class="n">continue_on</span><span class="p">:</span> <span class="n">Condition</span> <span class="o">=</span> <span class="n">Condition</span><span class="o">.</span><span class="n">Success</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_T</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
</span><span id="L-1211"><a href="#L-1211"><span class="linenos">1211</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1212"><a href="#L-1212"><span class="linenos">1212</span></a><span class="sd">        Adds an edge between nodes in the Queue DAG&#39;s underlying graph.</span>
</span><span id="L-1213"><a href="#L-1213"><span class="linenos">1213</span></a><span class="sd">        Queue DAG nodes may have a maximum of one child and one parent worker.</span>
</span><span id="L-1214"><a href="#L-1214"><span class="linenos">1214</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1215"><a href="#L-1215"><span class="linenos">1215</span></a>        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="p">(</span><span class="n">u_of_edge</span><span class="p">,</span> <span class="n">v_of_edge</span><span class="p">):</span>
</span><span id="L-1216"><a href="#L-1216"><span class="linenos">1216</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-1217"><a href="#L-1217"><span class="linenos">1217</span></a>                <span class="n">node_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_id</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
</span><span id="L-1218"><a href="#L-1218"><span class="linenos">1218</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="L-1219"><a href="#L-1219"><span class="linenos">1219</span></a>                <span class="k">continue</span>
</span><span id="L-1220"><a href="#L-1220"><span class="linenos">1220</span></a>        
</span><span id="L-1221"><a href="#L-1221"><span class="linenos">1221</span></a>            <span class="nb">filter</span> <span class="o">=</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="n">e</span><span class="o">.</span><span class="n">parent</span> <span class="o">==</span> <span class="n">node_id</span><span class="p">)</span> <span class="k">if</span> <span class="n">node</span> <span class="o">==</span> <span class="n">u_of_edge</span> <span class="k">else</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="n">e</span><span class="o">.</span><span class="n">child</span> <span class="o">==</span> <span class="n">node_id</span><span class="p">)</span>
</span><span id="L-1222"><a href="#L-1222"><span class="linenos">1222</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-1223"><a href="#L-1223"><span class="linenos">1223</span></a>                <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filter_edges</span><span class="p">(</span><span class="nb">filter</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="L-1224"><a href="#L-1224"><span class="linenos">1224</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-1225"><a href="#L-1225"><span class="linenos">1225</span></a>                <span class="n">e</span><span class="o">.</span><span class="n">add_note</span><span class="p">(</span><span class="s2">&quot;Queue DAG nodes may have a maximum of one child and one parent worker.&quot;</span><span class="p">)</span>
</span><span id="L-1226"><a href="#L-1226"><span class="linenos">1226</span></a>                <span class="k">raise</span> <span class="n">e</span>
</span><span id="L-1227"><a href="#L-1227"><span class="linenos">1227</span></a>
</span><span id="L-1228"><a href="#L-1228"><span class="linenos">1228</span></a>        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">u_of_edge</span><span class="p">,</span> <span class="n">v_of_edge</span><span class="p">,</span> <span class="n">continue_on</span><span class="p">)</span>
</span><span id="L-1229"><a href="#L-1229"><span class="linenos">1229</span></a>
</span><span id="L-1230"><a href="#L-1230"><span class="linenos">1230</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">promises</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">,</span> <span class="n">return_ref</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">print_exc</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_T</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1231"><a href="#L-1231"><span class="linenos">1231</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1232"><a href="#L-1232"><span class="linenos">1232</span></a><span class="sd">        Basic wrapper for execution of the DAG&#39;s underlying callables.</span>
</span><span id="L-1233"><a href="#L-1233"><span class="linenos">1233</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1234"><a href="#L-1234"><span class="linenos">1234</span></a>        <span class="n">queues</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_q</span><span class="o">.</span><span class="n">LifoQueue</span><span class="p">[</span><span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-1235"><a href="#L-1235"><span class="linenos">1235</span></a>        <span class="n">processes</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_futures</span><span class="o">.</span><span class="n">Future</span><span class="p">[</span><span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-1236"><a href="#L-1236"><span class="linenos">1236</span></a>        <span class="n">join</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="L-1237"><a href="#L-1237"><span class="linenos">1237</span></a>        <span class="n">end_proc</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-1238"><a href="#L-1238"><span class="linenos">1238</span></a>
</span><span id="L-1239"><a href="#L-1239"><span class="linenos">1239</span></a>        <span class="n">_promises</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">_it</span><span class="o">.</span><span class="n">pairwise</span><span class="p">(</span><span class="n">promises</span><span class="p">)</span> <span class="p">}</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">promises</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">{}</span>
</span><span id="L-1240"><a href="#L-1240"><span class="linenos">1240</span></a>
</span><span id="L-1241"><a href="#L-1241"><span class="linenos">1241</span></a>        <span class="k">with</span> <span class="n">_TaskLogger</span><span class="p">(</span><span class="s2">&quot;root&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">_</span><span class="p">:</span>
</span><span id="L-1242"><a href="#L-1242"><span class="linenos">1242</span></a>
</span><span id="L-1243"><a href="#L-1243"><span class="linenos">1243</span></a>            <span class="c1"># Skip execution if there are no callables in scope.</span>
</span><span id="L-1244"><a href="#L-1244"><span class="linenos">1244</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1245"><a href="#L-1245"><span class="linenos">1245</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Given DAG has no callables in scope. Skipping execution...&#39;</span><span class="p">)</span>
</span><span id="L-1246"><a href="#L-1246"><span class="linenos">1246</span></a>                <span class="k">return</span>
</span><span id="L-1247"><a href="#L-1247"><span class="linenos">1247</span></a>
</span><span id="L-1248"><a href="#L-1248"><span class="linenos">1248</span></a>            <span class="k">with</span> <span class="n">_futures</span><span class="o">.</span><span class="n">ThreadPoolExecutor</span><span class="p">()</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
</span><span id="L-1249"><a href="#L-1249"><span class="linenos">1249</span></a>
</span><span id="L-1250"><a href="#L-1250"><span class="linenos">1250</span></a>                <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">:</span>
</span><span id="L-1251"><a href="#L-1251"><span class="linenos">1251</span></a>                    <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
</span><span id="L-1252"><a href="#L-1252"><span class="linenos">1252</span></a>                    <span class="n">queues</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">_q</span><span class="o">.</span><span class="n">LifoQueue</span><span class="p">()</span>
</span><span id="L-1253"><a href="#L-1253"><span class="linenos">1253</span></a>                    <span class="n">node</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
</span><span id="L-1254"><a href="#L-1254"><span class="linenos">1254</span></a>                        <span class="s1">&#39;callable&#39;</span><span class="p">:</span> <span class="n">_queue</span><span class="o">.</span><span class="n">_worker</span><span class="p">,</span>
</span><span id="L-1255"><a href="#L-1255"><span class="linenos">1255</span></a>                        <span class="s1">&#39;args&#39;</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">(),</span>
</span><span id="L-1256"><a href="#L-1256"><span class="linenos">1256</span></a>                        <span class="s1">&#39;kwargs&#39;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="L-1257"><a href="#L-1257"><span class="linenos">1257</span></a>                            <span class="s1">&#39;work&#39;</span><span class="p">:</span> <span class="n">node</span><span class="o">.</span><span class="n">callable</span><span class="p">,</span>
</span><span id="L-1258"><a href="#L-1258"><span class="linenos">1258</span></a>                            <span class="s1">&#39;args&#39;</span><span class="p">:</span> <span class="n">node</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="s1">&#39;kwargs&#39;</span><span class="p">:</span> <span class="n">node</span><span class="o">.</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="L-1259"><a href="#L-1259"><span class="linenos">1259</span></a>                            <span class="s1">&#39;promises&#39;</span><span class="p">:</span> <span class="n">_promises</span><span class="p">,</span>
</span><span id="L-1260"><a href="#L-1260"><span class="linenos">1260</span></a>                            <span class="s1">&#39;print_exc&#39;</span><span class="p">:</span> <span class="n">print_exc</span><span class="p">,</span>
</span><span id="L-1261"><a href="#L-1261"><span class="linenos">1261</span></a>                            <span class="s1">&#39;halt_condition&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">conditions</span><span class="p">[</span><span class="nb">id</span><span class="p">][</span><span class="s1">&#39;halt_condition&#39;</span><span class="p">],</span>
</span><span id="L-1262"><a href="#L-1262"><span class="linenos">1262</span></a>                            <span class="s1">&#39;iter_limit&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">conditions</span><span class="p">[</span><span class="nb">id</span><span class="p">][</span><span class="s1">&#39;iter_limit&#39;</span><span class="p">],</span>
</span><span id="L-1263"><a href="#L-1263"><span class="linenos">1263</span></a>                            <span class="s1">&#39;out_queue&#39;</span><span class="p">:</span> <span class="n">queues</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
</span><span id="L-1264"><a href="#L-1264"><span class="linenos">1264</span></a>                        <span class="p">}</span>
</span><span id="L-1265"><a href="#L-1265"><span class="linenos">1265</span></a>                    <span class="p">})</span>
</span><span id="L-1266"><a href="#L-1266"><span class="linenos">1266</span></a>                    <span class="n">processes</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span>
</span><span id="L-1267"><a href="#L-1267"><span class="linenos">1267</span></a>                        <span class="n">_event_wrapper</span><span class="p">,</span>
</span><span id="L-1268"><a href="#L-1268"><span class="linenos">1268</span></a>                        <span class="n">_callable</span><span class="o">=</span><span class="n">node</span><span class="p">[</span><span class="s1">&#39;callable&#39;</span><span class="p">],</span>
</span><span id="L-1269"><a href="#L-1269"><span class="linenos">1269</span></a>                        <span class="n">_name</span><span class="o">=</span><span class="n">node</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
</span><span id="L-1270"><a href="#L-1270"><span class="linenos">1270</span></a>                        <span class="n">_args</span><span class="o">=</span><span class="n">node</span><span class="p">[</span><span class="s1">&#39;args&#39;</span><span class="p">],</span>
</span><span id="L-1271"><a href="#L-1271"><span class="linenos">1271</span></a>                        <span class="n">_kwargs</span><span class="o">=</span><span class="n">node</span><span class="p">[</span><span class="s1">&#39;kwargs&#39;</span><span class="p">]</span>
</span><span id="L-1272"><a href="#L-1272"><span class="linenos">1272</span></a>                    <span class="p">)</span>
</span><span id="L-1273"><a href="#L-1273"><span class="linenos">1273</span></a>                
</span><span id="L-1274"><a href="#L-1274"><span class="linenos">1274</span></a>                <span class="k">for</span> <span class="n">parent_id</span><span class="p">,</span> <span class="nb">id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">:</span>
</span><span id="L-1275"><a href="#L-1275"><span class="linenos">1275</span></a>                    <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
</span><span id="L-1276"><a href="#L-1276"><span class="linenos">1276</span></a>                    <span class="n">queues</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">_q</span><span class="o">.</span><span class="n">LifoQueue</span><span class="p">()</span>
</span><span id="L-1277"><a href="#L-1277"><span class="linenos">1277</span></a>                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">successors</span><span class="p">(</span><span class="nb">id</span><span class="p">)))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1278"><a href="#L-1278"><span class="linenos">1278</span></a>                        <span class="n">end_proc</span> <span class="o">=</span> <span class="nb">id</span>
</span><span id="L-1279"><a href="#L-1279"><span class="linenos">1279</span></a>                    <span class="n">node</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
</span><span id="L-1280"><a href="#L-1280"><span class="linenos">1280</span></a>                        <span class="s1">&#39;callable&#39;</span><span class="p">:</span> <span class="n">_queue</span><span class="o">.</span><span class="n">_worker</span><span class="p">,</span>
</span><span id="L-1281"><a href="#L-1281"><span class="linenos">1281</span></a>                        <span class="s1">&#39;args&#39;</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">(),</span>
</span><span id="L-1282"><a href="#L-1282"><span class="linenos">1282</span></a>                        <span class="s1">&#39;kwargs&#39;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="L-1283"><a href="#L-1283"><span class="linenos">1283</span></a>                            <span class="s1">&#39;work&#39;</span><span class="p">:</span> <span class="n">node</span><span class="o">.</span><span class="n">callable</span><span class="p">,</span>
</span><span id="L-1284"><a href="#L-1284"><span class="linenos">1284</span></a>                            <span class="s1">&#39;args&#39;</span><span class="p">:</span> <span class="n">node</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="s1">&#39;kwargs&#39;</span><span class="p">:</span> <span class="n">node</span><span class="o">.</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="L-1285"><a href="#L-1285"><span class="linenos">1285</span></a>                            <span class="s1">&#39;promises&#39;</span><span class="p">:</span> <span class="n">_promises</span><span class="p">,</span>
</span><span id="L-1286"><a href="#L-1286"><span class="linenos">1286</span></a>                            <span class="s1">&#39;print_exc&#39;</span><span class="p">:</span> <span class="n">print_exc</span><span class="p">,</span>
</span><span id="L-1287"><a href="#L-1287"><span class="linenos">1287</span></a>                            <span class="s1">&#39;parent_id&#39;</span><span class="p">:</span> <span class="n">parent_id</span><span class="p">,</span>
</span><span id="L-1288"><a href="#L-1288"><span class="linenos">1288</span></a>                            <span class="s1">&#39;parent_process&#39;</span><span class="p">:</span> <span class="n">processes</span><span class="p">[</span><span class="n">parent_id</span><span class="p">],</span>
</span><span id="L-1289"><a href="#L-1289"><span class="linenos">1289</span></a>                            <span class="s1">&#39;in_queue&#39;</span><span class="p">:</span> <span class="n">queues</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">parent_id</span><span class="p">),</span>
</span><span id="L-1290"><a href="#L-1290"><span class="linenos">1290</span></a>                            <span class="s1">&#39;out_queue&#39;</span><span class="p">:</span> <span class="n">queues</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
</span><span id="L-1291"><a href="#L-1291"><span class="linenos">1291</span></a>                        <span class="p">}</span>
</span><span id="L-1292"><a href="#L-1292"><span class="linenos">1292</span></a>                    <span class="p">})</span>
</span><span id="L-1293"><a href="#L-1293"><span class="linenos">1293</span></a>                    <span class="n">processes</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span>
</span><span id="L-1294"><a href="#L-1294"><span class="linenos">1294</span></a>                        <span class="n">_event_wrapper</span><span class="p">,</span>
</span><span id="L-1295"><a href="#L-1295"><span class="linenos">1295</span></a>                        <span class="n">_callable</span><span class="o">=</span><span class="n">node</span><span class="p">[</span><span class="s1">&#39;callable&#39;</span><span class="p">],</span>
</span><span id="L-1296"><a href="#L-1296"><span class="linenos">1296</span></a>                        <span class="n">_name</span><span class="o">=</span><span class="n">node</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
</span><span id="L-1297"><a href="#L-1297"><span class="linenos">1297</span></a>                        <span class="n">_args</span><span class="o">=</span><span class="n">node</span><span class="p">[</span><span class="s1">&#39;args&#39;</span><span class="p">],</span>
</span><span id="L-1298"><a href="#L-1298"><span class="linenos">1298</span></a>                        <span class="n">_kwargs</span><span class="o">=</span><span class="n">node</span><span class="p">[</span><span class="s1">&#39;kwargs&#39;</span><span class="p">]</span>
</span><span id="L-1299"><a href="#L-1299"><span class="linenos">1299</span></a>                    <span class="p">)</span>
</span><span id="L-1300"><a href="#L-1300"><span class="linenos">1300</span></a>
</span><span id="L-1301"><a href="#L-1301"><span class="linenos">1301</span></a>            <span class="c1"># For single-node DAGs with no edges, end_proc is the root node</span>
</span><span id="L-1302"><a href="#L-1302"><span class="linenos">1302</span></a>            <span class="k">if</span> <span class="n">end_proc</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1303"><a href="#L-1303"><span class="linenos">1303</span></a>                <span class="n">end_proc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-1304"><a href="#L-1304"><span class="linenos">1304</span></a>
</span><span id="L-1305"><a href="#L-1305"><span class="linenos">1305</span></a>            <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">join</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">):</span>
</span><span id="L-1306"><a href="#L-1306"><span class="linenos">1306</span></a>                <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
</span><span id="L-1307"><a href="#L-1307"><span class="linenos">1307</span></a>                    <span class="k">if</span> <span class="n">processes</span><span class="p">[</span><span class="n">node</span><span class="p">]</span><span class="o">.</span><span class="n">done</span><span class="p">():</span>
</span><span id="L-1308"><a href="#L-1308"><span class="linenos">1308</span></a>                        <span class="n">join</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
</span><span id="L-1309"><a href="#L-1309"><span class="linenos">1309</span></a>
</span><span id="L-1310"><a href="#L-1310"><span class="linenos">1310</span></a>            <span class="n">return_val</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1311"><a href="#L-1311"><span class="linenos">1311</span></a>            <span class="k">if</span> <span class="n">end_proc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">end_proc</span> <span class="ow">in</span> <span class="n">queues</span><span class="p">:</span>
</span><span id="L-1312"><a href="#L-1312"><span class="linenos">1312</span></a>                <span class="k">while</span> <span class="ow">not</span> <span class="n">queues</span><span class="p">[</span><span class="n">end_proc</span><span class="p">]</span><span class="o">.</span><span class="n">empty</span><span class="p">():</span>
</span><span id="L-1313"><a href="#L-1313"><span class="linenos">1313</span></a>                    <span class="n">return_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">queues</span><span class="p">[</span><span class="n">end_proc</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">())</span>
</span><span id="L-1314"><a href="#L-1314"><span class="linenos">1314</span></a>
</span><span id="L-1315"><a href="#L-1315"><span class="linenos">1315</span></a>            <span class="k">return</span> <span class="n">return_val</span>
</span></pre></div>


            </section>
                <section id="DAG">
                            <input id="DAG-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">DAG</span>:

                <label class="view-source-button" for="DAG-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DAG"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DAG-195"><a href="#DAG-195"><span class="linenos"> 195</span></a><span class="k">class</span><span class="w"> </span><span class="nc">DAG</span><span class="p">:</span>
</span><span id="DAG-196"><a href="#DAG-196"><span class="linenos"> 196</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DAG-197"><a href="#DAG-197"><span class="linenos"> 197</span></a><span class="sd">    Directed Acyclic Graph used to represent Pythonic tasks in parallel.</span>
</span><span id="DAG-198"><a href="#DAG-198"><span class="linenos"> 198</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="DAG-199"><a href="#DAG-199"><span class="linenos"> 199</span></a>    <span class="n">graph</span><span class="p">:</span> <span class="n">_nx</span><span class="o">.</span><span class="n">DiGraph</span>
</span><span id="DAG-200"><a href="#DAG-200"><span class="linenos"> 200</span></a>    <span class="n">_callable_to_id</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="n">_T</span><span class="o">.</span><span class="n">Callable</span><span class="p">,</span> <span class="n">_T</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span>  <span class="c1"># O(1) callable-&gt;node_id lookup cache (None = duplicates)</span>
</span><span id="DAG-201"><a href="#DAG-201"><span class="linenos"> 201</span></a>
</span><span id="DAG-202"><a href="#DAG-202"><span class="linenos"> 202</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_callable_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Callable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_T</span><span class="o">.</span><span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;many&#39;</span><span class="p">]:</span>
</span><span id="DAG-203"><a href="#DAG-203"><span class="linenos"> 203</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns &#39;none&#39; if not in DAG, &#39;one&#39; if unique, &#39;many&#39; if duplicated.</span>
</span><span id="DAG-204"><a href="#DAG-204"><span class="linenos"> 204</span></a><span class="sd">        O(1) lookup using _callable_to_id cache.&quot;&quot;&quot;</span>
</span><span id="DAG-205"><a href="#DAG-205"><span class="linenos"> 205</span></a>        <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_callable_to_id</span><span class="p">:</span>
</span><span id="DAG-206"><a href="#DAG-206"><span class="linenos"> 206</span></a>            <span class="k">return</span> <span class="s1">&#39;none&#39;</span>
</span><span id="DAG-207"><a href="#DAG-207"><span class="linenos"> 207</span></a>        <span class="k">return</span> <span class="s1">&#39;one&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_callable_to_id</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s1">&#39;many&#39;</span>
</span><span id="DAG-208"><a href="#DAG-208"><span class="linenos"> 208</span></a>
</span><span id="DAG-209"><a href="#DAG-209"><span class="linenos"> 209</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_assign_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">,</span> <span class="n">new_callables</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="n">_T</span><span class="o">.</span><span class="n">Callable</span><span class="p">,</span> <span class="n">_T</span><span class="o">.</span><span class="n">Callable</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="DAG-210"><a href="#DAG-210"><span class="linenos"> 210</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Helper to resolve node to its ID, adding to new_callables dict if needed.&quot;&quot;&quot;</span>
</span><span id="DAG-211"><a href="#DAG-211"><span class="linenos"> 211</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">_iscallable</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
</span><span id="DAG-212"><a href="#DAG-212"><span class="linenos"> 212</span></a>            <span class="k">return</span> <span class="n">n</span>
</span><span id="DAG-213"><a href="#DAG-213"><span class="linenos"> 213</span></a>        <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_callable_status</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</span><span id="DAG-214"><a href="#DAG-214"><span class="linenos"> 214</span></a>        <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="s1">&#39;many&#39;</span><span class="p">:</span>
</span><span id="DAG-215"><a href="#DAG-215"><span class="linenos"> 215</span></a>            <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Callable </span><span class="si">{</span><span class="n">n</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> &quot;</span> \
</span><span id="DAG-216"><a href="#DAG-216"><span class="linenos"> 216</span></a>                <span class="o">+</span> <span class="s2">&quot;exists more than once in this DAG. &quot;</span> \
</span><span id="DAG-217"><a href="#DAG-217"><span class="linenos"> 217</span></a>                <span class="o">+</span> <span class="s2">&quot;Use the unique string identifier of the required node.&quot;</span>
</span><span id="DAG-218"><a href="#DAG-218"><span class="linenos"> 218</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="DAG-219"><a href="#DAG-219"><span class="linenos"> 219</span></a>        <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="s1">&#39;one&#39;</span><span class="p">:</span>
</span><span id="DAG-220"><a href="#DAG-220"><span class="linenos"> 220</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_callable_to_id</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>  <span class="c1"># type: ignore[return-value]</span>
</span><span id="DAG-221"><a href="#DAG-221"><span class="linenos"> 221</span></a>        <span class="n">new_callables</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">n</span>
</span><span id="DAG-222"><a href="#DAG-222"><span class="linenos"> 222</span></a>        <span class="k">return</span> <span class="n">_edges</span><span class="o">.</span><span class="n">label_node</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</span><span id="DAG-223"><a href="#DAG-223"><span class="linenos"> 223</span></a>
</span><span id="DAG-224"><a href="#DAG-224"><span class="linenos"> 224</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="DAG-225"><a href="#DAG-225"><span class="linenos"> 225</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DAG-226"><a href="#DAG-226"><span class="linenos"> 226</span></a><span class="sd">        Adds a callable with positional and keyword arguments to the DAG&#39;s underlying graph.</span>
</span><span id="DAG-227"><a href="#DAG-227"><span class="linenos"> 227</span></a><span class="sd">        On success, return unique identifier for the new node.</span>
</span><span id="DAG-228"><a href="#DAG-228"><span class="linenos"> 228</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DAG-229"><a href="#DAG-229"><span class="linenos"> 229</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">_iscallable</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
</span><span id="DAG-230"><a href="#DAG-230"><span class="linenos"> 230</span></a>            <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">: requested node is not a callable Python function.&quot;</span>
</span><span id="DAG-231"><a href="#DAG-231"><span class="linenos"> 231</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="DAG-232"><a href="#DAG-232"><span class="linenos"> 232</span></a>
</span><span id="DAG-233"><a href="#DAG-233"><span class="linenos"> 233</span></a>        <span class="n">node_name</span> <span class="o">=</span> <span class="n">_edges</span><span class="o">.</span><span class="n">label_node</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
</span><span id="DAG-234"><a href="#DAG-234"><span class="linenos"> 234</span></a>
</span><span id="DAG-235"><a href="#DAG-235"><span class="linenos"> 235</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
</span><span id="DAG-236"><a href="#DAG-236"><span class="linenos"> 236</span></a>            <span class="n">arg</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">_xcoms</span><span class="o">.</span><span class="n">Promise</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolve_promise</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
</span><span id="DAG-237"><a href="#DAG-237"><span class="linenos"> 237</span></a>            <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span>
</span><span id="DAG-238"><a href="#DAG-238"><span class="linenos"> 238</span></a>        <span class="p">)</span>
</span><span id="DAG-239"><a href="#DAG-239"><span class="linenos"> 239</span></a>
</span><span id="DAG-240"><a href="#DAG-240"><span class="linenos"> 240</span></a>        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="DAG-241"><a href="#DAG-241"><span class="linenos"> 241</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">_xcoms</span><span class="o">.</span><span class="n">Promise</span><span class="p">):</span>
</span><span id="DAG-242"><a href="#DAG-242"><span class="linenos"> 242</span></a>                <span class="n">kwargs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolve_promise</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
</span><span id="DAG-243"><a href="#DAG-243"><span class="linenos"> 243</span></a>
</span><span id="DAG-244"><a href="#DAG-244"><span class="linenos"> 244</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span>
</span><span id="DAG-245"><a href="#DAG-245"><span class="linenos"> 245</span></a>            <span class="n">node_for_adding</span><span class="o">=</span><span class="n">node_name</span><span class="p">,</span>
</span><span id="DAG-246"><a href="#DAG-246"><span class="linenos"> 246</span></a>            <span class="nb">callable</span><span class="o">=</span><span class="n">node</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="DAG-247"><a href="#DAG-247"><span class="linenos"> 247</span></a>            <span class="n">name</span><span class="o">=</span><span class="n">node</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
</span><span id="DAG-248"><a href="#DAG-248"><span class="linenos"> 248</span></a>            <span class="nb">id</span><span class="o">=</span><span class="n">node_name</span>
</span><span id="DAG-249"><a href="#DAG-249"><span class="linenos"> 249</span></a>        <span class="p">)</span>
</span><span id="DAG-250"><a href="#DAG-250"><span class="linenos"> 250</span></a>
</span><span id="DAG-251"><a href="#DAG-251"><span class="linenos"> 251</span></a>        <span class="c1"># Populate callable-&gt;id cache for O(1) lookup</span>
</span><span id="DAG-252"><a href="#DAG-252"><span class="linenos"> 252</span></a>        <span class="c1"># If callable already exists, mark as None to indicate duplicates</span>
</span><span id="DAG-253"><a href="#DAG-253"><span class="linenos"> 253</span></a>        <span class="k">if</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_callable_to_id</span><span class="p">:</span>
</span><span id="DAG-254"><a href="#DAG-254"><span class="linenos"> 254</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_callable_to_id</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Multiple occurrences - must use string ID</span>
</span><span id="DAG-255"><a href="#DAG-255"><span class="linenos"> 255</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DAG-256"><a href="#DAG-256"><span class="linenos"> 256</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_callable_to_id</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">node_name</span>
</span><span id="DAG-257"><a href="#DAG-257"><span class="linenos"> 257</span></a>
</span><span id="DAG-258"><a href="#DAG-258"><span class="linenos"> 258</span></a>        <span class="k">return</span> <span class="n">node_name</span>
</span><span id="DAG-259"><a href="#DAG-259"><span class="linenos"> 259</span></a>
</span><span id="DAG-260"><a href="#DAG-260"><span class="linenos"> 260</span></a>
</span><span id="DAG-261"><a href="#DAG-261"><span class="linenos"> 261</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_edge</span><span class="p">(</span>
</span><span id="DAG-262"><a href="#DAG-262"><span class="linenos"> 262</span></a>            <span class="bp">self</span><span class="p">,</span> 
</span><span id="DAG-263"><a href="#DAG-263"><span class="linenos"> 263</span></a>            <span class="n">u_of_edge</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_T</span><span class="o">.</span><span class="n">Callable</span><span class="p">],</span> <span class="n">v_of_edge</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_T</span><span class="o">.</span><span class="n">Callable</span><span class="p">],</span>
</span><span id="DAG-264"><a href="#DAG-264"><span class="linenos"> 264</span></a>            <span class="n">continue_on</span><span class="p">:</span> <span class="n">Condition</span> <span class="o">=</span> <span class="n">Condition</span><span class="o">.</span><span class="n">Success</span>
</span><span id="DAG-265"><a href="#DAG-265"><span class="linenos"> 265</span></a>        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_T</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="DAG-266"><a href="#DAG-266"><span class="linenos"> 266</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DAG-267"><a href="#DAG-267"><span class="linenos"> 267</span></a><span class="sd">        Adds an edge between nodes in the DAG&#39;s underlying graph,</span>
</span><span id="DAG-268"><a href="#DAG-268"><span class="linenos"> 268</span></a><span class="sd">        so long as the requested edge is unique and has not been added previously.</span>
</span><span id="DAG-269"><a href="#DAG-269"><span class="linenos"> 269</span></a>
</span><span id="DAG-270"><a href="#DAG-270"><span class="linenos"> 270</span></a><span class="sd">        On success, returns Tuple of the new edge&#39;s unique identifiers.</span>
</span><span id="DAG-271"><a href="#DAG-271"><span class="linenos"> 271</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DAG-272"><a href="#DAG-272"><span class="linenos"> 272</span></a>        <span class="c1"># Validate inputs prior to execution</span>
</span><span id="DAG-273"><a href="#DAG-273"><span class="linenos"> 273</span></a>        <span class="c1"># - Nodes must be identifiers or callables</span>
</span><span id="DAG-274"><a href="#DAG-274"><span class="linenos"> 274</span></a>        <span class="c1"># - Conditions must belong to the webber.edges.Condition class</span>
</span><span id="DAG-275"><a href="#DAG-275"><span class="linenos"> 275</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">u_of_edge</span><span class="p">,</span><span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="n">_iscallable</span><span class="p">(</span><span class="n">u_of_edge</span><span class="p">)):</span>
</span><span id="DAG-276"><a href="#DAG-276"><span class="linenos"> 276</span></a>            <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Outgoing node </span><span class="si">{</span><span class="n">u_of_edge</span><span class="si">}</span><span class="s2"> must be a string or a Python callable&quot;</span>
</span><span id="DAG-277"><a href="#DAG-277"><span class="linenos"> 277</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="DAG-278"><a href="#DAG-278"><span class="linenos"> 278</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">v_of_edge</span><span class="p">,</span><span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="n">_iscallable</span><span class="p">(</span><span class="n">v_of_edge</span><span class="p">)):</span>
</span><span id="DAG-279"><a href="#DAG-279"><span class="linenos"> 279</span></a>            <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Outgoing node </span><span class="si">{</span><span class="n">v_of_edge</span><span class="si">}</span><span class="s2"> must be a string or a Python callable&quot;</span>
</span><span id="DAG-280"><a href="#DAG-280"><span class="linenos"> 280</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="DAG-281"><a href="#DAG-281"><span class="linenos"> 281</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">continue_on</span><span class="p">,</span> <span class="n">Condition</span><span class="p">):</span>
</span><span id="DAG-282"><a href="#DAG-282"><span class="linenos"> 282</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Edge conditions must use the webber.edges.Condition class.&quot;</span><span class="p">)</span>
</span><span id="DAG-283"><a href="#DAG-283"><span class="linenos"> 283</span></a>
</span><span id="DAG-284"><a href="#DAG-284"><span class="linenos"> 284</span></a>        <span class="c1"># Base Case 0: No nodes are present in the DAG:</span>
</span><span id="DAG-285"><a href="#DAG-285"><span class="linenos"> 285</span></a>        <span class="c1"># Ensure that both nodes are callables, then add both to the graph and</span>
</span><span id="DAG-286"><a href="#DAG-286"><span class="linenos"> 286</span></a>        <span class="c1"># assign the outgoing node as a root.</span>
</span><span id="DAG-287"><a href="#DAG-287"><span class="linenos"> 287</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="DAG-288"><a href="#DAG-288"><span class="linenos"> 288</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">_iscallable</span><span class="p">(</span><span class="n">u_of_edge</span><span class="p">):</span>
</span><span id="DAG-289"><a href="#DAG-289"><span class="linenos"> 289</span></a>                <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Outgoing node </span><span class="si">{</span><span class="n">u_of_edge</span><span class="si">}</span><span class="s2"> is not defined in this DAG&#39;s scope.&quot;</span>
</span><span id="DAG-290"><a href="#DAG-290"><span class="linenos"> 290</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="DAG-291"><a href="#DAG-291"><span class="linenos"> 291</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">_iscallable</span><span class="p">(</span><span class="n">v_of_edge</span><span class="p">):</span>
</span><span id="DAG-292"><a href="#DAG-292"><span class="linenos"> 292</span></a>                <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Incoming node </span><span class="si">{</span><span class="n">v_of_edge</span><span class="si">}</span><span class="s2"> is not defined in this DAG&#39;s scope.&quot;</span>
</span><span id="DAG-293"><a href="#DAG-293"><span class="linenos"> 293</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="DAG-294"><a href="#DAG-294"><span class="linenos"> 294</span></a>            <span class="n">outgoing_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">u_of_edge</span><span class="p">)</span>
</span><span id="DAG-295"><a href="#DAG-295"><span class="linenos"> 295</span></a>            <span class="n">incoming_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">v_of_edge</span><span class="p">)</span>
</span><span id="DAG-296"><a href="#DAG-296"><span class="linenos"> 296</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">outgoing_node</span><span class="p">,</span> <span class="n">incoming_node</span><span class="p">,</span> <span class="n">Condition</span> <span class="o">=</span> <span class="n">continue_on</span><span class="p">)</span>
</span><span id="DAG-297"><a href="#DAG-297"><span class="linenos"> 297</span></a>            <span class="k">return</span> <span class="p">(</span><span class="n">outgoing_node</span><span class="p">,</span> <span class="n">incoming_node</span><span class="p">)</span>
</span><span id="DAG-298"><a href="#DAG-298"><span class="linenos"> 298</span></a>
</span><span id="DAG-299"><a href="#DAG-299"><span class="linenos"> 299</span></a>        <span class="n">new_callables</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="n">_T</span><span class="o">.</span><span class="n">Callable</span><span class="p">,</span> <span class="n">_T</span><span class="o">.</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="DAG-300"><a href="#DAG-300"><span class="linenos"> 300</span></a>
</span><span id="DAG-301"><a href="#DAG-301"><span class="linenos"> 301</span></a>        <span class="k">if</span> <span class="n">_iscallable</span><span class="p">(</span><span class="n">u_of_edge</span><span class="p">)</span> <span class="ow">and</span> <span class="n">_iscallable</span><span class="p">(</span><span class="n">v_of_edge</span><span class="p">):</span>
</span><span id="DAG-302"><a href="#DAG-302"><span class="linenos"> 302</span></a>            <span class="c1"># Type narrowing: we&#39;ve verified both are callables</span>
</span><span id="DAG-303"><a href="#DAG-303"><span class="linenos"> 303</span></a>            <span class="n">u_callable</span> <span class="o">=</span> <span class="n">_T</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">_T</span><span class="o">.</span><span class="n">Callable</span><span class="p">,</span> <span class="n">u_of_edge</span><span class="p">)</span>
</span><span id="DAG-304"><a href="#DAG-304"><span class="linenos"> 304</span></a>            <span class="n">v_callable</span> <span class="o">=</span> <span class="n">_T</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">_T</span><span class="o">.</span><span class="n">Callable</span><span class="p">,</span> <span class="n">v_of_edge</span><span class="p">)</span>
</span><span id="DAG-305"><a href="#DAG-305"><span class="linenos"> 305</span></a>
</span><span id="DAG-306"><a href="#DAG-306"><span class="linenos"> 306</span></a>            <span class="c1"># Error Cases 0, 1: Either of the callables appear more than once in the DAG.</span>
</span><span id="DAG-307"><a href="#DAG-307"><span class="linenos"> 307</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_callable_status</span><span class="p">(</span><span class="n">u_callable</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;many&#39;</span><span class="p">:</span>
</span><span id="DAG-308"><a href="#DAG-308"><span class="linenos"> 308</span></a>                <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Callable </span><span class="si">{</span><span class="n">u_callable</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> &quot;</span> \
</span><span id="DAG-309"><a href="#DAG-309"><span class="linenos"> 309</span></a>                        <span class="o">+</span> <span class="s2">&quot;exists more than once in this DAG. &quot;</span> \
</span><span id="DAG-310"><a href="#DAG-310"><span class="linenos"> 310</span></a>                        <span class="o">+</span> <span class="s2">&quot;Use the unique string identifier of the required node.&quot;</span>
</span><span id="DAG-311"><a href="#DAG-311"><span class="linenos"> 311</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="DAG-312"><a href="#DAG-312"><span class="linenos"> 312</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_callable_status</span><span class="p">(</span><span class="n">v_callable</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;many&#39;</span><span class="p">:</span>
</span><span id="DAG-313"><a href="#DAG-313"><span class="linenos"> 313</span></a>                <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Callable </span><span class="si">{</span><span class="n">v_callable</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> &quot;</span> \
</span><span id="DAG-314"><a href="#DAG-314"><span class="linenos"> 314</span></a>                        <span class="o">+</span> <span class="s2">&quot;exists more than once in this DAG. &quot;</span> \
</span><span id="DAG-315"><a href="#DAG-315"><span class="linenos"> 315</span></a>                        <span class="o">+</span> <span class="s2">&quot;Use the unique string identifier of the required node.&quot;</span>
</span><span id="DAG-316"><a href="#DAG-316"><span class="linenos"> 316</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="DAG-317"><a href="#DAG-317"><span class="linenos"> 317</span></a>
</span><span id="DAG-318"><a href="#DAG-318"><span class="linenos"> 318</span></a>            <span class="c1"># Base Case 1: Both args are callables and will be present in the DAG scope no more than once.</span>
</span><span id="DAG-319"><a href="#DAG-319"><span class="linenos"> 319</span></a>            <span class="c1"># We will create new nodes if necessary, after validation, and get the unique string identifiers of the nodes.</span>
</span><span id="DAG-320"><a href="#DAG-320"><span class="linenos"> 320</span></a>            <span class="n">cached_u</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_callable_to_id</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">u_callable</span><span class="p">)</span>
</span><span id="DAG-321"><a href="#DAG-321"><span class="linenos"> 321</span></a>            <span class="k">if</span> <span class="n">cached_u</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DAG-322"><a href="#DAG-322"><span class="linenos"> 322</span></a>                <span class="n">outgoing_node</span> <span class="o">=</span> <span class="n">cached_u</span>
</span><span id="DAG-323"><a href="#DAG-323"><span class="linenos"> 323</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DAG-324"><a href="#DAG-324"><span class="linenos"> 324</span></a>                <span class="n">new_callables</span><span class="p">[</span><span class="n">u_callable</span><span class="p">]</span> <span class="o">=</span> <span class="n">u_callable</span>
</span><span id="DAG-325"><a href="#DAG-325"><span class="linenos"> 325</span></a>                <span class="n">outgoing_node</span> <span class="o">=</span> <span class="n">_edges</span><span class="o">.</span><span class="n">label_node</span><span class="p">(</span><span class="n">u_callable</span><span class="p">)</span>
</span><span id="DAG-326"><a href="#DAG-326"><span class="linenos"> 326</span></a>
</span><span id="DAG-327"><a href="#DAG-327"><span class="linenos"> 327</span></a>            <span class="n">cached_v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_callable_to_id</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">v_callable</span><span class="p">)</span>
</span><span id="DAG-328"><a href="#DAG-328"><span class="linenos"> 328</span></a>            <span class="k">if</span> <span class="n">cached_v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DAG-329"><a href="#DAG-329"><span class="linenos"> 329</span></a>                <span class="n">incoming_node</span> <span class="o">=</span> <span class="n">cached_v</span>
</span><span id="DAG-330"><a href="#DAG-330"><span class="linenos"> 330</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DAG-331"><a href="#DAG-331"><span class="linenos"> 331</span></a>                <span class="n">new_callables</span><span class="p">[</span><span class="n">v_callable</span><span class="p">]</span> <span class="o">=</span> <span class="n">v_callable</span>
</span><span id="DAG-332"><a href="#DAG-332"><span class="linenos"> 332</span></a>                <span class="n">incoming_node</span> <span class="o">=</span> <span class="n">_edges</span><span class="o">.</span><span class="n">label_node</span><span class="p">(</span><span class="n">v_callable</span><span class="p">)</span>
</span><span id="DAG-333"><a href="#DAG-333"><span class="linenos"> 333</span></a>
</span><span id="DAG-334"><a href="#DAG-334"><span class="linenos"> 334</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DAG-335"><a href="#DAG-335"><span class="linenos"> 335</span></a>
</span><span id="DAG-336"><a href="#DAG-336"><span class="linenos"> 336</span></a>            <span class="c1"># Error Cases 2, 3: Either of the requested IDs are not in the DAG&#39;s current scope.</span>
</span><span id="DAG-337"><a href="#DAG-337"><span class="linenos"> 337</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">u_of_edge</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">u_of_edge</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
</span><span id="DAG-338"><a href="#DAG-338"><span class="linenos"> 338</span></a>                <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Outgoing node </span><span class="si">{</span><span class="n">u_of_edge</span><span class="si">}</span><span class="s2"> not in DAG&#39;s current scope.&quot;</span>
</span><span id="DAG-339"><a href="#DAG-339"><span class="linenos"> 339</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="DAG-340"><a href="#DAG-340"><span class="linenos"> 340</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v_of_edge</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">v_of_edge</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
</span><span id="DAG-341"><a href="#DAG-341"><span class="linenos"> 341</span></a>                <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Incoming node </span><span class="si">{</span><span class="n">v_of_edge</span><span class="si">}</span><span class="s2"> not in DAG&#39;s current scope.&quot;</span>
</span><span id="DAG-342"><a href="#DAG-342"><span class="linenos"> 342</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="DAG-343"><a href="#DAG-343"><span class="linenos"> 343</span></a>
</span><span id="DAG-344"><a href="#DAG-344"><span class="linenos"> 344</span></a>            <span class="c1"># Both nodes&#39; unique identifiers are present in the DAG</span>
</span><span id="DAG-345"><a href="#DAG-345"><span class="linenos"> 345</span></a>            <span class="c1"># and should be evaluated for a valid edge.</span>
</span><span id="DAG-346"><a href="#DAG-346"><span class="linenos"> 346</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">u_of_edge</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v_of_edge</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="DAG-347"><a href="#DAG-347"><span class="linenos"> 347</span></a>                <span class="n">outgoing_node</span> <span class="o">=</span> <span class="n">u_of_edge</span>
</span><span id="DAG-348"><a href="#DAG-348"><span class="linenos"> 348</span></a>                <span class="n">incoming_node</span> <span class="o">=</span> <span class="n">v_of_edge</span>
</span><span id="DAG-349"><a href="#DAG-349"><span class="linenos"> 349</span></a>
</span><span id="DAG-350"><a href="#DAG-350"><span class="linenos"> 350</span></a>            <span class="c1"># Otherwise, one of the nodes is a callable, and the other is a valid unique identifier.</span>
</span><span id="DAG-351"><a href="#DAG-351"><span class="linenos"> 351</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DAG-352"><a href="#DAG-352"><span class="linenos"> 352</span></a>                <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="p">(</span><span class="n">u_of_edge</span><span class="p">,</span> <span class="n">v_of_edge</span><span class="p">):</span>
</span><span id="DAG-353"><a href="#DAG-353"><span class="linenos"> 353</span></a>                    <span class="k">if</span> <span class="n">node</span> <span class="o">==</span> <span class="n">u_of_edge</span><span class="p">:</span>
</span><span id="DAG-354"><a href="#DAG-354"><span class="linenos"> 354</span></a>                        <span class="n">outgoing_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_assign_node</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">new_callables</span><span class="p">)</span>
</span><span id="DAG-355"><a href="#DAG-355"><span class="linenos"> 355</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="DAG-356"><a href="#DAG-356"><span class="linenos"> 356</span></a>                        <span class="n">incoming_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_assign_node</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">new_callables</span><span class="p">)</span>
</span><span id="DAG-357"><a href="#DAG-357"><span class="linenos"> 357</span></a>
</span><span id="DAG-358"><a href="#DAG-358"><span class="linenos"> 358</span></a>        <span class="c1"># Error Case 5: Both callables exist only once in the DAG,</span>
</span><span id="DAG-359"><a href="#DAG-359"><span class="linenos"> 359</span></a>        <span class="c1"># but an edge already exists between them. O(1) lookup with has_edge().</span>
</span><span id="DAG-360"><a href="#DAG-360"><span class="linenos"> 360</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">has_edge</span><span class="p">(</span><span class="n">outgoing_node</span><span class="p">,</span> <span class="n">incoming_node</span><span class="p">):</span>
</span><span id="DAG-361"><a href="#DAG-361"><span class="linenos"> 361</span></a>            <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Requested edge (</span><span class="si">{</span><span class="n">outgoing_node</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">incoming_node</span><span class="si">}</span><span class="s2">) already has &quot;</span> \
</span><span id="DAG-362"><a href="#DAG-362"><span class="linenos"> 362</span></a>                    <span class="o">+</span> <span class="s2">&quot;a definition in this DAG.&quot;</span>
</span><span id="DAG-363"><a href="#DAG-363"><span class="linenos"> 363</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="DAG-364"><a href="#DAG-364"><span class="linenos"> 364</span></a>
</span><span id="DAG-365"><a href="#DAG-365"><span class="linenos"> 365</span></a>        <span class="c1"># Error Case 6: Adding an edge would create circular dependencies.</span>
</span><span id="DAG-366"><a href="#DAG-366"><span class="linenos"> 366</span></a>        <span class="c1"># Use has_path() for O(V+E) incremental check instead of rebuilding entire graph.</span>
</span><span id="DAG-367"><a href="#DAG-367"><span class="linenos"> 367</span></a>        <span class="k">if</span> <span class="n">incoming_node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="ow">and</span> <span class="n">_nx</span><span class="o">.</span><span class="n">has_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="p">,</span> <span class="n">incoming_node</span><span class="p">,</span> <span class="n">outgoing_node</span><span class="p">):</span>
</span><span id="DAG-368"><a href="#DAG-368"><span class="linenos"> 368</span></a>            <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Requested edge (</span><span class="si">{</span><span class="n">outgoing_node</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">incoming_node</span><span class="si">}</span><span class="s2">) &quot;</span> \
</span><span id="DAG-369"><a href="#DAG-369"><span class="linenos"> 369</span></a>                    <span class="o">+</span> <span class="s2">&quot;results in circular dependencies.&quot;</span>
</span><span id="DAG-370"><a href="#DAG-370"><span class="linenos"> 370</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="DAG-371"><a href="#DAG-371"><span class="linenos"> 371</span></a>
</span><span id="DAG-372"><a href="#DAG-372"><span class="linenos"> 372</span></a>        <span class="c1"># We can now add the edge to the DAG, since we are certain it will not result in</span>
</span><span id="DAG-373"><a href="#DAG-373"><span class="linenos"> 373</span></a>        <span class="c1"># illegal dependencies/behavior.</span>
</span><span id="DAG-374"><a href="#DAG-374"><span class="linenos"> 374</span></a>        <span class="c1"># First, we should account for potential new nodes. This also handles</span>
</span><span id="DAG-375"><a href="#DAG-375"><span class="linenos"> 375</span></a>        <span class="c1"># duplicates on first entry to the DAG (e.g.: edge == (print, print))</span>
</span><span id="DAG-376"><a href="#DAG-376"><span class="linenos"> 376</span></a>        <span class="k">if</span> <span class="n">_iscallable</span><span class="p">(</span><span class="n">u_of_edge</span><span class="p">)</span> <span class="ow">and</span> <span class="n">new_callables</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">_T</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">_T</span><span class="o">.</span><span class="n">Callable</span><span class="p">,</span> <span class="n">u_of_edge</span><span class="p">))</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DAG-377"><a href="#DAG-377"><span class="linenos"> 377</span></a>            <span class="n">outgoing_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">new_callables</span><span class="p">[</span><span class="n">_T</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">_T</span><span class="o">.</span><span class="n">Callable</span><span class="p">,</span> <span class="n">u_of_edge</span><span class="p">)])</span>
</span><span id="DAG-378"><a href="#DAG-378"><span class="linenos"> 378</span></a>        <span class="k">if</span> <span class="n">_iscallable</span><span class="p">(</span><span class="n">v_of_edge</span><span class="p">)</span> <span class="ow">and</span> <span class="n">new_callables</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">_T</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">_T</span><span class="o">.</span><span class="n">Callable</span><span class="p">,</span> <span class="n">v_of_edge</span><span class="p">))</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DAG-379"><a href="#DAG-379"><span class="linenos"> 379</span></a>            <span class="n">incoming_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">new_callables</span><span class="p">[</span><span class="n">_T</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">_T</span><span class="o">.</span><span class="n">Callable</span><span class="p">,</span> <span class="n">v_of_edge</span><span class="p">)])</span>
</span><span id="DAG-380"><a href="#DAG-380"><span class="linenos"> 380</span></a>
</span><span id="DAG-381"><a href="#DAG-381"><span class="linenos"> 381</span></a>        <span class="c1"># Then we can add the new edge.</span>
</span><span id="DAG-382"><a href="#DAG-382"><span class="linenos"> 382</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">outgoing_node</span><span class="p">,</span> <span class="n">incoming_node</span><span class="p">,</span> <span class="n">Condition</span> <span class="o">=</span> <span class="n">continue_on</span><span class="p">)</span>
</span><span id="DAG-383"><a href="#DAG-383"><span class="linenos"> 383</span></a>        <span class="k">return</span> <span class="p">(</span><span class="n">outgoing_node</span><span class="p">,</span> <span class="n">incoming_node</span><span class="p">)</span>
</span><span id="DAG-384"><a href="#DAG-384"><span class="linenos"> 384</span></a>    
</span><span id="DAG-385"><a href="#DAG-385"><span class="linenos"> 385</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">remove_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">posargs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DAG-386"><a href="#DAG-386"><span class="linenos"> 386</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DAG-387"><a href="#DAG-387"><span class="linenos"> 387</span></a><span class="sd">        Currently out-of-scope. Node-removal can lead to unexpected behavior in a DAG.</span>
</span><span id="DAG-388"><a href="#DAG-388"><span class="linenos"> 388</span></a><span class="sd">        Throws error message and recommends safer methods.</span>
</span><span id="DAG-389"><a href="#DAG-389"><span class="linenos"> 389</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DAG-390"><a href="#DAG-390"><span class="linenos"> 390</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Node removals can lead to unexpected behavior in a DAG without special care. Please consider using the skip_node operation or define a new DAG to achieve the same effect.&quot;</span><span class="p">)</span>
</span><span id="DAG-391"><a href="#DAG-391"><span class="linenos"> 391</span></a>
</span><span id="DAG-392"><a href="#DAG-392"><span class="linenos"> 392</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">remove_edge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">u_of_edge</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span><span class="n">_T</span><span class="o">.</span><span class="n">Callable</span><span class="p">],</span> <span class="n">v_of_edge</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span><span class="n">_T</span><span class="o">.</span><span class="n">Callable</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">_T</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="DAG-393"><a href="#DAG-393"><span class="linenos"> 393</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DAG-394"><a href="#DAG-394"><span class="linenos"> 394</span></a><span class="sd">        Removes an directed edge between nodes in the DAG&#39;s underlying graph.</span>
</span><span id="DAG-395"><a href="#DAG-395"><span class="linenos"> 395</span></a><span class="sd">        Throws error if the edge does not exist.</span>
</span><span id="DAG-396"><a href="#DAG-396"><span class="linenos"> 396</span></a><span class="sd">        On success, returns Tuple of the removed edge&#39;s unique identifiers.</span>
</span><span id="DAG-397"><a href="#DAG-397"><span class="linenos"> 397</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DAG-398"><a href="#DAG-398"><span class="linenos"> 398</span></a>        <span class="n">edge_id</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node_id</span><span class="p">(</span><span class="n">u_of_edge</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_id</span><span class="p">(</span><span class="n">v_of_edge</span><span class="p">))</span>
</span><span id="DAG-399"><a href="#DAG-399"><span class="linenos"> 399</span></a>        <span class="k">if</span> <span class="n">edge_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="DAG-400"><a href="#DAG-400"><span class="linenos"> 400</span></a>            <span class="n">err_msg</span> <span class="o">=</span> <span class="s2">&quot;Requested edge does not exist in the DAG&#39;s scope&quot;</span>
</span><span id="DAG-401"><a href="#DAG-401"><span class="linenos"> 401</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="DAG-402"><a href="#DAG-402"><span class="linenos"> 402</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">remove_edge</span><span class="p">(</span><span class="n">edge_id</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">edge_id</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="DAG-403"><a href="#DAG-403"><span class="linenos"> 403</span></a>        <span class="k">return</span> <span class="n">edge_id</span>
</span><span id="DAG-404"><a href="#DAG-404"><span class="linenos"> 404</span></a>
</span><span id="DAG-405"><a href="#DAG-405"><span class="linenos"> 405</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">update_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">E</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">,</span> <span class="n">continue_on</span><span class="p">:</span> <span class="n">Condition</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">filter</span><span class="p">:</span> <span class="n">_types</span><span class="o">.</span><span class="n">LambdaType</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="n">edgedict</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DAG-406"><a href="#DAG-406"><span class="linenos"> 406</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DAG-407"><a href="#DAG-407"><span class="linenos"> 407</span></a><span class="sd">        Flexible function to update properties of edges in the DAG&#39;s scope, </span>
</span><span id="DAG-408"><a href="#DAG-408"><span class="linenos"> 408</span></a><span class="sd">        based on unique identifier(s) (e.g.: string IDs or unique callables) or a</span>
</span><span id="DAG-409"><a href="#DAG-409"><span class="linenos"> 409</span></a><span class="sd">        lambda filter using the edgedict syntax.</span>
</span><span id="DAG-410"><a href="#DAG-410"><span class="linenos"> 410</span></a><span class="sd">        </span>
</span><span id="DAG-411"><a href="#DAG-411"><span class="linenos"> 411</span></a><span class="sd">        List of nodes to update or filter argument is expected. Valid edge lists include:</span>
</span><span id="DAG-412"><a href="#DAG-412"><span class="linenos"> 412</span></a>
</span><span id="DAG-413"><a href="#DAG-413"><span class="linenos"> 413</span></a><span class="sd">        \t update_edges((node1, node2), ...)       or update_edges([(node1, node2)], ...)</span>
</span><span id="DAG-414"><a href="#DAG-414"><span class="linenos"> 414</span></a>
</span><span id="DAG-415"><a href="#DAG-415"><span class="linenos"> 415</span></a><span class="sd">        \t update_edges((node1, callable2), ...)   or update_edges([(node1, callable2)], ...)</span>
</span><span id="DAG-416"><a href="#DAG-416"><span class="linenos"> 416</span></a><span class="sd">        </span>
</span><span id="DAG-417"><a href="#DAG-417"><span class="linenos"> 417</span></a><span class="sd">        \t update_edges(edgedict),                 where isinstance(edgedict, webber.edges.edgedict) == True</span>
</span><span id="DAG-418"><a href="#DAG-418"><span class="linenos"> 418</span></a>
</span><span id="DAG-419"><a href="#DAG-419"><span class="linenos"> 419</span></a><span class="sd">        Parameters:</span>
</span><span id="DAG-420"><a href="#DAG-420"><span class="linenos"> 420</span></a>
</span><span id="DAG-421"><a href="#DAG-421"><span class="linenos"> 421</span></a><span class="sd">        &gt; continue_on: webber.edges.Condition value to update matching edges with, </span>
</span><span id="DAG-422"><a href="#DAG-422"><span class="linenos"> 422</span></a><span class="sd">        </span>
</span><span id="DAG-423"><a href="#DAG-423"><span class="linenos"> 423</span></a><span class="sd">        \t Execute child on success, failure, or any exit state, of the parent node</span>
</span><span id="DAG-424"><a href="#DAG-424"><span class="linenos"> 424</span></a>
</span><span id="DAG-425"><a href="#DAG-425"><span class="linenos"> 425</span></a><span class="sd">        &gt; filter: lambda property that can be used instead of a list of edges to be updated.</span>
</span><span id="DAG-426"><a href="#DAG-426"><span class="linenos"> 426</span></a><span class="sd">        </span>
</span><span id="DAG-427"><a href="#DAG-427"><span class="linenos"> 427</span></a><span class="sd">        \t filter = (lambda e: n.parent == print or e.child == print)</span>
</span><span id="DAG-428"><a href="#DAG-428"><span class="linenos"> 428</span></a>
</span><span id="DAG-429"><a href="#DAG-429"><span class="linenos"> 429</span></a><span class="sd">        &gt; data: If given, expects a dictionary or edgedict to update edge properties. Currently, only continue_on property should be set.</span>
</span><span id="DAG-430"><a href="#DAG-430"><span class="linenos"> 430</span></a>
</span><span id="DAG-431"><a href="#DAG-431"><span class="linenos"> 431</span></a><span class="sd">        \t data = { &#39;continue_on&#39;: webber.edges.Condition }</span>
</span><span id="DAG-432"><a href="#DAG-432"><span class="linenos"> 432</span></a>
</span><span id="DAG-433"><a href="#DAG-433"><span class="linenos"> 433</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DAG-434"><a href="#DAG-434"><span class="linenos"> 434</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">E</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">filter</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DAG-435"><a href="#DAG-435"><span class="linenos"> 435</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Either an array of edge IDs / edgedicts (E) or a filter must be passed to this function.&quot;</span><span class="p">)</span>
</span><span id="DAG-436"><a href="#DAG-436"><span class="linenos"> 436</span></a>
</span><span id="DAG-437"><a href="#DAG-437"><span class="linenos"> 437</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="n">edgedict</span><span class="p">):</span>
</span><span id="DAG-438"><a href="#DAG-438"><span class="linenos"> 438</span></a>            <span class="n">E</span> <span class="o">=</span> <span class="p">[</span><span class="n">E</span><span class="p">]</span>
</span><span id="DAG-439"><a href="#DAG-439"><span class="linenos"> 439</span></a>
</span><span id="DAG-440"><a href="#DAG-440"><span class="linenos"> 440</span></a>        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">E</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">E</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">_abc</span><span class="o">.</span><span class="n">Iterable</span><span class="p">):</span>
</span><span id="DAG-441"><a href="#DAG-441"><span class="linenos"> 441</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="DAG-442"><a href="#DAG-442"><span class="linenos"> 442</span></a>                <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_edges</span><span class="p">(</span><span class="n">E</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="DAG-443"><a href="#DAG-443"><span class="linenos"> 443</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="DAG-444"><a href="#DAG-444"><span class="linenos"> 444</span></a>                <span class="n">E</span> <span class="o">=</span> <span class="n">E</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="DAG-445"><a href="#DAG-445"><span class="linenos"> 445</span></a>
</span><span id="DAG-446"><a href="#DAG-446"><span class="linenos"> 446</span></a>        <span class="k">if</span> <span class="nb">filter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DAG-447"><a href="#DAG-447"><span class="linenos"> 447</span></a>            <span class="n">edge_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_edges</span><span class="p">(</span><span class="nb">filter</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="DAG-448"><a href="#DAG-448"><span class="linenos"> 448</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DAG-449"><a href="#DAG-449"><span class="linenos"> 449</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">E</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">E</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">edgedict</span><span class="p">):</span>
</span><span id="DAG-450"><a href="#DAG-450"><span class="linenos"> 450</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="DAG-451"><a href="#DAG-451"><span class="linenos"> 451</span></a>                    <span class="n">ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">E</span><span class="p">]</span>
</span><span id="DAG-452"><a href="#DAG-452"><span class="linenos"> 452</span></a>                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span><span id="DAG-453"><a href="#DAG-453"><span class="linenos"> 453</span></a>                    <span class="n">err_msg</span> <span class="o">=</span> <span class="s1">&#39;In dictionary form, all given edges must be follow edgedict standards.&#39;</span>
</span><span id="DAG-454"><a href="#DAG-454"><span class="linenos"> 454</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="DAG-455"><a href="#DAG-455"><span class="linenos"> 455</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DAG-456"><a href="#DAG-456"><span class="linenos"> 456</span></a>                <span class="n">ids</span> <span class="o">=</span> <span class="n">E</span>
</span><span id="DAG-457"><a href="#DAG-457"><span class="linenos"> 457</span></a>            <span class="n">edge_ids</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_edge</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">data</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ids</span><span class="p">]</span>
</span><span id="DAG-458"><a href="#DAG-458"><span class="linenos"> 458</span></a>
</span><span id="DAG-459"><a href="#DAG-459"><span class="linenos"> 459</span></a>        <span class="n">std_update</span> <span class="o">=</span> <span class="p">(</span><span class="n">continue_on</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="DAG-460"><a href="#DAG-460"><span class="linenos"> 460</span></a>
</span><span id="DAG-461"><a href="#DAG-461"><span class="linenos"> 461</span></a>        <span class="k">if</span> <span class="n">std_update</span><span class="p">:</span>
</span><span id="DAG-462"><a href="#DAG-462"><span class="linenos"> 462</span></a>            <span class="k">for</span> <span class="n">edge_id</span><span class="p">,</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">edge_ids</span><span class="p">,</span> <span class="n">E</span><span class="p">):</span>
</span><span id="DAG-463"><a href="#DAG-463"><span class="linenos"> 463</span></a>                <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DAG-464"><a href="#DAG-464"><span class="linenos"> 464</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_update_edge</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">id</span> <span class="o">=</span> <span class="n">edge_id</span><span class="p">)</span>
</span><span id="DAG-465"><a href="#DAG-465"><span class="linenos"> 465</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="DAG-466"><a href="#DAG-466"><span class="linenos"> 466</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_update_edge</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="nb">id</span> <span class="o">=</span> <span class="n">edge_id</span><span class="p">)</span>
</span><span id="DAG-467"><a href="#DAG-467"><span class="linenos"> 467</span></a>        
</span><span id="DAG-468"><a href="#DAG-468"><span class="linenos"> 468</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DAG-469"><a href="#DAG-469"><span class="linenos"> 469</span></a>            <span class="k">if</span> <span class="n">continue_on</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DAG-470"><a href="#DAG-470"><span class="linenos"> 470</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">continue_on</span><span class="p">,</span> <span class="n">Condition</span><span class="p">):</span>
</span><span id="DAG-471"><a href="#DAG-471"><span class="linenos"> 471</span></a>                    <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Condition assignment must use webber.edges.Condition&quot;</span>
</span><span id="DAG-472"><a href="#DAG-472"><span class="linenos"> 472</span></a>                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="DAG-473"><a href="#DAG-473"><span class="linenos"> 473</span></a>                <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">edge_ids</span><span class="p">:</span>
</span><span id="DAG-474"><a href="#DAG-474"><span class="linenos"> 474</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;Condition&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">continue_on</span>
</span><span id="DAG-475"><a href="#DAG-475"><span class="linenos"> 475</span></a>
</span><span id="DAG-476"><a href="#DAG-476"><span class="linenos"> 476</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_update_edge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edgedict</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">],</span> <span class="nb">id</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DAG-477"><a href="#DAG-477"><span class="linenos"> 477</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DAG-478"><a href="#DAG-478"><span class="linenos"> 478</span></a><span class="sd">        Internal only. Update properties of an individual edge within a DAG&#39;s scope, </span>
</span><span id="DAG-479"><a href="#DAG-479"><span class="linenos"> 479</span></a><span class="sd">        given a well-structured dictionary and the tuple identifier of the network edge. </span>
</span><span id="DAG-480"><a href="#DAG-480"><span class="linenos"> 480</span></a><span class="sd">        Force argument bypasses validation, and should only be used internally.</span>
</span><span id="DAG-481"><a href="#DAG-481"><span class="linenos"> 481</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DAG-482"><a href="#DAG-482"><span class="linenos"> 482</span></a>        <span class="k">if</span> <span class="nb">id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DAG-483"><a href="#DAG-483"><span class="linenos"> 483</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="DAG-484"><a href="#DAG-484"><span class="linenos"> 484</span></a>                <span class="k">if</span> <span class="n">edgedict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">id</span> <span class="o">!=</span> <span class="n">edgedict</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]:</span>
</span><span id="DAG-485"><a href="#DAG-485"><span class="linenos"> 485</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Given ID </span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s2"> inconsistent with dictionary identifier: </span><span class="si">{</span><span class="n">edgedict</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="DAG-486"><a href="#DAG-486"><span class="linenos"> 486</span></a>            <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="DAG-487"><a href="#DAG-487"><span class="linenos"> 487</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">force</span><span class="p">:</span>
</span><span id="DAG-488"><a href="#DAG-488"><span class="linenos"> 488</span></a>                    <span class="k">raise</span> <span class="n">e</span>
</span><span id="DAG-489"><a href="#DAG-489"><span class="linenos"> 489</span></a>            <span class="n">edgedict</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">id</span>
</span><span id="DAG-490"><a href="#DAG-490"><span class="linenos"> 490</span></a>
</span><span id="DAG-491"><a href="#DAG-491"><span class="linenos"> 491</span></a>        <span class="n">expected_keys</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;parent&#39;</span><span class="p">,</span> <span class="s1">&#39;child&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;continue_on&#39;</span><span class="p">)</span>
</span><span id="DAG-492"><a href="#DAG-492"><span class="linenos"> 492</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">set</span><span class="p">(</span><span class="n">expected_keys</span><span class="p">)</span><span class="o">.</span><span class="n">issuperset</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">edgedict</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span>
</span><span id="DAG-493"><a href="#DAG-493"><span class="linenos"> 493</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Expecting keys: </span><span class="si">{</span><span class="n">expected_keys</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="DAG-494"><a href="#DAG-494"><span class="linenos"> 494</span></a>
</span><span id="DAG-495"><a href="#DAG-495"><span class="linenos"> 495</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">force</span><span class="p">:</span>
</span><span id="DAG-496"><a href="#DAG-496"><span class="linenos"> 496</span></a>            
</span><span id="DAG-497"><a href="#DAG-497"><span class="linenos"> 497</span></a>            <span class="n">e1</span><span class="p">,</span> <span class="n">e2</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="DAG-498"><a href="#DAG-498"><span class="linenos"> 498</span></a>
</span><span id="DAG-499"><a href="#DAG-499"><span class="linenos"> 499</span></a>            <span class="k">if</span> <span class="n">edgedict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">):</span>
</span><span id="DAG-500"><a href="#DAG-500"><span class="linenos"> 500</span></a>                <span class="n">e1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_edge</span><span class="p">(</span><span class="n">edgedict</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span> <span class="n">data</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="DAG-501"><a href="#DAG-501"><span class="linenos"> 501</span></a>
</span><span id="DAG-502"><a href="#DAG-502"><span class="linenos"> 502</span></a>            <span class="k">if</span> <span class="n">edgedict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;parent&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">edgedict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;child&#39;</span><span class="p">):</span>
</span><span id="DAG-503"><a href="#DAG-503"><span class="linenos"> 503</span></a>                <span class="n">e2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_edge</span><span class="p">(</span><span class="n">edgedict</span><span class="p">[</span><span class="s1">&#39;parent&#39;</span><span class="p">],</span> <span class="n">edgedict</span><span class="p">[</span><span class="s1">&#39;child&#39;</span><span class="p">],</span> <span class="n">data</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="DAG-504"><a href="#DAG-504"><span class="linenos"> 504</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DAG-505"><a href="#DAG-505"><span class="linenos"> 505</span></a>                <span class="n">e2</span> <span class="o">=</span> <span class="n">e1</span>
</span><span id="DAG-506"><a href="#DAG-506"><span class="linenos"> 506</span></a>
</span><span id="DAG-507"><a href="#DAG-507"><span class="linenos"> 507</span></a>            <span class="k">if</span> <span class="n">e1</span> <span class="o">!=</span> <span class="n">e2</span><span class="p">:</span>
</span><span id="DAG-508"><a href="#DAG-508"><span class="linenos"> 508</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Edge vertices should not be changed using update functions.&#39;</span><span class="p">)</span>
</span><span id="DAG-509"><a href="#DAG-509"><span class="linenos"> 509</span></a>            
</span><span id="DAG-510"><a href="#DAG-510"><span class="linenos"> 510</span></a>            <span class="k">elif</span> <span class="n">e1</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DAG-511"><a href="#DAG-511"><span class="linenos"> 511</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Requested edge was not given an identifier.&#39;</span><span class="p">)</span>
</span><span id="DAG-512"><a href="#DAG-512"><span class="linenos"> 512</span></a>
</span><span id="DAG-513"><a href="#DAG-513"><span class="linenos"> 513</span></a>            <span class="k">if</span> <span class="n">edgedict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;continue_on&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">edgedict</span><span class="p">[</span><span class="s1">&#39;continue_on&#39;</span><span class="p">],</span> <span class="n">Condition</span><span class="p">):</span>
</span><span id="DAG-514"><a href="#DAG-514"><span class="linenos"> 514</span></a>                <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Condition assignment must use webber.edges.Condition&quot;</span>
</span><span id="DAG-515"><a href="#DAG-515"><span class="linenos"> 515</span></a>                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="DAG-516"><a href="#DAG-516"><span class="linenos"> 516</span></a>                       
</span><span id="DAG-517"><a href="#DAG-517"><span class="linenos"> 517</span></a>        <span class="n">edge_id</span> <span class="o">=</span> <span class="n">edgedict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>
</span><span id="DAG-518"><a href="#DAG-518"><span class="linenos"> 518</span></a>        <span class="n">edge</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">edgedict</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;parent&#39;</span><span class="p">,</span> <span class="s1">&#39;child&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">)}</span>
</span><span id="DAG-519"><a href="#DAG-519"><span class="linenos"> 519</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">[(</span><span class="n">edge_id</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">edge_id</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">edge</span><span class="p">)</span>
</span><span id="DAG-520"><a href="#DAG-520"><span class="linenos"> 520</span></a>
</span><span id="DAG-521"><a href="#DAG-521"><span class="linenos"> 521</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">relabel_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_T</span><span class="o">.</span><span class="n">Callable</span><span class="p">],</span> <span class="n">label</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="DAG-522"><a href="#DAG-522"><span class="linenos"> 522</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DAG-523"><a href="#DAG-523"><span class="linenos"> 523</span></a><span class="sd">        Update the label, or name, given to a node in the DAG&#39;s scope, </span>
</span><span id="DAG-524"><a href="#DAG-524"><span class="linenos"> 524</span></a><span class="sd">        given a Python string and a node identifier. </span>
</span><span id="DAG-525"><a href="#DAG-525"><span class="linenos"> 525</span></a><span class="sd">        Well-structured wrapper for a common use-case of DAG.update_nodes.</span>
</span><span id="DAG-526"><a href="#DAG-526"><span class="linenos"> 526</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DAG-527"><a href="#DAG-527"><span class="linenos"> 527</span></a>        <span class="n">node_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_id</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
</span><span id="DAG-528"><a href="#DAG-528"><span class="linenos"> 528</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">label</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="DAG-529"><a href="#DAG-529"><span class="linenos"> 529</span></a>            <span class="n">err_msg</span> <span class="o">=</span> <span class="s2">&quot;Node label must be a Python string with one or more characters.&quot;</span>
</span><span id="DAG-530"><a href="#DAG-530"><span class="linenos"> 530</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="DAG-531"><a href="#DAG-531"><span class="linenos"> 531</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">update_nodes</span><span class="p">(</span><span class="n">node_id</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">label</span><span class="p">})</span>
</span><span id="DAG-532"><a href="#DAG-532"><span class="linenos"> 532</span></a>        <span class="k">return</span> <span class="n">label</span>
</span><span id="DAG-533"><a href="#DAG-533"><span class="linenos"> 533</span></a>
</span><span id="DAG-534"><a href="#DAG-534"><span class="linenos"> 534</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">update_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">N</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">,</span> <span class="nb">filter</span><span class="p">:</span> <span class="n">_types</span><span class="o">.</span><span class="n">LambdaType</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="n">dotdict</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">callable</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Callable</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">args</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Iterable</span><span class="p">[</span><span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DAG-535"><a href="#DAG-535"><span class="linenos"> 535</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DAG-536"><a href="#DAG-536"><span class="linenos"> 536</span></a><span class="sd">        Flexible function to update properties of nodes in the DAG&#39;s scope, </span>
</span><span id="DAG-537"><a href="#DAG-537"><span class="linenos"> 537</span></a><span class="sd">        based on unique identifier(s) (e.g.: string IDs or unique callables) or a</span>
</span><span id="DAG-538"><a href="#DAG-538"><span class="linenos"> 538</span></a><span class="sd">        lambda filter using the dotdict syntax.</span>
</span><span id="DAG-539"><a href="#DAG-539"><span class="linenos"> 539</span></a><span class="sd">        </span>
</span><span id="DAG-540"><a href="#DAG-540"><span class="linenos"> 540</span></a><span class="sd">        List of nodes to update or filter argument is expected. Valid node lists include:</span>
</span><span id="DAG-541"><a href="#DAG-541"><span class="linenos"> 541</span></a>
</span><span id="DAG-542"><a href="#DAG-542"><span class="linenos"> 542</span></a><span class="sd">        \t update_nodes(node_id, ...)           or update_nodes([node_id], ...)</span>
</span><span id="DAG-543"><a href="#DAG-543"><span class="linenos"> 543</span></a>
</span><span id="DAG-544"><a href="#DAG-544"><span class="linenos"> 544</span></a><span class="sd">        \t update_nodes(callable, ...)          or update_nodes([callable], ...)</span>
</span><span id="DAG-545"><a href="#DAG-545"><span class="linenos"> 545</span></a><span class="sd">        </span>
</span><span id="DAG-546"><a href="#DAG-546"><span class="linenos"> 546</span></a><span class="sd">        \t update_nodes(node1, node2, ...)      or update_nodes([node1, node2], ...)</span>
</span><span id="DAG-547"><a href="#DAG-547"><span class="linenos"> 547</span></a><span class="sd">        </span>
</span><span id="DAG-548"><a href="#DAG-548"><span class="linenos"> 548</span></a><span class="sd">        \t update_nodes(node1, callable2, ...)  or update_nodes([node1, callable2], ...)</span>
</span><span id="DAG-549"><a href="#DAG-549"><span class="linenos"> 549</span></a>
</span><span id="DAG-550"><a href="#DAG-550"><span class="linenos"> 550</span></a><span class="sd">        &gt; update_nodes(node_id, ...) is equivalent to update_nodes(filter = lambda n: n.id == node_id)</span>
</span><span id="DAG-551"><a href="#DAG-551"><span class="linenos"> 551</span></a>
</span><span id="DAG-552"><a href="#DAG-552"><span class="linenos"> 552</span></a><span class="sd">        Parameters:</span>
</span><span id="DAG-553"><a href="#DAG-553"><span class="linenos"> 553</span></a>
</span><span id="DAG-554"><a href="#DAG-554"><span class="linenos"> 554</span></a><span class="sd">        &gt; filter: lambda property that can be used instead of a list of nodes to be updated.</span>
</span><span id="DAG-555"><a href="#DAG-555"><span class="linenos"> 555</span></a><span class="sd">        </span>
</span><span id="DAG-556"><a href="#DAG-556"><span class="linenos"> 556</span></a><span class="sd">        \t filter = (lambda n: n.callable == print or &#39;Hello, World&#39; in n.args)</span>
</span><span id="DAG-557"><a href="#DAG-557"><span class="linenos"> 557</span></a>
</span><span id="DAG-558"><a href="#DAG-558"><span class="linenos"> 558</span></a><span class="sd">        &gt; data: If given, expects a dictionary or dotdict to update node properties. At least one property should be defined if data argument is set.</span>
</span><span id="DAG-559"><a href="#DAG-559"><span class="linenos"> 559</span></a><span class="sd">            Any value given to the id key will be ignored. Allowed for ease of use with DAG.get nodes method.</span>
</span><span id="DAG-560"><a href="#DAG-560"><span class="linenos"> 560</span></a><span class="sd">            </span>
</span><span id="DAG-561"><a href="#DAG-561"><span class="linenos"> 561</span></a><span class="sd">        \t data = {</span>
</span><span id="DAG-562"><a href="#DAG-562"><span class="linenos"> 562</span></a><span class="sd">            \t &#39;callable&#39;: print,</span>
</span><span id="DAG-563"><a href="#DAG-563"><span class="linenos"> 563</span></a><span class="sd">            \t &#39;args&#39;: [&#39;Hello&#39;, &#39;World&#39;],</span>
</span><span id="DAG-564"><a href="#DAG-564"><span class="linenos"> 564</span></a><span class="sd">            \t &#39;kwargs&#39;: {&#39;sep&#39;: &#39;, &#39;},</span>
</span><span id="DAG-565"><a href="#DAG-565"><span class="linenos"> 565</span></a><span class="sd">            \t &#39;name&#39;: &#39;custom_label&#39;,</span>
</span><span id="DAG-566"><a href="#DAG-566"><span class="linenos"> 566</span></a><span class="sd">            \t &#39;id&#39;: &#39;unique-identifier&#39;</span>
</span><span id="DAG-567"><a href="#DAG-567"><span class="linenos"> 567</span></a><span class="sd">            \t}</span>
</span><span id="DAG-568"><a href="#DAG-568"><span class="linenos"> 568</span></a>
</span><span id="DAG-569"><a href="#DAG-569"><span class="linenos"> 569</span></a><span class="sd">        &gt; args: Positional arguments to be passed to matching callables in the DAG&#39;s scope, using a Python iterable (e.g.: Tuple or List).</span>
</span><span id="DAG-570"><a href="#DAG-570"><span class="linenos"> 570</span></a>
</span><span id="DAG-571"><a href="#DAG-571"><span class="linenos"> 571</span></a><span class="sd">        &gt; kwargs: Keyword arguments to be passed to matching callables in the DAG&#39;s scope, using a Python dictionary.</span>
</span><span id="DAG-572"><a href="#DAG-572"><span class="linenos"> 572</span></a>
</span><span id="DAG-573"><a href="#DAG-573"><span class="linenos"> 573</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DAG-574"><a href="#DAG-574"><span class="linenos"> 574</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">filter</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DAG-575"><a href="#DAG-575"><span class="linenos"> 575</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Either an array of node IDs or node data (N) or a filter must be passed to this function.&quot;</span><span class="p">)</span>
</span><span id="DAG-576"><a href="#DAG-576"><span class="linenos"> 576</span></a>
</span><span id="DAG-577"><a href="#DAG-577"><span class="linenos"> 577</span></a>        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">filter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DAG-578"><a href="#DAG-578"><span class="linenos"> 578</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Node data array (N) and filter argument are mutually exclusive, and cannot both be defined to identify nodes to update DAG&#39;s scope.&quot;</span><span class="p">)</span>
</span><span id="DAG-579"><a href="#DAG-579"><span class="linenos"> 579</span></a>
</span><span id="DAG-580"><a href="#DAG-580"><span class="linenos"> 580</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="DAG-581"><a href="#DAG-581"><span class="linenos"> 581</span></a>            <span class="n">N</span> <span class="o">=</span> <span class="p">[</span><span class="n">N</span><span class="p">]</span>
</span><span id="DAG-582"><a href="#DAG-582"><span class="linenos"> 582</span></a>
</span><span id="DAG-583"><a href="#DAG-583"><span class="linenos"> 583</span></a>        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">N</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">_abc</span><span class="o">.</span><span class="n">Iterable</span><span class="p">):</span>
</span><span id="DAG-584"><a href="#DAG-584"><span class="linenos"> 584</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">N</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="DAG-585"><a href="#DAG-585"><span class="linenos"> 585</span></a>                <span class="n">N</span> <span class="o">=</span> <span class="n">N</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="DAG-586"><a href="#DAG-586"><span class="linenos"> 586</span></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">N</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="DAG-587"><a href="#DAG-587"><span class="linenos"> 587</span></a>                <span class="c1"># BUG: A list of all single character IDs will fail to be updated. Please try another call method (i.e.: nested iterator).</span>
</span><span id="DAG-588"><a href="#DAG-588"><span class="linenos"> 588</span></a>                <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">n</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">N</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">N</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span> 
</span><span id="DAG-589"><a href="#DAG-589"><span class="linenos"> 589</span></a>                    <span class="n">N</span> <span class="o">=</span> <span class="n">N</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="DAG-590"><a href="#DAG-590"><span class="linenos"> 590</span></a>
</span><span id="DAG-591"><a href="#DAG-591"><span class="linenos"> 591</span></a>
</span><span id="DAG-592"><a href="#DAG-592"><span class="linenos"> 592</span></a>        <span class="k">if</span> <span class="nb">filter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DAG-593"><a href="#DAG-593"><span class="linenos"> 593</span></a>            <span class="n">node_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_nodes</span><span class="p">(</span><span class="nb">filter</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="DAG-594"><a href="#DAG-594"><span class="linenos"> 594</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DAG-595"><a href="#DAG-595"><span class="linenos"> 595</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">N</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="DAG-596"><a href="#DAG-596"><span class="linenos"> 596</span></a>                <span class="n">ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">N</span><span class="p">]</span>
</span><span id="DAG-597"><a href="#DAG-597"><span class="linenos"> 597</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DAG-598"><a href="#DAG-598"><span class="linenos"> 598</span></a>                <span class="n">ids</span> <span class="o">=</span> <span class="n">N</span>
</span><span id="DAG-599"><a href="#DAG-599"><span class="linenos"> 599</span></a>            <span class="n">node_ids</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">node_id</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ids</span><span class="p">]</span>
</span><span id="DAG-600"><a href="#DAG-600"><span class="linenos"> 600</span></a>        
</span><span id="DAG-601"><a href="#DAG-601"><span class="linenos"> 601</span></a>        <span class="n">std_update</span> <span class="o">=</span> <span class="p">(</span><span class="nb">callable</span> <span class="o">==</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">args</span> <span class="o">==</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">kwargs</span> <span class="o">==</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="DAG-602"><a href="#DAG-602"><span class="linenos"> 602</span></a>
</span><span id="DAG-603"><a href="#DAG-603"><span class="linenos"> 603</span></a>        <span class="k">if</span> <span class="n">std_update</span><span class="p">:</span>
</span><span id="DAG-604"><a href="#DAG-604"><span class="linenos"> 604</span></a>            <span class="k">for</span> <span class="n">node_id</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">node_ids</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
</span><span id="DAG-605"><a href="#DAG-605"><span class="linenos"> 605</span></a>                <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DAG-606"><a href="#DAG-606"><span class="linenos"> 606</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_update_node</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">id</span> <span class="o">=</span> <span class="n">node_id</span><span class="p">)</span>
</span><span id="DAG-607"><a href="#DAG-607"><span class="linenos"> 607</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="DAG-608"><a href="#DAG-608"><span class="linenos"> 608</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_update_node</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="nb">id</span> <span class="o">=</span> <span class="n">node_id</span><span class="p">)</span>
</span><span id="DAG-609"><a href="#DAG-609"><span class="linenos"> 609</span></a>        
</span><span id="DAG-610"><a href="#DAG-610"><span class="linenos"> 610</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DAG-611"><a href="#DAG-611"><span class="linenos"> 611</span></a>            <span class="k">if</span> <span class="nb">callable</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DAG-612"><a href="#DAG-612"><span class="linenos"> 612</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">_iscallable</span><span class="p">(</span><span class="nb">callable</span><span class="p">):</span>
</span><span id="DAG-613"><a href="#DAG-613"><span class="linenos"> 613</span></a>                    <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Requested node is not assigned a callable Python function.&quot;</span>
</span><span id="DAG-614"><a href="#DAG-614"><span class="linenos"> 614</span></a>                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="DAG-615"><a href="#DAG-615"><span class="linenos"> 615</span></a>                <span class="k">for</span> <span class="n">node_id</span> <span class="ow">in</span> <span class="n">node_ids</span><span class="p">:</span>
</span><span id="DAG-616"><a href="#DAG-616"><span class="linenos"> 616</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node_id</span><span class="p">][</span><span class="s1">&#39;callable&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">callable</span>
</span><span id="DAG-617"><a href="#DAG-617"><span class="linenos"> 617</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node_id</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">callable</span><span class="o">.</span><span class="vm">__name__</span>
</span><span id="DAG-618"><a href="#DAG-618"><span class="linenos"> 618</span></a>            
</span><span id="DAG-619"><a href="#DAG-619"><span class="linenos"> 619</span></a>            <span class="k">if</span> <span class="n">args</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DAG-620"><a href="#DAG-620"><span class="linenos"> 620</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">_abc</span><span class="o">.</span><span class="n">Iterable</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="nb">str</span><span class="p">)):</span>
</span><span id="DAG-621"><a href="#DAG-621"><span class="linenos"> 621</span></a>                    <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Requested node is not assigned a tuple of pos args.&quot;</span>
</span><span id="DAG-622"><a href="#DAG-622"><span class="linenos"> 622</span></a>                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="DAG-623"><a href="#DAG-623"><span class="linenos"> 623</span></a>                <span class="n">args</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
</span><span id="DAG-624"><a href="#DAG-624"><span class="linenos"> 624</span></a>                <span class="k">for</span> <span class="n">node_id</span> <span class="ow">in</span> <span class="n">node_ids</span><span class="p">:</span>
</span><span id="DAG-625"><a href="#DAG-625"><span class="linenos"> 625</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node_id</span><span class="p">][</span><span class="s1">&#39;args&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">args</span>
</span><span id="DAG-626"><a href="#DAG-626"><span class="linenos"> 626</span></a>            
</span><span id="DAG-627"><a href="#DAG-627"><span class="linenos"> 627</span></a>            <span class="k">if</span> <span class="n">kwargs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DAG-628"><a href="#DAG-628"><span class="linenos"> 628</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="DAG-629"><a href="#DAG-629"><span class="linenos"> 629</span></a>                    <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Requested node is not assigned a dictionary of kw args.&quot;</span>
</span><span id="DAG-630"><a href="#DAG-630"><span class="linenos"> 630</span></a>                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="DAG-631"><a href="#DAG-631"><span class="linenos"> 631</span></a>                <span class="k">for</span> <span class="n">node_id</span> <span class="ow">in</span> <span class="n">node_ids</span><span class="p">:</span>
</span><span id="DAG-632"><a href="#DAG-632"><span class="linenos"> 632</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node_id</span><span class="p">][</span><span class="s1">&#39;kwargs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span>
</span><span id="DAG-633"><a href="#DAG-633"><span class="linenos"> 633</span></a>
</span><span id="DAG-634"><a href="#DAG-634"><span class="linenos"> 634</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">N</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_T</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">_T</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">edgedict</span><span class="p">],</span> <span class="n">_T</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">_T</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]]:</span>
</span><span id="DAG-635"><a href="#DAG-635"><span class="linenos"> 635</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DAG-636"><a href="#DAG-636"><span class="linenos"> 636</span></a><span class="sd">        Retrieval function for DAG edge data, based on tuple identifiers.</span>
</span><span id="DAG-637"><a href="#DAG-637"><span class="linenos"> 637</span></a><span class="sd">        Use filter_edges for more flexible controls (e.g.: filter_edges(in=[&#39;node_1&#39;, &#39;node_2&#39;]))</span>
</span><span id="DAG-638"><a href="#DAG-638"><span class="linenos"> 638</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DAG-639"><a href="#DAG-639"><span class="linenos"> 639</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="DAG-640"><a href="#DAG-640"><span class="linenos"> 640</span></a>            <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
</span><span id="DAG-641"><a href="#DAG-641"><span class="linenos"> 641</span></a>                <span class="k">return</span> <span class="p">[</span><span class="n">edgedict</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="o">**</span><span class="n">d</span><span class="p">)</span> <span class="k">for</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">data</span><span class="p">()]</span>
</span><span id="DAG-642"><a href="#DAG-642"><span class="linenos"> 642</span></a>            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
</span><span id="DAG-643"><a href="#DAG-643"><span class="linenos"> 643</span></a>            
</span><span id="DAG-644"><a href="#DAG-644"><span class="linenos"> 644</span></a>        <span class="c1"># elif len(N) == 1:</span>
</span><span id="DAG-645"><a href="#DAG-645"><span class="linenos"> 645</span></a>        <span class="c1">#     if isinstance(N[0], _abc.Iterable) and not isinstance(N[0], tuple):</span>
</span><span id="DAG-646"><a href="#DAG-646"><span class="linenos"> 646</span></a>        <span class="c1">#         N = N[0]</span>
</span><span id="DAG-647"><a href="#DAG-647"><span class="linenos"> 647</span></a>
</span><span id="DAG-648"><a href="#DAG-648"><span class="linenos"> 648</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">N</span><span class="p">))</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">_abc</span><span class="o">.</span><span class="n">Iterable</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">N</span><span class="p">):</span>
</span><span id="DAG-649"><a href="#DAG-649"><span class="linenos"> 649</span></a>            <span class="n">err_msg</span> <span class="o">=</span> <span class="s1">&#39;All requested edges must be unique tuples of size 2.&#39;</span>
</span><span id="DAG-650"><a href="#DAG-650"><span class="linenos"> 650</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="DAG-651"><a href="#DAG-651"><span class="linenos"> 651</span></a>    
</span><span id="DAG-652"><a href="#DAG-652"><span class="linenos"> 652</span></a>        <span class="n">edge_data</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_edge</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="ow">in</span> <span class="n">N</span><span class="p">]</span>
</span><span id="DAG-653"><a href="#DAG-653"><span class="linenos"> 653</span></a>        <span class="k">return</span> <span class="n">edge_data</span>
</span><span id="DAG-654"><a href="#DAG-654"><span class="linenos"> 654</span></a>    
</span><span id="DAG-655"><a href="#DAG-655"><span class="linenos"> 655</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_edge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outgoing_node</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_T</span><span class="o">.</span><span class="n">Callable</span><span class="p">],</span> <span class="n">incoming_node</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_T</span><span class="o">.</span><span class="n">Callable</span><span class="p">],</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_T</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">edgedict</span><span class="p">,</span> <span class="n">_T</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
</span><span id="DAG-656"><a href="#DAG-656"><span class="linenos"> 656</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DAG-657"><a href="#DAG-657"><span class="linenos"> 657</span></a><span class="sd">        Retrieval function for a single directed edge between nodes in a DAG&#39;s scope. </span>
</span><span id="DAG-658"><a href="#DAG-658"><span class="linenos"> 658</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DAG-659"><a href="#DAG-659"><span class="linenos"> 659</span></a>        <span class="nb">id</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node_id</span><span class="p">(</span><span class="n">outgoing_node</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_id</span><span class="p">(</span><span class="n">incoming_node</span><span class="p">))</span>
</span><span id="DAG-660"><a href="#DAG-660"><span class="linenos"> 660</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
</span><span id="DAG-661"><a href="#DAG-661"><span class="linenos"> 661</span></a>            <span class="k">return</span> <span class="nb">id</span>
</span><span id="DAG-662"><a href="#DAG-662"><span class="linenos"> 662</span></a>        <span class="n">edge_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">get_edge_data</span><span class="p">(</span><span class="n">u</span> <span class="o">=</span> <span class="nb">id</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">v</span> <span class="o">=</span> <span class="nb">id</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="DAG-663"><a href="#DAG-663"><span class="linenos"> 663</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">edge_data</span><span class="p">:</span>
</span><span id="DAG-664"><a href="#DAG-664"><span class="linenos"> 664</span></a>            <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;No match found for the directed edge requested: </span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="DAG-665"><a href="#DAG-665"><span class="linenos"> 665</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="DAG-666"><a href="#DAG-666"><span class="linenos"> 666</span></a>        <span class="k">assert</span> <span class="n">edge_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>  <span class="c1"># Type narrowing for Pylance</span>
</span><span id="DAG-667"><a href="#DAG-667"><span class="linenos"> 667</span></a>        <span class="k">return</span> <span class="n">edgedict</span><span class="p">(</span><span class="o">*</span><span class="nb">id</span><span class="p">,</span> <span class="o">**</span><span class="n">edge_data</span><span class="p">)</span>
</span><span id="DAG-668"><a href="#DAG-668"><span class="linenos"> 668</span></a>
</span><span id="DAG-669"><a href="#DAG-669"><span class="linenos"> 669</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_T</span><span class="o">.</span><span class="n">Callable</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">dotdict</span><span class="p">:</span>
</span><span id="DAG-670"><a href="#DAG-670"><span class="linenos"> 670</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DAG-671"><a href="#DAG-671"><span class="linenos"> 671</span></a><span class="sd">        Given a unique identifier, returns a dictionary of node metadata</span>
</span><span id="DAG-672"><a href="#DAG-672"><span class="linenos"> 672</span></a><span class="sd">        for a single node in the DAG&#39;s scope.</span>
</span><span id="DAG-673"><a href="#DAG-673"><span class="linenos"> 673</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DAG-674"><a href="#DAG-674"><span class="linenos"> 674</span></a>        <span class="n">node_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_id</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</span><span id="DAG-675"><a href="#DAG-675"><span class="linenos"> 675</span></a>        <span class="k">return</span> <span class="n">dotdict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node_id</span><span class="p">])</span>
</span><span id="DAG-676"><a href="#DAG-676"><span class="linenos"> 676</span></a>
</span><span id="DAG-677"><a href="#DAG-677"><span class="linenos"> 677</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">N</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_T</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">dotdict</span><span class="p">]:</span>
</span><span id="DAG-678"><a href="#DAG-678"><span class="linenos"> 678</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DAG-679"><a href="#DAG-679"><span class="linenos"> 679</span></a><span class="sd">        Flexible function to retrieve DAG node data, based on node identifiers </span>
</span><span id="DAG-680"><a href="#DAG-680"><span class="linenos"> 680</span></a><span class="sd">        (e.g.: string IDs or unique callables).</span>
</span><span id="DAG-681"><a href="#DAG-681"><span class="linenos"> 681</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DAG-682"><a href="#DAG-682"><span class="linenos"> 682</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="DAG-683"><a href="#DAG-683"><span class="linenos"> 683</span></a>            <span class="n">node_data</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</span><span id="DAG-684"><a href="#DAG-684"><span class="linenos"> 684</span></a>            <span class="k">return</span> <span class="p">[</span><span class="n">dotdict</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">node_data</span><span class="p">]</span>
</span><span id="DAG-685"><a href="#DAG-685"><span class="linenos"> 685</span></a>
</span><span id="DAG-686"><a href="#DAG-686"><span class="linenos"> 686</span></a>        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="DAG-687"><a href="#DAG-687"><span class="linenos"> 687</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">N</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">_abc</span><span class="o">.</span><span class="n">Iterable</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">N</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="DAG-688"><a href="#DAG-688"><span class="linenos"> 688</span></a>                <span class="n">N</span> <span class="o">=</span> <span class="n">N</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="DAG-689"><a href="#DAG-689"><span class="linenos"> 689</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DAG-690"><a href="#DAG-690"><span class="linenos"> 690</span></a>                <span class="n">node_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_id</span><span class="p">(</span><span class="n">N</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="DAG-691"><a href="#DAG-691"><span class="linenos"> 691</span></a>                <span class="n">node_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">dotdict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node_id</span><span class="p">])]</span>
</span><span id="DAG-692"><a href="#DAG-692"><span class="linenos"> 692</span></a>                <span class="k">return</span> <span class="n">node_data</span>
</span><span id="DAG-693"><a href="#DAG-693"><span class="linenos"> 693</span></a>            
</span><span id="DAG-694"><a href="#DAG-694"><span class="linenos"> 694</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">N</span><span class="p">)):</span>
</span><span id="DAG-695"><a href="#DAG-695"><span class="linenos"> 695</span></a>            <span class="n">err_msg</span> <span class="o">=</span> <span class="s1">&#39;All requested nodes must be unique identifiers.&#39;</span>
</span><span id="DAG-696"><a href="#DAG-696"><span class="linenos"> 696</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="DAG-697"><a href="#DAG-697"><span class="linenos"> 697</span></a>        
</span><span id="DAG-698"><a href="#DAG-698"><span class="linenos"> 698</span></a>        <span class="n">node_ids</span>  <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">node_id</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">N</span><span class="p">]</span>
</span><span id="DAG-699"><a href="#DAG-699"><span class="linenos"> 699</span></a>        <span class="n">node_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">dotdict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">n</span><span class="p">])</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">node_ids</span><span class="p">]</span>
</span><span id="DAG-700"><a href="#DAG-700"><span class="linenos"> 700</span></a>        <span class="k">return</span> <span class="n">node_data</span>
</span><span id="DAG-701"><a href="#DAG-701"><span class="linenos"> 701</span></a>
</span><span id="DAG-702"><a href="#DAG-702"><span class="linenos"> 702</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">filter_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">filter</span><span class="p">:</span> <span class="n">_types</span><span class="o">.</span><span class="n">LambdaType</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_T</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="n">_T</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">dotdict</span><span class="p">]:</span>
</span><span id="DAG-703"><a href="#DAG-703"><span class="linenos"> 703</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DAG-704"><a href="#DAG-704"><span class="linenos"> 704</span></a><span class="sd">        Given a lambda function, filter nodes in a DAG&#39;s scope based on its attributes.</span>
</span><span id="DAG-705"><a href="#DAG-705"><span class="linenos"> 705</span></a><span class="sd">        Current limitation: Filters must use node identifier strings when referencing nodes.</span>
</span><span id="DAG-706"><a href="#DAG-706"><span class="linenos"> 706</span></a><span class="sd">        Use get_nodes for more flexible controls.</span>
</span><span id="DAG-707"><a href="#DAG-707"><span class="linenos"> 707</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DAG-708"><a href="#DAG-708"><span class="linenos"> 708</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
</span><span id="DAG-709"><a href="#DAG-709"><span class="linenos"> 709</span></a>            <span class="k">return</span> <span class="p">[</span><span class="n">node</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span> <span class="nb">filter</span><span class="p">(</span><span class="n">dotdict</span><span class="p">(</span><span class="n">node</span><span class="p">))]</span>
</span><span id="DAG-710"><a href="#DAG-710"><span class="linenos"> 710</span></a>        <span class="k">return</span> <span class="p">[</span><span class="n">dotdict</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span> <span class="nb">filter</span><span class="p">(</span><span class="n">dotdict</span><span class="p">(</span><span class="n">node</span><span class="p">))]</span>
</span><span id="DAG-711"><a href="#DAG-711"><span class="linenos"> 711</span></a>    
</span><span id="DAG-712"><a href="#DAG-712"><span class="linenos"> 712</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">filter_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">filter</span><span class="p">:</span> <span class="n">_types</span><span class="o">.</span><span class="n">LambdaType</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_T</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">_T</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">|</span> <span class="n">_T</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">edgedict</span><span class="p">]:</span>
</span><span id="DAG-713"><a href="#DAG-713"><span class="linenos"> 713</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DAG-714"><a href="#DAG-714"><span class="linenos"> 714</span></a><span class="sd">        Given a lambda function, filter edges in a DAG&#39;s scope based on its attributes.</span>
</span><span id="DAG-715"><a href="#DAG-715"><span class="linenos"> 715</span></a><span class="sd">        Current limitation: Filters must use node identifier strings when referencing nodes.</span>
</span><span id="DAG-716"><a href="#DAG-716"><span class="linenos"> 716</span></a><span class="sd">        Use get_edges for more flexible controls.</span>
</span><span id="DAG-717"><a href="#DAG-717"><span class="linenos"> 717</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DAG-718"><a href="#DAG-718"><span class="linenos"> 718</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
</span><span id="DAG-719"><a href="#DAG-719"><span class="linenos"> 719</span></a>            <span class="k">return</span> <span class="p">[</span><span class="n">e</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">data</span><span class="p">())</span> <span class="k">if</span> <span class="nb">filter</span><span class="p">(</span><span class="n">edgedict</span><span class="p">(</span><span class="o">*</span><span class="n">e</span><span class="p">))]</span>
</span><span id="DAG-720"><a href="#DAG-720"><span class="linenos"> 720</span></a>        <span class="k">return</span> <span class="p">[</span><span class="n">edgedict</span><span class="p">(</span><span class="o">*</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">data</span><span class="p">())</span> <span class="k">if</span> <span class="nb">filter</span><span class="p">(</span><span class="n">edgedict</span><span class="p">(</span><span class="o">*</span><span class="n">e</span><span class="p">))]</span>
</span><span id="DAG-721"><a href="#DAG-721"><span class="linenos"> 721</span></a>
</span><span id="DAG-722"><a href="#DAG-722"><span class="linenos"> 722</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">retry_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">identifier</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span><span class="n">_T</span><span class="o">.</span><span class="n">Callable</span><span class="p">],</span> <span class="n">count</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DAG-723"><a href="#DAG-723"><span class="linenos"> 723</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DAG-724"><a href="#DAG-724"><span class="linenos"> 724</span></a><span class="sd">        Given a node identifier, set number of automatic retries in case of failure.</span>
</span><span id="DAG-725"><a href="#DAG-725"><span class="linenos"> 725</span></a><span class="sd">        Re-attempts will begin as soon as possible.</span>
</span><span id="DAG-726"><a href="#DAG-726"><span class="linenos"> 726</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DAG-727"><a href="#DAG-727"><span class="linenos"> 727</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">count</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="DAG-728"><a href="#DAG-728"><span class="linenos"> 728</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Retry count must be a non-negative integer.&quot;</span><span class="p">)</span>
</span><span id="DAG-729"><a href="#DAG-729"><span class="linenos"> 729</span></a>        <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_id</span><span class="p">(</span><span class="n">identifier</span><span class="p">)</span>
</span><span id="DAG-730"><a href="#DAG-730"><span class="linenos"> 730</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s1">&#39;retry&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">count</span>
</span><span id="DAG-731"><a href="#DAG-731"><span class="linenos"> 731</span></a>
</span><span id="DAG-732"><a href="#DAG-732"><span class="linenos"> 732</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">skip_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">identifier</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_T</span><span class="o">.</span><span class="n">Callable</span><span class="p">],</span> <span class="n">skip</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">as_failure</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DAG-733"><a href="#DAG-733"><span class="linenos"> 733</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DAG-734"><a href="#DAG-734"><span class="linenos"> 734</span></a><span class="sd">        Given a node identifier, set DAG to skip node execution as a success (stdout print) or a failure (exception error).</span>
</span><span id="DAG-735"><a href="#DAG-735"><span class="linenos"> 735</span></a><span class="sd">        Allows conditional control and testing over DAG&#39;s order of operations.</span>
</span><span id="DAG-736"><a href="#DAG-736"><span class="linenos"> 736</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DAG-737"><a href="#DAG-737"><span class="linenos"> 737</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">skip</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
</span><span id="DAG-738"><a href="#DAG-738"><span class="linenos"> 738</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Skip argument must be a boolean value.&quot;</span><span class="p">)</span>
</span><span id="DAG-739"><a href="#DAG-739"><span class="linenos"> 739</span></a>        <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_id</span><span class="p">(</span><span class="n">identifier</span><span class="p">)</span>
</span><span id="DAG-740"><a href="#DAG-740"><span class="linenos"> 740</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s1">&#39;skip&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">skip</span><span class="p">,</span> <span class="n">as_failure</span><span class="p">)</span>
</span><span id="DAG-741"><a href="#DAG-741"><span class="linenos"> 741</span></a>      
</span><span id="DAG-742"><a href="#DAG-742"><span class="linenos"> 742</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">critical_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nodes</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_T</span><span class="o">.</span><span class="n">Callable</span><span class="p">,</span> <span class="n">_T</span><span class="o">.</span><span class="n">Iterable</span><span class="p">[</span><span class="n">_T</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_T</span><span class="o">.</span><span class="n">Callable</span><span class="p">]]])</span> <span class="o">-&gt;</span> <span class="s1">&#39;DAG&#39;</span><span class="p">:</span>
</span><span id="DAG-743"><a href="#DAG-743"><span class="linenos"> 743</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DAG-744"><a href="#DAG-744"><span class="linenos"> 744</span></a><span class="sd">        Given a set of nodes, returns a subset of the DAG containing</span>
</span><span id="DAG-745"><a href="#DAG-745"><span class="linenos"> 745</span></a><span class="sd">        only the node(s) and its parents, or upstream dependencies.</span>
</span><span id="DAG-746"><a href="#DAG-746"><span class="linenos"> 746</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DAG-747"><a href="#DAG-747"><span class="linenos"> 747</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="n">_abc</span><span class="o">.</span><span class="n">Iterable</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="DAG-748"><a href="#DAG-748"><span class="linenos"> 748</span></a>            <span class="n">node_ids</span> <span class="o">=</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">node_id</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">}</span>
</span><span id="DAG-749"><a href="#DAG-749"><span class="linenos"> 749</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DAG-750"><a href="#DAG-750"><span class="linenos"> 750</span></a>            <span class="n">node_ids</span> <span class="o">=</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">node_id</span><span class="p">(</span><span class="n">nodes</span><span class="p">)}</span>
</span><span id="DAG-751"><a href="#DAG-751"><span class="linenos"> 751</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_subgraph</span><span class="p">(</span><span class="n">node_ids</span><span class="p">)</span>
</span><span id="DAG-752"><a href="#DAG-752"><span class="linenos"> 752</span></a>
</span><span id="DAG-753"><a href="#DAG-753"><span class="linenos"> 753</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span>
</span><span id="DAG-754"><a href="#DAG-754"><span class="linenos"> 754</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="DAG-755"><a href="#DAG-755"><span class="linenos"> 755</span></a>        <span class="n">return_ref</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="DAG-756"><a href="#DAG-756"><span class="linenos"> 756</span></a>        <span class="n">print_exc</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="DAG-757"><a href="#DAG-757"><span class="linenos"> 757</span></a>        <span class="n">max_workers</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="DAG-758"><a href="#DAG-758"><span class="linenos"> 758</span></a>        <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="DAG-759"><a href="#DAG-759"><span class="linenos"> 759</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_T</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="s1">&#39;DAG.DAGExecutor&#39;</span><span class="p">]:</span>
</span><span id="DAG-760"><a href="#DAG-760"><span class="linenos"> 760</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DAG-761"><a href="#DAG-761"><span class="linenos"> 761</span></a><span class="sd">        Basic wrapper for execution of the DAG&#39;s underlying callables.</span>
</span><span id="DAG-762"><a href="#DAG-762"><span class="linenos"> 762</span></a>
</span><span id="DAG-763"><a href="#DAG-763"><span class="linenos"> 763</span></a><span class="sd">        Args:</span>
</span><span id="DAG-764"><a href="#DAG-764"><span class="linenos"> 764</span></a><span class="sd">            return_ref: If True, return the DAGExecutor instance.</span>
</span><span id="DAG-765"><a href="#DAG-765"><span class="linenos"> 765</span></a><span class="sd">            print_exc: If True, print full exception tracebacks.</span>
</span><span id="DAG-766"><a href="#DAG-766"><span class="linenos"> 766</span></a><span class="sd">            max_workers: Maximum number of worker threads. Defaults to None (auto).</span>
</span><span id="DAG-767"><a href="#DAG-767"><span class="linenos"> 767</span></a><span class="sd">            verbose: If True, log task start/completion messages. Defaults to True.</span>
</span><span id="DAG-768"><a href="#DAG-768"><span class="linenos"> 768</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DAG-769"><a href="#DAG-769"><span class="linenos"> 769</span></a>        <span class="n">executor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DAGExecutor</span><span class="p">(</span>
</span><span id="DAG-770"><a href="#DAG-770"><span class="linenos"> 770</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="n">print_exc</span><span class="p">,</span>
</span><span id="DAG-771"><a href="#DAG-771"><span class="linenos"> 771</span></a>            <span class="n">max_workers</span><span class="o">=</span><span class="n">max_workers</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span>
</span><span id="DAG-772"><a href="#DAG-772"><span class="linenos"> 772</span></a>        <span class="p">)</span>
</span><span id="DAG-773"><a href="#DAG-773"><span class="linenos"> 773</span></a>        <span class="k">return</span> <span class="n">executor</span> <span class="k">if</span> <span class="n">return_ref</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="DAG-774"><a href="#DAG-774"><span class="linenos"> 774</span></a>
</span><span id="DAG-775"><a href="#DAG-775"><span class="linenos"> 775</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">visualize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;gui&#39;</span><span class="p">,</span> <span class="s1">&#39;browser&#39;</span><span class="p">,</span> <span class="s1">&#39;plt&#39;</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">:</span>
</span><span id="DAG-776"><a href="#DAG-776"><span class="linenos"> 776</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DAG-777"><a href="#DAG-777"><span class="linenos"> 777</span></a><span class="sd">        Basic wrapper to visualize DAG using Vis.js and NetGraph libraries.</span>
</span><span id="DAG-778"><a href="#DAG-778"><span class="linenos"> 778</span></a><span class="sd">        By default, visualization library only loaded in after DAG.visualize() is called, halving import times.</span>
</span><span id="DAG-779"><a href="#DAG-779"><span class="linenos"> 779</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DAG-780"><a href="#DAG-780"><span class="linenos"> 780</span></a>        <span class="kn">import</span><span class="w"> </span><span class="nn">webber.viz</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">_viz</span>
</span><span id="DAG-781"><a href="#DAG-781"><span class="linenos"> 781</span></a>
</span><span id="DAG-782"><a href="#DAG-782"><span class="linenos"> 782</span></a>        <span class="k">match</span> <span class="nb">type</span><span class="p">:</span>
</span><span id="DAG-783"><a href="#DAG-783"><span class="linenos"> 783</span></a>            <span class="k">case</span> <span class="s1">&#39;browser&#39;</span><span class="p">:</span>
</span><span id="DAG-784"><a href="#DAG-784"><span class="linenos"> 784</span></a>                <span class="n">_viz</span><span class="o">.</span><span class="n">visualize_browser</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="p">)</span>
</span><span id="DAG-785"><a href="#DAG-785"><span class="linenos"> 785</span></a>
</span><span id="DAG-786"><a href="#DAG-786"><span class="linenos"> 786</span></a>            <span class="k">case</span> <span class="s1">&#39;plt&#39;</span><span class="p">:</span>
</span><span id="DAG-787"><a href="#DAG-787"><span class="linenos"> 787</span></a>                <span class="k">return</span> <span class="n">_viz</span><span class="o">.</span><span class="n">visualize_plt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="p">)</span>
</span><span id="DAG-788"><a href="#DAG-788"><span class="linenos"> 788</span></a>
</span><span id="DAG-789"><a href="#DAG-789"><span class="linenos"> 789</span></a>            <span class="k">case</span> <span class="s1">&#39;gui&#39;</span><span class="p">:</span>
</span><span id="DAG-790"><a href="#DAG-790"><span class="linenos"> 790</span></a>                <span class="c1"># _visualize_gui(self.graph)</span>
</span><span id="DAG-791"><a href="#DAG-791"><span class="linenos"> 791</span></a>                <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span><span id="DAG-792"><a href="#DAG-792"><span class="linenos"> 792</span></a>
</span><span id="DAG-793"><a href="#DAG-793"><span class="linenos"> 793</span></a>            <span class="k">case</span> <span class="kc">None</span><span class="p">:</span> 
</span><span id="DAG-794"><a href="#DAG-794"><span class="linenos"> 794</span></a>                <span class="k">if</span> <span class="n">_viz</span><span class="o">.</span><span class="n">_in_notebook</span><span class="p">():</span>
</span><span id="DAG-795"><a href="#DAG-795"><span class="linenos"> 795</span></a>                    <span class="k">return</span> <span class="n">_viz</span><span class="o">.</span><span class="n">visualize_plt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="p">)</span>
</span><span id="DAG-796"><a href="#DAG-796"><span class="linenos"> 796</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="DAG-797"><a href="#DAG-797"><span class="linenos"> 797</span></a>                    <span class="n">_viz</span><span class="o">.</span><span class="n">visualize_browser</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="p">)</span>
</span><span id="DAG-798"><a href="#DAG-798"><span class="linenos"> 798</span></a>
</span><span id="DAG-799"><a href="#DAG-799"><span class="linenos"> 799</span></a>            <span class="k">case</span><span class="w"> </span><span class="k">_</span><span class="p">:</span>
</span><span id="DAG-800"><a href="#DAG-800"><span class="linenos"> 800</span></a>                <span class="n">err_msg</span> <span class="o">=</span> <span class="s2">&quot;Unknown visualization type requested.&quot;</span>
</span><span id="DAG-801"><a href="#DAG-801"><span class="linenos"> 801</span></a>                <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="DAG-802"><a href="#DAG-802"><span class="linenos"> 802</span></a>
</span><span id="DAG-803"><a href="#DAG-803"><span class="linenos"> 803</span></a>    <span class="nd">@property</span>
</span><span id="DAG-804"><a href="#DAG-804"><span class="linenos"> 804</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">root</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_T</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="DAG-805"><a href="#DAG-805"><span class="linenos"> 805</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DAG-806"><a href="#DAG-806"><span class="linenos"> 806</span></a><span class="sd">        Return list of nodes with no dependencies.</span>
</span><span id="DAG-807"><a href="#DAG-807"><span class="linenos"> 807</span></a><span class="sd">        Root nodes will occur first in DAG&#39;s order of operations.</span>
</span><span id="DAG-808"><a href="#DAG-808"><span class="linenos"> 808</span></a><span class="sd">        Uses O(1) in_degree() instead of O(k) predecessors list creation.</span>
</span><span id="DAG-809"><a href="#DAG-809"><span class="linenos"> 809</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DAG-810"><a href="#DAG-810"><span class="linenos"> 810</span></a>        <span class="k">return</span> <span class="p">[</span><span class="n">node</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">in_degree</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="DAG-811"><a href="#DAG-811"><span class="linenos"> 811</span></a>
</span><span id="DAG-812"><a href="#DAG-812"><span class="linenos"> 812</span></a>    <span class="nd">@property</span>
</span><span id="DAG-813"><a href="#DAG-813"><span class="linenos"> 813</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">:</span>
</span><span id="DAG-814"><a href="#DAG-814"><span class="linenos"> 814</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the NodeView of the underlying NetworkX graph containing all DAG nodes.&quot;&quot;&quot;</span>
</span><span id="DAG-815"><a href="#DAG-815"><span class="linenos"> 815</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span>
</span><span id="DAG-816"><a href="#DAG-816"><span class="linenos"> 816</span></a>
</span><span id="DAG-817"><a href="#DAG-817"><span class="linenos"> 817</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">node_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">identifier</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span><span class="n">_T</span><span class="o">.</span><span class="n">Callable</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="DAG-818"><a href="#DAG-818"><span class="linenos"> 818</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DAG-819"><a href="#DAG-819"><span class="linenos"> 819</span></a><span class="sd">        Validate whether identifier given is a valid node within the DAG&#39;s scope.</span>
</span><span id="DAG-820"><a href="#DAG-820"><span class="linenos"> 820</span></a><span class="sd">        Primarily for internal use, but useful for retrieving string identifiers</span>
</span><span id="DAG-821"><a href="#DAG-821"><span class="linenos"> 821</span></a><span class="sd">        for a unique callable in a DAG.</span>
</span><span id="DAG-822"><a href="#DAG-822"><span class="linenos"> 822</span></a><span class="sd">        Uses O(1) cache lookup for callables instead of O(n) linear search.</span>
</span><span id="DAG-823"><a href="#DAG-823"><span class="linenos"> 823</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DAG-824"><a href="#DAG-824"><span class="linenos"> 824</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">identifier</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="DAG-825"><a href="#DAG-825"><span class="linenos"> 825</span></a>            <span class="c1"># O(1) lookup using graph.nodes dict</span>
</span><span id="DAG-826"><a href="#DAG-826"><span class="linenos"> 826</span></a>            <span class="k">if</span> <span class="n">identifier</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
</span><span id="DAG-827"><a href="#DAG-827"><span class="linenos"> 827</span></a>                <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Node </span><span class="si">{</span><span class="n">identifier</span><span class="si">}</span><span class="s2"> is not defined in this DAG&#39;s scope.&quot;</span>
</span><span id="DAG-828"><a href="#DAG-828"><span class="linenos"> 828</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="DAG-829"><a href="#DAG-829"><span class="linenos"> 829</span></a>            <span class="k">return</span> <span class="n">identifier</span>
</span><span id="DAG-830"><a href="#DAG-830"><span class="linenos"> 830</span></a>        <span class="k">elif</span> <span class="n">_iscallable</span><span class="p">(</span><span class="n">identifier</span><span class="p">):</span>
</span><span id="DAG-831"><a href="#DAG-831"><span class="linenos"> 831</span></a>            <span class="c1"># O(1) lookup using _callable_to_id cache</span>
</span><span id="DAG-832"><a href="#DAG-832"><span class="linenos"> 832</span></a>            <span class="k">if</span> <span class="n">identifier</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_callable_to_id</span><span class="p">:</span>
</span><span id="DAG-833"><a href="#DAG-833"><span class="linenos"> 833</span></a>                <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Callable </span><span class="si">{</span><span class="n">identifier</span><span class="si">}</span><span class="s2"> is not defined in this DAG&#39;s scope.&quot;</span>
</span><span id="DAG-834"><a href="#DAG-834"><span class="linenos"> 834</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="DAG-835"><a href="#DAG-835"><span class="linenos"> 835</span></a>            <span class="n">cached_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_callable_to_id</span><span class="p">[</span><span class="n">identifier</span><span class="p">]</span>
</span><span id="DAG-836"><a href="#DAG-836"><span class="linenos"> 836</span></a>            <span class="k">if</span> <span class="n">cached_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DAG-837"><a href="#DAG-837"><span class="linenos"> 837</span></a>                <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Callable </span><span class="si">{</span><span class="n">identifier</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> &quot;</span> \
</span><span id="DAG-838"><a href="#DAG-838"><span class="linenos"> 838</span></a>                        <span class="o">+</span> <span class="s2">&quot;exists more than once in this DAG. &quot;</span> \
</span><span id="DAG-839"><a href="#DAG-839"><span class="linenos"> 839</span></a>                        <span class="o">+</span> <span class="s2">&quot;Use the unique string identifier of the required node.&quot;</span>
</span><span id="DAG-840"><a href="#DAG-840"><span class="linenos"> 840</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="DAG-841"><a href="#DAG-841"><span class="linenos"> 841</span></a>            <span class="k">return</span> <span class="n">cached_id</span>
</span><span id="DAG-842"><a href="#DAG-842"><span class="linenos"> 842</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DAG-843"><a href="#DAG-843"><span class="linenos"> 843</span></a>            <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Node </span><span class="si">{</span><span class="n">identifier</span><span class="si">}</span><span class="s2"> must be a string or a Python callable&quot;</span>
</span><span id="DAG-844"><a href="#DAG-844"><span class="linenos"> 844</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="DAG-845"><a href="#DAG-845"><span class="linenos"> 845</span></a>    
</span><span id="DAG-846"><a href="#DAG-846"><span class="linenos"> 846</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_update_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nodedict</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">],</span> <span class="nb">id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DAG-847"><a href="#DAG-847"><span class="linenos"> 847</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DAG-848"><a href="#DAG-848"><span class="linenos"> 848</span></a><span class="sd">        Internal only. Update properties of single node within a DAG&#39;s scope, </span>
</span><span id="DAG-849"><a href="#DAG-849"><span class="linenos"> 849</span></a><span class="sd">        given a well-structured dictionary and the tuple identifier of the network edge. </span>
</span><span id="DAG-850"><a href="#DAG-850"><span class="linenos"> 850</span></a><span class="sd">        Force argument bypasses dictionary validation, and should only be used internally.</span>
</span><span id="DAG-851"><a href="#DAG-851"><span class="linenos"> 851</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DAG-852"><a href="#DAG-852"><span class="linenos"> 852</span></a>        <span class="k">if</span> <span class="nb">id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DAG-853"><a href="#DAG-853"><span class="linenos"> 853</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="DAG-854"><a href="#DAG-854"><span class="linenos"> 854</span></a>                <span class="k">if</span> <span class="n">nodedict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">id</span> <span class="o">!=</span> <span class="n">nodedict</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]:</span>
</span><span id="DAG-855"><a href="#DAG-855"><span class="linenos"> 855</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Given ID </span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s2"> inconsistent with dictionary identifier: </span><span class="si">{</span><span class="n">nodedict</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="DAG-856"><a href="#DAG-856"><span class="linenos"> 856</span></a>            <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="DAG-857"><a href="#DAG-857"><span class="linenos"> 857</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">force</span><span class="p">:</span>
</span><span id="DAG-858"><a href="#DAG-858"><span class="linenos"> 858</span></a>                    <span class="k">raise</span> <span class="n">e</span>
</span><span id="DAG-859"><a href="#DAG-859"><span class="linenos"> 859</span></a>            <span class="n">nodedict</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">id</span>
</span><span id="DAG-860"><a href="#DAG-860"><span class="linenos"> 860</span></a>        
</span><span id="DAG-861"><a href="#DAG-861"><span class="linenos"> 861</span></a>        <span class="n">expected_keys</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;callable&#39;</span><span class="p">,</span> <span class="s1">&#39;args&#39;</span><span class="p">,</span> <span class="s1">&#39;kwargs&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">)</span>
</span><span id="DAG-862"><a href="#DAG-862"><span class="linenos"> 862</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">set</span><span class="p">(</span><span class="n">expected_keys</span><span class="p">)</span><span class="o">.</span><span class="n">issuperset</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">nodedict</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span>
</span><span id="DAG-863"><a href="#DAG-863"><span class="linenos"> 863</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Expecting keys: </span><span class="si">{</span><span class="n">expected_keys</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="DAG-864"><a href="#DAG-864"><span class="linenos"> 864</span></a>        
</span><span id="DAG-865"><a href="#DAG-865"><span class="linenos"> 865</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">force</span><span class="p">:</span>
</span><span id="DAG-866"><a href="#DAG-866"><span class="linenos"> 866</span></a>            <span class="k">if</span> <span class="n">nodedict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;callable&#39;</span><span class="p">):</span>
</span><span id="DAG-867"><a href="#DAG-867"><span class="linenos"> 867</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">_iscallable</span><span class="p">(</span><span class="n">nodedict</span><span class="p">[</span><span class="s1">&#39;callable&#39;</span><span class="p">]):</span>
</span><span id="DAG-868"><a href="#DAG-868"><span class="linenos"> 868</span></a>                    <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Requested node is not assigned a callable Python function.&quot;</span>
</span><span id="DAG-869"><a href="#DAG-869"><span class="linenos"> 869</span></a>                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="DAG-870"><a href="#DAG-870"><span class="linenos"> 870</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">nodedict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">):</span>
</span><span id="DAG-871"><a href="#DAG-871"><span class="linenos"> 871</span></a>                    <span class="n">nodedict</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nodedict</span><span class="p">[</span><span class="s1">&#39;callable&#39;</span><span class="p">]</span><span class="o">.</span><span class="vm">__name__</span>
</span><span id="DAG-872"><a href="#DAG-872"><span class="linenos"> 872</span></a>
</span><span id="DAG-873"><a href="#DAG-873"><span class="linenos"> 873</span></a>            <span class="k">if</span> <span class="n">nodedict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nodedict</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">nodedict</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span> 
</span><span id="DAG-874"><a href="#DAG-874"><span class="linenos"> 874</span></a>                <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Requested node name must be a non-null Python string, will default to callable when not set.&quot;</span>
</span><span id="DAG-875"><a href="#DAG-875"><span class="linenos"> 875</span></a>                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="DAG-876"><a href="#DAG-876"><span class="linenos"> 876</span></a>
</span><span id="DAG-877"><a href="#DAG-877"><span class="linenos"> 877</span></a>            <span class="k">if</span> <span class="n">nodedict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;args&#39;</span><span class="p">):</span>
</span><span id="DAG-878"><a href="#DAG-878"><span class="linenos"> 878</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">nodedict</span><span class="p">[</span><span class="s1">&#39;args&#39;</span><span class="p">],</span> <span class="n">_abc</span><span class="o">.</span><span class="n">Iterable</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nodedict</span><span class="p">[</span><span class="s1">&#39;args&#39;</span><span class="p">],</span> <span class="nb">str</span><span class="p">)):</span>
</span><span id="DAG-879"><a href="#DAG-879"><span class="linenos"> 879</span></a>                    <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Requested node is not assigned a tuple of pos args.&quot;</span>
</span><span id="DAG-880"><a href="#DAG-880"><span class="linenos"> 880</span></a>                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="DAG-881"><a href="#DAG-881"><span class="linenos"> 881</span></a>                <span class="n">nodedict</span><span class="p">[</span><span class="s1">&#39;args&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">nodedict</span><span class="p">[</span><span class="s1">&#39;args&#39;</span><span class="p">])</span>
</span><span id="DAG-882"><a href="#DAG-882"><span class="linenos"> 882</span></a>            
</span><span id="DAG-883"><a href="#DAG-883"><span class="linenos"> 883</span></a>            <span class="k">if</span> <span class="n">nodedict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;kwargs&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nodedict</span><span class="p">[</span><span class="s1">&#39;kwargs&#39;</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="DAG-884"><a href="#DAG-884"><span class="linenos"> 884</span></a>                <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Requested node is not assigned a dictionary of kw args.&quot;</span>
</span><span id="DAG-885"><a href="#DAG-885"><span class="linenos"> 885</span></a>                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>                    
</span><span id="DAG-886"><a href="#DAG-886"><span class="linenos"> 886</span></a>        
</span><span id="DAG-887"><a href="#DAG-887"><span class="linenos"> 887</span></a>        <span class="n">node_id</span> <span class="o">=</span> <span class="n">nodedict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>
</span><span id="DAG-888"><a href="#DAG-888"><span class="linenos"> 888</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node_id</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">nodedict</span><span class="p">)</span>
</span><span id="DAG-889"><a href="#DAG-889"><span class="linenos"> 889</span></a>
</span><span id="DAG-890"><a href="#DAG-890"><span class="linenos"> 890</span></a>        <span class="c1"># Reset node name if implicitly requested.</span>
</span><span id="DAG-891"><a href="#DAG-891"><span class="linenos"> 891</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">nodedict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">):</span>
</span><span id="DAG-892"><a href="#DAG-892"><span class="linenos"> 892</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node_id</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node_id</span><span class="p">][</span><span class="s1">&#39;callable&#39;</span><span class="p">]</span><span class="o">.</span><span class="vm">__name__</span>
</span><span id="DAG-893"><a href="#DAG-893"><span class="linenos"> 893</span></a>
</span><span id="DAG-894"><a href="#DAG-894"><span class="linenos"> 894</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_subgraph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_ids</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s1">&#39;DAG&#39;</span><span class="p">:</span>
</span><span id="DAG-895"><a href="#DAG-895"><span class="linenos"> 895</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DAG-896"><a href="#DAG-896"><span class="linenos"> 896</span></a><span class="sd">        Internal only. Given a set of nodes, returns a subset of the DAG containing</span>
</span><span id="DAG-897"><a href="#DAG-897"><span class="linenos"> 897</span></a><span class="sd">        only the node(s) and upstream dependencies.</span>
</span><span id="DAG-898"><a href="#DAG-898"><span class="linenos"> 898</span></a><span class="sd">        Uses nx.ancestors() for O(V+E) performance instead of manual traversal.</span>
</span><span id="DAG-899"><a href="#DAG-899"><span class="linenos"> 899</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DAG-900"><a href="#DAG-900"><span class="linenos"> 900</span></a>        <span class="n">all_nodes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">node_ids</span><span class="p">)</span>
</span><span id="DAG-901"><a href="#DAG-901"><span class="linenos"> 901</span></a>        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">node_ids</span><span class="p">:</span>
</span><span id="DAG-902"><a href="#DAG-902"><span class="linenos"> 902</span></a>            <span class="n">all_nodes</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">_nx</span><span class="o">.</span><span class="n">ancestors</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="p">,</span> <span class="n">node</span><span class="p">))</span>
</span><span id="DAG-903"><a href="#DAG-903"><span class="linenos"> 903</span></a>        <span class="n">subgraph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">subgraph</span><span class="p">(</span><span class="n">all_nodes</span><span class="p">)</span>
</span><span id="DAG-904"><a href="#DAG-904"><span class="linenos"> 904</span></a>        <span class="k">return</span> <span class="n">DAG</span><span class="p">(</span><span class="n">subgraph</span><span class="p">,</span> <span class="n">__force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="DAG-905"><a href="#DAG-905"><span class="linenos"> 905</span></a>
</span><span id="DAG-906"><a href="#DAG-906"><span class="linenos"> 906</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">resolve_promise</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">promise</span><span class="p">:</span> <span class="n">_xcoms</span><span class="o">.</span><span class="n">Promise</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_xcoms</span><span class="o">.</span><span class="n">Promise</span><span class="p">:</span>
</span><span id="DAG-907"><a href="#DAG-907"><span class="linenos"> 907</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DAG-908"><a href="#DAG-908"><span class="linenos"> 908</span></a><span class="sd">        Returns a Promise with a unique string identifier, if a given Promise is valid, based on the DAG&#39;s current scope.</span>
</span><span id="DAG-909"><a href="#DAG-909"><span class="linenos"> 909</span></a><span class="sd">        Raises `webber.xcoms.InvalidCallable` if Promise requests a callable that is out of scope.</span>
</span><span id="DAG-910"><a href="#DAG-910"><span class="linenos"> 910</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DAG-911"><a href="#DAG-911"><span class="linenos"> 911</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="DAG-912"><a href="#DAG-912"><span class="linenos"> 912</span></a>            <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_id</span><span class="p">(</span><span class="n">promise</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>
</span><span id="DAG-913"><a href="#DAG-913"><span class="linenos"> 913</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="DAG-914"><a href="#DAG-914"><span class="linenos"> 914</span></a>            <span class="k">raise</span> <span class="n">_xcoms</span><span class="o">.</span><span class="n">InvalidCallable</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span id="DAG-915"><a href="#DAG-915"><span class="linenos"> 915</span></a>        <span class="k">return</span> <span class="n">_xcoms</span><span class="o">.</span><span class="n">Promise</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span id="DAG-916"><a href="#DAG-916"><span class="linenos"> 916</span></a>
</span><span id="DAG-917"><a href="#DAG-917"><span class="linenos"> 917</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">_nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">,</span> <span class="n">_nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DAG-918"><a href="#DAG-918"><span class="linenos"> 918</span></a>
</span><span id="DAG-919"><a href="#DAG-919"><span class="linenos"> 919</span></a>        <span class="k">if</span> <span class="n">graph</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DAG-920"><a href="#DAG-920"><span class="linenos"> 920</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="o">=</span> <span class="n">_nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">()</span>
</span><span id="DAG-921"><a href="#DAG-921"><span class="linenos"> 921</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_callable_to_id</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="DAG-922"><a href="#DAG-922"><span class="linenos"> 922</span></a>            <span class="k">return</span>
</span><span id="DAG-923"><a href="#DAG-923"><span class="linenos"> 923</span></a>
</span><span id="DAG-924"><a href="#DAG-924"><span class="linenos"> 924</span></a>        <span class="c1"># Meant for internal use only, creating DAGs from subgraphs.</span>
</span><span id="DAG-925"><a href="#DAG-925"><span class="linenos"> 925</span></a>        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;__force&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="DAG-926"><a href="#DAG-926"><span class="linenos"> 926</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="o">=</span> <span class="n">_T</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">_nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">,</span> <span class="n">graph</span><span class="p">)</span>
</span><span id="DAG-927"><a href="#DAG-927"><span class="linenos"> 927</span></a>            <span class="c1"># Build cache from existing subgraph</span>
</span><span id="DAG-928"><a href="#DAG-928"><span class="linenos"> 928</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_callable_to_id</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="DAG-929"><a href="#DAG-929"><span class="linenos"> 929</span></a>            <span class="k">for</span> <span class="n">node_id</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="DAG-930"><a href="#DAG-930"><span class="linenos"> 930</span></a>                <span class="n">callable_fn</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;callable&#39;</span><span class="p">)</span>
</span><span id="DAG-931"><a href="#DAG-931"><span class="linenos"> 931</span></a>                <span class="k">if</span> <span class="n">callable_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DAG-932"><a href="#DAG-932"><span class="linenos"> 932</span></a>                    <span class="k">if</span> <span class="n">callable_fn</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_callable_to_id</span><span class="p">:</span>
</span><span id="DAG-933"><a href="#DAG-933"><span class="linenos"> 933</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">_callable_to_id</span><span class="p">[</span><span class="n">callable_fn</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Duplicate</span>
</span><span id="DAG-934"><a href="#DAG-934"><span class="linenos"> 934</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="DAG-935"><a href="#DAG-935"><span class="linenos"> 935</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">_callable_to_id</span><span class="p">[</span><span class="n">callable_fn</span><span class="p">]</span> <span class="o">=</span> <span class="n">node_id</span>
</span><span id="DAG-936"><a href="#DAG-936"><span class="linenos"> 936</span></a>            <span class="k">return</span>
</span><span id="DAG-937"><a href="#DAG-937"><span class="linenos"> 937</span></a>
</span><span id="DAG-938"><a href="#DAG-938"><span class="linenos"> 938</span></a>        <span class="n">_edges</span><span class="o">.</span><span class="n">validate_dag</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
</span><span id="DAG-939"><a href="#DAG-939"><span class="linenos"> 939</span></a>        <span class="c1"># Type narrowing: validate_dag ensures graph is a DiGraph</span>
</span><span id="DAG-940"><a href="#DAG-940"><span class="linenos"> 940</span></a>        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">_nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">)</span>
</span><span id="DAG-941"><a href="#DAG-941"><span class="linenos"> 941</span></a>
</span><span id="DAG-942"><a href="#DAG-942"><span class="linenos"> 942</span></a>        <span class="c1"># Define framework specific logic as nested dictionaries.</span>
</span><span id="DAG-943"><a href="#DAG-943"><span class="linenos"> 943</span></a>        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="DAG-944"><a href="#DAG-944"><span class="linenos"> 944</span></a>            <span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s1">&#39;callable&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">node</span>
</span><span id="DAG-945"><a href="#DAG-945"><span class="linenos"> 945</span></a>            <span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="vm">__name__</span>
</span><span id="DAG-946"><a href="#DAG-946"><span class="linenos"> 946</span></a>            <span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s1">&#39;args&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="DAG-947"><a href="#DAG-947"><span class="linenos"> 947</span></a>            <span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s1">&#39;kwargs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="DAG-948"><a href="#DAG-948"><span class="linenos"> 948</span></a>
</span><span id="DAG-949"><a href="#DAG-949"><span class="linenos"> 949</span></a>        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">:</span>
</span><span id="DAG-950"><a href="#DAG-950"><span class="linenos"> 950</span></a>            <span class="n">condition</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">e</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Condition&#39;</span><span class="p">)</span>
</span><span id="DAG-951"><a href="#DAG-951"><span class="linenos"> 951</span></a>            <span class="k">if</span> <span class="n">condition</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DAG-952"><a href="#DAG-952"><span class="linenos"> 952</span></a>                <span class="k">if</span> <span class="n">condition</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">Condition</span><span class="p">:</span>
</span><span id="DAG-953"><a href="#DAG-953"><span class="linenos"> 953</span></a>                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="s1">&#39;Edge conditions must belong to IntEnum type Webber.Condition.&#39;</span><span class="p">)</span>
</span><span id="DAG-954"><a href="#DAG-954"><span class="linenos"> 954</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DAG-955"><a href="#DAG-955"><span class="linenos"> 955</span></a>                <span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;Condition&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Condition</span><span class="o">.</span><span class="n">Success</span>
</span><span id="DAG-956"><a href="#DAG-956"><span class="linenos"> 956</span></a>
</span><span id="DAG-957"><a href="#DAG-957"><span class="linenos"> 957</span></a>        <span class="n">graph</span> <span class="o">=</span> <span class="n">_nx</span><span class="o">.</span><span class="n">relabel_nodes</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">node</span><span class="p">:</span> <span class="n">_edges</span><span class="o">.</span><span class="n">label_node</span><span class="p">(</span><span class="n">node</span><span class="p">))</span>
</span><span id="DAG-958"><a href="#DAG-958"><span class="linenos"> 958</span></a>        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
</span><span id="DAG-959"><a href="#DAG-959"><span class="linenos"> 959</span></a>            <span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">n</span>
</span><span id="DAG-960"><a href="#DAG-960"><span class="linenos"> 960</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="o">=</span> <span class="n">_nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
</span><span id="DAG-961"><a href="#DAG-961"><span class="linenos"> 961</span></a>
</span><span id="DAG-962"><a href="#DAG-962"><span class="linenos"> 962</span></a>        <span class="c1"># Build callable-&gt;id cache after relabeling</span>
</span><span id="DAG-963"><a href="#DAG-963"><span class="linenos"> 963</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_callable_to_id</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="DAG-964"><a href="#DAG-964"><span class="linenos"> 964</span></a>        <span class="k">for</span> <span class="n">node_id</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="DAG-965"><a href="#DAG-965"><span class="linenos"> 965</span></a>            <span class="n">callable_fn</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;callable&#39;</span><span class="p">)</span>
</span><span id="DAG-966"><a href="#DAG-966"><span class="linenos"> 966</span></a>            <span class="k">if</span> <span class="n">callable_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DAG-967"><a href="#DAG-967"><span class="linenos"> 967</span></a>                <span class="k">if</span> <span class="n">callable_fn</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_callable_to_id</span><span class="p">:</span>
</span><span id="DAG-968"><a href="#DAG-968"><span class="linenos"> 968</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_callable_to_id</span><span class="p">[</span><span class="n">callable_fn</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Duplicate</span>
</span><span id="DAG-969"><a href="#DAG-969"><span class="linenos"> 969</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="DAG-970"><a href="#DAG-970"><span class="linenos"> 970</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_callable_to_id</span><span class="p">[</span><span class="n">callable_fn</span><span class="p">]</span> <span class="o">=</span> <span class="n">node_id</span>
</span><span id="DAG-971"><a href="#DAG-971"><span class="linenos"> 971</span></a>
</span><span id="DAG-972"><a href="#DAG-972"><span class="linenos"> 972</span></a>    <span class="k">class</span><span class="w"> </span><span class="nc">DAGExecutor</span><span class="p">:</span>
</span><span id="DAG-973"><a href="#DAG-973"><span class="linenos"> 973</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DAG-974"><a href="#DAG-974"><span class="linenos"> 974</span></a><span class="sd">        Base class used to execute DAG in embarrassingly parallel.</span>
</span><span id="DAG-975"><a href="#DAG-975"><span class="linenos"> 975</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DAG-976"><a href="#DAG-976"><span class="linenos"> 976</span></a>        <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="DAG-977"><a href="#DAG-977"><span class="linenos"> 977</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="DAG-978"><a href="#DAG-978"><span class="linenos"> 978</span></a>            <span class="n">graph</span><span class="p">:</span> <span class="n">_nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">,</span>
</span><span id="DAG-979"><a href="#DAG-979"><span class="linenos"> 979</span></a>            <span class="n">roots</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="DAG-980"><a href="#DAG-980"><span class="linenos"> 980</span></a>            <span class="n">print_exc</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="DAG-981"><a href="#DAG-981"><span class="linenos"> 981</span></a>            <span class="n">max_workers</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="DAG-982"><a href="#DAG-982"><span class="linenos"> 982</span></a>            <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="DAG-983"><a href="#DAG-983"><span class="linenos"> 983</span></a>        <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DAG-984"><a href="#DAG-984"><span class="linenos"> 984</span></a>
</span><span id="DAG-985"><a href="#DAG-985"><span class="linenos"> 985</span></a>            <span class="c1"># Skip execution if there are no callables in scope.</span>
</span><span id="DAG-986"><a href="#DAG-986"><span class="linenos"> 986</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="DAG-987"><a href="#DAG-987"><span class="linenos"> 987</span></a>                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="DAG-988"><a href="#DAG-988"><span class="linenos"> 988</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Given DAG has no callables in scope. Skipping execution...&#39;</span><span class="p">)</span>
</span><span id="DAG-989"><a href="#DAG-989"><span class="linenos"> 989</span></a>                <span class="k">return</span>
</span><span id="DAG-990"><a href="#DAG-990"><span class="linenos"> 990</span></a>
</span><span id="DAG-991"><a href="#DAG-991"><span class="linenos"> 991</span></a>            <span class="c1"># Initialize local variables for execution.</span>
</span><span id="DAG-992"><a href="#DAG-992"><span class="linenos"> 992</span></a>            <span class="n">complete</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="DAG-993"><a href="#DAG-993"><span class="linenos"> 993</span></a>            <span class="n">started</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="DAG-994"><a href="#DAG-994"><span class="linenos"> 994</span></a>            <span class="n">failed</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="DAG-995"><a href="#DAG-995"><span class="linenos"> 995</span></a>            <span class="n">skipped</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="DAG-996"><a href="#DAG-996"><span class="linenos"> 996</span></a>            <span class="n">refs</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_futures</span><span class="o">.</span><span class="n">Future</span><span class="p">[</span><span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="DAG-997"><a href="#DAG-997"><span class="linenos"> 997</span></a>
</span><span id="DAG-998"><a href="#DAG-998"><span class="linenos"> 998</span></a>            <span class="k">def</span><span class="w"> </span><span class="nf">raise_exc</span><span class="p">(</span><span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DAG-999"><a href="#DAG-999"><span class="linenos"> 999</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</span><span id="DAG-1000"><a href="#DAG-1000"><span class="linenos">1000</span></a>
</span><span id="DAG-1001"><a href="#DAG-1001"><span class="linenos">1001</span></a>            <span class="k">def</span><span class="w"> </span><span class="nf">run_conditions_met</span><span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="DAG-1002"><a href="#DAG-1002"><span class="linenos">1002</span></a>                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">predecessors</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
</span><span id="DAG-1003"><a href="#DAG-1003"><span class="linenos">1003</span></a>                    <span class="k">match</span> <span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">[(</span><span class="n">p</span><span class="p">,</span> <span class="n">n</span><span class="p">)][</span><span class="s1">&#39;Condition&#39;</span><span class="p">]:</span>
</span><span id="DAG-1004"><a href="#DAG-1004"><span class="linenos">1004</span></a>                        <span class="k">case</span> <span class="n">Condition</span><span class="o">.</span><span class="n">Success</span><span class="p">:</span>
</span><span id="DAG-1005"><a href="#DAG-1005"><span class="linenos">1005</span></a>                            <span class="k">if</span> <span class="n">p</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">complete</span><span class="p">:</span>
</span><span id="DAG-1006"><a href="#DAG-1006"><span class="linenos">1006</span></a>                                <span class="k">return</span> <span class="kc">False</span>
</span><span id="DAG-1007"><a href="#DAG-1007"><span class="linenos">1007</span></a>                        <span class="k">case</span> <span class="n">Condition</span><span class="o">.</span><span class="n">Failure</span><span class="p">:</span>
</span><span id="DAG-1008"><a href="#DAG-1008"><span class="linenos">1008</span></a>                            <span class="k">if</span> <span class="n">p</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">failed</span><span class="p">:</span>
</span><span id="DAG-1009"><a href="#DAG-1009"><span class="linenos">1009</span></a>                                <span class="k">return</span> <span class="kc">False</span>
</span><span id="DAG-1010"><a href="#DAG-1010"><span class="linenos">1010</span></a>                        <span class="k">case</span> <span class="n">Condition</span><span class="o">.</span><span class="n">AnyCase</span><span class="p">:</span>
</span><span id="DAG-1011"><a href="#DAG-1011"><span class="linenos">1011</span></a>                            <span class="k">if</span> <span class="n">p</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">failed</span> <span class="ow">and</span> <span class="n">p</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">complete</span><span class="p">:</span>
</span><span id="DAG-1012"><a href="#DAG-1012"><span class="linenos">1012</span></a>                                <span class="k">return</span> <span class="kc">False</span>
</span><span id="DAG-1013"><a href="#DAG-1013"><span class="linenos">1013</span></a>                <span class="k">return</span> <span class="kc">True</span>
</span><span id="DAG-1014"><a href="#DAG-1014"><span class="linenos">1014</span></a>
</span><span id="DAG-1015"><a href="#DAG-1015"><span class="linenos">1015</span></a>            <span class="n">skip</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="s2">&quot;skip&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
</span><span id="DAG-1016"><a href="#DAG-1016"><span class="linenos">1016</span></a>            <span class="n">retry</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_T</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="DAG-1017"><a href="#DAG-1017"><span class="linenos">1017</span></a>                <span class="n">n</span><span class="p">:</span> <span class="p">[</span><span class="n">c</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="p">{}]</span> <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="s2">&quot;retry&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="DAG-1018"><a href="#DAG-1018"><span class="linenos">1018</span></a>            <span class="p">}</span>
</span><span id="DAG-1019"><a href="#DAG-1019"><span class="linenos">1019</span></a>
</span><span id="DAG-1020"><a href="#DAG-1020"><span class="linenos">1020</span></a>            <span class="c1"># Start execution of root node functions.</span>
</span><span id="DAG-1021"><a href="#DAG-1021"><span class="linenos">1021</span></a>            <span class="k">with</span> <span class="n">_futures</span><span class="o">.</span><span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="n">max_workers</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
</span><span id="DAG-1022"><a href="#DAG-1022"><span class="linenos">1022</span></a>
</span><span id="DAG-1023"><a href="#DAG-1023"><span class="linenos">1023</span></a>                <span class="k">def</span><span class="w"> </span><span class="nf">Submit</span><span class="p">(</span>
</span><span id="DAG-1024"><a href="#DAG-1024"><span class="linenos">1024</span></a>                    <span class="n">event</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="DAG-1025"><a href="#DAG-1025"><span class="linenos">1025</span></a>                    <span class="nb">callable</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">],</span>
</span><span id="DAG-1026"><a href="#DAG-1026"><span class="linenos">1026</span></a>                    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="DAG-1027"><a href="#DAG-1027"><span class="linenos">1027</span></a>                    <span class="n">args</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="nb">list</span><span class="p">[</span><span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">]],</span>
</span><span id="DAG-1028"><a href="#DAG-1028"><span class="linenos">1028</span></a>                    <span class="n">kwargs</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span>
</span><span id="DAG-1029"><a href="#DAG-1029"><span class="linenos">1029</span></a>                <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_futures</span><span class="o">.</span><span class="n">Future</span><span class="p">[</span><span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">]:</span>
</span><span id="DAG-1030"><a href="#DAG-1030"><span class="linenos">1030</span></a>                    <span class="k">if</span> <span class="n">skip</span><span class="p">[</span><span class="n">event</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
</span><span id="DAG-1031"><a href="#DAG-1031"><span class="linenos">1031</span></a>                        <span class="n">retry</span><span class="p">[</span><span class="n">event</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="DAG-1032"><a href="#DAG-1032"><span class="linenos">1032</span></a>                        <span class="n">skip_callable</span> <span class="o">=</span> <span class="n">raise_exc</span> <span class="k">if</span> <span class="n">skip</span><span class="p">[</span><span class="n">event</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="k">else</span> <span class="nb">print</span>
</span><span id="DAG-1033"><a href="#DAG-1033"><span class="linenos">1033</span></a>                        <span class="k">return</span> <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span>
</span><span id="DAG-1034"><a href="#DAG-1034"><span class="linenos">1034</span></a>                            <span class="n">_event_wrapper</span><span class="p">,</span>
</span><span id="DAG-1035"><a href="#DAG-1035"><span class="linenos">1035</span></a>                            <span class="n">_callable</span><span class="o">=</span><span class="n">skip_callable</span><span class="p">,</span>
</span><span id="DAG-1036"><a href="#DAG-1036"><span class="linenos">1036</span></a>                            <span class="n">_name</span><span class="o">=</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">event</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
</span><span id="DAG-1037"><a href="#DAG-1037"><span class="linenos">1037</span></a>                            <span class="n">_args</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Event </span><span class="si">{</span><span class="n">event</span><span class="si">}</span><span class="s2"> skipped...&quot;</span><span class="p">],</span>
</span><span id="DAG-1038"><a href="#DAG-1038"><span class="linenos">1038</span></a>                            <span class="n">_kwargs</span><span class="o">=</span><span class="p">{},</span>
</span><span id="DAG-1039"><a href="#DAG-1039"><span class="linenos">1039</span></a>                            <span class="n">_verbose</span><span class="o">=</span><span class="n">verbose</span>
</span><span id="DAG-1040"><a href="#DAG-1040"><span class="linenos">1040</span></a>                        <span class="p">)</span>
</span><span id="DAG-1041"><a href="#DAG-1041"><span class="linenos">1041</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="DAG-1042"><a href="#DAG-1042"><span class="linenos">1042</span></a>                        <span class="n">retry</span><span class="p">[</span><span class="n">event</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>
</span><span id="DAG-1043"><a href="#DAG-1043"><span class="linenos">1043</span></a>                        <span class="k">if</span> <span class="p">(</span><span class="n">retry</span><span class="p">[</span><span class="n">event</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">retry</span><span class="p">[</span><span class="n">event</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="p">{}):</span>
</span><span id="DAG-1044"><a href="#DAG-1044"><span class="linenos">1044</span></a>                            <span class="n">retry</span><span class="p">[</span><span class="n">event</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="DAG-1045"><a href="#DAG-1045"><span class="linenos">1045</span></a>                                <span class="s1">&#39;callable&#39;</span><span class="p">:</span> <span class="nb">callable</span><span class="p">,</span>
</span><span id="DAG-1046"><a href="#DAG-1046"><span class="linenos">1046</span></a>                                <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
</span><span id="DAG-1047"><a href="#DAG-1047"><span class="linenos">1047</span></a>                                <span class="s1">&#39;args&#39;</span><span class="p">:</span> <span class="n">args</span><span class="p">,</span>
</span><span id="DAG-1048"><a href="#DAG-1048"><span class="linenos">1048</span></a>                                <span class="s1">&#39;kwargs&#39;</span><span class="p">:</span> <span class="n">kwargs</span>
</span><span id="DAG-1049"><a href="#DAG-1049"><span class="linenos">1049</span></a>                            <span class="p">}</span>
</span><span id="DAG-1050"><a href="#DAG-1050"><span class="linenos">1050</span></a>                        <span class="k">return</span> <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span>
</span><span id="DAG-1051"><a href="#DAG-1051"><span class="linenos">1051</span></a>                            <span class="n">_event_wrapper</span><span class="p">,</span>
</span><span id="DAG-1052"><a href="#DAG-1052"><span class="linenos">1052</span></a>                            <span class="n">_callable</span><span class="o">=</span><span class="nb">callable</span><span class="p">,</span>
</span><span id="DAG-1053"><a href="#DAG-1053"><span class="linenos">1053</span></a>                            <span class="n">_name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span id="DAG-1054"><a href="#DAG-1054"><span class="linenos">1054</span></a>                            <span class="n">_args</span><span class="o">=</span><span class="n">args</span><span class="p">,</span>
</span><span id="DAG-1055"><a href="#DAG-1055"><span class="linenos">1055</span></a>                            <span class="n">_kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="DAG-1056"><a href="#DAG-1056"><span class="linenos">1056</span></a>                            <span class="n">_verbose</span><span class="o">=</span><span class="n">verbose</span>
</span><span id="DAG-1057"><a href="#DAG-1057"><span class="linenos">1057</span></a>                        <span class="p">)</span>
</span><span id="DAG-1058"><a href="#DAG-1058"><span class="linenos">1058</span></a>
</span><span id="DAG-1059"><a href="#DAG-1059"><span class="linenos">1059</span></a>                <span class="c1"># Submit root nodes</span>
</span><span id="DAG-1060"><a href="#DAG-1060"><span class="linenos">1060</span></a>                <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">roots</span><span class="p">:</span>
</span><span id="DAG-1061"><a href="#DAG-1061"><span class="linenos">1061</span></a>                    <span class="n">refs</span><span class="p">[</span><span class="n">event</span><span class="p">]</span> <span class="o">=</span> <span class="n">Submit</span><span class="p">(</span>
</span><span id="DAG-1062"><a href="#DAG-1062"><span class="linenos">1062</span></a>                        <span class="n">event</span><span class="p">,</span>
</span><span id="DAG-1063"><a href="#DAG-1063"><span class="linenos">1063</span></a>                        <span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">event</span><span class="p">][</span><span class="s1">&#39;callable&#39;</span><span class="p">],</span>
</span><span id="DAG-1064"><a href="#DAG-1064"><span class="linenos">1064</span></a>                        <span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">event</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
</span><span id="DAG-1065"><a href="#DAG-1065"><span class="linenos">1065</span></a>                        <span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">event</span><span class="p">][</span><span class="s1">&#39;args&#39;</span><span class="p">],</span>
</span><span id="DAG-1066"><a href="#DAG-1066"><span class="linenos">1066</span></a>                        <span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">event</span><span class="p">][</span><span class="s1">&#39;kwargs&#39;</span><span class="p">]</span>
</span><span id="DAG-1067"><a href="#DAG-1067"><span class="linenos">1067</span></a>                    <span class="p">)</span>
</span><span id="DAG-1068"><a href="#DAG-1068"><span class="linenos">1068</span></a>                    <span class="n">started</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
</span><span id="DAG-1069"><a href="#DAG-1069"><span class="linenos">1069</span></a>
</span><span id="DAG-1070"><a href="#DAG-1070"><span class="linenos">1070</span></a>                <span class="c1"># Process futures as they complete (no busy-wait)</span>
</span><span id="DAG-1071"><a href="#DAG-1071"><span class="linenos">1071</span></a>                <span class="n">pending</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">refs</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</span><span id="DAG-1072"><a href="#DAG-1072"><span class="linenos">1072</span></a>                <span class="n">future_to_event</span> <span class="o">=</span> <span class="p">{</span><span class="n">v</span><span class="p">:</span> <span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">refs</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
</span><span id="DAG-1073"><a href="#DAG-1073"><span class="linenos">1073</span></a>
</span><span id="DAG-1074"><a href="#DAG-1074"><span class="linenos">1074</span></a>                <span class="k">while</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">complete</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">failed</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">skipped</span><span class="p">))</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">graph</span><span class="p">):</span>
</span><span id="DAG-1075"><a href="#DAG-1075"><span class="linenos">1075</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="n">pending</span><span class="p">:</span>
</span><span id="DAG-1076"><a href="#DAG-1076"><span class="linenos">1076</span></a>                        <span class="k">break</span>
</span><span id="DAG-1077"><a href="#DAG-1077"><span class="linenos">1077</span></a>
</span><span id="DAG-1078"><a href="#DAG-1078"><span class="linenos">1078</span></a>                    <span class="c1"># Wait for at least one future to complete</span>
</span><span id="DAG-1079"><a href="#DAG-1079"><span class="linenos">1079</span></a>                    <span class="n">done</span><span class="p">,</span> <span class="n">pending</span> <span class="o">=</span> <span class="n">_futures</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="n">pending</span><span class="p">,</span> <span class="n">return_when</span><span class="o">=</span><span class="n">_futures</span><span class="o">.</span><span class="n">FIRST_COMPLETED</span><span class="p">)</span>
</span><span id="DAG-1080"><a href="#DAG-1080"><span class="linenos">1080</span></a>
</span><span id="DAG-1081"><a href="#DAG-1081"><span class="linenos">1081</span></a>                    <span class="k">for</span> <span class="n">future</span> <span class="ow">in</span> <span class="n">done</span><span class="p">:</span>
</span><span id="DAG-1082"><a href="#DAG-1082"><span class="linenos">1082</span></a>                        <span class="n">event</span> <span class="o">=</span> <span class="n">future_to_event</span><span class="p">[</span><span class="n">future</span><span class="p">]</span>
</span><span id="DAG-1083"><a href="#DAG-1083"><span class="linenos">1083</span></a>
</span><span id="DAG-1084"><a href="#DAG-1084"><span class="linenos">1084</span></a>                        <span class="k">if</span> <span class="n">future</span><span class="o">.</span><span class="n">exception</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DAG-1085"><a href="#DAG-1085"><span class="linenos">1085</span></a>                            <span class="k">try</span><span class="p">:</span>
</span><span id="DAG-1086"><a href="#DAG-1086"><span class="linenos">1086</span></a>                                <span class="k">raise</span> <span class="n">future</span><span class="o">.</span><span class="n">exception</span><span class="p">()</span>  <span class="c1"># type: ignore</span>
</span><span id="DAG-1087"><a href="#DAG-1087"><span class="linenos">1087</span></a>                            <span class="k">except</span><span class="p">:</span>
</span><span id="DAG-1088"><a href="#DAG-1088"><span class="linenos">1088</span></a>                                <span class="k">if</span> <span class="n">print_exc</span><span class="p">:</span>
</span><span id="DAG-1089"><a href="#DAG-1089"><span class="linenos">1089</span></a>                                    <span class="n">_traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
</span><span id="DAG-1090"><a href="#DAG-1090"><span class="linenos">1090</span></a>
</span><span id="DAG-1091"><a href="#DAG-1091"><span class="linenos">1091</span></a>                                <span class="k">if</span> <span class="n">retry</span><span class="p">[</span><span class="n">event</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="DAG-1092"><a href="#DAG-1092"><span class="linenos">1092</span></a>                                    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="DAG-1093"><a href="#DAG-1093"><span class="linenos">1093</span></a>                                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Event </span><span class="si">{</span><span class="n">event</span><span class="si">}</span><span class="s2"> exited with exception, retrying...&quot;</span><span class="p">)</span>
</span><span id="DAG-1094"><a href="#DAG-1094"><span class="linenos">1094</span></a>                                    <span class="n">new_future</span> <span class="o">=</span> <span class="n">Submit</span><span class="p">(</span>
</span><span id="DAG-1095"><a href="#DAG-1095"><span class="linenos">1095</span></a>                                        <span class="n">event</span><span class="p">,</span>
</span><span id="DAG-1096"><a href="#DAG-1096"><span class="linenos">1096</span></a>                                        <span class="nb">callable</span><span class="o">=</span><span class="n">retry</span><span class="p">[</span><span class="n">event</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;callable&#39;</span><span class="p">],</span>
</span><span id="DAG-1097"><a href="#DAG-1097"><span class="linenos">1097</span></a>                                        <span class="n">name</span><span class="o">=</span><span class="n">retry</span><span class="p">[</span><span class="n">event</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
</span><span id="DAG-1098"><a href="#DAG-1098"><span class="linenos">1098</span></a>                                        <span class="n">args</span><span class="o">=</span><span class="n">retry</span><span class="p">[</span><span class="n">event</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;args&#39;</span><span class="p">],</span>
</span><span id="DAG-1099"><a href="#DAG-1099"><span class="linenos">1099</span></a>                                        <span class="n">kwargs</span><span class="o">=</span><span class="n">retry</span><span class="p">[</span><span class="n">event</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;kwargs&#39;</span><span class="p">]</span>
</span><span id="DAG-1100"><a href="#DAG-1100"><span class="linenos">1100</span></a>                                    <span class="p">)</span>
</span><span id="DAG-1101"><a href="#DAG-1101"><span class="linenos">1101</span></a>                                    <span class="n">refs</span><span class="p">[</span><span class="n">event</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_future</span>
</span><span id="DAG-1102"><a href="#DAG-1102"><span class="linenos">1102</span></a>                                    <span class="n">pending</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">new_future</span><span class="p">)</span>
</span><span id="DAG-1103"><a href="#DAG-1103"><span class="linenos">1103</span></a>                                    <span class="n">future_to_event</span><span class="p">[</span><span class="n">new_future</span><span class="p">]</span> <span class="o">=</span> <span class="n">event</span>
</span><span id="DAG-1104"><a href="#DAG-1104"><span class="linenos">1104</span></a>                                    <span class="k">continue</span>
</span><span id="DAG-1105"><a href="#DAG-1105"><span class="linenos">1105</span></a>
</span><span id="DAG-1106"><a href="#DAG-1106"><span class="linenos">1106</span></a>                                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="DAG-1107"><a href="#DAG-1107"><span class="linenos">1107</span></a>                                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Event </span><span class="si">{</span><span class="n">event</span><span class="si">}</span><span class="s2"> exited with exception...&quot;</span><span class="p">)</span>
</span><span id="DAG-1108"><a href="#DAG-1108"><span class="linenos">1108</span></a>                                <span class="n">failed</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
</span><span id="DAG-1109"><a href="#DAG-1109"><span class="linenos">1109</span></a>                                <span class="n">skipping</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="DAG-1110"><a href="#DAG-1110"><span class="linenos">1110</span></a>                                    <span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">out_edges</span><span class="p">(</span><span class="n">event</span><span class="p">))</span>
</span><span id="DAG-1111"><a href="#DAG-1111"><span class="linenos">1111</span></a>                                    <span class="k">if</span> <span class="ow">not</span> <span class="n">_edges</span><span class="o">.</span><span class="n">continue_on_failure</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">e</span><span class="p">])</span>
</span><span id="DAG-1112"><a href="#DAG-1112"><span class="linenos">1112</span></a>                                <span class="p">]</span>
</span><span id="DAG-1113"><a href="#DAG-1113"><span class="linenos">1113</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="DAG-1114"><a href="#DAG-1114"><span class="linenos">1114</span></a>                            <span class="n">complete</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
</span><span id="DAG-1115"><a href="#DAG-1115"><span class="linenos">1115</span></a>                            <span class="n">skipping</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="DAG-1116"><a href="#DAG-1116"><span class="linenos">1116</span></a>                                <span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">out_edges</span><span class="p">(</span><span class="n">event</span><span class="p">))</span>
</span><span id="DAG-1117"><a href="#DAG-1117"><span class="linenos">1117</span></a>                                <span class="k">if</span> <span class="ow">not</span> <span class="n">_edges</span><span class="o">.</span><span class="n">continue_on_success</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">e</span><span class="p">])</span>
</span><span id="DAG-1118"><a href="#DAG-1118"><span class="linenos">1118</span></a>                            <span class="p">]</span>
</span><span id="DAG-1119"><a href="#DAG-1119"><span class="linenos">1119</span></a>
</span><span id="DAG-1120"><a href="#DAG-1120"><span class="linenos">1120</span></a>                        <span class="n">skipped</span> <span class="o">=</span> <span class="n">skipped</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">skipping</span><span class="p">)</span>
</span><span id="DAG-1121"><a href="#DAG-1121"><span class="linenos">1121</span></a>                        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">skipping</span><span class="p">:</span>
</span><span id="DAG-1122"><a href="#DAG-1122"><span class="linenos">1122</span></a>                            <span class="n">skipped</span> <span class="o">=</span> <span class="n">skipped</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">_nx</span><span class="o">.</span><span class="n">descendants</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
</span><span id="DAG-1123"><a href="#DAG-1123"><span class="linenos">1123</span></a>
</span><span id="DAG-1124"><a href="#DAG-1124"><span class="linenos">1124</span></a>                        <span class="n">carryon</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">successors</span><span class="p">(</span><span class="n">event</span><span class="p">))</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">skipped</span><span class="p">)</span>
</span><span id="DAG-1125"><a href="#DAG-1125"><span class="linenos">1125</span></a>                        <span class="n">starting</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="DAG-1126"><a href="#DAG-1126"><span class="linenos">1126</span></a>                            <span class="n">successor</span> <span class="k">for</span> <span class="n">successor</span> <span class="ow">in</span> <span class="n">carryon</span>
</span><span id="DAG-1127"><a href="#DAG-1127"><span class="linenos">1127</span></a>                            <span class="k">if</span> <span class="n">run_conditions_met</span><span class="p">(</span><span class="n">successor</span><span class="p">)</span>
</span><span id="DAG-1128"><a href="#DAG-1128"><span class="linenos">1128</span></a>                        <span class="p">]</span>
</span><span id="DAG-1129"><a href="#DAG-1129"><span class="linenos">1129</span></a>
</span><span id="DAG-1130"><a href="#DAG-1130"><span class="linenos">1130</span></a>                        <span class="k">for</span> <span class="n">successor</span> <span class="ow">in</span> <span class="n">starting</span><span class="p">:</span>
</span><span id="DAG-1131"><a href="#DAG-1131"><span class="linenos">1131</span></a>                            <span class="n">_args</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="DAG-1132"><a href="#DAG-1132"><span class="linenos">1132</span></a>                                <span class="n">a</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">_xcoms</span><span class="o">.</span><span class="n">Promise</span><span class="p">)</span> <span class="k">else</span> <span class="n">refs</span><span class="p">[</span><span class="n">_T</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">key</span><span class="p">)]</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
</span><span id="DAG-1133"><a href="#DAG-1133"><span class="linenos">1133</span></a>                                <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">successor</span><span class="p">][</span><span class="s1">&#39;args&#39;</span><span class="p">]</span>
</span><span id="DAG-1134"><a href="#DAG-1134"><span class="linenos">1134</span></a>                            <span class="p">]</span>
</span><span id="DAG-1135"><a href="#DAG-1135"><span class="linenos">1135</span></a>                            <span class="n">_kwargs</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="DAG-1136"><a href="#DAG-1136"><span class="linenos">1136</span></a>                                <span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">_xcoms</span><span class="o">.</span><span class="n">Promise</span><span class="p">)</span> <span class="k">else</span> <span class="n">refs</span><span class="p">[</span><span class="n">_T</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">key</span><span class="p">)]</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
</span><span id="DAG-1137"><a href="#DAG-1137"><span class="linenos">1137</span></a>                                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">successor</span><span class="p">][</span><span class="s1">&#39;kwargs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="DAG-1138"><a href="#DAG-1138"><span class="linenos">1138</span></a>                            <span class="p">}</span>
</span><span id="DAG-1139"><a href="#DAG-1139"><span class="linenos">1139</span></a>                            <span class="n">new_future</span> <span class="o">=</span> <span class="n">Submit</span><span class="p">(</span>
</span><span id="DAG-1140"><a href="#DAG-1140"><span class="linenos">1140</span></a>                                <span class="n">successor</span><span class="p">,</span>
</span><span id="DAG-1141"><a href="#DAG-1141"><span class="linenos">1141</span></a>                                <span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">successor</span><span class="p">][</span><span class="s1">&#39;callable&#39;</span><span class="p">],</span>
</span><span id="DAG-1142"><a href="#DAG-1142"><span class="linenos">1142</span></a>                                <span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">successor</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
</span><span id="DAG-1143"><a href="#DAG-1143"><span class="linenos">1143</span></a>                                <span class="n">_args</span><span class="p">,</span>
</span><span id="DAG-1144"><a href="#DAG-1144"><span class="linenos">1144</span></a>                                <span class="n">_kwargs</span>
</span><span id="DAG-1145"><a href="#DAG-1145"><span class="linenos">1145</span></a>                            <span class="p">)</span>
</span><span id="DAG-1146"><a href="#DAG-1146"><span class="linenos">1146</span></a>                            <span class="n">refs</span><span class="p">[</span><span class="n">successor</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_future</span>
</span><span id="DAG-1147"><a href="#DAG-1147"><span class="linenos">1147</span></a>                            <span class="n">pending</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">new_future</span><span class="p">)</span>
</span><span id="DAG-1148"><a href="#DAG-1148"><span class="linenos">1148</span></a>                            <span class="n">future_to_event</span><span class="p">[</span><span class="n">new_future</span><span class="p">]</span> <span class="o">=</span> <span class="n">successor</span>
</span><span id="DAG-1149"><a href="#DAG-1149"><span class="linenos">1149</span></a>                            <span class="n">started</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">successor</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Directed Acyclic Graph used to represent Pythonic tasks in parallel.</p>
</div>


                            <div id="DAG.__init__" class="classattr">
                                        <input id="DAG.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">DAG</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">graph</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">networkx</span><span class="o">.</span><span class="n">classes</span><span class="o">.</span><span class="n">digraph</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">,</span> <span class="n">networkx</span><span class="o">.</span><span class="n">classes</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">Graph</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span></span>)</span>

                <label class="view-source-button" for="DAG.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DAG.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DAG.__init__-917"><a href="#DAG.__init__-917"><span class="linenos">917</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">_nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">,</span> <span class="n">_nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DAG.__init__-918"><a href="#DAG.__init__-918"><span class="linenos">918</span></a>
</span><span id="DAG.__init__-919"><a href="#DAG.__init__-919"><span class="linenos">919</span></a>        <span class="k">if</span> <span class="n">graph</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DAG.__init__-920"><a href="#DAG.__init__-920"><span class="linenos">920</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="o">=</span> <span class="n">_nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">()</span>
</span><span id="DAG.__init__-921"><a href="#DAG.__init__-921"><span class="linenos">921</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_callable_to_id</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="DAG.__init__-922"><a href="#DAG.__init__-922"><span class="linenos">922</span></a>            <span class="k">return</span>
</span><span id="DAG.__init__-923"><a href="#DAG.__init__-923"><span class="linenos">923</span></a>
</span><span id="DAG.__init__-924"><a href="#DAG.__init__-924"><span class="linenos">924</span></a>        <span class="c1"># Meant for internal use only, creating DAGs from subgraphs.</span>
</span><span id="DAG.__init__-925"><a href="#DAG.__init__-925"><span class="linenos">925</span></a>        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;__force&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="DAG.__init__-926"><a href="#DAG.__init__-926"><span class="linenos">926</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="o">=</span> <span class="n">_T</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">_nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">,</span> <span class="n">graph</span><span class="p">)</span>
</span><span id="DAG.__init__-927"><a href="#DAG.__init__-927"><span class="linenos">927</span></a>            <span class="c1"># Build cache from existing subgraph</span>
</span><span id="DAG.__init__-928"><a href="#DAG.__init__-928"><span class="linenos">928</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_callable_to_id</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="DAG.__init__-929"><a href="#DAG.__init__-929"><span class="linenos">929</span></a>            <span class="k">for</span> <span class="n">node_id</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="DAG.__init__-930"><a href="#DAG.__init__-930"><span class="linenos">930</span></a>                <span class="n">callable_fn</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;callable&#39;</span><span class="p">)</span>
</span><span id="DAG.__init__-931"><a href="#DAG.__init__-931"><span class="linenos">931</span></a>                <span class="k">if</span> <span class="n">callable_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DAG.__init__-932"><a href="#DAG.__init__-932"><span class="linenos">932</span></a>                    <span class="k">if</span> <span class="n">callable_fn</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_callable_to_id</span><span class="p">:</span>
</span><span id="DAG.__init__-933"><a href="#DAG.__init__-933"><span class="linenos">933</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">_callable_to_id</span><span class="p">[</span><span class="n">callable_fn</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Duplicate</span>
</span><span id="DAG.__init__-934"><a href="#DAG.__init__-934"><span class="linenos">934</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="DAG.__init__-935"><a href="#DAG.__init__-935"><span class="linenos">935</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">_callable_to_id</span><span class="p">[</span><span class="n">callable_fn</span><span class="p">]</span> <span class="o">=</span> <span class="n">node_id</span>
</span><span id="DAG.__init__-936"><a href="#DAG.__init__-936"><span class="linenos">936</span></a>            <span class="k">return</span>
</span><span id="DAG.__init__-937"><a href="#DAG.__init__-937"><span class="linenos">937</span></a>
</span><span id="DAG.__init__-938"><a href="#DAG.__init__-938"><span class="linenos">938</span></a>        <span class="n">_edges</span><span class="o">.</span><span class="n">validate_dag</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
</span><span id="DAG.__init__-939"><a href="#DAG.__init__-939"><span class="linenos">939</span></a>        <span class="c1"># Type narrowing: validate_dag ensures graph is a DiGraph</span>
</span><span id="DAG.__init__-940"><a href="#DAG.__init__-940"><span class="linenos">940</span></a>        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">_nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">)</span>
</span><span id="DAG.__init__-941"><a href="#DAG.__init__-941"><span class="linenos">941</span></a>
</span><span id="DAG.__init__-942"><a href="#DAG.__init__-942"><span class="linenos">942</span></a>        <span class="c1"># Define framework specific logic as nested dictionaries.</span>
</span><span id="DAG.__init__-943"><a href="#DAG.__init__-943"><span class="linenos">943</span></a>        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="DAG.__init__-944"><a href="#DAG.__init__-944"><span class="linenos">944</span></a>            <span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s1">&#39;callable&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">node</span>
</span><span id="DAG.__init__-945"><a href="#DAG.__init__-945"><span class="linenos">945</span></a>            <span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="vm">__name__</span>
</span><span id="DAG.__init__-946"><a href="#DAG.__init__-946"><span class="linenos">946</span></a>            <span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s1">&#39;args&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="DAG.__init__-947"><a href="#DAG.__init__-947"><span class="linenos">947</span></a>            <span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s1">&#39;kwargs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="DAG.__init__-948"><a href="#DAG.__init__-948"><span class="linenos">948</span></a>
</span><span id="DAG.__init__-949"><a href="#DAG.__init__-949"><span class="linenos">949</span></a>        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">:</span>
</span><span id="DAG.__init__-950"><a href="#DAG.__init__-950"><span class="linenos">950</span></a>            <span class="n">condition</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">e</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Condition&#39;</span><span class="p">)</span>
</span><span id="DAG.__init__-951"><a href="#DAG.__init__-951"><span class="linenos">951</span></a>            <span class="k">if</span> <span class="n">condition</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DAG.__init__-952"><a href="#DAG.__init__-952"><span class="linenos">952</span></a>                <span class="k">if</span> <span class="n">condition</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">Condition</span><span class="p">:</span>
</span><span id="DAG.__init__-953"><a href="#DAG.__init__-953"><span class="linenos">953</span></a>                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="s1">&#39;Edge conditions must belong to IntEnum type Webber.Condition.&#39;</span><span class="p">)</span>
</span><span id="DAG.__init__-954"><a href="#DAG.__init__-954"><span class="linenos">954</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DAG.__init__-955"><a href="#DAG.__init__-955"><span class="linenos">955</span></a>                <span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;Condition&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Condition</span><span class="o">.</span><span class="n">Success</span>
</span><span id="DAG.__init__-956"><a href="#DAG.__init__-956"><span class="linenos">956</span></a>
</span><span id="DAG.__init__-957"><a href="#DAG.__init__-957"><span class="linenos">957</span></a>        <span class="n">graph</span> <span class="o">=</span> <span class="n">_nx</span><span class="o">.</span><span class="n">relabel_nodes</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">node</span><span class="p">:</span> <span class="n">_edges</span><span class="o">.</span><span class="n">label_node</span><span class="p">(</span><span class="n">node</span><span class="p">))</span>
</span><span id="DAG.__init__-958"><a href="#DAG.__init__-958"><span class="linenos">958</span></a>        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
</span><span id="DAG.__init__-959"><a href="#DAG.__init__-959"><span class="linenos">959</span></a>            <span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">n</span>
</span><span id="DAG.__init__-960"><a href="#DAG.__init__-960"><span class="linenos">960</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="o">=</span> <span class="n">_nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
</span><span id="DAG.__init__-961"><a href="#DAG.__init__-961"><span class="linenos">961</span></a>
</span><span id="DAG.__init__-962"><a href="#DAG.__init__-962"><span class="linenos">962</span></a>        <span class="c1"># Build callable-&gt;id cache after relabeling</span>
</span><span id="DAG.__init__-963"><a href="#DAG.__init__-963"><span class="linenos">963</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_callable_to_id</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="DAG.__init__-964"><a href="#DAG.__init__-964"><span class="linenos">964</span></a>        <span class="k">for</span> <span class="n">node_id</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="DAG.__init__-965"><a href="#DAG.__init__-965"><span class="linenos">965</span></a>            <span class="n">callable_fn</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;callable&#39;</span><span class="p">)</span>
</span><span id="DAG.__init__-966"><a href="#DAG.__init__-966"><span class="linenos">966</span></a>            <span class="k">if</span> <span class="n">callable_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DAG.__init__-967"><a href="#DAG.__init__-967"><span class="linenos">967</span></a>                <span class="k">if</span> <span class="n">callable_fn</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_callable_to_id</span><span class="p">:</span>
</span><span id="DAG.__init__-968"><a href="#DAG.__init__-968"><span class="linenos">968</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_callable_to_id</span><span class="p">[</span><span class="n">callable_fn</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Duplicate</span>
</span><span id="DAG.__init__-969"><a href="#DAG.__init__-969"><span class="linenos">969</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="DAG.__init__-970"><a href="#DAG.__init__-970"><span class="linenos">970</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_callable_to_id</span><span class="p">[</span><span class="n">callable_fn</span><span class="p">]</span> <span class="o">=</span> <span class="n">node_id</span>
</span></pre></div>


    

                            </div>
                            <div id="DAG.graph" class="classattr">
                                <div class="attr variable">
            <span class="name">graph</span><span class="annotation">: networkx.classes.digraph.DiGraph</span>

        
    </div>
    <a class="headerlink" href="#DAG.graph"></a>
    
    

                            </div>
                            <div id="DAG.add_node" class="classattr">
                                        <input id="DAG.add_node-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_node</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">node</span><span class="p">:</span> <span class="n">Any</span>, </span><span class="param"><span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="DAG.add_node-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DAG.add_node"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DAG.add_node-224"><a href="#DAG.add_node-224"><span class="linenos">224</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="DAG.add_node-225"><a href="#DAG.add_node-225"><span class="linenos">225</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DAG.add_node-226"><a href="#DAG.add_node-226"><span class="linenos">226</span></a><span class="sd">        Adds a callable with positional and keyword arguments to the DAG&#39;s underlying graph.</span>
</span><span id="DAG.add_node-227"><a href="#DAG.add_node-227"><span class="linenos">227</span></a><span class="sd">        On success, return unique identifier for the new node.</span>
</span><span id="DAG.add_node-228"><a href="#DAG.add_node-228"><span class="linenos">228</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DAG.add_node-229"><a href="#DAG.add_node-229"><span class="linenos">229</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">_iscallable</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
</span><span id="DAG.add_node-230"><a href="#DAG.add_node-230"><span class="linenos">230</span></a>            <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2">: requested node is not a callable Python function.&quot;</span>
</span><span id="DAG.add_node-231"><a href="#DAG.add_node-231"><span class="linenos">231</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="DAG.add_node-232"><a href="#DAG.add_node-232"><span class="linenos">232</span></a>
</span><span id="DAG.add_node-233"><a href="#DAG.add_node-233"><span class="linenos">233</span></a>        <span class="n">node_name</span> <span class="o">=</span> <span class="n">_edges</span><span class="o">.</span><span class="n">label_node</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
</span><span id="DAG.add_node-234"><a href="#DAG.add_node-234"><span class="linenos">234</span></a>
</span><span id="DAG.add_node-235"><a href="#DAG.add_node-235"><span class="linenos">235</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
</span><span id="DAG.add_node-236"><a href="#DAG.add_node-236"><span class="linenos">236</span></a>            <span class="n">arg</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">_xcoms</span><span class="o">.</span><span class="n">Promise</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolve_promise</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
</span><span id="DAG.add_node-237"><a href="#DAG.add_node-237"><span class="linenos">237</span></a>            <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span>
</span><span id="DAG.add_node-238"><a href="#DAG.add_node-238"><span class="linenos">238</span></a>        <span class="p">)</span>
</span><span id="DAG.add_node-239"><a href="#DAG.add_node-239"><span class="linenos">239</span></a>
</span><span id="DAG.add_node-240"><a href="#DAG.add_node-240"><span class="linenos">240</span></a>        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="DAG.add_node-241"><a href="#DAG.add_node-241"><span class="linenos">241</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">_xcoms</span><span class="o">.</span><span class="n">Promise</span><span class="p">):</span>
</span><span id="DAG.add_node-242"><a href="#DAG.add_node-242"><span class="linenos">242</span></a>                <span class="n">kwargs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolve_promise</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
</span><span id="DAG.add_node-243"><a href="#DAG.add_node-243"><span class="linenos">243</span></a>
</span><span id="DAG.add_node-244"><a href="#DAG.add_node-244"><span class="linenos">244</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span>
</span><span id="DAG.add_node-245"><a href="#DAG.add_node-245"><span class="linenos">245</span></a>            <span class="n">node_for_adding</span><span class="o">=</span><span class="n">node_name</span><span class="p">,</span>
</span><span id="DAG.add_node-246"><a href="#DAG.add_node-246"><span class="linenos">246</span></a>            <span class="nb">callable</span><span class="o">=</span><span class="n">node</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="DAG.add_node-247"><a href="#DAG.add_node-247"><span class="linenos">247</span></a>            <span class="n">name</span><span class="o">=</span><span class="n">node</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
</span><span id="DAG.add_node-248"><a href="#DAG.add_node-248"><span class="linenos">248</span></a>            <span class="nb">id</span><span class="o">=</span><span class="n">node_name</span>
</span><span id="DAG.add_node-249"><a href="#DAG.add_node-249"><span class="linenos">249</span></a>        <span class="p">)</span>
</span><span id="DAG.add_node-250"><a href="#DAG.add_node-250"><span class="linenos">250</span></a>
</span><span id="DAG.add_node-251"><a href="#DAG.add_node-251"><span class="linenos">251</span></a>        <span class="c1"># Populate callable-&gt;id cache for O(1) lookup</span>
</span><span id="DAG.add_node-252"><a href="#DAG.add_node-252"><span class="linenos">252</span></a>        <span class="c1"># If callable already exists, mark as None to indicate duplicates</span>
</span><span id="DAG.add_node-253"><a href="#DAG.add_node-253"><span class="linenos">253</span></a>        <span class="k">if</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_callable_to_id</span><span class="p">:</span>
</span><span id="DAG.add_node-254"><a href="#DAG.add_node-254"><span class="linenos">254</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_callable_to_id</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Multiple occurrences - must use string ID</span>
</span><span id="DAG.add_node-255"><a href="#DAG.add_node-255"><span class="linenos">255</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DAG.add_node-256"><a href="#DAG.add_node-256"><span class="linenos">256</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_callable_to_id</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">node_name</span>
</span><span id="DAG.add_node-257"><a href="#DAG.add_node-257"><span class="linenos">257</span></a>
</span><span id="DAG.add_node-258"><a href="#DAG.add_node-258"><span class="linenos">258</span></a>        <span class="k">return</span> <span class="n">node_name</span>
</span></pre></div>


            <div class="docstring"><p>Adds a callable with positional and keyword arguments to the DAG's underlying graph.
On success, return unique identifier for the new node.</p>
</div>


                            </div>
                            <div id="DAG.add_edge" class="classattr">
                                        <input id="DAG.add_edge-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_edge</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">u_of_edge</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Callable</span><span class="p">]</span>,</span><span class="param">	<span class="n">v_of_edge</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Callable</span><span class="p">]</span>,</span><span class="param">	<span class="n">continue_on</span><span class="p">:</span> <span class="n"><a href="#Condition">Condition</a></span> <span class="o">=</span> <span class="o">&lt;</span><span class="n"><a href="#Condition.Success">Condition.Success</a></span><span class="p">:</span> <span class="mi">0</span><span class="o">&gt;</span></span><span class="return-annotation">) -> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="DAG.add_edge-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DAG.add_edge"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DAG.add_edge-261"><a href="#DAG.add_edge-261"><span class="linenos">261</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_edge</span><span class="p">(</span>
</span><span id="DAG.add_edge-262"><a href="#DAG.add_edge-262"><span class="linenos">262</span></a>            <span class="bp">self</span><span class="p">,</span> 
</span><span id="DAG.add_edge-263"><a href="#DAG.add_edge-263"><span class="linenos">263</span></a>            <span class="n">u_of_edge</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_T</span><span class="o">.</span><span class="n">Callable</span><span class="p">],</span> <span class="n">v_of_edge</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_T</span><span class="o">.</span><span class="n">Callable</span><span class="p">],</span>
</span><span id="DAG.add_edge-264"><a href="#DAG.add_edge-264"><span class="linenos">264</span></a>            <span class="n">continue_on</span><span class="p">:</span> <span class="n">Condition</span> <span class="o">=</span> <span class="n">Condition</span><span class="o">.</span><span class="n">Success</span>
</span><span id="DAG.add_edge-265"><a href="#DAG.add_edge-265"><span class="linenos">265</span></a>        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_T</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="DAG.add_edge-266"><a href="#DAG.add_edge-266"><span class="linenos">266</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DAG.add_edge-267"><a href="#DAG.add_edge-267"><span class="linenos">267</span></a><span class="sd">        Adds an edge between nodes in the DAG&#39;s underlying graph,</span>
</span><span id="DAG.add_edge-268"><a href="#DAG.add_edge-268"><span class="linenos">268</span></a><span class="sd">        so long as the requested edge is unique and has not been added previously.</span>
</span><span id="DAG.add_edge-269"><a href="#DAG.add_edge-269"><span class="linenos">269</span></a>
</span><span id="DAG.add_edge-270"><a href="#DAG.add_edge-270"><span class="linenos">270</span></a><span class="sd">        On success, returns Tuple of the new edge&#39;s unique identifiers.</span>
</span><span id="DAG.add_edge-271"><a href="#DAG.add_edge-271"><span class="linenos">271</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DAG.add_edge-272"><a href="#DAG.add_edge-272"><span class="linenos">272</span></a>        <span class="c1"># Validate inputs prior to execution</span>
</span><span id="DAG.add_edge-273"><a href="#DAG.add_edge-273"><span class="linenos">273</span></a>        <span class="c1"># - Nodes must be identifiers or callables</span>
</span><span id="DAG.add_edge-274"><a href="#DAG.add_edge-274"><span class="linenos">274</span></a>        <span class="c1"># - Conditions must belong to the webber.edges.Condition class</span>
</span><span id="DAG.add_edge-275"><a href="#DAG.add_edge-275"><span class="linenos">275</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">u_of_edge</span><span class="p">,</span><span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="n">_iscallable</span><span class="p">(</span><span class="n">u_of_edge</span><span class="p">)):</span>
</span><span id="DAG.add_edge-276"><a href="#DAG.add_edge-276"><span class="linenos">276</span></a>            <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Outgoing node </span><span class="si">{</span><span class="n">u_of_edge</span><span class="si">}</span><span class="s2"> must be a string or a Python callable&quot;</span>
</span><span id="DAG.add_edge-277"><a href="#DAG.add_edge-277"><span class="linenos">277</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="DAG.add_edge-278"><a href="#DAG.add_edge-278"><span class="linenos">278</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">v_of_edge</span><span class="p">,</span><span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="n">_iscallable</span><span class="p">(</span><span class="n">v_of_edge</span><span class="p">)):</span>
</span><span id="DAG.add_edge-279"><a href="#DAG.add_edge-279"><span class="linenos">279</span></a>            <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Outgoing node </span><span class="si">{</span><span class="n">v_of_edge</span><span class="si">}</span><span class="s2"> must be a string or a Python callable&quot;</span>
</span><span id="DAG.add_edge-280"><a href="#DAG.add_edge-280"><span class="linenos">280</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="DAG.add_edge-281"><a href="#DAG.add_edge-281"><span class="linenos">281</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">continue_on</span><span class="p">,</span> <span class="n">Condition</span><span class="p">):</span>
</span><span id="DAG.add_edge-282"><a href="#DAG.add_edge-282"><span class="linenos">282</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Edge conditions must use the webber.edges.Condition class.&quot;</span><span class="p">)</span>
</span><span id="DAG.add_edge-283"><a href="#DAG.add_edge-283"><span class="linenos">283</span></a>
</span><span id="DAG.add_edge-284"><a href="#DAG.add_edge-284"><span class="linenos">284</span></a>        <span class="c1"># Base Case 0: No nodes are present in the DAG:</span>
</span><span id="DAG.add_edge-285"><a href="#DAG.add_edge-285"><span class="linenos">285</span></a>        <span class="c1"># Ensure that both nodes are callables, then add both to the graph and</span>
</span><span id="DAG.add_edge-286"><a href="#DAG.add_edge-286"><span class="linenos">286</span></a>        <span class="c1"># assign the outgoing node as a root.</span>
</span><span id="DAG.add_edge-287"><a href="#DAG.add_edge-287"><span class="linenos">287</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="DAG.add_edge-288"><a href="#DAG.add_edge-288"><span class="linenos">288</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">_iscallable</span><span class="p">(</span><span class="n">u_of_edge</span><span class="p">):</span>
</span><span id="DAG.add_edge-289"><a href="#DAG.add_edge-289"><span class="linenos">289</span></a>                <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Outgoing node </span><span class="si">{</span><span class="n">u_of_edge</span><span class="si">}</span><span class="s2"> is not defined in this DAG&#39;s scope.&quot;</span>
</span><span id="DAG.add_edge-290"><a href="#DAG.add_edge-290"><span class="linenos">290</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="DAG.add_edge-291"><a href="#DAG.add_edge-291"><span class="linenos">291</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">_iscallable</span><span class="p">(</span><span class="n">v_of_edge</span><span class="p">):</span>
</span><span id="DAG.add_edge-292"><a href="#DAG.add_edge-292"><span class="linenos">292</span></a>                <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Incoming node </span><span class="si">{</span><span class="n">v_of_edge</span><span class="si">}</span><span class="s2"> is not defined in this DAG&#39;s scope.&quot;</span>
</span><span id="DAG.add_edge-293"><a href="#DAG.add_edge-293"><span class="linenos">293</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="DAG.add_edge-294"><a href="#DAG.add_edge-294"><span class="linenos">294</span></a>            <span class="n">outgoing_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">u_of_edge</span><span class="p">)</span>
</span><span id="DAG.add_edge-295"><a href="#DAG.add_edge-295"><span class="linenos">295</span></a>            <span class="n">incoming_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">v_of_edge</span><span class="p">)</span>
</span><span id="DAG.add_edge-296"><a href="#DAG.add_edge-296"><span class="linenos">296</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">outgoing_node</span><span class="p">,</span> <span class="n">incoming_node</span><span class="p">,</span> <span class="n">Condition</span> <span class="o">=</span> <span class="n">continue_on</span><span class="p">)</span>
</span><span id="DAG.add_edge-297"><a href="#DAG.add_edge-297"><span class="linenos">297</span></a>            <span class="k">return</span> <span class="p">(</span><span class="n">outgoing_node</span><span class="p">,</span> <span class="n">incoming_node</span><span class="p">)</span>
</span><span id="DAG.add_edge-298"><a href="#DAG.add_edge-298"><span class="linenos">298</span></a>
</span><span id="DAG.add_edge-299"><a href="#DAG.add_edge-299"><span class="linenos">299</span></a>        <span class="n">new_callables</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="n">_T</span><span class="o">.</span><span class="n">Callable</span><span class="p">,</span> <span class="n">_T</span><span class="o">.</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="DAG.add_edge-300"><a href="#DAG.add_edge-300"><span class="linenos">300</span></a>
</span><span id="DAG.add_edge-301"><a href="#DAG.add_edge-301"><span class="linenos">301</span></a>        <span class="k">if</span> <span class="n">_iscallable</span><span class="p">(</span><span class="n">u_of_edge</span><span class="p">)</span> <span class="ow">and</span> <span class="n">_iscallable</span><span class="p">(</span><span class="n">v_of_edge</span><span class="p">):</span>
</span><span id="DAG.add_edge-302"><a href="#DAG.add_edge-302"><span class="linenos">302</span></a>            <span class="c1"># Type narrowing: we&#39;ve verified both are callables</span>
</span><span id="DAG.add_edge-303"><a href="#DAG.add_edge-303"><span class="linenos">303</span></a>            <span class="n">u_callable</span> <span class="o">=</span> <span class="n">_T</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">_T</span><span class="o">.</span><span class="n">Callable</span><span class="p">,</span> <span class="n">u_of_edge</span><span class="p">)</span>
</span><span id="DAG.add_edge-304"><a href="#DAG.add_edge-304"><span class="linenos">304</span></a>            <span class="n">v_callable</span> <span class="o">=</span> <span class="n">_T</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">_T</span><span class="o">.</span><span class="n">Callable</span><span class="p">,</span> <span class="n">v_of_edge</span><span class="p">)</span>
</span><span id="DAG.add_edge-305"><a href="#DAG.add_edge-305"><span class="linenos">305</span></a>
</span><span id="DAG.add_edge-306"><a href="#DAG.add_edge-306"><span class="linenos">306</span></a>            <span class="c1"># Error Cases 0, 1: Either of the callables appear more than once in the DAG.</span>
</span><span id="DAG.add_edge-307"><a href="#DAG.add_edge-307"><span class="linenos">307</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_callable_status</span><span class="p">(</span><span class="n">u_callable</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;many&#39;</span><span class="p">:</span>
</span><span id="DAG.add_edge-308"><a href="#DAG.add_edge-308"><span class="linenos">308</span></a>                <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Callable </span><span class="si">{</span><span class="n">u_callable</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> &quot;</span> \
</span><span id="DAG.add_edge-309"><a href="#DAG.add_edge-309"><span class="linenos">309</span></a>                        <span class="o">+</span> <span class="s2">&quot;exists more than once in this DAG. &quot;</span> \
</span><span id="DAG.add_edge-310"><a href="#DAG.add_edge-310"><span class="linenos">310</span></a>                        <span class="o">+</span> <span class="s2">&quot;Use the unique string identifier of the required node.&quot;</span>
</span><span id="DAG.add_edge-311"><a href="#DAG.add_edge-311"><span class="linenos">311</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="DAG.add_edge-312"><a href="#DAG.add_edge-312"><span class="linenos">312</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_callable_status</span><span class="p">(</span><span class="n">v_callable</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;many&#39;</span><span class="p">:</span>
</span><span id="DAG.add_edge-313"><a href="#DAG.add_edge-313"><span class="linenos">313</span></a>                <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Callable </span><span class="si">{</span><span class="n">v_callable</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> &quot;</span> \
</span><span id="DAG.add_edge-314"><a href="#DAG.add_edge-314"><span class="linenos">314</span></a>                        <span class="o">+</span> <span class="s2">&quot;exists more than once in this DAG. &quot;</span> \
</span><span id="DAG.add_edge-315"><a href="#DAG.add_edge-315"><span class="linenos">315</span></a>                        <span class="o">+</span> <span class="s2">&quot;Use the unique string identifier of the required node.&quot;</span>
</span><span id="DAG.add_edge-316"><a href="#DAG.add_edge-316"><span class="linenos">316</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="DAG.add_edge-317"><a href="#DAG.add_edge-317"><span class="linenos">317</span></a>
</span><span id="DAG.add_edge-318"><a href="#DAG.add_edge-318"><span class="linenos">318</span></a>            <span class="c1"># Base Case 1: Both args are callables and will be present in the DAG scope no more than once.</span>
</span><span id="DAG.add_edge-319"><a href="#DAG.add_edge-319"><span class="linenos">319</span></a>            <span class="c1"># We will create new nodes if necessary, after validation, and get the unique string identifiers of the nodes.</span>
</span><span id="DAG.add_edge-320"><a href="#DAG.add_edge-320"><span class="linenos">320</span></a>            <span class="n">cached_u</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_callable_to_id</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">u_callable</span><span class="p">)</span>
</span><span id="DAG.add_edge-321"><a href="#DAG.add_edge-321"><span class="linenos">321</span></a>            <span class="k">if</span> <span class="n">cached_u</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DAG.add_edge-322"><a href="#DAG.add_edge-322"><span class="linenos">322</span></a>                <span class="n">outgoing_node</span> <span class="o">=</span> <span class="n">cached_u</span>
</span><span id="DAG.add_edge-323"><a href="#DAG.add_edge-323"><span class="linenos">323</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DAG.add_edge-324"><a href="#DAG.add_edge-324"><span class="linenos">324</span></a>                <span class="n">new_callables</span><span class="p">[</span><span class="n">u_callable</span><span class="p">]</span> <span class="o">=</span> <span class="n">u_callable</span>
</span><span id="DAG.add_edge-325"><a href="#DAG.add_edge-325"><span class="linenos">325</span></a>                <span class="n">outgoing_node</span> <span class="o">=</span> <span class="n">_edges</span><span class="o">.</span><span class="n">label_node</span><span class="p">(</span><span class="n">u_callable</span><span class="p">)</span>
</span><span id="DAG.add_edge-326"><a href="#DAG.add_edge-326"><span class="linenos">326</span></a>
</span><span id="DAG.add_edge-327"><a href="#DAG.add_edge-327"><span class="linenos">327</span></a>            <span class="n">cached_v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_callable_to_id</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">v_callable</span><span class="p">)</span>
</span><span id="DAG.add_edge-328"><a href="#DAG.add_edge-328"><span class="linenos">328</span></a>            <span class="k">if</span> <span class="n">cached_v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DAG.add_edge-329"><a href="#DAG.add_edge-329"><span class="linenos">329</span></a>                <span class="n">incoming_node</span> <span class="o">=</span> <span class="n">cached_v</span>
</span><span id="DAG.add_edge-330"><a href="#DAG.add_edge-330"><span class="linenos">330</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DAG.add_edge-331"><a href="#DAG.add_edge-331"><span class="linenos">331</span></a>                <span class="n">new_callables</span><span class="p">[</span><span class="n">v_callable</span><span class="p">]</span> <span class="o">=</span> <span class="n">v_callable</span>
</span><span id="DAG.add_edge-332"><a href="#DAG.add_edge-332"><span class="linenos">332</span></a>                <span class="n">incoming_node</span> <span class="o">=</span> <span class="n">_edges</span><span class="o">.</span><span class="n">label_node</span><span class="p">(</span><span class="n">v_callable</span><span class="p">)</span>
</span><span id="DAG.add_edge-333"><a href="#DAG.add_edge-333"><span class="linenos">333</span></a>
</span><span id="DAG.add_edge-334"><a href="#DAG.add_edge-334"><span class="linenos">334</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DAG.add_edge-335"><a href="#DAG.add_edge-335"><span class="linenos">335</span></a>
</span><span id="DAG.add_edge-336"><a href="#DAG.add_edge-336"><span class="linenos">336</span></a>            <span class="c1"># Error Cases 2, 3: Either of the requested IDs are not in the DAG&#39;s current scope.</span>
</span><span id="DAG.add_edge-337"><a href="#DAG.add_edge-337"><span class="linenos">337</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">u_of_edge</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">u_of_edge</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
</span><span id="DAG.add_edge-338"><a href="#DAG.add_edge-338"><span class="linenos">338</span></a>                <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Outgoing node </span><span class="si">{</span><span class="n">u_of_edge</span><span class="si">}</span><span class="s2"> not in DAG&#39;s current scope.&quot;</span>
</span><span id="DAG.add_edge-339"><a href="#DAG.add_edge-339"><span class="linenos">339</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="DAG.add_edge-340"><a href="#DAG.add_edge-340"><span class="linenos">340</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v_of_edge</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">v_of_edge</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
</span><span id="DAG.add_edge-341"><a href="#DAG.add_edge-341"><span class="linenos">341</span></a>                <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Incoming node </span><span class="si">{</span><span class="n">v_of_edge</span><span class="si">}</span><span class="s2"> not in DAG&#39;s current scope.&quot;</span>
</span><span id="DAG.add_edge-342"><a href="#DAG.add_edge-342"><span class="linenos">342</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="DAG.add_edge-343"><a href="#DAG.add_edge-343"><span class="linenos">343</span></a>
</span><span id="DAG.add_edge-344"><a href="#DAG.add_edge-344"><span class="linenos">344</span></a>            <span class="c1"># Both nodes&#39; unique identifiers are present in the DAG</span>
</span><span id="DAG.add_edge-345"><a href="#DAG.add_edge-345"><span class="linenos">345</span></a>            <span class="c1"># and should be evaluated for a valid edge.</span>
</span><span id="DAG.add_edge-346"><a href="#DAG.add_edge-346"><span class="linenos">346</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">u_of_edge</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v_of_edge</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="DAG.add_edge-347"><a href="#DAG.add_edge-347"><span class="linenos">347</span></a>                <span class="n">outgoing_node</span> <span class="o">=</span> <span class="n">u_of_edge</span>
</span><span id="DAG.add_edge-348"><a href="#DAG.add_edge-348"><span class="linenos">348</span></a>                <span class="n">incoming_node</span> <span class="o">=</span> <span class="n">v_of_edge</span>
</span><span id="DAG.add_edge-349"><a href="#DAG.add_edge-349"><span class="linenos">349</span></a>
</span><span id="DAG.add_edge-350"><a href="#DAG.add_edge-350"><span class="linenos">350</span></a>            <span class="c1"># Otherwise, one of the nodes is a callable, and the other is a valid unique identifier.</span>
</span><span id="DAG.add_edge-351"><a href="#DAG.add_edge-351"><span class="linenos">351</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DAG.add_edge-352"><a href="#DAG.add_edge-352"><span class="linenos">352</span></a>                <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="p">(</span><span class="n">u_of_edge</span><span class="p">,</span> <span class="n">v_of_edge</span><span class="p">):</span>
</span><span id="DAG.add_edge-353"><a href="#DAG.add_edge-353"><span class="linenos">353</span></a>                    <span class="k">if</span> <span class="n">node</span> <span class="o">==</span> <span class="n">u_of_edge</span><span class="p">:</span>
</span><span id="DAG.add_edge-354"><a href="#DAG.add_edge-354"><span class="linenos">354</span></a>                        <span class="n">outgoing_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_assign_node</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">new_callables</span><span class="p">)</span>
</span><span id="DAG.add_edge-355"><a href="#DAG.add_edge-355"><span class="linenos">355</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="DAG.add_edge-356"><a href="#DAG.add_edge-356"><span class="linenos">356</span></a>                        <span class="n">incoming_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_assign_node</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">new_callables</span><span class="p">)</span>
</span><span id="DAG.add_edge-357"><a href="#DAG.add_edge-357"><span class="linenos">357</span></a>
</span><span id="DAG.add_edge-358"><a href="#DAG.add_edge-358"><span class="linenos">358</span></a>        <span class="c1"># Error Case 5: Both callables exist only once in the DAG,</span>
</span><span id="DAG.add_edge-359"><a href="#DAG.add_edge-359"><span class="linenos">359</span></a>        <span class="c1"># but an edge already exists between them. O(1) lookup with has_edge().</span>
</span><span id="DAG.add_edge-360"><a href="#DAG.add_edge-360"><span class="linenos">360</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">has_edge</span><span class="p">(</span><span class="n">outgoing_node</span><span class="p">,</span> <span class="n">incoming_node</span><span class="p">):</span>
</span><span id="DAG.add_edge-361"><a href="#DAG.add_edge-361"><span class="linenos">361</span></a>            <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Requested edge (</span><span class="si">{</span><span class="n">outgoing_node</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">incoming_node</span><span class="si">}</span><span class="s2">) already has &quot;</span> \
</span><span id="DAG.add_edge-362"><a href="#DAG.add_edge-362"><span class="linenos">362</span></a>                    <span class="o">+</span> <span class="s2">&quot;a definition in this DAG.&quot;</span>
</span><span id="DAG.add_edge-363"><a href="#DAG.add_edge-363"><span class="linenos">363</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="DAG.add_edge-364"><a href="#DAG.add_edge-364"><span class="linenos">364</span></a>
</span><span id="DAG.add_edge-365"><a href="#DAG.add_edge-365"><span class="linenos">365</span></a>        <span class="c1"># Error Case 6: Adding an edge would create circular dependencies.</span>
</span><span id="DAG.add_edge-366"><a href="#DAG.add_edge-366"><span class="linenos">366</span></a>        <span class="c1"># Use has_path() for O(V+E) incremental check instead of rebuilding entire graph.</span>
</span><span id="DAG.add_edge-367"><a href="#DAG.add_edge-367"><span class="linenos">367</span></a>        <span class="k">if</span> <span class="n">incoming_node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="ow">and</span> <span class="n">_nx</span><span class="o">.</span><span class="n">has_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="p">,</span> <span class="n">incoming_node</span><span class="p">,</span> <span class="n">outgoing_node</span><span class="p">):</span>
</span><span id="DAG.add_edge-368"><a href="#DAG.add_edge-368"><span class="linenos">368</span></a>            <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Requested edge (</span><span class="si">{</span><span class="n">outgoing_node</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">incoming_node</span><span class="si">}</span><span class="s2">) &quot;</span> \
</span><span id="DAG.add_edge-369"><a href="#DAG.add_edge-369"><span class="linenos">369</span></a>                    <span class="o">+</span> <span class="s2">&quot;results in circular dependencies.&quot;</span>
</span><span id="DAG.add_edge-370"><a href="#DAG.add_edge-370"><span class="linenos">370</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="DAG.add_edge-371"><a href="#DAG.add_edge-371"><span class="linenos">371</span></a>
</span><span id="DAG.add_edge-372"><a href="#DAG.add_edge-372"><span class="linenos">372</span></a>        <span class="c1"># We can now add the edge to the DAG, since we are certain it will not result in</span>
</span><span id="DAG.add_edge-373"><a href="#DAG.add_edge-373"><span class="linenos">373</span></a>        <span class="c1"># illegal dependencies/behavior.</span>
</span><span id="DAG.add_edge-374"><a href="#DAG.add_edge-374"><span class="linenos">374</span></a>        <span class="c1"># First, we should account for potential new nodes. This also handles</span>
</span><span id="DAG.add_edge-375"><a href="#DAG.add_edge-375"><span class="linenos">375</span></a>        <span class="c1"># duplicates on first entry to the DAG (e.g.: edge == (print, print))</span>
</span><span id="DAG.add_edge-376"><a href="#DAG.add_edge-376"><span class="linenos">376</span></a>        <span class="k">if</span> <span class="n">_iscallable</span><span class="p">(</span><span class="n">u_of_edge</span><span class="p">)</span> <span class="ow">and</span> <span class="n">new_callables</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">_T</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">_T</span><span class="o">.</span><span class="n">Callable</span><span class="p">,</span> <span class="n">u_of_edge</span><span class="p">))</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DAG.add_edge-377"><a href="#DAG.add_edge-377"><span class="linenos">377</span></a>            <span class="n">outgoing_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">new_callables</span><span class="p">[</span><span class="n">_T</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">_T</span><span class="o">.</span><span class="n">Callable</span><span class="p">,</span> <span class="n">u_of_edge</span><span class="p">)])</span>
</span><span id="DAG.add_edge-378"><a href="#DAG.add_edge-378"><span class="linenos">378</span></a>        <span class="k">if</span> <span class="n">_iscallable</span><span class="p">(</span><span class="n">v_of_edge</span><span class="p">)</span> <span class="ow">and</span> <span class="n">new_callables</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">_T</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">_T</span><span class="o">.</span><span class="n">Callable</span><span class="p">,</span> <span class="n">v_of_edge</span><span class="p">))</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DAG.add_edge-379"><a href="#DAG.add_edge-379"><span class="linenos">379</span></a>            <span class="n">incoming_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">new_callables</span><span class="p">[</span><span class="n">_T</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">_T</span><span class="o">.</span><span class="n">Callable</span><span class="p">,</span> <span class="n">v_of_edge</span><span class="p">)])</span>
</span><span id="DAG.add_edge-380"><a href="#DAG.add_edge-380"><span class="linenos">380</span></a>
</span><span id="DAG.add_edge-381"><a href="#DAG.add_edge-381"><span class="linenos">381</span></a>        <span class="c1"># Then we can add the new edge.</span>
</span><span id="DAG.add_edge-382"><a href="#DAG.add_edge-382"><span class="linenos">382</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">outgoing_node</span><span class="p">,</span> <span class="n">incoming_node</span><span class="p">,</span> <span class="n">Condition</span> <span class="o">=</span> <span class="n">continue_on</span><span class="p">)</span>
</span><span id="DAG.add_edge-383"><a href="#DAG.add_edge-383"><span class="linenos">383</span></a>        <span class="k">return</span> <span class="p">(</span><span class="n">outgoing_node</span><span class="p">,</span> <span class="n">incoming_node</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Adds an edge between nodes in the DAG's underlying graph,
so long as the requested edge is unique and has not been added previously.</p>

<p>On success, returns Tuple of the new edge's unique identifiers.</p>
</div>


                            </div>
                            <div id="DAG.remove_node" class="classattr">
                                        <input id="DAG.remove_node-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">remove_node</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="o">*</span><span class="n">posargs</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="DAG.remove_node-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DAG.remove_node"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DAG.remove_node-385"><a href="#DAG.remove_node-385"><span class="linenos">385</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">remove_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">posargs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DAG.remove_node-386"><a href="#DAG.remove_node-386"><span class="linenos">386</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DAG.remove_node-387"><a href="#DAG.remove_node-387"><span class="linenos">387</span></a><span class="sd">        Currently out-of-scope. Node-removal can lead to unexpected behavior in a DAG.</span>
</span><span id="DAG.remove_node-388"><a href="#DAG.remove_node-388"><span class="linenos">388</span></a><span class="sd">        Throws error message and recommends safer methods.</span>
</span><span id="DAG.remove_node-389"><a href="#DAG.remove_node-389"><span class="linenos">389</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DAG.remove_node-390"><a href="#DAG.remove_node-390"><span class="linenos">390</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Node removals can lead to unexpected behavior in a DAG without special care. Please consider using the skip_node operation or define a new DAG to achieve the same effect.&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Currently out-of-scope. Node-removal can lead to unexpected behavior in a DAG.
Throws error message and recommends safer methods.</p>
</div>


                            </div>
                            <div id="DAG.remove_edge" class="classattr">
                                        <input id="DAG.remove_edge-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">remove_edge</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">u_of_edge</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Callable</span><span class="p">]</span>,</span><span class="param">	<span class="n">v_of_edge</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Callable</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="DAG.remove_edge-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DAG.remove_edge"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DAG.remove_edge-392"><a href="#DAG.remove_edge-392"><span class="linenos">392</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">remove_edge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">u_of_edge</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span><span class="n">_T</span><span class="o">.</span><span class="n">Callable</span><span class="p">],</span> <span class="n">v_of_edge</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span><span class="n">_T</span><span class="o">.</span><span class="n">Callable</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">_T</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="DAG.remove_edge-393"><a href="#DAG.remove_edge-393"><span class="linenos">393</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DAG.remove_edge-394"><a href="#DAG.remove_edge-394"><span class="linenos">394</span></a><span class="sd">        Removes an directed edge between nodes in the DAG&#39;s underlying graph.</span>
</span><span id="DAG.remove_edge-395"><a href="#DAG.remove_edge-395"><span class="linenos">395</span></a><span class="sd">        Throws error if the edge does not exist.</span>
</span><span id="DAG.remove_edge-396"><a href="#DAG.remove_edge-396"><span class="linenos">396</span></a><span class="sd">        On success, returns Tuple of the removed edge&#39;s unique identifiers.</span>
</span><span id="DAG.remove_edge-397"><a href="#DAG.remove_edge-397"><span class="linenos">397</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DAG.remove_edge-398"><a href="#DAG.remove_edge-398"><span class="linenos">398</span></a>        <span class="n">edge_id</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node_id</span><span class="p">(</span><span class="n">u_of_edge</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_id</span><span class="p">(</span><span class="n">v_of_edge</span><span class="p">))</span>
</span><span id="DAG.remove_edge-399"><a href="#DAG.remove_edge-399"><span class="linenos">399</span></a>        <span class="k">if</span> <span class="n">edge_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="DAG.remove_edge-400"><a href="#DAG.remove_edge-400"><span class="linenos">400</span></a>            <span class="n">err_msg</span> <span class="o">=</span> <span class="s2">&quot;Requested edge does not exist in the DAG&#39;s scope&quot;</span>
</span><span id="DAG.remove_edge-401"><a href="#DAG.remove_edge-401"><span class="linenos">401</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="DAG.remove_edge-402"><a href="#DAG.remove_edge-402"><span class="linenos">402</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">remove_edge</span><span class="p">(</span><span class="n">edge_id</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">edge_id</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="DAG.remove_edge-403"><a href="#DAG.remove_edge-403"><span class="linenos">403</span></a>        <span class="k">return</span> <span class="n">edge_id</span>
</span></pre></div>


            <div class="docstring"><p>Removes an directed edge between nodes in the DAG's underlying graph.
Throws error if the edge does not exist.
On success, returns Tuple of the removed edge's unique identifiers.</p>
</div>


                            </div>
                            <div id="DAG.update_edges" class="classattr">
                                        <input id="DAG.update_edges-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">update_edges</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="o">*</span><span class="n">E</span><span class="p">:</span> <span class="n">Any</span>,</span><span class="param">	<span class="n">continue_on</span><span class="p">:</span> <span class="n"><a href="#Condition">Condition</a></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="nb">filter</span><span class="p">:</span> <span class="n">function</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">webber</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">edgedict</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="DAG.update_edges-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DAG.update_edges"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DAG.update_edges-405"><a href="#DAG.update_edges-405"><span class="linenos">405</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">update_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">E</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">,</span> <span class="n">continue_on</span><span class="p">:</span> <span class="n">Condition</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">filter</span><span class="p">:</span> <span class="n">_types</span><span class="o">.</span><span class="n">LambdaType</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="n">edgedict</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DAG.update_edges-406"><a href="#DAG.update_edges-406"><span class="linenos">406</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DAG.update_edges-407"><a href="#DAG.update_edges-407"><span class="linenos">407</span></a><span class="sd">        Flexible function to update properties of edges in the DAG&#39;s scope, </span>
</span><span id="DAG.update_edges-408"><a href="#DAG.update_edges-408"><span class="linenos">408</span></a><span class="sd">        based on unique identifier(s) (e.g.: string IDs or unique callables) or a</span>
</span><span id="DAG.update_edges-409"><a href="#DAG.update_edges-409"><span class="linenos">409</span></a><span class="sd">        lambda filter using the edgedict syntax.</span>
</span><span id="DAG.update_edges-410"><a href="#DAG.update_edges-410"><span class="linenos">410</span></a><span class="sd">        </span>
</span><span id="DAG.update_edges-411"><a href="#DAG.update_edges-411"><span class="linenos">411</span></a><span class="sd">        List of nodes to update or filter argument is expected. Valid edge lists include:</span>
</span><span id="DAG.update_edges-412"><a href="#DAG.update_edges-412"><span class="linenos">412</span></a>
</span><span id="DAG.update_edges-413"><a href="#DAG.update_edges-413"><span class="linenos">413</span></a><span class="sd">        \t update_edges((node1, node2), ...)       or update_edges([(node1, node2)], ...)</span>
</span><span id="DAG.update_edges-414"><a href="#DAG.update_edges-414"><span class="linenos">414</span></a>
</span><span id="DAG.update_edges-415"><a href="#DAG.update_edges-415"><span class="linenos">415</span></a><span class="sd">        \t update_edges((node1, callable2), ...)   or update_edges([(node1, callable2)], ...)</span>
</span><span id="DAG.update_edges-416"><a href="#DAG.update_edges-416"><span class="linenos">416</span></a><span class="sd">        </span>
</span><span id="DAG.update_edges-417"><a href="#DAG.update_edges-417"><span class="linenos">417</span></a><span class="sd">        \t update_edges(edgedict),                 where isinstance(edgedict, webber.edges.edgedict) == True</span>
</span><span id="DAG.update_edges-418"><a href="#DAG.update_edges-418"><span class="linenos">418</span></a>
</span><span id="DAG.update_edges-419"><a href="#DAG.update_edges-419"><span class="linenos">419</span></a><span class="sd">        Parameters:</span>
</span><span id="DAG.update_edges-420"><a href="#DAG.update_edges-420"><span class="linenos">420</span></a>
</span><span id="DAG.update_edges-421"><a href="#DAG.update_edges-421"><span class="linenos">421</span></a><span class="sd">        &gt; continue_on: webber.edges.Condition value to update matching edges with, </span>
</span><span id="DAG.update_edges-422"><a href="#DAG.update_edges-422"><span class="linenos">422</span></a><span class="sd">        </span>
</span><span id="DAG.update_edges-423"><a href="#DAG.update_edges-423"><span class="linenos">423</span></a><span class="sd">        \t Execute child on success, failure, or any exit state, of the parent node</span>
</span><span id="DAG.update_edges-424"><a href="#DAG.update_edges-424"><span class="linenos">424</span></a>
</span><span id="DAG.update_edges-425"><a href="#DAG.update_edges-425"><span class="linenos">425</span></a><span class="sd">        &gt; filter: lambda property that can be used instead of a list of edges to be updated.</span>
</span><span id="DAG.update_edges-426"><a href="#DAG.update_edges-426"><span class="linenos">426</span></a><span class="sd">        </span>
</span><span id="DAG.update_edges-427"><a href="#DAG.update_edges-427"><span class="linenos">427</span></a><span class="sd">        \t filter = (lambda e: n.parent == print or e.child == print)</span>
</span><span id="DAG.update_edges-428"><a href="#DAG.update_edges-428"><span class="linenos">428</span></a>
</span><span id="DAG.update_edges-429"><a href="#DAG.update_edges-429"><span class="linenos">429</span></a><span class="sd">        &gt; data: If given, expects a dictionary or edgedict to update edge properties. Currently, only continue_on property should be set.</span>
</span><span id="DAG.update_edges-430"><a href="#DAG.update_edges-430"><span class="linenos">430</span></a>
</span><span id="DAG.update_edges-431"><a href="#DAG.update_edges-431"><span class="linenos">431</span></a><span class="sd">        \t data = { &#39;continue_on&#39;: webber.edges.Condition }</span>
</span><span id="DAG.update_edges-432"><a href="#DAG.update_edges-432"><span class="linenos">432</span></a>
</span><span id="DAG.update_edges-433"><a href="#DAG.update_edges-433"><span class="linenos">433</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DAG.update_edges-434"><a href="#DAG.update_edges-434"><span class="linenos">434</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">E</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">filter</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DAG.update_edges-435"><a href="#DAG.update_edges-435"><span class="linenos">435</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Either an array of edge IDs / edgedicts (E) or a filter must be passed to this function.&quot;</span><span class="p">)</span>
</span><span id="DAG.update_edges-436"><a href="#DAG.update_edges-436"><span class="linenos">436</span></a>
</span><span id="DAG.update_edges-437"><a href="#DAG.update_edges-437"><span class="linenos">437</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="n">edgedict</span><span class="p">):</span>
</span><span id="DAG.update_edges-438"><a href="#DAG.update_edges-438"><span class="linenos">438</span></a>            <span class="n">E</span> <span class="o">=</span> <span class="p">[</span><span class="n">E</span><span class="p">]</span>
</span><span id="DAG.update_edges-439"><a href="#DAG.update_edges-439"><span class="linenos">439</span></a>
</span><span id="DAG.update_edges-440"><a href="#DAG.update_edges-440"><span class="linenos">440</span></a>        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">E</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">E</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">_abc</span><span class="o">.</span><span class="n">Iterable</span><span class="p">):</span>
</span><span id="DAG.update_edges-441"><a href="#DAG.update_edges-441"><span class="linenos">441</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="DAG.update_edges-442"><a href="#DAG.update_edges-442"><span class="linenos">442</span></a>                <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_edges</span><span class="p">(</span><span class="n">E</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="DAG.update_edges-443"><a href="#DAG.update_edges-443"><span class="linenos">443</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="DAG.update_edges-444"><a href="#DAG.update_edges-444"><span class="linenos">444</span></a>                <span class="n">E</span> <span class="o">=</span> <span class="n">E</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="DAG.update_edges-445"><a href="#DAG.update_edges-445"><span class="linenos">445</span></a>
</span><span id="DAG.update_edges-446"><a href="#DAG.update_edges-446"><span class="linenos">446</span></a>        <span class="k">if</span> <span class="nb">filter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DAG.update_edges-447"><a href="#DAG.update_edges-447"><span class="linenos">447</span></a>            <span class="n">edge_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_edges</span><span class="p">(</span><span class="nb">filter</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="DAG.update_edges-448"><a href="#DAG.update_edges-448"><span class="linenos">448</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DAG.update_edges-449"><a href="#DAG.update_edges-449"><span class="linenos">449</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">E</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">E</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">edgedict</span><span class="p">):</span>
</span><span id="DAG.update_edges-450"><a href="#DAG.update_edges-450"><span class="linenos">450</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="DAG.update_edges-451"><a href="#DAG.update_edges-451"><span class="linenos">451</span></a>                    <span class="n">ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">E</span><span class="p">]</span>
</span><span id="DAG.update_edges-452"><a href="#DAG.update_edges-452"><span class="linenos">452</span></a>                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span><span id="DAG.update_edges-453"><a href="#DAG.update_edges-453"><span class="linenos">453</span></a>                    <span class="n">err_msg</span> <span class="o">=</span> <span class="s1">&#39;In dictionary form, all given edges must be follow edgedict standards.&#39;</span>
</span><span id="DAG.update_edges-454"><a href="#DAG.update_edges-454"><span class="linenos">454</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="DAG.update_edges-455"><a href="#DAG.update_edges-455"><span class="linenos">455</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DAG.update_edges-456"><a href="#DAG.update_edges-456"><span class="linenos">456</span></a>                <span class="n">ids</span> <span class="o">=</span> <span class="n">E</span>
</span><span id="DAG.update_edges-457"><a href="#DAG.update_edges-457"><span class="linenos">457</span></a>            <span class="n">edge_ids</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_edge</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">data</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ids</span><span class="p">]</span>
</span><span id="DAG.update_edges-458"><a href="#DAG.update_edges-458"><span class="linenos">458</span></a>
</span><span id="DAG.update_edges-459"><a href="#DAG.update_edges-459"><span class="linenos">459</span></a>        <span class="n">std_update</span> <span class="o">=</span> <span class="p">(</span><span class="n">continue_on</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="DAG.update_edges-460"><a href="#DAG.update_edges-460"><span class="linenos">460</span></a>
</span><span id="DAG.update_edges-461"><a href="#DAG.update_edges-461"><span class="linenos">461</span></a>        <span class="k">if</span> <span class="n">std_update</span><span class="p">:</span>
</span><span id="DAG.update_edges-462"><a href="#DAG.update_edges-462"><span class="linenos">462</span></a>            <span class="k">for</span> <span class="n">edge_id</span><span class="p">,</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">edge_ids</span><span class="p">,</span> <span class="n">E</span><span class="p">):</span>
</span><span id="DAG.update_edges-463"><a href="#DAG.update_edges-463"><span class="linenos">463</span></a>                <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DAG.update_edges-464"><a href="#DAG.update_edges-464"><span class="linenos">464</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_update_edge</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">id</span> <span class="o">=</span> <span class="n">edge_id</span><span class="p">)</span>
</span><span id="DAG.update_edges-465"><a href="#DAG.update_edges-465"><span class="linenos">465</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="DAG.update_edges-466"><a href="#DAG.update_edges-466"><span class="linenos">466</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_update_edge</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="nb">id</span> <span class="o">=</span> <span class="n">edge_id</span><span class="p">)</span>
</span><span id="DAG.update_edges-467"><a href="#DAG.update_edges-467"><span class="linenos">467</span></a>        
</span><span id="DAG.update_edges-468"><a href="#DAG.update_edges-468"><span class="linenos">468</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DAG.update_edges-469"><a href="#DAG.update_edges-469"><span class="linenos">469</span></a>            <span class="k">if</span> <span class="n">continue_on</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DAG.update_edges-470"><a href="#DAG.update_edges-470"><span class="linenos">470</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">continue_on</span><span class="p">,</span> <span class="n">Condition</span><span class="p">):</span>
</span><span id="DAG.update_edges-471"><a href="#DAG.update_edges-471"><span class="linenos">471</span></a>                    <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Condition assignment must use webber.edges.Condition&quot;</span>
</span><span id="DAG.update_edges-472"><a href="#DAG.update_edges-472"><span class="linenos">472</span></a>                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="DAG.update_edges-473"><a href="#DAG.update_edges-473"><span class="linenos">473</span></a>                <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">edge_ids</span><span class="p">:</span>
</span><span id="DAG.update_edges-474"><a href="#DAG.update_edges-474"><span class="linenos">474</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;Condition&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">continue_on</span>
</span></pre></div>


            <div class="docstring"><p>Flexible function to update properties of edges in the DAG's scope, 
based on unique identifier(s) (e.g.: string IDs or unique callables) or a
lambda filter using the edgedict syntax.</p>

<p>List of nodes to update or filter argument is expected. Valid edge lists include:</p>

<pre><code>     update_edges((node1, node2), ...)       or update_edges([(node1, node2)], ...)

     update_edges((node1, callable2), ...)   or update_edges([(node1, callable2)], ...)

     update_edges(edgedict),                 where isinstance(edgedict, webber.edges.edgedict) == True
</code></pre>

<p>Parameters:</p>

<blockquote>
  <p>continue_on: <a href="#Condition">webber.edges.Condition</a> value to update matching edges with, </p>

<pre><code>     Execute child on success, failure, or any exit state, of the parent node
</code></pre>
  
  <p>filter: lambda property that can be used instead of a list of edges to be updated.</p>

<pre><code>     filter = (lambda e: n.parent == print or e.child == print)
</code></pre>
  
  <p>data: If given, expects a dictionary or edgedict to update edge properties. Currently, only continue_on property should be set.</p>

<pre><code>     data = { 'continue_on': <a href="#Condition">webber.edges.Condition</a> }
</code></pre>
</blockquote>
</div>


                            </div>
                            <div id="DAG.relabel_node" class="classattr">
                                        <input id="DAG.relabel_node-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">relabel_node</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">node</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Callable</span><span class="p">]</span>, </span><span class="param"><span class="n">label</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="DAG.relabel_node-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DAG.relabel_node"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DAG.relabel_node-521"><a href="#DAG.relabel_node-521"><span class="linenos">521</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">relabel_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_T</span><span class="o">.</span><span class="n">Callable</span><span class="p">],</span> <span class="n">label</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="DAG.relabel_node-522"><a href="#DAG.relabel_node-522"><span class="linenos">522</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DAG.relabel_node-523"><a href="#DAG.relabel_node-523"><span class="linenos">523</span></a><span class="sd">        Update the label, or name, given to a node in the DAG&#39;s scope, </span>
</span><span id="DAG.relabel_node-524"><a href="#DAG.relabel_node-524"><span class="linenos">524</span></a><span class="sd">        given a Python string and a node identifier. </span>
</span><span id="DAG.relabel_node-525"><a href="#DAG.relabel_node-525"><span class="linenos">525</span></a><span class="sd">        Well-structured wrapper for a common use-case of DAG.update_nodes.</span>
</span><span id="DAG.relabel_node-526"><a href="#DAG.relabel_node-526"><span class="linenos">526</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DAG.relabel_node-527"><a href="#DAG.relabel_node-527"><span class="linenos">527</span></a>        <span class="n">node_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_id</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
</span><span id="DAG.relabel_node-528"><a href="#DAG.relabel_node-528"><span class="linenos">528</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">label</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="DAG.relabel_node-529"><a href="#DAG.relabel_node-529"><span class="linenos">529</span></a>            <span class="n">err_msg</span> <span class="o">=</span> <span class="s2">&quot;Node label must be a Python string with one or more characters.&quot;</span>
</span><span id="DAG.relabel_node-530"><a href="#DAG.relabel_node-530"><span class="linenos">530</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="DAG.relabel_node-531"><a href="#DAG.relabel_node-531"><span class="linenos">531</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">update_nodes</span><span class="p">(</span><span class="n">node_id</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">label</span><span class="p">})</span>
</span><span id="DAG.relabel_node-532"><a href="#DAG.relabel_node-532"><span class="linenos">532</span></a>        <span class="k">return</span> <span class="n">label</span>
</span></pre></div>


            <div class="docstring"><p>Update the label, or name, given to a node in the DAG's scope, 
given a Python string and a node identifier. 
Well-structured wrapper for a common use-case of <a href="#DAG.update_nodes">DAG.update_nodes</a>.</p>
</div>


                            </div>
                            <div id="DAG.update_nodes" class="classattr">
                                        <input id="DAG.update_nodes-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">update_nodes</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="o">*</span><span class="n">N</span><span class="p">:</span> <span class="n">Any</span>,</span><span class="param">	<span class="nb">filter</span><span class="p">:</span> <span class="n">function</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">webber</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">dotdict</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="nb">callable</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">args</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Iterable</span><span class="p">[</span><span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="DAG.update_nodes-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DAG.update_nodes"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DAG.update_nodes-534"><a href="#DAG.update_nodes-534"><span class="linenos">534</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">update_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">N</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">,</span> <span class="nb">filter</span><span class="p">:</span> <span class="n">_types</span><span class="o">.</span><span class="n">LambdaType</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="n">dotdict</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">callable</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Callable</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">args</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Iterable</span><span class="p">[</span><span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DAG.update_nodes-535"><a href="#DAG.update_nodes-535"><span class="linenos">535</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DAG.update_nodes-536"><a href="#DAG.update_nodes-536"><span class="linenos">536</span></a><span class="sd">        Flexible function to update properties of nodes in the DAG&#39;s scope, </span>
</span><span id="DAG.update_nodes-537"><a href="#DAG.update_nodes-537"><span class="linenos">537</span></a><span class="sd">        based on unique identifier(s) (e.g.: string IDs or unique callables) or a</span>
</span><span id="DAG.update_nodes-538"><a href="#DAG.update_nodes-538"><span class="linenos">538</span></a><span class="sd">        lambda filter using the dotdict syntax.</span>
</span><span id="DAG.update_nodes-539"><a href="#DAG.update_nodes-539"><span class="linenos">539</span></a><span class="sd">        </span>
</span><span id="DAG.update_nodes-540"><a href="#DAG.update_nodes-540"><span class="linenos">540</span></a><span class="sd">        List of nodes to update or filter argument is expected. Valid node lists include:</span>
</span><span id="DAG.update_nodes-541"><a href="#DAG.update_nodes-541"><span class="linenos">541</span></a>
</span><span id="DAG.update_nodes-542"><a href="#DAG.update_nodes-542"><span class="linenos">542</span></a><span class="sd">        \t update_nodes(node_id, ...)           or update_nodes([node_id], ...)</span>
</span><span id="DAG.update_nodes-543"><a href="#DAG.update_nodes-543"><span class="linenos">543</span></a>
</span><span id="DAG.update_nodes-544"><a href="#DAG.update_nodes-544"><span class="linenos">544</span></a><span class="sd">        \t update_nodes(callable, ...)          or update_nodes([callable], ...)</span>
</span><span id="DAG.update_nodes-545"><a href="#DAG.update_nodes-545"><span class="linenos">545</span></a><span class="sd">        </span>
</span><span id="DAG.update_nodes-546"><a href="#DAG.update_nodes-546"><span class="linenos">546</span></a><span class="sd">        \t update_nodes(node1, node2, ...)      or update_nodes([node1, node2], ...)</span>
</span><span id="DAG.update_nodes-547"><a href="#DAG.update_nodes-547"><span class="linenos">547</span></a><span class="sd">        </span>
</span><span id="DAG.update_nodes-548"><a href="#DAG.update_nodes-548"><span class="linenos">548</span></a><span class="sd">        \t update_nodes(node1, callable2, ...)  or update_nodes([node1, callable2], ...)</span>
</span><span id="DAG.update_nodes-549"><a href="#DAG.update_nodes-549"><span class="linenos">549</span></a>
</span><span id="DAG.update_nodes-550"><a href="#DAG.update_nodes-550"><span class="linenos">550</span></a><span class="sd">        &gt; update_nodes(node_id, ...) is equivalent to update_nodes(filter = lambda n: n.id == node_id)</span>
</span><span id="DAG.update_nodes-551"><a href="#DAG.update_nodes-551"><span class="linenos">551</span></a>
</span><span id="DAG.update_nodes-552"><a href="#DAG.update_nodes-552"><span class="linenos">552</span></a><span class="sd">        Parameters:</span>
</span><span id="DAG.update_nodes-553"><a href="#DAG.update_nodes-553"><span class="linenos">553</span></a>
</span><span id="DAG.update_nodes-554"><a href="#DAG.update_nodes-554"><span class="linenos">554</span></a><span class="sd">        &gt; filter: lambda property that can be used instead of a list of nodes to be updated.</span>
</span><span id="DAG.update_nodes-555"><a href="#DAG.update_nodes-555"><span class="linenos">555</span></a><span class="sd">        </span>
</span><span id="DAG.update_nodes-556"><a href="#DAG.update_nodes-556"><span class="linenos">556</span></a><span class="sd">        \t filter = (lambda n: n.callable == print or &#39;Hello, World&#39; in n.args)</span>
</span><span id="DAG.update_nodes-557"><a href="#DAG.update_nodes-557"><span class="linenos">557</span></a>
</span><span id="DAG.update_nodes-558"><a href="#DAG.update_nodes-558"><span class="linenos">558</span></a><span class="sd">        &gt; data: If given, expects a dictionary or dotdict to update node properties. At least one property should be defined if data argument is set.</span>
</span><span id="DAG.update_nodes-559"><a href="#DAG.update_nodes-559"><span class="linenos">559</span></a><span class="sd">            Any value given to the id key will be ignored. Allowed for ease of use with DAG.get nodes method.</span>
</span><span id="DAG.update_nodes-560"><a href="#DAG.update_nodes-560"><span class="linenos">560</span></a><span class="sd">            </span>
</span><span id="DAG.update_nodes-561"><a href="#DAG.update_nodes-561"><span class="linenos">561</span></a><span class="sd">        \t data = {</span>
</span><span id="DAG.update_nodes-562"><a href="#DAG.update_nodes-562"><span class="linenos">562</span></a><span class="sd">            \t &#39;callable&#39;: print,</span>
</span><span id="DAG.update_nodes-563"><a href="#DAG.update_nodes-563"><span class="linenos">563</span></a><span class="sd">            \t &#39;args&#39;: [&#39;Hello&#39;, &#39;World&#39;],</span>
</span><span id="DAG.update_nodes-564"><a href="#DAG.update_nodes-564"><span class="linenos">564</span></a><span class="sd">            \t &#39;kwargs&#39;: {&#39;sep&#39;: &#39;, &#39;},</span>
</span><span id="DAG.update_nodes-565"><a href="#DAG.update_nodes-565"><span class="linenos">565</span></a><span class="sd">            \t &#39;name&#39;: &#39;custom_label&#39;,</span>
</span><span id="DAG.update_nodes-566"><a href="#DAG.update_nodes-566"><span class="linenos">566</span></a><span class="sd">            \t &#39;id&#39;: &#39;unique-identifier&#39;</span>
</span><span id="DAG.update_nodes-567"><a href="#DAG.update_nodes-567"><span class="linenos">567</span></a><span class="sd">            \t}</span>
</span><span id="DAG.update_nodes-568"><a href="#DAG.update_nodes-568"><span class="linenos">568</span></a>
</span><span id="DAG.update_nodes-569"><a href="#DAG.update_nodes-569"><span class="linenos">569</span></a><span class="sd">        &gt; args: Positional arguments to be passed to matching callables in the DAG&#39;s scope, using a Python iterable (e.g.: Tuple or List).</span>
</span><span id="DAG.update_nodes-570"><a href="#DAG.update_nodes-570"><span class="linenos">570</span></a>
</span><span id="DAG.update_nodes-571"><a href="#DAG.update_nodes-571"><span class="linenos">571</span></a><span class="sd">        &gt; kwargs: Keyword arguments to be passed to matching callables in the DAG&#39;s scope, using a Python dictionary.</span>
</span><span id="DAG.update_nodes-572"><a href="#DAG.update_nodes-572"><span class="linenos">572</span></a>
</span><span id="DAG.update_nodes-573"><a href="#DAG.update_nodes-573"><span class="linenos">573</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DAG.update_nodes-574"><a href="#DAG.update_nodes-574"><span class="linenos">574</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">filter</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DAG.update_nodes-575"><a href="#DAG.update_nodes-575"><span class="linenos">575</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Either an array of node IDs or node data (N) or a filter must be passed to this function.&quot;</span><span class="p">)</span>
</span><span id="DAG.update_nodes-576"><a href="#DAG.update_nodes-576"><span class="linenos">576</span></a>
</span><span id="DAG.update_nodes-577"><a href="#DAG.update_nodes-577"><span class="linenos">577</span></a>        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">filter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DAG.update_nodes-578"><a href="#DAG.update_nodes-578"><span class="linenos">578</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Node data array (N) and filter argument are mutually exclusive, and cannot both be defined to identify nodes to update DAG&#39;s scope.&quot;</span><span class="p">)</span>
</span><span id="DAG.update_nodes-579"><a href="#DAG.update_nodes-579"><span class="linenos">579</span></a>
</span><span id="DAG.update_nodes-580"><a href="#DAG.update_nodes-580"><span class="linenos">580</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="DAG.update_nodes-581"><a href="#DAG.update_nodes-581"><span class="linenos">581</span></a>            <span class="n">N</span> <span class="o">=</span> <span class="p">[</span><span class="n">N</span><span class="p">]</span>
</span><span id="DAG.update_nodes-582"><a href="#DAG.update_nodes-582"><span class="linenos">582</span></a>
</span><span id="DAG.update_nodes-583"><a href="#DAG.update_nodes-583"><span class="linenos">583</span></a>        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">N</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">_abc</span><span class="o">.</span><span class="n">Iterable</span><span class="p">):</span>
</span><span id="DAG.update_nodes-584"><a href="#DAG.update_nodes-584"><span class="linenos">584</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">N</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="DAG.update_nodes-585"><a href="#DAG.update_nodes-585"><span class="linenos">585</span></a>                <span class="n">N</span> <span class="o">=</span> <span class="n">N</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="DAG.update_nodes-586"><a href="#DAG.update_nodes-586"><span class="linenos">586</span></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">N</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="DAG.update_nodes-587"><a href="#DAG.update_nodes-587"><span class="linenos">587</span></a>                <span class="c1"># BUG: A list of all single character IDs will fail to be updated. Please try another call method (i.e.: nested iterator).</span>
</span><span id="DAG.update_nodes-588"><a href="#DAG.update_nodes-588"><span class="linenos">588</span></a>                <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">n</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">N</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">N</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span> 
</span><span id="DAG.update_nodes-589"><a href="#DAG.update_nodes-589"><span class="linenos">589</span></a>                    <span class="n">N</span> <span class="o">=</span> <span class="n">N</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="DAG.update_nodes-590"><a href="#DAG.update_nodes-590"><span class="linenos">590</span></a>
</span><span id="DAG.update_nodes-591"><a href="#DAG.update_nodes-591"><span class="linenos">591</span></a>
</span><span id="DAG.update_nodes-592"><a href="#DAG.update_nodes-592"><span class="linenos">592</span></a>        <span class="k">if</span> <span class="nb">filter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DAG.update_nodes-593"><a href="#DAG.update_nodes-593"><span class="linenos">593</span></a>            <span class="n">node_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_nodes</span><span class="p">(</span><span class="nb">filter</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="DAG.update_nodes-594"><a href="#DAG.update_nodes-594"><span class="linenos">594</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DAG.update_nodes-595"><a href="#DAG.update_nodes-595"><span class="linenos">595</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">N</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="DAG.update_nodes-596"><a href="#DAG.update_nodes-596"><span class="linenos">596</span></a>                <span class="n">ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">N</span><span class="p">]</span>
</span><span id="DAG.update_nodes-597"><a href="#DAG.update_nodes-597"><span class="linenos">597</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DAG.update_nodes-598"><a href="#DAG.update_nodes-598"><span class="linenos">598</span></a>                <span class="n">ids</span> <span class="o">=</span> <span class="n">N</span>
</span><span id="DAG.update_nodes-599"><a href="#DAG.update_nodes-599"><span class="linenos">599</span></a>            <span class="n">node_ids</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">node_id</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ids</span><span class="p">]</span>
</span><span id="DAG.update_nodes-600"><a href="#DAG.update_nodes-600"><span class="linenos">600</span></a>        
</span><span id="DAG.update_nodes-601"><a href="#DAG.update_nodes-601"><span class="linenos">601</span></a>        <span class="n">std_update</span> <span class="o">=</span> <span class="p">(</span><span class="nb">callable</span> <span class="o">==</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">args</span> <span class="o">==</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">kwargs</span> <span class="o">==</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="DAG.update_nodes-602"><a href="#DAG.update_nodes-602"><span class="linenos">602</span></a>
</span><span id="DAG.update_nodes-603"><a href="#DAG.update_nodes-603"><span class="linenos">603</span></a>        <span class="k">if</span> <span class="n">std_update</span><span class="p">:</span>
</span><span id="DAG.update_nodes-604"><a href="#DAG.update_nodes-604"><span class="linenos">604</span></a>            <span class="k">for</span> <span class="n">node_id</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">node_ids</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
</span><span id="DAG.update_nodes-605"><a href="#DAG.update_nodes-605"><span class="linenos">605</span></a>                <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DAG.update_nodes-606"><a href="#DAG.update_nodes-606"><span class="linenos">606</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_update_node</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">id</span> <span class="o">=</span> <span class="n">node_id</span><span class="p">)</span>
</span><span id="DAG.update_nodes-607"><a href="#DAG.update_nodes-607"><span class="linenos">607</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="DAG.update_nodes-608"><a href="#DAG.update_nodes-608"><span class="linenos">608</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_update_node</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="nb">id</span> <span class="o">=</span> <span class="n">node_id</span><span class="p">)</span>
</span><span id="DAG.update_nodes-609"><a href="#DAG.update_nodes-609"><span class="linenos">609</span></a>        
</span><span id="DAG.update_nodes-610"><a href="#DAG.update_nodes-610"><span class="linenos">610</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DAG.update_nodes-611"><a href="#DAG.update_nodes-611"><span class="linenos">611</span></a>            <span class="k">if</span> <span class="nb">callable</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DAG.update_nodes-612"><a href="#DAG.update_nodes-612"><span class="linenos">612</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">_iscallable</span><span class="p">(</span><span class="nb">callable</span><span class="p">):</span>
</span><span id="DAG.update_nodes-613"><a href="#DAG.update_nodes-613"><span class="linenos">613</span></a>                    <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Requested node is not assigned a callable Python function.&quot;</span>
</span><span id="DAG.update_nodes-614"><a href="#DAG.update_nodes-614"><span class="linenos">614</span></a>                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="DAG.update_nodes-615"><a href="#DAG.update_nodes-615"><span class="linenos">615</span></a>                <span class="k">for</span> <span class="n">node_id</span> <span class="ow">in</span> <span class="n">node_ids</span><span class="p">:</span>
</span><span id="DAG.update_nodes-616"><a href="#DAG.update_nodes-616"><span class="linenos">616</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node_id</span><span class="p">][</span><span class="s1">&#39;callable&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">callable</span>
</span><span id="DAG.update_nodes-617"><a href="#DAG.update_nodes-617"><span class="linenos">617</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node_id</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">callable</span><span class="o">.</span><span class="vm">__name__</span>
</span><span id="DAG.update_nodes-618"><a href="#DAG.update_nodes-618"><span class="linenos">618</span></a>            
</span><span id="DAG.update_nodes-619"><a href="#DAG.update_nodes-619"><span class="linenos">619</span></a>            <span class="k">if</span> <span class="n">args</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DAG.update_nodes-620"><a href="#DAG.update_nodes-620"><span class="linenos">620</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">_abc</span><span class="o">.</span><span class="n">Iterable</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="nb">str</span><span class="p">)):</span>
</span><span id="DAG.update_nodes-621"><a href="#DAG.update_nodes-621"><span class="linenos">621</span></a>                    <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Requested node is not assigned a tuple of pos args.&quot;</span>
</span><span id="DAG.update_nodes-622"><a href="#DAG.update_nodes-622"><span class="linenos">622</span></a>                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="DAG.update_nodes-623"><a href="#DAG.update_nodes-623"><span class="linenos">623</span></a>                <span class="n">args</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
</span><span id="DAG.update_nodes-624"><a href="#DAG.update_nodes-624"><span class="linenos">624</span></a>                <span class="k">for</span> <span class="n">node_id</span> <span class="ow">in</span> <span class="n">node_ids</span><span class="p">:</span>
</span><span id="DAG.update_nodes-625"><a href="#DAG.update_nodes-625"><span class="linenos">625</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node_id</span><span class="p">][</span><span class="s1">&#39;args&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">args</span>
</span><span id="DAG.update_nodes-626"><a href="#DAG.update_nodes-626"><span class="linenos">626</span></a>            
</span><span id="DAG.update_nodes-627"><a href="#DAG.update_nodes-627"><span class="linenos">627</span></a>            <span class="k">if</span> <span class="n">kwargs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DAG.update_nodes-628"><a href="#DAG.update_nodes-628"><span class="linenos">628</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="DAG.update_nodes-629"><a href="#DAG.update_nodes-629"><span class="linenos">629</span></a>                    <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Requested node is not assigned a dictionary of kw args.&quot;</span>
</span><span id="DAG.update_nodes-630"><a href="#DAG.update_nodes-630"><span class="linenos">630</span></a>                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="DAG.update_nodes-631"><a href="#DAG.update_nodes-631"><span class="linenos">631</span></a>                <span class="k">for</span> <span class="n">node_id</span> <span class="ow">in</span> <span class="n">node_ids</span><span class="p">:</span>
</span><span id="DAG.update_nodes-632"><a href="#DAG.update_nodes-632"><span class="linenos">632</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node_id</span><span class="p">][</span><span class="s1">&#39;kwargs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span>
</span></pre></div>


            <div class="docstring"><p>Flexible function to update properties of nodes in the DAG's scope, 
based on unique identifier(s) (e.g.: string IDs or unique callables) or a
lambda filter using the dotdict syntax.</p>

<p>List of nodes to update or filter argument is expected. Valid node lists include:</p>

<pre><code>     update_nodes(node_id, ...)           or update_nodes([node_id], ...)

     update_nodes(callable, ...)          or update_nodes([callable], ...)

     update_nodes(node1, node2, ...)      or update_nodes([node1, node2], ...)

     update_nodes(node1, callable2, ...)  or update_nodes([node1, callable2], ...)
</code></pre>

<blockquote>
  <p>update_nodes(node_id, ...) is equivalent to update_nodes(filter = lambda n: n.id == node_id)</p>
</blockquote>

<p>Parameters:</p>

<blockquote>
  <p>filter: lambda property that can be used instead of a list of nodes to be updated.</p>

<pre><code>     filter = (lambda n: n.callable == print or 'Hello, World' in n.args)
</code></pre>
  
  <p>data: If given, expects a dictionary or dotdict to update node properties. At least one property should be defined if data argument is set.
      Any value given to the id key will be ignored. Allowed for ease of use with DAG.get nodes method.</p>

<pre><code>     data = {
     'callable': print,
     'args': ['Hello', 'World'],
     'kwargs': {'sep': ', '},
     'name': 'custom_label',
     'id': 'unique-identifier'
    }
</code></pre>
  
  <p>args: Positional arguments to be passed to matching callables in the DAG's scope, using a Python iterable (e.g.: Tuple or List).</p>
</blockquote>

<blockquote>
  <p>kwargs: Keyword arguments to be passed to matching callables in the DAG's scope, using a Python dictionary.</p>
</blockquote>
</div>


                            </div>
                            <div id="DAG.get_edges" class="classattr">
                                        <input id="DAG.get_edges-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_edges</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="o">*</span><span class="n">N</span><span class="p">:</span> <span class="n">Any</span>,</span><span class="param">	<span class="n">data</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span></span><span class="return-annotation">) -> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">webber</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">edgedict</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]]</span>:</span></span>

                <label class="view-source-button" for="DAG.get_edges-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DAG.get_edges"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DAG.get_edges-634"><a href="#DAG.get_edges-634"><span class="linenos">634</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">N</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_T</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">_T</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">edgedict</span><span class="p">],</span> <span class="n">_T</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">_T</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]]:</span>
</span><span id="DAG.get_edges-635"><a href="#DAG.get_edges-635"><span class="linenos">635</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DAG.get_edges-636"><a href="#DAG.get_edges-636"><span class="linenos">636</span></a><span class="sd">        Retrieval function for DAG edge data, based on tuple identifiers.</span>
</span><span id="DAG.get_edges-637"><a href="#DAG.get_edges-637"><span class="linenos">637</span></a><span class="sd">        Use filter_edges for more flexible controls (e.g.: filter_edges(in=[&#39;node_1&#39;, &#39;node_2&#39;]))</span>
</span><span id="DAG.get_edges-638"><a href="#DAG.get_edges-638"><span class="linenos">638</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DAG.get_edges-639"><a href="#DAG.get_edges-639"><span class="linenos">639</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="DAG.get_edges-640"><a href="#DAG.get_edges-640"><span class="linenos">640</span></a>            <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
</span><span id="DAG.get_edges-641"><a href="#DAG.get_edges-641"><span class="linenos">641</span></a>                <span class="k">return</span> <span class="p">[</span><span class="n">edgedict</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="o">**</span><span class="n">d</span><span class="p">)</span> <span class="k">for</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">data</span><span class="p">()]</span>
</span><span id="DAG.get_edges-642"><a href="#DAG.get_edges-642"><span class="linenos">642</span></a>            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
</span><span id="DAG.get_edges-643"><a href="#DAG.get_edges-643"><span class="linenos">643</span></a>            
</span><span id="DAG.get_edges-644"><a href="#DAG.get_edges-644"><span class="linenos">644</span></a>        <span class="c1"># elif len(N) == 1:</span>
</span><span id="DAG.get_edges-645"><a href="#DAG.get_edges-645"><span class="linenos">645</span></a>        <span class="c1">#     if isinstance(N[0], _abc.Iterable) and not isinstance(N[0], tuple):</span>
</span><span id="DAG.get_edges-646"><a href="#DAG.get_edges-646"><span class="linenos">646</span></a>        <span class="c1">#         N = N[0]</span>
</span><span id="DAG.get_edges-647"><a href="#DAG.get_edges-647"><span class="linenos">647</span></a>
</span><span id="DAG.get_edges-648"><a href="#DAG.get_edges-648"><span class="linenos">648</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">N</span><span class="p">))</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">_abc</span><span class="o">.</span><span class="n">Iterable</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">N</span><span class="p">):</span>
</span><span id="DAG.get_edges-649"><a href="#DAG.get_edges-649"><span class="linenos">649</span></a>            <span class="n">err_msg</span> <span class="o">=</span> <span class="s1">&#39;All requested edges must be unique tuples of size 2.&#39;</span>
</span><span id="DAG.get_edges-650"><a href="#DAG.get_edges-650"><span class="linenos">650</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="DAG.get_edges-651"><a href="#DAG.get_edges-651"><span class="linenos">651</span></a>    
</span><span id="DAG.get_edges-652"><a href="#DAG.get_edges-652"><span class="linenos">652</span></a>        <span class="n">edge_data</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_edge</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="ow">in</span> <span class="n">N</span><span class="p">]</span>
</span><span id="DAG.get_edges-653"><a href="#DAG.get_edges-653"><span class="linenos">653</span></a>        <span class="k">return</span> <span class="n">edge_data</span>
</span></pre></div>


            <div class="docstring"><p>Retrieval function for DAG edge data, based on tuple identifiers.
Use filter_edges for more flexible controls (e.g.: filter_edges(in=['node_1', 'node_2']))</p>
</div>


                            </div>
                            <div id="DAG.get_edge" class="classattr">
                                        <input id="DAG.get_edge-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_edge</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">outgoing_node</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Callable</span><span class="p">]</span>,</span><span class="param">	<span class="n">incoming_node</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Callable</span><span class="p">]</span>,</span><span class="param">	<span class="n">data</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span></span><span class="return-annotation">) -> <span class="n">Union</span><span class="p">[</span><span class="n">webber</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">edgedict</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="DAG.get_edge-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DAG.get_edge"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DAG.get_edge-655"><a href="#DAG.get_edge-655"><span class="linenos">655</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_edge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outgoing_node</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_T</span><span class="o">.</span><span class="n">Callable</span><span class="p">],</span> <span class="n">incoming_node</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_T</span><span class="o">.</span><span class="n">Callable</span><span class="p">],</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_T</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">edgedict</span><span class="p">,</span> <span class="n">_T</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
</span><span id="DAG.get_edge-656"><a href="#DAG.get_edge-656"><span class="linenos">656</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DAG.get_edge-657"><a href="#DAG.get_edge-657"><span class="linenos">657</span></a><span class="sd">        Retrieval function for a single directed edge between nodes in a DAG&#39;s scope. </span>
</span><span id="DAG.get_edge-658"><a href="#DAG.get_edge-658"><span class="linenos">658</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DAG.get_edge-659"><a href="#DAG.get_edge-659"><span class="linenos">659</span></a>        <span class="nb">id</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node_id</span><span class="p">(</span><span class="n">outgoing_node</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_id</span><span class="p">(</span><span class="n">incoming_node</span><span class="p">))</span>
</span><span id="DAG.get_edge-660"><a href="#DAG.get_edge-660"><span class="linenos">660</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
</span><span id="DAG.get_edge-661"><a href="#DAG.get_edge-661"><span class="linenos">661</span></a>            <span class="k">return</span> <span class="nb">id</span>
</span><span id="DAG.get_edge-662"><a href="#DAG.get_edge-662"><span class="linenos">662</span></a>        <span class="n">edge_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">get_edge_data</span><span class="p">(</span><span class="n">u</span> <span class="o">=</span> <span class="nb">id</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">v</span> <span class="o">=</span> <span class="nb">id</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="DAG.get_edge-663"><a href="#DAG.get_edge-663"><span class="linenos">663</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">edge_data</span><span class="p">:</span>
</span><span id="DAG.get_edge-664"><a href="#DAG.get_edge-664"><span class="linenos">664</span></a>            <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;No match found for the directed edge requested: </span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="DAG.get_edge-665"><a href="#DAG.get_edge-665"><span class="linenos">665</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="DAG.get_edge-666"><a href="#DAG.get_edge-666"><span class="linenos">666</span></a>        <span class="k">assert</span> <span class="n">edge_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>  <span class="c1"># Type narrowing for Pylance</span>
</span><span id="DAG.get_edge-667"><a href="#DAG.get_edge-667"><span class="linenos">667</span></a>        <span class="k">return</span> <span class="n">edgedict</span><span class="p">(</span><span class="o">*</span><span class="nb">id</span><span class="p">,</span> <span class="o">**</span><span class="n">edge_data</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Retrieval function for a single directed edge between nodes in a DAG's scope.</p>
</div>


                            </div>
                            <div id="DAG.get_node" class="classattr">
                                        <input id="DAG.get_node-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_node</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">n</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Callable</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="n">webber</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">dotdict</span>:</span></span>

                <label class="view-source-button" for="DAG.get_node-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DAG.get_node"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DAG.get_node-669"><a href="#DAG.get_node-669"><span class="linenos">669</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_T</span><span class="o">.</span><span class="n">Callable</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">dotdict</span><span class="p">:</span>
</span><span id="DAG.get_node-670"><a href="#DAG.get_node-670"><span class="linenos">670</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DAG.get_node-671"><a href="#DAG.get_node-671"><span class="linenos">671</span></a><span class="sd">        Given a unique identifier, returns a dictionary of node metadata</span>
</span><span id="DAG.get_node-672"><a href="#DAG.get_node-672"><span class="linenos">672</span></a><span class="sd">        for a single node in the DAG&#39;s scope.</span>
</span><span id="DAG.get_node-673"><a href="#DAG.get_node-673"><span class="linenos">673</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DAG.get_node-674"><a href="#DAG.get_node-674"><span class="linenos">674</span></a>        <span class="n">node_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_id</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</span><span id="DAG.get_node-675"><a href="#DAG.get_node-675"><span class="linenos">675</span></a>        <span class="k">return</span> <span class="n">dotdict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node_id</span><span class="p">])</span>
</span></pre></div>


            <div class="docstring"><p>Given a unique identifier, returns a dictionary of node metadata
for a single node in the DAG's scope.</p>
</div>


                            </div>
                            <div id="DAG.get_nodes" class="classattr">
                                        <input id="DAG.get_nodes-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_nodes</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="o">*</span><span class="n">N</span><span class="p">:</span> <span class="n">Any</span></span><span class="return-annotation">) -> <span class="n">List</span><span class="p">[</span><span class="n">webber</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">dotdict</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="DAG.get_nodes-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DAG.get_nodes"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DAG.get_nodes-677"><a href="#DAG.get_nodes-677"><span class="linenos">677</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">N</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_T</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">dotdict</span><span class="p">]:</span>
</span><span id="DAG.get_nodes-678"><a href="#DAG.get_nodes-678"><span class="linenos">678</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DAG.get_nodes-679"><a href="#DAG.get_nodes-679"><span class="linenos">679</span></a><span class="sd">        Flexible function to retrieve DAG node data, based on node identifiers </span>
</span><span id="DAG.get_nodes-680"><a href="#DAG.get_nodes-680"><span class="linenos">680</span></a><span class="sd">        (e.g.: string IDs or unique callables).</span>
</span><span id="DAG.get_nodes-681"><a href="#DAG.get_nodes-681"><span class="linenos">681</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DAG.get_nodes-682"><a href="#DAG.get_nodes-682"><span class="linenos">682</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="DAG.get_nodes-683"><a href="#DAG.get_nodes-683"><span class="linenos">683</span></a>            <span class="n">node_data</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</span><span id="DAG.get_nodes-684"><a href="#DAG.get_nodes-684"><span class="linenos">684</span></a>            <span class="k">return</span> <span class="p">[</span><span class="n">dotdict</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">node_data</span><span class="p">]</span>
</span><span id="DAG.get_nodes-685"><a href="#DAG.get_nodes-685"><span class="linenos">685</span></a>
</span><span id="DAG.get_nodes-686"><a href="#DAG.get_nodes-686"><span class="linenos">686</span></a>        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="DAG.get_nodes-687"><a href="#DAG.get_nodes-687"><span class="linenos">687</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">N</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">_abc</span><span class="o">.</span><span class="n">Iterable</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">N</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="DAG.get_nodes-688"><a href="#DAG.get_nodes-688"><span class="linenos">688</span></a>                <span class="n">N</span> <span class="o">=</span> <span class="n">N</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="DAG.get_nodes-689"><a href="#DAG.get_nodes-689"><span class="linenos">689</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DAG.get_nodes-690"><a href="#DAG.get_nodes-690"><span class="linenos">690</span></a>                <span class="n">node_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_id</span><span class="p">(</span><span class="n">N</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="DAG.get_nodes-691"><a href="#DAG.get_nodes-691"><span class="linenos">691</span></a>                <span class="n">node_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">dotdict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node_id</span><span class="p">])]</span>
</span><span id="DAG.get_nodes-692"><a href="#DAG.get_nodes-692"><span class="linenos">692</span></a>                <span class="k">return</span> <span class="n">node_data</span>
</span><span id="DAG.get_nodes-693"><a href="#DAG.get_nodes-693"><span class="linenos">693</span></a>            
</span><span id="DAG.get_nodes-694"><a href="#DAG.get_nodes-694"><span class="linenos">694</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">N</span><span class="p">)):</span>
</span><span id="DAG.get_nodes-695"><a href="#DAG.get_nodes-695"><span class="linenos">695</span></a>            <span class="n">err_msg</span> <span class="o">=</span> <span class="s1">&#39;All requested nodes must be unique identifiers.&#39;</span>
</span><span id="DAG.get_nodes-696"><a href="#DAG.get_nodes-696"><span class="linenos">696</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="DAG.get_nodes-697"><a href="#DAG.get_nodes-697"><span class="linenos">697</span></a>        
</span><span id="DAG.get_nodes-698"><a href="#DAG.get_nodes-698"><span class="linenos">698</span></a>        <span class="n">node_ids</span>  <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">node_id</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">N</span><span class="p">]</span>
</span><span id="DAG.get_nodes-699"><a href="#DAG.get_nodes-699"><span class="linenos">699</span></a>        <span class="n">node_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">dotdict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">n</span><span class="p">])</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">node_ids</span><span class="p">]</span>
</span><span id="DAG.get_nodes-700"><a href="#DAG.get_nodes-700"><span class="linenos">700</span></a>        <span class="k">return</span> <span class="n">node_data</span>
</span></pre></div>


            <div class="docstring"><p>Flexible function to retrieve DAG node data, based on node identifiers 
(e.g.: string IDs or unique callables).</p>
</div>


                            </div>
                            <div id="DAG.filter_nodes" class="classattr">
                                        <input id="DAG.filter_nodes-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">filter_nodes</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="nb">filter</span><span class="p">:</span> <span class="n">function</span>,</span><span class="param">	<span class="n">data</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">webber</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">dotdict</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="DAG.filter_nodes-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DAG.filter_nodes"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DAG.filter_nodes-702"><a href="#DAG.filter_nodes-702"><span class="linenos">702</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">filter_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">filter</span><span class="p">:</span> <span class="n">_types</span><span class="o">.</span><span class="n">LambdaType</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_T</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="n">_T</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">dotdict</span><span class="p">]:</span>
</span><span id="DAG.filter_nodes-703"><a href="#DAG.filter_nodes-703"><span class="linenos">703</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DAG.filter_nodes-704"><a href="#DAG.filter_nodes-704"><span class="linenos">704</span></a><span class="sd">        Given a lambda function, filter nodes in a DAG&#39;s scope based on its attributes.</span>
</span><span id="DAG.filter_nodes-705"><a href="#DAG.filter_nodes-705"><span class="linenos">705</span></a><span class="sd">        Current limitation: Filters must use node identifier strings when referencing nodes.</span>
</span><span id="DAG.filter_nodes-706"><a href="#DAG.filter_nodes-706"><span class="linenos">706</span></a><span class="sd">        Use get_nodes for more flexible controls.</span>
</span><span id="DAG.filter_nodes-707"><a href="#DAG.filter_nodes-707"><span class="linenos">707</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DAG.filter_nodes-708"><a href="#DAG.filter_nodes-708"><span class="linenos">708</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
</span><span id="DAG.filter_nodes-709"><a href="#DAG.filter_nodes-709"><span class="linenos">709</span></a>            <span class="k">return</span> <span class="p">[</span><span class="n">node</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span> <span class="nb">filter</span><span class="p">(</span><span class="n">dotdict</span><span class="p">(</span><span class="n">node</span><span class="p">))]</span>
</span><span id="DAG.filter_nodes-710"><a href="#DAG.filter_nodes-710"><span class="linenos">710</span></a>        <span class="k">return</span> <span class="p">[</span><span class="n">dotdict</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span> <span class="nb">filter</span><span class="p">(</span><span class="n">dotdict</span><span class="p">(</span><span class="n">node</span><span class="p">))]</span>
</span></pre></div>


            <div class="docstring"><p>Given a lambda function, filter nodes in a DAG's scope based on its attributes.
Current limitation: Filters must use node identifier strings when referencing nodes.
Use get_nodes for more flexible controls.</p>
</div>


                            </div>
                            <div id="DAG.filter_edges" class="classattr">
                                        <input id="DAG.filter_edges-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">filter_edges</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="nb">filter</span><span class="p">:</span> <span class="n">function</span>,</span><span class="param">	<span class="n">data</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]],</span> <span class="n">List</span><span class="p">[</span><span class="n">webber</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">edgedict</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="DAG.filter_edges-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DAG.filter_edges"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DAG.filter_edges-712"><a href="#DAG.filter_edges-712"><span class="linenos">712</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">filter_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">filter</span><span class="p">:</span> <span class="n">_types</span><span class="o">.</span><span class="n">LambdaType</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_T</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">_T</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">|</span> <span class="n">_T</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">edgedict</span><span class="p">]:</span>
</span><span id="DAG.filter_edges-713"><a href="#DAG.filter_edges-713"><span class="linenos">713</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DAG.filter_edges-714"><a href="#DAG.filter_edges-714"><span class="linenos">714</span></a><span class="sd">        Given a lambda function, filter edges in a DAG&#39;s scope based on its attributes.</span>
</span><span id="DAG.filter_edges-715"><a href="#DAG.filter_edges-715"><span class="linenos">715</span></a><span class="sd">        Current limitation: Filters must use node identifier strings when referencing nodes.</span>
</span><span id="DAG.filter_edges-716"><a href="#DAG.filter_edges-716"><span class="linenos">716</span></a><span class="sd">        Use get_edges for more flexible controls.</span>
</span><span id="DAG.filter_edges-717"><a href="#DAG.filter_edges-717"><span class="linenos">717</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DAG.filter_edges-718"><a href="#DAG.filter_edges-718"><span class="linenos">718</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
</span><span id="DAG.filter_edges-719"><a href="#DAG.filter_edges-719"><span class="linenos">719</span></a>            <span class="k">return</span> <span class="p">[</span><span class="n">e</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">data</span><span class="p">())</span> <span class="k">if</span> <span class="nb">filter</span><span class="p">(</span><span class="n">edgedict</span><span class="p">(</span><span class="o">*</span><span class="n">e</span><span class="p">))]</span>
</span><span id="DAG.filter_edges-720"><a href="#DAG.filter_edges-720"><span class="linenos">720</span></a>        <span class="k">return</span> <span class="p">[</span><span class="n">edgedict</span><span class="p">(</span><span class="o">*</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">data</span><span class="p">())</span> <span class="k">if</span> <span class="nb">filter</span><span class="p">(</span><span class="n">edgedict</span><span class="p">(</span><span class="o">*</span><span class="n">e</span><span class="p">))]</span>
</span></pre></div>


            <div class="docstring"><p>Given a lambda function, filter edges in a DAG's scope based on its attributes.
Current limitation: Filters must use node identifier strings when referencing nodes.
Use get_edges for more flexible controls.</p>
</div>


                            </div>
                            <div id="DAG.retry_node" class="classattr">
                                        <input id="DAG.retry_node-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">retry_node</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">identifier</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Callable</span><span class="p">]</span>, </span><span class="param"><span class="n">count</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="DAG.retry_node-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DAG.retry_node"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DAG.retry_node-722"><a href="#DAG.retry_node-722"><span class="linenos">722</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">retry_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">identifier</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span><span class="n">_T</span><span class="o">.</span><span class="n">Callable</span><span class="p">],</span> <span class="n">count</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DAG.retry_node-723"><a href="#DAG.retry_node-723"><span class="linenos">723</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DAG.retry_node-724"><a href="#DAG.retry_node-724"><span class="linenos">724</span></a><span class="sd">        Given a node identifier, set number of automatic retries in case of failure.</span>
</span><span id="DAG.retry_node-725"><a href="#DAG.retry_node-725"><span class="linenos">725</span></a><span class="sd">        Re-attempts will begin as soon as possible.</span>
</span><span id="DAG.retry_node-726"><a href="#DAG.retry_node-726"><span class="linenos">726</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DAG.retry_node-727"><a href="#DAG.retry_node-727"><span class="linenos">727</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">count</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="DAG.retry_node-728"><a href="#DAG.retry_node-728"><span class="linenos">728</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Retry count must be a non-negative integer.&quot;</span><span class="p">)</span>
</span><span id="DAG.retry_node-729"><a href="#DAG.retry_node-729"><span class="linenos">729</span></a>        <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_id</span><span class="p">(</span><span class="n">identifier</span><span class="p">)</span>
</span><span id="DAG.retry_node-730"><a href="#DAG.retry_node-730"><span class="linenos">730</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s1">&#39;retry&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">count</span>
</span></pre></div>


            <div class="docstring"><p>Given a node identifier, set number of automatic retries in case of failure.
Re-attempts will begin as soon as possible.</p>
</div>


                            </div>
                            <div id="DAG.skip_node" class="classattr">
                                        <input id="DAG.skip_node-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">skip_node</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">identifier</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Callable</span><span class="p">]</span>,</span><span class="param">	<span class="n">skip</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">as_failure</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="DAG.skip_node-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DAG.skip_node"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DAG.skip_node-732"><a href="#DAG.skip_node-732"><span class="linenos">732</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">skip_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">identifier</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_T</span><span class="o">.</span><span class="n">Callable</span><span class="p">],</span> <span class="n">skip</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">as_failure</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DAG.skip_node-733"><a href="#DAG.skip_node-733"><span class="linenos">733</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DAG.skip_node-734"><a href="#DAG.skip_node-734"><span class="linenos">734</span></a><span class="sd">        Given a node identifier, set DAG to skip node execution as a success (stdout print) or a failure (exception error).</span>
</span><span id="DAG.skip_node-735"><a href="#DAG.skip_node-735"><span class="linenos">735</span></a><span class="sd">        Allows conditional control and testing over DAG&#39;s order of operations.</span>
</span><span id="DAG.skip_node-736"><a href="#DAG.skip_node-736"><span class="linenos">736</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DAG.skip_node-737"><a href="#DAG.skip_node-737"><span class="linenos">737</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">skip</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
</span><span id="DAG.skip_node-738"><a href="#DAG.skip_node-738"><span class="linenos">738</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Skip argument must be a boolean value.&quot;</span><span class="p">)</span>
</span><span id="DAG.skip_node-739"><a href="#DAG.skip_node-739"><span class="linenos">739</span></a>        <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_id</span><span class="p">(</span><span class="n">identifier</span><span class="p">)</span>
</span><span id="DAG.skip_node-740"><a href="#DAG.skip_node-740"><span class="linenos">740</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s1">&#39;skip&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">skip</span><span class="p">,</span> <span class="n">as_failure</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Given a node identifier, set DAG to skip node execution as a success (stdout print) or a failure (exception error).
Allows conditional control and testing over DAG's order of operations.</p>
</div>


                            </div>
                            <div id="DAG.critical_path" class="classattr">
                                        <input id="DAG.critical_path-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">critical_path</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">nodes</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Callable</span><span class="p">]]]</span></span><span class="return-annotation">) -> <span class="n"><a href="#DAG">DAG</a></span>:</span></span>

                <label class="view-source-button" for="DAG.critical_path-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DAG.critical_path"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DAG.critical_path-742"><a href="#DAG.critical_path-742"><span class="linenos">742</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">critical_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nodes</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_T</span><span class="o">.</span><span class="n">Callable</span><span class="p">,</span> <span class="n">_T</span><span class="o">.</span><span class="n">Iterable</span><span class="p">[</span><span class="n">_T</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_T</span><span class="o">.</span><span class="n">Callable</span><span class="p">]]])</span> <span class="o">-&gt;</span> <span class="s1">&#39;DAG&#39;</span><span class="p">:</span>
</span><span id="DAG.critical_path-743"><a href="#DAG.critical_path-743"><span class="linenos">743</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DAG.critical_path-744"><a href="#DAG.critical_path-744"><span class="linenos">744</span></a><span class="sd">        Given a set of nodes, returns a subset of the DAG containing</span>
</span><span id="DAG.critical_path-745"><a href="#DAG.critical_path-745"><span class="linenos">745</span></a><span class="sd">        only the node(s) and its parents, or upstream dependencies.</span>
</span><span id="DAG.critical_path-746"><a href="#DAG.critical_path-746"><span class="linenos">746</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DAG.critical_path-747"><a href="#DAG.critical_path-747"><span class="linenos">747</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="n">_abc</span><span class="o">.</span><span class="n">Iterable</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="DAG.critical_path-748"><a href="#DAG.critical_path-748"><span class="linenos">748</span></a>            <span class="n">node_ids</span> <span class="o">=</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">node_id</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">}</span>
</span><span id="DAG.critical_path-749"><a href="#DAG.critical_path-749"><span class="linenos">749</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DAG.critical_path-750"><a href="#DAG.critical_path-750"><span class="linenos">750</span></a>            <span class="n">node_ids</span> <span class="o">=</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">node_id</span><span class="p">(</span><span class="n">nodes</span><span class="p">)}</span>
</span><span id="DAG.critical_path-751"><a href="#DAG.critical_path-751"><span class="linenos">751</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_subgraph</span><span class="p">(</span><span class="n">node_ids</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Given a set of nodes, returns a subset of the DAG containing
only the node(s) and its parents, or upstream dependencies.</p>
</div>


                            </div>
                            <div id="DAG.execute" class="classattr">
                                        <input id="DAG.execute-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">execute</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">return_ref</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">print_exc</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">max_workers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span></span><span class="return-annotation">) -> <span class="n">Optional</span><span class="p">[</span><span class="n"><a href="#DAG.DAGExecutor">DAG.DAGExecutor</a></span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="DAG.execute-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DAG.execute"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DAG.execute-753"><a href="#DAG.execute-753"><span class="linenos">753</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span>
</span><span id="DAG.execute-754"><a href="#DAG.execute-754"><span class="linenos">754</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="DAG.execute-755"><a href="#DAG.execute-755"><span class="linenos">755</span></a>        <span class="n">return_ref</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="DAG.execute-756"><a href="#DAG.execute-756"><span class="linenos">756</span></a>        <span class="n">print_exc</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="DAG.execute-757"><a href="#DAG.execute-757"><span class="linenos">757</span></a>        <span class="n">max_workers</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="DAG.execute-758"><a href="#DAG.execute-758"><span class="linenos">758</span></a>        <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="DAG.execute-759"><a href="#DAG.execute-759"><span class="linenos">759</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_T</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="s1">&#39;DAG.DAGExecutor&#39;</span><span class="p">]:</span>
</span><span id="DAG.execute-760"><a href="#DAG.execute-760"><span class="linenos">760</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DAG.execute-761"><a href="#DAG.execute-761"><span class="linenos">761</span></a><span class="sd">        Basic wrapper for execution of the DAG&#39;s underlying callables.</span>
</span><span id="DAG.execute-762"><a href="#DAG.execute-762"><span class="linenos">762</span></a>
</span><span id="DAG.execute-763"><a href="#DAG.execute-763"><span class="linenos">763</span></a><span class="sd">        Args:</span>
</span><span id="DAG.execute-764"><a href="#DAG.execute-764"><span class="linenos">764</span></a><span class="sd">            return_ref: If True, return the DAGExecutor instance.</span>
</span><span id="DAG.execute-765"><a href="#DAG.execute-765"><span class="linenos">765</span></a><span class="sd">            print_exc: If True, print full exception tracebacks.</span>
</span><span id="DAG.execute-766"><a href="#DAG.execute-766"><span class="linenos">766</span></a><span class="sd">            max_workers: Maximum number of worker threads. Defaults to None (auto).</span>
</span><span id="DAG.execute-767"><a href="#DAG.execute-767"><span class="linenos">767</span></a><span class="sd">            verbose: If True, log task start/completion messages. Defaults to True.</span>
</span><span id="DAG.execute-768"><a href="#DAG.execute-768"><span class="linenos">768</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DAG.execute-769"><a href="#DAG.execute-769"><span class="linenos">769</span></a>        <span class="n">executor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DAGExecutor</span><span class="p">(</span>
</span><span id="DAG.execute-770"><a href="#DAG.execute-770"><span class="linenos">770</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="n">print_exc</span><span class="p">,</span>
</span><span id="DAG.execute-771"><a href="#DAG.execute-771"><span class="linenos">771</span></a>            <span class="n">max_workers</span><span class="o">=</span><span class="n">max_workers</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span>
</span><span id="DAG.execute-772"><a href="#DAG.execute-772"><span class="linenos">772</span></a>        <span class="p">)</span>
</span><span id="DAG.execute-773"><a href="#DAG.execute-773"><span class="linenos">773</span></a>        <span class="k">return</span> <span class="n">executor</span> <span class="k">if</span> <span class="n">return_ref</span> <span class="k">else</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Basic wrapper for execution of the DAG's underlying callables.</p>

<p>Args:
    return_ref: If True, return the DAGExecutor instance.
    print_exc: If True, print full exception tracebacks.
    max_workers: Maximum number of worker threads. Defaults to None (auto).
    verbose: If True, log task start/completion messages. Defaults to True.</p>
</div>


                            </div>
                            <div id="DAG.visualize" class="classattr">
                                        <input id="DAG.visualize-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">visualize</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="nb">type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;gui&#39;</span><span class="p">,</span> <span class="s1">&#39;browser&#39;</span><span class="p">,</span> <span class="s1">&#39;plt&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">Any</span>:</span></span>

                <label class="view-source-button" for="DAG.visualize-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DAG.visualize"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DAG.visualize-775"><a href="#DAG.visualize-775"><span class="linenos">775</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">visualize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;gui&#39;</span><span class="p">,</span> <span class="s1">&#39;browser&#39;</span><span class="p">,</span> <span class="s1">&#39;plt&#39;</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">:</span>
</span><span id="DAG.visualize-776"><a href="#DAG.visualize-776"><span class="linenos">776</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DAG.visualize-777"><a href="#DAG.visualize-777"><span class="linenos">777</span></a><span class="sd">        Basic wrapper to visualize DAG using Vis.js and NetGraph libraries.</span>
</span><span id="DAG.visualize-778"><a href="#DAG.visualize-778"><span class="linenos">778</span></a><span class="sd">        By default, visualization library only loaded in after DAG.visualize() is called, halving import times.</span>
</span><span id="DAG.visualize-779"><a href="#DAG.visualize-779"><span class="linenos">779</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DAG.visualize-780"><a href="#DAG.visualize-780"><span class="linenos">780</span></a>        <span class="kn">import</span><span class="w"> </span><span class="nn">webber.viz</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">_viz</span>
</span><span id="DAG.visualize-781"><a href="#DAG.visualize-781"><span class="linenos">781</span></a>
</span><span id="DAG.visualize-782"><a href="#DAG.visualize-782"><span class="linenos">782</span></a>        <span class="k">match</span> <span class="nb">type</span><span class="p">:</span>
</span><span id="DAG.visualize-783"><a href="#DAG.visualize-783"><span class="linenos">783</span></a>            <span class="k">case</span> <span class="s1">&#39;browser&#39;</span><span class="p">:</span>
</span><span id="DAG.visualize-784"><a href="#DAG.visualize-784"><span class="linenos">784</span></a>                <span class="n">_viz</span><span class="o">.</span><span class="n">visualize_browser</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="p">)</span>
</span><span id="DAG.visualize-785"><a href="#DAG.visualize-785"><span class="linenos">785</span></a>
</span><span id="DAG.visualize-786"><a href="#DAG.visualize-786"><span class="linenos">786</span></a>            <span class="k">case</span> <span class="s1">&#39;plt&#39;</span><span class="p">:</span>
</span><span id="DAG.visualize-787"><a href="#DAG.visualize-787"><span class="linenos">787</span></a>                <span class="k">return</span> <span class="n">_viz</span><span class="o">.</span><span class="n">visualize_plt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="p">)</span>
</span><span id="DAG.visualize-788"><a href="#DAG.visualize-788"><span class="linenos">788</span></a>
</span><span id="DAG.visualize-789"><a href="#DAG.visualize-789"><span class="linenos">789</span></a>            <span class="k">case</span> <span class="s1">&#39;gui&#39;</span><span class="p">:</span>
</span><span id="DAG.visualize-790"><a href="#DAG.visualize-790"><span class="linenos">790</span></a>                <span class="c1"># _visualize_gui(self.graph)</span>
</span><span id="DAG.visualize-791"><a href="#DAG.visualize-791"><span class="linenos">791</span></a>                <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span><span id="DAG.visualize-792"><a href="#DAG.visualize-792"><span class="linenos">792</span></a>
</span><span id="DAG.visualize-793"><a href="#DAG.visualize-793"><span class="linenos">793</span></a>            <span class="k">case</span> <span class="kc">None</span><span class="p">:</span> 
</span><span id="DAG.visualize-794"><a href="#DAG.visualize-794"><span class="linenos">794</span></a>                <span class="k">if</span> <span class="n">_viz</span><span class="o">.</span><span class="n">_in_notebook</span><span class="p">():</span>
</span><span id="DAG.visualize-795"><a href="#DAG.visualize-795"><span class="linenos">795</span></a>                    <span class="k">return</span> <span class="n">_viz</span><span class="o">.</span><span class="n">visualize_plt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="p">)</span>
</span><span id="DAG.visualize-796"><a href="#DAG.visualize-796"><span class="linenos">796</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="DAG.visualize-797"><a href="#DAG.visualize-797"><span class="linenos">797</span></a>                    <span class="n">_viz</span><span class="o">.</span><span class="n">visualize_browser</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="p">)</span>
</span><span id="DAG.visualize-798"><a href="#DAG.visualize-798"><span class="linenos">798</span></a>
</span><span id="DAG.visualize-799"><a href="#DAG.visualize-799"><span class="linenos">799</span></a>            <span class="k">case</span><span class="w"> </span><span class="k">_</span><span class="p">:</span>
</span><span id="DAG.visualize-800"><a href="#DAG.visualize-800"><span class="linenos">800</span></a>                <span class="n">err_msg</span> <span class="o">=</span> <span class="s2">&quot;Unknown visualization type requested.&quot;</span>
</span><span id="DAG.visualize-801"><a href="#DAG.visualize-801"><span class="linenos">801</span></a>                <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Basic wrapper to visualize DAG using Vis.js and NetGraph libraries.
By default, visualization library only loaded in after <a href="#DAG.visualize">DAG.visualize()</a> is called, halving import times.</p>
</div>


                            </div>
                            <div id="DAG.root" class="classattr">
                                        <input id="DAG.root-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">root</span><span class="annotation">: List[str]</span>

                <label class="view-source-button" for="DAG.root-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DAG.root"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DAG.root-803"><a href="#DAG.root-803"><span class="linenos">803</span></a>    <span class="nd">@property</span>
</span><span id="DAG.root-804"><a href="#DAG.root-804"><span class="linenos">804</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">root</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_T</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="DAG.root-805"><a href="#DAG.root-805"><span class="linenos">805</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DAG.root-806"><a href="#DAG.root-806"><span class="linenos">806</span></a><span class="sd">        Return list of nodes with no dependencies.</span>
</span><span id="DAG.root-807"><a href="#DAG.root-807"><span class="linenos">807</span></a><span class="sd">        Root nodes will occur first in DAG&#39;s order of operations.</span>
</span><span id="DAG.root-808"><a href="#DAG.root-808"><span class="linenos">808</span></a><span class="sd">        Uses O(1) in_degree() instead of O(k) predecessors list creation.</span>
</span><span id="DAG.root-809"><a href="#DAG.root-809"><span class="linenos">809</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DAG.root-810"><a href="#DAG.root-810"><span class="linenos">810</span></a>        <span class="k">return</span> <span class="p">[</span><span class="n">node</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">in_degree</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Return list of nodes with no dependencies.
Root nodes will occur first in DAG's order of operations.
Uses O(1) in_degree() instead of O(k) predecessors list creation.</p>
</div>


                            </div>
                            <div id="DAG.nodes" class="classattr">
                                        <input id="DAG.nodes-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">nodes</span><span class="annotation">: Any</span>

                <label class="view-source-button" for="DAG.nodes-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DAG.nodes"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DAG.nodes-812"><a href="#DAG.nodes-812"><span class="linenos">812</span></a>    <span class="nd">@property</span>
</span><span id="DAG.nodes-813"><a href="#DAG.nodes-813"><span class="linenos">813</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">:</span>
</span><span id="DAG.nodes-814"><a href="#DAG.nodes-814"><span class="linenos">814</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the NodeView of the underlying NetworkX graph containing all DAG nodes.&quot;&quot;&quot;</span>
</span><span id="DAG.nodes-815"><a href="#DAG.nodes-815"><span class="linenos">815</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span>
</span></pre></div>


            <div class="docstring"><p>Returns the NodeView of the underlying NetworkX graph containing all DAG nodes.</p>
</div>


                            </div>
                            <div id="DAG.node_id" class="classattr">
                                        <input id="DAG.node_id-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">node_id</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">identifier</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Callable</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="DAG.node_id-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DAG.node_id"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DAG.node_id-817"><a href="#DAG.node_id-817"><span class="linenos">817</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">node_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">identifier</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span><span class="n">_T</span><span class="o">.</span><span class="n">Callable</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="DAG.node_id-818"><a href="#DAG.node_id-818"><span class="linenos">818</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DAG.node_id-819"><a href="#DAG.node_id-819"><span class="linenos">819</span></a><span class="sd">        Validate whether identifier given is a valid node within the DAG&#39;s scope.</span>
</span><span id="DAG.node_id-820"><a href="#DAG.node_id-820"><span class="linenos">820</span></a><span class="sd">        Primarily for internal use, but useful for retrieving string identifiers</span>
</span><span id="DAG.node_id-821"><a href="#DAG.node_id-821"><span class="linenos">821</span></a><span class="sd">        for a unique callable in a DAG.</span>
</span><span id="DAG.node_id-822"><a href="#DAG.node_id-822"><span class="linenos">822</span></a><span class="sd">        Uses O(1) cache lookup for callables instead of O(n) linear search.</span>
</span><span id="DAG.node_id-823"><a href="#DAG.node_id-823"><span class="linenos">823</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DAG.node_id-824"><a href="#DAG.node_id-824"><span class="linenos">824</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">identifier</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="DAG.node_id-825"><a href="#DAG.node_id-825"><span class="linenos">825</span></a>            <span class="c1"># O(1) lookup using graph.nodes dict</span>
</span><span id="DAG.node_id-826"><a href="#DAG.node_id-826"><span class="linenos">826</span></a>            <span class="k">if</span> <span class="n">identifier</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
</span><span id="DAG.node_id-827"><a href="#DAG.node_id-827"><span class="linenos">827</span></a>                <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Node </span><span class="si">{</span><span class="n">identifier</span><span class="si">}</span><span class="s2"> is not defined in this DAG&#39;s scope.&quot;</span>
</span><span id="DAG.node_id-828"><a href="#DAG.node_id-828"><span class="linenos">828</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="DAG.node_id-829"><a href="#DAG.node_id-829"><span class="linenos">829</span></a>            <span class="k">return</span> <span class="n">identifier</span>
</span><span id="DAG.node_id-830"><a href="#DAG.node_id-830"><span class="linenos">830</span></a>        <span class="k">elif</span> <span class="n">_iscallable</span><span class="p">(</span><span class="n">identifier</span><span class="p">):</span>
</span><span id="DAG.node_id-831"><a href="#DAG.node_id-831"><span class="linenos">831</span></a>            <span class="c1"># O(1) lookup using _callable_to_id cache</span>
</span><span id="DAG.node_id-832"><a href="#DAG.node_id-832"><span class="linenos">832</span></a>            <span class="k">if</span> <span class="n">identifier</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_callable_to_id</span><span class="p">:</span>
</span><span id="DAG.node_id-833"><a href="#DAG.node_id-833"><span class="linenos">833</span></a>                <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Callable </span><span class="si">{</span><span class="n">identifier</span><span class="si">}</span><span class="s2"> is not defined in this DAG&#39;s scope.&quot;</span>
</span><span id="DAG.node_id-834"><a href="#DAG.node_id-834"><span class="linenos">834</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="DAG.node_id-835"><a href="#DAG.node_id-835"><span class="linenos">835</span></a>            <span class="n">cached_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_callable_to_id</span><span class="p">[</span><span class="n">identifier</span><span class="p">]</span>
</span><span id="DAG.node_id-836"><a href="#DAG.node_id-836"><span class="linenos">836</span></a>            <span class="k">if</span> <span class="n">cached_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DAG.node_id-837"><a href="#DAG.node_id-837"><span class="linenos">837</span></a>                <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Callable </span><span class="si">{</span><span class="n">identifier</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> &quot;</span> \
</span><span id="DAG.node_id-838"><a href="#DAG.node_id-838"><span class="linenos">838</span></a>                        <span class="o">+</span> <span class="s2">&quot;exists more than once in this DAG. &quot;</span> \
</span><span id="DAG.node_id-839"><a href="#DAG.node_id-839"><span class="linenos">839</span></a>                        <span class="o">+</span> <span class="s2">&quot;Use the unique string identifier of the required node.&quot;</span>
</span><span id="DAG.node_id-840"><a href="#DAG.node_id-840"><span class="linenos">840</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span><span id="DAG.node_id-841"><a href="#DAG.node_id-841"><span class="linenos">841</span></a>            <span class="k">return</span> <span class="n">cached_id</span>
</span><span id="DAG.node_id-842"><a href="#DAG.node_id-842"><span class="linenos">842</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DAG.node_id-843"><a href="#DAG.node_id-843"><span class="linenos">843</span></a>            <span class="n">err_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Node </span><span class="si">{</span><span class="n">identifier</span><span class="si">}</span><span class="s2"> must be a string or a Python callable&quot;</span>
</span><span id="DAG.node_id-844"><a href="#DAG.node_id-844"><span class="linenos">844</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Validate whether identifier given is a valid node within the DAG's scope.
Primarily for internal use, but useful for retrieving string identifiers
for a unique callable in a DAG.
Uses O(1) cache lookup for callables instead of O(n) linear search.</p>
</div>


                            </div>
                            <div id="DAG.resolve_promise" class="classattr">
                                        <input id="DAG.resolve_promise-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">resolve_promise</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">promise</span><span class="p">:</span> <span class="n"><a href="xcoms.html#Promise">webber.xcoms.Promise</a></span></span><span class="return-annotation">) -> <span class="n"><a href="xcoms.html#Promise">webber.xcoms.Promise</a></span>:</span></span>

                <label class="view-source-button" for="DAG.resolve_promise-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DAG.resolve_promise"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DAG.resolve_promise-906"><a href="#DAG.resolve_promise-906"><span class="linenos">906</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">resolve_promise</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">promise</span><span class="p">:</span> <span class="n">_xcoms</span><span class="o">.</span><span class="n">Promise</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_xcoms</span><span class="o">.</span><span class="n">Promise</span><span class="p">:</span>
</span><span id="DAG.resolve_promise-907"><a href="#DAG.resolve_promise-907"><span class="linenos">907</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DAG.resolve_promise-908"><a href="#DAG.resolve_promise-908"><span class="linenos">908</span></a><span class="sd">        Returns a Promise with a unique string identifier, if a given Promise is valid, based on the DAG&#39;s current scope.</span>
</span><span id="DAG.resolve_promise-909"><a href="#DAG.resolve_promise-909"><span class="linenos">909</span></a><span class="sd">        Raises `webber.xcoms.InvalidCallable` if Promise requests a callable that is out of scope.</span>
</span><span id="DAG.resolve_promise-910"><a href="#DAG.resolve_promise-910"><span class="linenos">910</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DAG.resolve_promise-911"><a href="#DAG.resolve_promise-911"><span class="linenos">911</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="DAG.resolve_promise-912"><a href="#DAG.resolve_promise-912"><span class="linenos">912</span></a>            <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_id</span><span class="p">(</span><span class="n">promise</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>
</span><span id="DAG.resolve_promise-913"><a href="#DAG.resolve_promise-913"><span class="linenos">913</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="DAG.resolve_promise-914"><a href="#DAG.resolve_promise-914"><span class="linenos">914</span></a>            <span class="k">raise</span> <span class="n">_xcoms</span><span class="o">.</span><span class="n">InvalidCallable</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span id="DAG.resolve_promise-915"><a href="#DAG.resolve_promise-915"><span class="linenos">915</span></a>        <span class="k">return</span> <span class="n">_xcoms</span><span class="o">.</span><span class="n">Promise</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Returns a Promise with a unique string identifier, if a given Promise is valid, based on the DAG's current scope.
Raises <code><a href="xcoms.html#InvalidCallable">webber.xcoms.InvalidCallable</a></code> if Promise requests a callable that is out of scope.</p>
</div>


                            </div>
                </section>
                <section id="DAG.DAGExecutor">
                            <input id="DAG.DAGExecutor-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">DAG.DAGExecutor</span>:

                <label class="view-source-button" for="DAG.DAGExecutor-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DAG.DAGExecutor"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DAG.DAGExecutor-972"><a href="#DAG.DAGExecutor-972"><span class="linenos"> 972</span></a>    <span class="k">class</span><span class="w"> </span><span class="nc">DAGExecutor</span><span class="p">:</span>
</span><span id="DAG.DAGExecutor-973"><a href="#DAG.DAGExecutor-973"><span class="linenos"> 973</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DAG.DAGExecutor-974"><a href="#DAG.DAGExecutor-974"><span class="linenos"> 974</span></a><span class="sd">        Base class used to execute DAG in embarrassingly parallel.</span>
</span><span id="DAG.DAGExecutor-975"><a href="#DAG.DAGExecutor-975"><span class="linenos"> 975</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DAG.DAGExecutor-976"><a href="#DAG.DAGExecutor-976"><span class="linenos"> 976</span></a>        <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="DAG.DAGExecutor-977"><a href="#DAG.DAGExecutor-977"><span class="linenos"> 977</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="DAG.DAGExecutor-978"><a href="#DAG.DAGExecutor-978"><span class="linenos"> 978</span></a>            <span class="n">graph</span><span class="p">:</span> <span class="n">_nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">,</span>
</span><span id="DAG.DAGExecutor-979"><a href="#DAG.DAGExecutor-979"><span class="linenos"> 979</span></a>            <span class="n">roots</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="DAG.DAGExecutor-980"><a href="#DAG.DAGExecutor-980"><span class="linenos"> 980</span></a>            <span class="n">print_exc</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="DAG.DAGExecutor-981"><a href="#DAG.DAGExecutor-981"><span class="linenos"> 981</span></a>            <span class="n">max_workers</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="DAG.DAGExecutor-982"><a href="#DAG.DAGExecutor-982"><span class="linenos"> 982</span></a>            <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="DAG.DAGExecutor-983"><a href="#DAG.DAGExecutor-983"><span class="linenos"> 983</span></a>        <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DAG.DAGExecutor-984"><a href="#DAG.DAGExecutor-984"><span class="linenos"> 984</span></a>
</span><span id="DAG.DAGExecutor-985"><a href="#DAG.DAGExecutor-985"><span class="linenos"> 985</span></a>            <span class="c1"># Skip execution if there are no callables in scope.</span>
</span><span id="DAG.DAGExecutor-986"><a href="#DAG.DAGExecutor-986"><span class="linenos"> 986</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="DAG.DAGExecutor-987"><a href="#DAG.DAGExecutor-987"><span class="linenos"> 987</span></a>                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="DAG.DAGExecutor-988"><a href="#DAG.DAGExecutor-988"><span class="linenos"> 988</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Given DAG has no callables in scope. Skipping execution...&#39;</span><span class="p">)</span>
</span><span id="DAG.DAGExecutor-989"><a href="#DAG.DAGExecutor-989"><span class="linenos"> 989</span></a>                <span class="k">return</span>
</span><span id="DAG.DAGExecutor-990"><a href="#DAG.DAGExecutor-990"><span class="linenos"> 990</span></a>
</span><span id="DAG.DAGExecutor-991"><a href="#DAG.DAGExecutor-991"><span class="linenos"> 991</span></a>            <span class="c1"># Initialize local variables for execution.</span>
</span><span id="DAG.DAGExecutor-992"><a href="#DAG.DAGExecutor-992"><span class="linenos"> 992</span></a>            <span class="n">complete</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="DAG.DAGExecutor-993"><a href="#DAG.DAGExecutor-993"><span class="linenos"> 993</span></a>            <span class="n">started</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="DAG.DAGExecutor-994"><a href="#DAG.DAGExecutor-994"><span class="linenos"> 994</span></a>            <span class="n">failed</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="DAG.DAGExecutor-995"><a href="#DAG.DAGExecutor-995"><span class="linenos"> 995</span></a>            <span class="n">skipped</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="DAG.DAGExecutor-996"><a href="#DAG.DAGExecutor-996"><span class="linenos"> 996</span></a>            <span class="n">refs</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_futures</span><span class="o">.</span><span class="n">Future</span><span class="p">[</span><span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="DAG.DAGExecutor-997"><a href="#DAG.DAGExecutor-997"><span class="linenos"> 997</span></a>
</span><span id="DAG.DAGExecutor-998"><a href="#DAG.DAGExecutor-998"><span class="linenos"> 998</span></a>            <span class="k">def</span><span class="w"> </span><span class="nf">raise_exc</span><span class="p">(</span><span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DAG.DAGExecutor-999"><a href="#DAG.DAGExecutor-999"><span class="linenos"> 999</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</span><span id="DAG.DAGExecutor-1000"><a href="#DAG.DAGExecutor-1000"><span class="linenos">1000</span></a>
</span><span id="DAG.DAGExecutor-1001"><a href="#DAG.DAGExecutor-1001"><span class="linenos">1001</span></a>            <span class="k">def</span><span class="w"> </span><span class="nf">run_conditions_met</span><span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="DAG.DAGExecutor-1002"><a href="#DAG.DAGExecutor-1002"><span class="linenos">1002</span></a>                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">predecessors</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
</span><span id="DAG.DAGExecutor-1003"><a href="#DAG.DAGExecutor-1003"><span class="linenos">1003</span></a>                    <span class="k">match</span> <span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">[(</span><span class="n">p</span><span class="p">,</span> <span class="n">n</span><span class="p">)][</span><span class="s1">&#39;Condition&#39;</span><span class="p">]:</span>
</span><span id="DAG.DAGExecutor-1004"><a href="#DAG.DAGExecutor-1004"><span class="linenos">1004</span></a>                        <span class="k">case</span> <span class="n">Condition</span><span class="o">.</span><span class="n">Success</span><span class="p">:</span>
</span><span id="DAG.DAGExecutor-1005"><a href="#DAG.DAGExecutor-1005"><span class="linenos">1005</span></a>                            <span class="k">if</span> <span class="n">p</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">complete</span><span class="p">:</span>
</span><span id="DAG.DAGExecutor-1006"><a href="#DAG.DAGExecutor-1006"><span class="linenos">1006</span></a>                                <span class="k">return</span> <span class="kc">False</span>
</span><span id="DAG.DAGExecutor-1007"><a href="#DAG.DAGExecutor-1007"><span class="linenos">1007</span></a>                        <span class="k">case</span> <span class="n">Condition</span><span class="o">.</span><span class="n">Failure</span><span class="p">:</span>
</span><span id="DAG.DAGExecutor-1008"><a href="#DAG.DAGExecutor-1008"><span class="linenos">1008</span></a>                            <span class="k">if</span> <span class="n">p</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">failed</span><span class="p">:</span>
</span><span id="DAG.DAGExecutor-1009"><a href="#DAG.DAGExecutor-1009"><span class="linenos">1009</span></a>                                <span class="k">return</span> <span class="kc">False</span>
</span><span id="DAG.DAGExecutor-1010"><a href="#DAG.DAGExecutor-1010"><span class="linenos">1010</span></a>                        <span class="k">case</span> <span class="n">Condition</span><span class="o">.</span><span class="n">AnyCase</span><span class="p">:</span>
</span><span id="DAG.DAGExecutor-1011"><a href="#DAG.DAGExecutor-1011"><span class="linenos">1011</span></a>                            <span class="k">if</span> <span class="n">p</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">failed</span> <span class="ow">and</span> <span class="n">p</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">complete</span><span class="p">:</span>
</span><span id="DAG.DAGExecutor-1012"><a href="#DAG.DAGExecutor-1012"><span class="linenos">1012</span></a>                                <span class="k">return</span> <span class="kc">False</span>
</span><span id="DAG.DAGExecutor-1013"><a href="#DAG.DAGExecutor-1013"><span class="linenos">1013</span></a>                <span class="k">return</span> <span class="kc">True</span>
</span><span id="DAG.DAGExecutor-1014"><a href="#DAG.DAGExecutor-1014"><span class="linenos">1014</span></a>
</span><span id="DAG.DAGExecutor-1015"><a href="#DAG.DAGExecutor-1015"><span class="linenos">1015</span></a>            <span class="n">skip</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="s2">&quot;skip&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
</span><span id="DAG.DAGExecutor-1016"><a href="#DAG.DAGExecutor-1016"><span class="linenos">1016</span></a>            <span class="n">retry</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_T</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="DAG.DAGExecutor-1017"><a href="#DAG.DAGExecutor-1017"><span class="linenos">1017</span></a>                <span class="n">n</span><span class="p">:</span> <span class="p">[</span><span class="n">c</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="p">{}]</span> <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="s2">&quot;retry&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="DAG.DAGExecutor-1018"><a href="#DAG.DAGExecutor-1018"><span class="linenos">1018</span></a>            <span class="p">}</span>
</span><span id="DAG.DAGExecutor-1019"><a href="#DAG.DAGExecutor-1019"><span class="linenos">1019</span></a>
</span><span id="DAG.DAGExecutor-1020"><a href="#DAG.DAGExecutor-1020"><span class="linenos">1020</span></a>            <span class="c1"># Start execution of root node functions.</span>
</span><span id="DAG.DAGExecutor-1021"><a href="#DAG.DAGExecutor-1021"><span class="linenos">1021</span></a>            <span class="k">with</span> <span class="n">_futures</span><span class="o">.</span><span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="n">max_workers</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
</span><span id="DAG.DAGExecutor-1022"><a href="#DAG.DAGExecutor-1022"><span class="linenos">1022</span></a>
</span><span id="DAG.DAGExecutor-1023"><a href="#DAG.DAGExecutor-1023"><span class="linenos">1023</span></a>                <span class="k">def</span><span class="w"> </span><span class="nf">Submit</span><span class="p">(</span>
</span><span id="DAG.DAGExecutor-1024"><a href="#DAG.DAGExecutor-1024"><span class="linenos">1024</span></a>                    <span class="n">event</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="DAG.DAGExecutor-1025"><a href="#DAG.DAGExecutor-1025"><span class="linenos">1025</span></a>                    <span class="nb">callable</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">],</span>
</span><span id="DAG.DAGExecutor-1026"><a href="#DAG.DAGExecutor-1026"><span class="linenos">1026</span></a>                    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="DAG.DAGExecutor-1027"><a href="#DAG.DAGExecutor-1027"><span class="linenos">1027</span></a>                    <span class="n">args</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="nb">list</span><span class="p">[</span><span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">]],</span>
</span><span id="DAG.DAGExecutor-1028"><a href="#DAG.DAGExecutor-1028"><span class="linenos">1028</span></a>                    <span class="n">kwargs</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span>
</span><span id="DAG.DAGExecutor-1029"><a href="#DAG.DAGExecutor-1029"><span class="linenos">1029</span></a>                <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_futures</span><span class="o">.</span><span class="n">Future</span><span class="p">[</span><span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">]:</span>
</span><span id="DAG.DAGExecutor-1030"><a href="#DAG.DAGExecutor-1030"><span class="linenos">1030</span></a>                    <span class="k">if</span> <span class="n">skip</span><span class="p">[</span><span class="n">event</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
</span><span id="DAG.DAGExecutor-1031"><a href="#DAG.DAGExecutor-1031"><span class="linenos">1031</span></a>                        <span class="n">retry</span><span class="p">[</span><span class="n">event</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="DAG.DAGExecutor-1032"><a href="#DAG.DAGExecutor-1032"><span class="linenos">1032</span></a>                        <span class="n">skip_callable</span> <span class="o">=</span> <span class="n">raise_exc</span> <span class="k">if</span> <span class="n">skip</span><span class="p">[</span><span class="n">event</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="k">else</span> <span class="nb">print</span>
</span><span id="DAG.DAGExecutor-1033"><a href="#DAG.DAGExecutor-1033"><span class="linenos">1033</span></a>                        <span class="k">return</span> <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span>
</span><span id="DAG.DAGExecutor-1034"><a href="#DAG.DAGExecutor-1034"><span class="linenos">1034</span></a>                            <span class="n">_event_wrapper</span><span class="p">,</span>
</span><span id="DAG.DAGExecutor-1035"><a href="#DAG.DAGExecutor-1035"><span class="linenos">1035</span></a>                            <span class="n">_callable</span><span class="o">=</span><span class="n">skip_callable</span><span class="p">,</span>
</span><span id="DAG.DAGExecutor-1036"><a href="#DAG.DAGExecutor-1036"><span class="linenos">1036</span></a>                            <span class="n">_name</span><span class="o">=</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">event</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
</span><span id="DAG.DAGExecutor-1037"><a href="#DAG.DAGExecutor-1037"><span class="linenos">1037</span></a>                            <span class="n">_args</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Event </span><span class="si">{</span><span class="n">event</span><span class="si">}</span><span class="s2"> skipped...&quot;</span><span class="p">],</span>
</span><span id="DAG.DAGExecutor-1038"><a href="#DAG.DAGExecutor-1038"><span class="linenos">1038</span></a>                            <span class="n">_kwargs</span><span class="o">=</span><span class="p">{},</span>
</span><span id="DAG.DAGExecutor-1039"><a href="#DAG.DAGExecutor-1039"><span class="linenos">1039</span></a>                            <span class="n">_verbose</span><span class="o">=</span><span class="n">verbose</span>
</span><span id="DAG.DAGExecutor-1040"><a href="#DAG.DAGExecutor-1040"><span class="linenos">1040</span></a>                        <span class="p">)</span>
</span><span id="DAG.DAGExecutor-1041"><a href="#DAG.DAGExecutor-1041"><span class="linenos">1041</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="DAG.DAGExecutor-1042"><a href="#DAG.DAGExecutor-1042"><span class="linenos">1042</span></a>                        <span class="n">retry</span><span class="p">[</span><span class="n">event</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>
</span><span id="DAG.DAGExecutor-1043"><a href="#DAG.DAGExecutor-1043"><span class="linenos">1043</span></a>                        <span class="k">if</span> <span class="p">(</span><span class="n">retry</span><span class="p">[</span><span class="n">event</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">retry</span><span class="p">[</span><span class="n">event</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="p">{}):</span>
</span><span id="DAG.DAGExecutor-1044"><a href="#DAG.DAGExecutor-1044"><span class="linenos">1044</span></a>                            <span class="n">retry</span><span class="p">[</span><span class="n">event</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="DAG.DAGExecutor-1045"><a href="#DAG.DAGExecutor-1045"><span class="linenos">1045</span></a>                                <span class="s1">&#39;callable&#39;</span><span class="p">:</span> <span class="nb">callable</span><span class="p">,</span>
</span><span id="DAG.DAGExecutor-1046"><a href="#DAG.DAGExecutor-1046"><span class="linenos">1046</span></a>                                <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
</span><span id="DAG.DAGExecutor-1047"><a href="#DAG.DAGExecutor-1047"><span class="linenos">1047</span></a>                                <span class="s1">&#39;args&#39;</span><span class="p">:</span> <span class="n">args</span><span class="p">,</span>
</span><span id="DAG.DAGExecutor-1048"><a href="#DAG.DAGExecutor-1048"><span class="linenos">1048</span></a>                                <span class="s1">&#39;kwargs&#39;</span><span class="p">:</span> <span class="n">kwargs</span>
</span><span id="DAG.DAGExecutor-1049"><a href="#DAG.DAGExecutor-1049"><span class="linenos">1049</span></a>                            <span class="p">}</span>
</span><span id="DAG.DAGExecutor-1050"><a href="#DAG.DAGExecutor-1050"><span class="linenos">1050</span></a>                        <span class="k">return</span> <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span>
</span><span id="DAG.DAGExecutor-1051"><a href="#DAG.DAGExecutor-1051"><span class="linenos">1051</span></a>                            <span class="n">_event_wrapper</span><span class="p">,</span>
</span><span id="DAG.DAGExecutor-1052"><a href="#DAG.DAGExecutor-1052"><span class="linenos">1052</span></a>                            <span class="n">_callable</span><span class="o">=</span><span class="nb">callable</span><span class="p">,</span>
</span><span id="DAG.DAGExecutor-1053"><a href="#DAG.DAGExecutor-1053"><span class="linenos">1053</span></a>                            <span class="n">_name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span id="DAG.DAGExecutor-1054"><a href="#DAG.DAGExecutor-1054"><span class="linenos">1054</span></a>                            <span class="n">_args</span><span class="o">=</span><span class="n">args</span><span class="p">,</span>
</span><span id="DAG.DAGExecutor-1055"><a href="#DAG.DAGExecutor-1055"><span class="linenos">1055</span></a>                            <span class="n">_kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="DAG.DAGExecutor-1056"><a href="#DAG.DAGExecutor-1056"><span class="linenos">1056</span></a>                            <span class="n">_verbose</span><span class="o">=</span><span class="n">verbose</span>
</span><span id="DAG.DAGExecutor-1057"><a href="#DAG.DAGExecutor-1057"><span class="linenos">1057</span></a>                        <span class="p">)</span>
</span><span id="DAG.DAGExecutor-1058"><a href="#DAG.DAGExecutor-1058"><span class="linenos">1058</span></a>
</span><span id="DAG.DAGExecutor-1059"><a href="#DAG.DAGExecutor-1059"><span class="linenos">1059</span></a>                <span class="c1"># Submit root nodes</span>
</span><span id="DAG.DAGExecutor-1060"><a href="#DAG.DAGExecutor-1060"><span class="linenos">1060</span></a>                <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">roots</span><span class="p">:</span>
</span><span id="DAG.DAGExecutor-1061"><a href="#DAG.DAGExecutor-1061"><span class="linenos">1061</span></a>                    <span class="n">refs</span><span class="p">[</span><span class="n">event</span><span class="p">]</span> <span class="o">=</span> <span class="n">Submit</span><span class="p">(</span>
</span><span id="DAG.DAGExecutor-1062"><a href="#DAG.DAGExecutor-1062"><span class="linenos">1062</span></a>                        <span class="n">event</span><span class="p">,</span>
</span><span id="DAG.DAGExecutor-1063"><a href="#DAG.DAGExecutor-1063"><span class="linenos">1063</span></a>                        <span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">event</span><span class="p">][</span><span class="s1">&#39;callable&#39;</span><span class="p">],</span>
</span><span id="DAG.DAGExecutor-1064"><a href="#DAG.DAGExecutor-1064"><span class="linenos">1064</span></a>                        <span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">event</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
</span><span id="DAG.DAGExecutor-1065"><a href="#DAG.DAGExecutor-1065"><span class="linenos">1065</span></a>                        <span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">event</span><span class="p">][</span><span class="s1">&#39;args&#39;</span><span class="p">],</span>
</span><span id="DAG.DAGExecutor-1066"><a href="#DAG.DAGExecutor-1066"><span class="linenos">1066</span></a>                        <span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">event</span><span class="p">][</span><span class="s1">&#39;kwargs&#39;</span><span class="p">]</span>
</span><span id="DAG.DAGExecutor-1067"><a href="#DAG.DAGExecutor-1067"><span class="linenos">1067</span></a>                    <span class="p">)</span>
</span><span id="DAG.DAGExecutor-1068"><a href="#DAG.DAGExecutor-1068"><span class="linenos">1068</span></a>                    <span class="n">started</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
</span><span id="DAG.DAGExecutor-1069"><a href="#DAG.DAGExecutor-1069"><span class="linenos">1069</span></a>
</span><span id="DAG.DAGExecutor-1070"><a href="#DAG.DAGExecutor-1070"><span class="linenos">1070</span></a>                <span class="c1"># Process futures as they complete (no busy-wait)</span>
</span><span id="DAG.DAGExecutor-1071"><a href="#DAG.DAGExecutor-1071"><span class="linenos">1071</span></a>                <span class="n">pending</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">refs</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</span><span id="DAG.DAGExecutor-1072"><a href="#DAG.DAGExecutor-1072"><span class="linenos">1072</span></a>                <span class="n">future_to_event</span> <span class="o">=</span> <span class="p">{</span><span class="n">v</span><span class="p">:</span> <span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">refs</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
</span><span id="DAG.DAGExecutor-1073"><a href="#DAG.DAGExecutor-1073"><span class="linenos">1073</span></a>
</span><span id="DAG.DAGExecutor-1074"><a href="#DAG.DAGExecutor-1074"><span class="linenos">1074</span></a>                <span class="k">while</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">complete</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">failed</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">skipped</span><span class="p">))</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">graph</span><span class="p">):</span>
</span><span id="DAG.DAGExecutor-1075"><a href="#DAG.DAGExecutor-1075"><span class="linenos">1075</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="n">pending</span><span class="p">:</span>
</span><span id="DAG.DAGExecutor-1076"><a href="#DAG.DAGExecutor-1076"><span class="linenos">1076</span></a>                        <span class="k">break</span>
</span><span id="DAG.DAGExecutor-1077"><a href="#DAG.DAGExecutor-1077"><span class="linenos">1077</span></a>
</span><span id="DAG.DAGExecutor-1078"><a href="#DAG.DAGExecutor-1078"><span class="linenos">1078</span></a>                    <span class="c1"># Wait for at least one future to complete</span>
</span><span id="DAG.DAGExecutor-1079"><a href="#DAG.DAGExecutor-1079"><span class="linenos">1079</span></a>                    <span class="n">done</span><span class="p">,</span> <span class="n">pending</span> <span class="o">=</span> <span class="n">_futures</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="n">pending</span><span class="p">,</span> <span class="n">return_when</span><span class="o">=</span><span class="n">_futures</span><span class="o">.</span><span class="n">FIRST_COMPLETED</span><span class="p">)</span>
</span><span id="DAG.DAGExecutor-1080"><a href="#DAG.DAGExecutor-1080"><span class="linenos">1080</span></a>
</span><span id="DAG.DAGExecutor-1081"><a href="#DAG.DAGExecutor-1081"><span class="linenos">1081</span></a>                    <span class="k">for</span> <span class="n">future</span> <span class="ow">in</span> <span class="n">done</span><span class="p">:</span>
</span><span id="DAG.DAGExecutor-1082"><a href="#DAG.DAGExecutor-1082"><span class="linenos">1082</span></a>                        <span class="n">event</span> <span class="o">=</span> <span class="n">future_to_event</span><span class="p">[</span><span class="n">future</span><span class="p">]</span>
</span><span id="DAG.DAGExecutor-1083"><a href="#DAG.DAGExecutor-1083"><span class="linenos">1083</span></a>
</span><span id="DAG.DAGExecutor-1084"><a href="#DAG.DAGExecutor-1084"><span class="linenos">1084</span></a>                        <span class="k">if</span> <span class="n">future</span><span class="o">.</span><span class="n">exception</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DAG.DAGExecutor-1085"><a href="#DAG.DAGExecutor-1085"><span class="linenos">1085</span></a>                            <span class="k">try</span><span class="p">:</span>
</span><span id="DAG.DAGExecutor-1086"><a href="#DAG.DAGExecutor-1086"><span class="linenos">1086</span></a>                                <span class="k">raise</span> <span class="n">future</span><span class="o">.</span><span class="n">exception</span><span class="p">()</span>  <span class="c1"># type: ignore</span>
</span><span id="DAG.DAGExecutor-1087"><a href="#DAG.DAGExecutor-1087"><span class="linenos">1087</span></a>                            <span class="k">except</span><span class="p">:</span>
</span><span id="DAG.DAGExecutor-1088"><a href="#DAG.DAGExecutor-1088"><span class="linenos">1088</span></a>                                <span class="k">if</span> <span class="n">print_exc</span><span class="p">:</span>
</span><span id="DAG.DAGExecutor-1089"><a href="#DAG.DAGExecutor-1089"><span class="linenos">1089</span></a>                                    <span class="n">_traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
</span><span id="DAG.DAGExecutor-1090"><a href="#DAG.DAGExecutor-1090"><span class="linenos">1090</span></a>
</span><span id="DAG.DAGExecutor-1091"><a href="#DAG.DAGExecutor-1091"><span class="linenos">1091</span></a>                                <span class="k">if</span> <span class="n">retry</span><span class="p">[</span><span class="n">event</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="DAG.DAGExecutor-1092"><a href="#DAG.DAGExecutor-1092"><span class="linenos">1092</span></a>                                    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="DAG.DAGExecutor-1093"><a href="#DAG.DAGExecutor-1093"><span class="linenos">1093</span></a>                                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Event </span><span class="si">{</span><span class="n">event</span><span class="si">}</span><span class="s2"> exited with exception, retrying...&quot;</span><span class="p">)</span>
</span><span id="DAG.DAGExecutor-1094"><a href="#DAG.DAGExecutor-1094"><span class="linenos">1094</span></a>                                    <span class="n">new_future</span> <span class="o">=</span> <span class="n">Submit</span><span class="p">(</span>
</span><span id="DAG.DAGExecutor-1095"><a href="#DAG.DAGExecutor-1095"><span class="linenos">1095</span></a>                                        <span class="n">event</span><span class="p">,</span>
</span><span id="DAG.DAGExecutor-1096"><a href="#DAG.DAGExecutor-1096"><span class="linenos">1096</span></a>                                        <span class="nb">callable</span><span class="o">=</span><span class="n">retry</span><span class="p">[</span><span class="n">event</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;callable&#39;</span><span class="p">],</span>
</span><span id="DAG.DAGExecutor-1097"><a href="#DAG.DAGExecutor-1097"><span class="linenos">1097</span></a>                                        <span class="n">name</span><span class="o">=</span><span class="n">retry</span><span class="p">[</span><span class="n">event</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
</span><span id="DAG.DAGExecutor-1098"><a href="#DAG.DAGExecutor-1098"><span class="linenos">1098</span></a>                                        <span class="n">args</span><span class="o">=</span><span class="n">retry</span><span class="p">[</span><span class="n">event</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;args&#39;</span><span class="p">],</span>
</span><span id="DAG.DAGExecutor-1099"><a href="#DAG.DAGExecutor-1099"><span class="linenos">1099</span></a>                                        <span class="n">kwargs</span><span class="o">=</span><span class="n">retry</span><span class="p">[</span><span class="n">event</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;kwargs&#39;</span><span class="p">]</span>
</span><span id="DAG.DAGExecutor-1100"><a href="#DAG.DAGExecutor-1100"><span class="linenos">1100</span></a>                                    <span class="p">)</span>
</span><span id="DAG.DAGExecutor-1101"><a href="#DAG.DAGExecutor-1101"><span class="linenos">1101</span></a>                                    <span class="n">refs</span><span class="p">[</span><span class="n">event</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_future</span>
</span><span id="DAG.DAGExecutor-1102"><a href="#DAG.DAGExecutor-1102"><span class="linenos">1102</span></a>                                    <span class="n">pending</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">new_future</span><span class="p">)</span>
</span><span id="DAG.DAGExecutor-1103"><a href="#DAG.DAGExecutor-1103"><span class="linenos">1103</span></a>                                    <span class="n">future_to_event</span><span class="p">[</span><span class="n">new_future</span><span class="p">]</span> <span class="o">=</span> <span class="n">event</span>
</span><span id="DAG.DAGExecutor-1104"><a href="#DAG.DAGExecutor-1104"><span class="linenos">1104</span></a>                                    <span class="k">continue</span>
</span><span id="DAG.DAGExecutor-1105"><a href="#DAG.DAGExecutor-1105"><span class="linenos">1105</span></a>
</span><span id="DAG.DAGExecutor-1106"><a href="#DAG.DAGExecutor-1106"><span class="linenos">1106</span></a>                                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="DAG.DAGExecutor-1107"><a href="#DAG.DAGExecutor-1107"><span class="linenos">1107</span></a>                                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Event </span><span class="si">{</span><span class="n">event</span><span class="si">}</span><span class="s2"> exited with exception...&quot;</span><span class="p">)</span>
</span><span id="DAG.DAGExecutor-1108"><a href="#DAG.DAGExecutor-1108"><span class="linenos">1108</span></a>                                <span class="n">failed</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
</span><span id="DAG.DAGExecutor-1109"><a href="#DAG.DAGExecutor-1109"><span class="linenos">1109</span></a>                                <span class="n">skipping</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="DAG.DAGExecutor-1110"><a href="#DAG.DAGExecutor-1110"><span class="linenos">1110</span></a>                                    <span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">out_edges</span><span class="p">(</span><span class="n">event</span><span class="p">))</span>
</span><span id="DAG.DAGExecutor-1111"><a href="#DAG.DAGExecutor-1111"><span class="linenos">1111</span></a>                                    <span class="k">if</span> <span class="ow">not</span> <span class="n">_edges</span><span class="o">.</span><span class="n">continue_on_failure</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">e</span><span class="p">])</span>
</span><span id="DAG.DAGExecutor-1112"><a href="#DAG.DAGExecutor-1112"><span class="linenos">1112</span></a>                                <span class="p">]</span>
</span><span id="DAG.DAGExecutor-1113"><a href="#DAG.DAGExecutor-1113"><span class="linenos">1113</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="DAG.DAGExecutor-1114"><a href="#DAG.DAGExecutor-1114"><span class="linenos">1114</span></a>                            <span class="n">complete</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
</span><span id="DAG.DAGExecutor-1115"><a href="#DAG.DAGExecutor-1115"><span class="linenos">1115</span></a>                            <span class="n">skipping</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="DAG.DAGExecutor-1116"><a href="#DAG.DAGExecutor-1116"><span class="linenos">1116</span></a>                                <span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">out_edges</span><span class="p">(</span><span class="n">event</span><span class="p">))</span>
</span><span id="DAG.DAGExecutor-1117"><a href="#DAG.DAGExecutor-1117"><span class="linenos">1117</span></a>                                <span class="k">if</span> <span class="ow">not</span> <span class="n">_edges</span><span class="o">.</span><span class="n">continue_on_success</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">e</span><span class="p">])</span>
</span><span id="DAG.DAGExecutor-1118"><a href="#DAG.DAGExecutor-1118"><span class="linenos">1118</span></a>                            <span class="p">]</span>
</span><span id="DAG.DAGExecutor-1119"><a href="#DAG.DAGExecutor-1119"><span class="linenos">1119</span></a>
</span><span id="DAG.DAGExecutor-1120"><a href="#DAG.DAGExecutor-1120"><span class="linenos">1120</span></a>                        <span class="n">skipped</span> <span class="o">=</span> <span class="n">skipped</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">skipping</span><span class="p">)</span>
</span><span id="DAG.DAGExecutor-1121"><a href="#DAG.DAGExecutor-1121"><span class="linenos">1121</span></a>                        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">skipping</span><span class="p">:</span>
</span><span id="DAG.DAGExecutor-1122"><a href="#DAG.DAGExecutor-1122"><span class="linenos">1122</span></a>                            <span class="n">skipped</span> <span class="o">=</span> <span class="n">skipped</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">_nx</span><span class="o">.</span><span class="n">descendants</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
</span><span id="DAG.DAGExecutor-1123"><a href="#DAG.DAGExecutor-1123"><span class="linenos">1123</span></a>
</span><span id="DAG.DAGExecutor-1124"><a href="#DAG.DAGExecutor-1124"><span class="linenos">1124</span></a>                        <span class="n">carryon</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">successors</span><span class="p">(</span><span class="n">event</span><span class="p">))</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">skipped</span><span class="p">)</span>
</span><span id="DAG.DAGExecutor-1125"><a href="#DAG.DAGExecutor-1125"><span class="linenos">1125</span></a>                        <span class="n">starting</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="DAG.DAGExecutor-1126"><a href="#DAG.DAGExecutor-1126"><span class="linenos">1126</span></a>                            <span class="n">successor</span> <span class="k">for</span> <span class="n">successor</span> <span class="ow">in</span> <span class="n">carryon</span>
</span><span id="DAG.DAGExecutor-1127"><a href="#DAG.DAGExecutor-1127"><span class="linenos">1127</span></a>                            <span class="k">if</span> <span class="n">run_conditions_met</span><span class="p">(</span><span class="n">successor</span><span class="p">)</span>
</span><span id="DAG.DAGExecutor-1128"><a href="#DAG.DAGExecutor-1128"><span class="linenos">1128</span></a>                        <span class="p">]</span>
</span><span id="DAG.DAGExecutor-1129"><a href="#DAG.DAGExecutor-1129"><span class="linenos">1129</span></a>
</span><span id="DAG.DAGExecutor-1130"><a href="#DAG.DAGExecutor-1130"><span class="linenos">1130</span></a>                        <span class="k">for</span> <span class="n">successor</span> <span class="ow">in</span> <span class="n">starting</span><span class="p">:</span>
</span><span id="DAG.DAGExecutor-1131"><a href="#DAG.DAGExecutor-1131"><span class="linenos">1131</span></a>                            <span class="n">_args</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="DAG.DAGExecutor-1132"><a href="#DAG.DAGExecutor-1132"><span class="linenos">1132</span></a>                                <span class="n">a</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">_xcoms</span><span class="o">.</span><span class="n">Promise</span><span class="p">)</span> <span class="k">else</span> <span class="n">refs</span><span class="p">[</span><span class="n">_T</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">key</span><span class="p">)]</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
</span><span id="DAG.DAGExecutor-1133"><a href="#DAG.DAGExecutor-1133"><span class="linenos">1133</span></a>                                <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">successor</span><span class="p">][</span><span class="s1">&#39;args&#39;</span><span class="p">]</span>
</span><span id="DAG.DAGExecutor-1134"><a href="#DAG.DAGExecutor-1134"><span class="linenos">1134</span></a>                            <span class="p">]</span>
</span><span id="DAG.DAGExecutor-1135"><a href="#DAG.DAGExecutor-1135"><span class="linenos">1135</span></a>                            <span class="n">_kwargs</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="DAG.DAGExecutor-1136"><a href="#DAG.DAGExecutor-1136"><span class="linenos">1136</span></a>                                <span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">_xcoms</span><span class="o">.</span><span class="n">Promise</span><span class="p">)</span> <span class="k">else</span> <span class="n">refs</span><span class="p">[</span><span class="n">_T</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">key</span><span class="p">)]</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
</span><span id="DAG.DAGExecutor-1137"><a href="#DAG.DAGExecutor-1137"><span class="linenos">1137</span></a>                                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">successor</span><span class="p">][</span><span class="s1">&#39;kwargs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="DAG.DAGExecutor-1138"><a href="#DAG.DAGExecutor-1138"><span class="linenos">1138</span></a>                            <span class="p">}</span>
</span><span id="DAG.DAGExecutor-1139"><a href="#DAG.DAGExecutor-1139"><span class="linenos">1139</span></a>                            <span class="n">new_future</span> <span class="o">=</span> <span class="n">Submit</span><span class="p">(</span>
</span><span id="DAG.DAGExecutor-1140"><a href="#DAG.DAGExecutor-1140"><span class="linenos">1140</span></a>                                <span class="n">successor</span><span class="p">,</span>
</span><span id="DAG.DAGExecutor-1141"><a href="#DAG.DAGExecutor-1141"><span class="linenos">1141</span></a>                                <span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">successor</span><span class="p">][</span><span class="s1">&#39;callable&#39;</span><span class="p">],</span>
</span><span id="DAG.DAGExecutor-1142"><a href="#DAG.DAGExecutor-1142"><span class="linenos">1142</span></a>                                <span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">successor</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
</span><span id="DAG.DAGExecutor-1143"><a href="#DAG.DAGExecutor-1143"><span class="linenos">1143</span></a>                                <span class="n">_args</span><span class="p">,</span>
</span><span id="DAG.DAGExecutor-1144"><a href="#DAG.DAGExecutor-1144"><span class="linenos">1144</span></a>                                <span class="n">_kwargs</span>
</span><span id="DAG.DAGExecutor-1145"><a href="#DAG.DAGExecutor-1145"><span class="linenos">1145</span></a>                            <span class="p">)</span>
</span><span id="DAG.DAGExecutor-1146"><a href="#DAG.DAGExecutor-1146"><span class="linenos">1146</span></a>                            <span class="n">refs</span><span class="p">[</span><span class="n">successor</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_future</span>
</span><span id="DAG.DAGExecutor-1147"><a href="#DAG.DAGExecutor-1147"><span class="linenos">1147</span></a>                            <span class="n">pending</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">new_future</span><span class="p">)</span>
</span><span id="DAG.DAGExecutor-1148"><a href="#DAG.DAGExecutor-1148"><span class="linenos">1148</span></a>                            <span class="n">future_to_event</span><span class="p">[</span><span class="n">new_future</span><span class="p">]</span> <span class="o">=</span> <span class="n">successor</span>
</span><span id="DAG.DAGExecutor-1149"><a href="#DAG.DAGExecutor-1149"><span class="linenos">1149</span></a>                            <span class="n">started</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">successor</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Base class used to execute DAG in embarrassingly parallel.</p>
</div>


                            <div id="DAG.DAGExecutor.__init__" class="classattr">
                                        <input id="DAG.DAGExecutor.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">DAG.DAGExecutor</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">graph</span><span class="p">:</span> <span class="n">networkx</span><span class="o">.</span><span class="n">classes</span><span class="o">.</span><span class="n">digraph</span><span class="o">.</span><span class="n">DiGraph</span>,</span><span class="param">	<span class="n">roots</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>,</span><span class="param">	<span class="n">print_exc</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">max_workers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span></span>)</span>

                <label class="view-source-button" for="DAG.DAGExecutor.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DAG.DAGExecutor.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DAG.DAGExecutor.__init__-976"><a href="#DAG.DAGExecutor.__init__-976"><span class="linenos"> 976</span></a>        <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="DAG.DAGExecutor.__init__-977"><a href="#DAG.DAGExecutor.__init__-977"><span class="linenos"> 977</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="DAG.DAGExecutor.__init__-978"><a href="#DAG.DAGExecutor.__init__-978"><span class="linenos"> 978</span></a>            <span class="n">graph</span><span class="p">:</span> <span class="n">_nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">,</span>
</span><span id="DAG.DAGExecutor.__init__-979"><a href="#DAG.DAGExecutor.__init__-979"><span class="linenos"> 979</span></a>            <span class="n">roots</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="DAG.DAGExecutor.__init__-980"><a href="#DAG.DAGExecutor.__init__-980"><span class="linenos"> 980</span></a>            <span class="n">print_exc</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="DAG.DAGExecutor.__init__-981"><a href="#DAG.DAGExecutor.__init__-981"><span class="linenos"> 981</span></a>            <span class="n">max_workers</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="DAG.DAGExecutor.__init__-982"><a href="#DAG.DAGExecutor.__init__-982"><span class="linenos"> 982</span></a>            <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="DAG.DAGExecutor.__init__-983"><a href="#DAG.DAGExecutor.__init__-983"><span class="linenos"> 983</span></a>        <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DAG.DAGExecutor.__init__-984"><a href="#DAG.DAGExecutor.__init__-984"><span class="linenos"> 984</span></a>
</span><span id="DAG.DAGExecutor.__init__-985"><a href="#DAG.DAGExecutor.__init__-985"><span class="linenos"> 985</span></a>            <span class="c1"># Skip execution if there are no callables in scope.</span>
</span><span id="DAG.DAGExecutor.__init__-986"><a href="#DAG.DAGExecutor.__init__-986"><span class="linenos"> 986</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="DAG.DAGExecutor.__init__-987"><a href="#DAG.DAGExecutor.__init__-987"><span class="linenos"> 987</span></a>                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="DAG.DAGExecutor.__init__-988"><a href="#DAG.DAGExecutor.__init__-988"><span class="linenos"> 988</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Given DAG has no callables in scope. Skipping execution...&#39;</span><span class="p">)</span>
</span><span id="DAG.DAGExecutor.__init__-989"><a href="#DAG.DAGExecutor.__init__-989"><span class="linenos"> 989</span></a>                <span class="k">return</span>
</span><span id="DAG.DAGExecutor.__init__-990"><a href="#DAG.DAGExecutor.__init__-990"><span class="linenos"> 990</span></a>
</span><span id="DAG.DAGExecutor.__init__-991"><a href="#DAG.DAGExecutor.__init__-991"><span class="linenos"> 991</span></a>            <span class="c1"># Initialize local variables for execution.</span>
</span><span id="DAG.DAGExecutor.__init__-992"><a href="#DAG.DAGExecutor.__init__-992"><span class="linenos"> 992</span></a>            <span class="n">complete</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="DAG.DAGExecutor.__init__-993"><a href="#DAG.DAGExecutor.__init__-993"><span class="linenos"> 993</span></a>            <span class="n">started</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="DAG.DAGExecutor.__init__-994"><a href="#DAG.DAGExecutor.__init__-994"><span class="linenos"> 994</span></a>            <span class="n">failed</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="DAG.DAGExecutor.__init__-995"><a href="#DAG.DAGExecutor.__init__-995"><span class="linenos"> 995</span></a>            <span class="n">skipped</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="DAG.DAGExecutor.__init__-996"><a href="#DAG.DAGExecutor.__init__-996"><span class="linenos"> 996</span></a>            <span class="n">refs</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_futures</span><span class="o">.</span><span class="n">Future</span><span class="p">[</span><span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="DAG.DAGExecutor.__init__-997"><a href="#DAG.DAGExecutor.__init__-997"><span class="linenos"> 997</span></a>
</span><span id="DAG.DAGExecutor.__init__-998"><a href="#DAG.DAGExecutor.__init__-998"><span class="linenos"> 998</span></a>            <span class="k">def</span><span class="w"> </span><span class="nf">raise_exc</span><span class="p">(</span><span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DAG.DAGExecutor.__init__-999"><a href="#DAG.DAGExecutor.__init__-999"><span class="linenos"> 999</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</span><span id="DAG.DAGExecutor.__init__-1000"><a href="#DAG.DAGExecutor.__init__-1000"><span class="linenos">1000</span></a>
</span><span id="DAG.DAGExecutor.__init__-1001"><a href="#DAG.DAGExecutor.__init__-1001"><span class="linenos">1001</span></a>            <span class="k">def</span><span class="w"> </span><span class="nf">run_conditions_met</span><span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="DAG.DAGExecutor.__init__-1002"><a href="#DAG.DAGExecutor.__init__-1002"><span class="linenos">1002</span></a>                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">predecessors</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
</span><span id="DAG.DAGExecutor.__init__-1003"><a href="#DAG.DAGExecutor.__init__-1003"><span class="linenos">1003</span></a>                    <span class="k">match</span> <span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">[(</span><span class="n">p</span><span class="p">,</span> <span class="n">n</span><span class="p">)][</span><span class="s1">&#39;Condition&#39;</span><span class="p">]:</span>
</span><span id="DAG.DAGExecutor.__init__-1004"><a href="#DAG.DAGExecutor.__init__-1004"><span class="linenos">1004</span></a>                        <span class="k">case</span> <span class="n">Condition</span><span class="o">.</span><span class="n">Success</span><span class="p">:</span>
</span><span id="DAG.DAGExecutor.__init__-1005"><a href="#DAG.DAGExecutor.__init__-1005"><span class="linenos">1005</span></a>                            <span class="k">if</span> <span class="n">p</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">complete</span><span class="p">:</span>
</span><span id="DAG.DAGExecutor.__init__-1006"><a href="#DAG.DAGExecutor.__init__-1006"><span class="linenos">1006</span></a>                                <span class="k">return</span> <span class="kc">False</span>
</span><span id="DAG.DAGExecutor.__init__-1007"><a href="#DAG.DAGExecutor.__init__-1007"><span class="linenos">1007</span></a>                        <span class="k">case</span> <span class="n">Condition</span><span class="o">.</span><span class="n">Failure</span><span class="p">:</span>
</span><span id="DAG.DAGExecutor.__init__-1008"><a href="#DAG.DAGExecutor.__init__-1008"><span class="linenos">1008</span></a>                            <span class="k">if</span> <span class="n">p</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">failed</span><span class="p">:</span>
</span><span id="DAG.DAGExecutor.__init__-1009"><a href="#DAG.DAGExecutor.__init__-1009"><span class="linenos">1009</span></a>                                <span class="k">return</span> <span class="kc">False</span>
</span><span id="DAG.DAGExecutor.__init__-1010"><a href="#DAG.DAGExecutor.__init__-1010"><span class="linenos">1010</span></a>                        <span class="k">case</span> <span class="n">Condition</span><span class="o">.</span><span class="n">AnyCase</span><span class="p">:</span>
</span><span id="DAG.DAGExecutor.__init__-1011"><a href="#DAG.DAGExecutor.__init__-1011"><span class="linenos">1011</span></a>                            <span class="k">if</span> <span class="n">p</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">failed</span> <span class="ow">and</span> <span class="n">p</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">complete</span><span class="p">:</span>
</span><span id="DAG.DAGExecutor.__init__-1012"><a href="#DAG.DAGExecutor.__init__-1012"><span class="linenos">1012</span></a>                                <span class="k">return</span> <span class="kc">False</span>
</span><span id="DAG.DAGExecutor.__init__-1013"><a href="#DAG.DAGExecutor.__init__-1013"><span class="linenos">1013</span></a>                <span class="k">return</span> <span class="kc">True</span>
</span><span id="DAG.DAGExecutor.__init__-1014"><a href="#DAG.DAGExecutor.__init__-1014"><span class="linenos">1014</span></a>
</span><span id="DAG.DAGExecutor.__init__-1015"><a href="#DAG.DAGExecutor.__init__-1015"><span class="linenos">1015</span></a>            <span class="n">skip</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="s2">&quot;skip&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
</span><span id="DAG.DAGExecutor.__init__-1016"><a href="#DAG.DAGExecutor.__init__-1016"><span class="linenos">1016</span></a>            <span class="n">retry</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_T</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="DAG.DAGExecutor.__init__-1017"><a href="#DAG.DAGExecutor.__init__-1017"><span class="linenos">1017</span></a>                <span class="n">n</span><span class="p">:</span> <span class="p">[</span><span class="n">c</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="p">{}]</span> <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="s2">&quot;retry&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="DAG.DAGExecutor.__init__-1018"><a href="#DAG.DAGExecutor.__init__-1018"><span class="linenos">1018</span></a>            <span class="p">}</span>
</span><span id="DAG.DAGExecutor.__init__-1019"><a href="#DAG.DAGExecutor.__init__-1019"><span class="linenos">1019</span></a>
</span><span id="DAG.DAGExecutor.__init__-1020"><a href="#DAG.DAGExecutor.__init__-1020"><span class="linenos">1020</span></a>            <span class="c1"># Start execution of root node functions.</span>
</span><span id="DAG.DAGExecutor.__init__-1021"><a href="#DAG.DAGExecutor.__init__-1021"><span class="linenos">1021</span></a>            <span class="k">with</span> <span class="n">_futures</span><span class="o">.</span><span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="n">max_workers</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
</span><span id="DAG.DAGExecutor.__init__-1022"><a href="#DAG.DAGExecutor.__init__-1022"><span class="linenos">1022</span></a>
</span><span id="DAG.DAGExecutor.__init__-1023"><a href="#DAG.DAGExecutor.__init__-1023"><span class="linenos">1023</span></a>                <span class="k">def</span><span class="w"> </span><span class="nf">Submit</span><span class="p">(</span>
</span><span id="DAG.DAGExecutor.__init__-1024"><a href="#DAG.DAGExecutor.__init__-1024"><span class="linenos">1024</span></a>                    <span class="n">event</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="DAG.DAGExecutor.__init__-1025"><a href="#DAG.DAGExecutor.__init__-1025"><span class="linenos">1025</span></a>                    <span class="nb">callable</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">],</span>
</span><span id="DAG.DAGExecutor.__init__-1026"><a href="#DAG.DAGExecutor.__init__-1026"><span class="linenos">1026</span></a>                    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="DAG.DAGExecutor.__init__-1027"><a href="#DAG.DAGExecutor.__init__-1027"><span class="linenos">1027</span></a>                    <span class="n">args</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="nb">list</span><span class="p">[</span><span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">]],</span>
</span><span id="DAG.DAGExecutor.__init__-1028"><a href="#DAG.DAGExecutor.__init__-1028"><span class="linenos">1028</span></a>                    <span class="n">kwargs</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span>
</span><span id="DAG.DAGExecutor.__init__-1029"><a href="#DAG.DAGExecutor.__init__-1029"><span class="linenos">1029</span></a>                <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_futures</span><span class="o">.</span><span class="n">Future</span><span class="p">[</span><span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">]:</span>
</span><span id="DAG.DAGExecutor.__init__-1030"><a href="#DAG.DAGExecutor.__init__-1030"><span class="linenos">1030</span></a>                    <span class="k">if</span> <span class="n">skip</span><span class="p">[</span><span class="n">event</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
</span><span id="DAG.DAGExecutor.__init__-1031"><a href="#DAG.DAGExecutor.__init__-1031"><span class="linenos">1031</span></a>                        <span class="n">retry</span><span class="p">[</span><span class="n">event</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="DAG.DAGExecutor.__init__-1032"><a href="#DAG.DAGExecutor.__init__-1032"><span class="linenos">1032</span></a>                        <span class="n">skip_callable</span> <span class="o">=</span> <span class="n">raise_exc</span> <span class="k">if</span> <span class="n">skip</span><span class="p">[</span><span class="n">event</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="k">else</span> <span class="nb">print</span>
</span><span id="DAG.DAGExecutor.__init__-1033"><a href="#DAG.DAGExecutor.__init__-1033"><span class="linenos">1033</span></a>                        <span class="k">return</span> <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span>
</span><span id="DAG.DAGExecutor.__init__-1034"><a href="#DAG.DAGExecutor.__init__-1034"><span class="linenos">1034</span></a>                            <span class="n">_event_wrapper</span><span class="p">,</span>
</span><span id="DAG.DAGExecutor.__init__-1035"><a href="#DAG.DAGExecutor.__init__-1035"><span class="linenos">1035</span></a>                            <span class="n">_callable</span><span class="o">=</span><span class="n">skip_callable</span><span class="p">,</span>
</span><span id="DAG.DAGExecutor.__init__-1036"><a href="#DAG.DAGExecutor.__init__-1036"><span class="linenos">1036</span></a>                            <span class="n">_name</span><span class="o">=</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">event</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
</span><span id="DAG.DAGExecutor.__init__-1037"><a href="#DAG.DAGExecutor.__init__-1037"><span class="linenos">1037</span></a>                            <span class="n">_args</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Event </span><span class="si">{</span><span class="n">event</span><span class="si">}</span><span class="s2"> skipped...&quot;</span><span class="p">],</span>
</span><span id="DAG.DAGExecutor.__init__-1038"><a href="#DAG.DAGExecutor.__init__-1038"><span class="linenos">1038</span></a>                            <span class="n">_kwargs</span><span class="o">=</span><span class="p">{},</span>
</span><span id="DAG.DAGExecutor.__init__-1039"><a href="#DAG.DAGExecutor.__init__-1039"><span class="linenos">1039</span></a>                            <span class="n">_verbose</span><span class="o">=</span><span class="n">verbose</span>
</span><span id="DAG.DAGExecutor.__init__-1040"><a href="#DAG.DAGExecutor.__init__-1040"><span class="linenos">1040</span></a>                        <span class="p">)</span>
</span><span id="DAG.DAGExecutor.__init__-1041"><a href="#DAG.DAGExecutor.__init__-1041"><span class="linenos">1041</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="DAG.DAGExecutor.__init__-1042"><a href="#DAG.DAGExecutor.__init__-1042"><span class="linenos">1042</span></a>                        <span class="n">retry</span><span class="p">[</span><span class="n">event</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>
</span><span id="DAG.DAGExecutor.__init__-1043"><a href="#DAG.DAGExecutor.__init__-1043"><span class="linenos">1043</span></a>                        <span class="k">if</span> <span class="p">(</span><span class="n">retry</span><span class="p">[</span><span class="n">event</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">retry</span><span class="p">[</span><span class="n">event</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="p">{}):</span>
</span><span id="DAG.DAGExecutor.__init__-1044"><a href="#DAG.DAGExecutor.__init__-1044"><span class="linenos">1044</span></a>                            <span class="n">retry</span><span class="p">[</span><span class="n">event</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="DAG.DAGExecutor.__init__-1045"><a href="#DAG.DAGExecutor.__init__-1045"><span class="linenos">1045</span></a>                                <span class="s1">&#39;callable&#39;</span><span class="p">:</span> <span class="nb">callable</span><span class="p">,</span>
</span><span id="DAG.DAGExecutor.__init__-1046"><a href="#DAG.DAGExecutor.__init__-1046"><span class="linenos">1046</span></a>                                <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
</span><span id="DAG.DAGExecutor.__init__-1047"><a href="#DAG.DAGExecutor.__init__-1047"><span class="linenos">1047</span></a>                                <span class="s1">&#39;args&#39;</span><span class="p">:</span> <span class="n">args</span><span class="p">,</span>
</span><span id="DAG.DAGExecutor.__init__-1048"><a href="#DAG.DAGExecutor.__init__-1048"><span class="linenos">1048</span></a>                                <span class="s1">&#39;kwargs&#39;</span><span class="p">:</span> <span class="n">kwargs</span>
</span><span id="DAG.DAGExecutor.__init__-1049"><a href="#DAG.DAGExecutor.__init__-1049"><span class="linenos">1049</span></a>                            <span class="p">}</span>
</span><span id="DAG.DAGExecutor.__init__-1050"><a href="#DAG.DAGExecutor.__init__-1050"><span class="linenos">1050</span></a>                        <span class="k">return</span> <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span>
</span><span id="DAG.DAGExecutor.__init__-1051"><a href="#DAG.DAGExecutor.__init__-1051"><span class="linenos">1051</span></a>                            <span class="n">_event_wrapper</span><span class="p">,</span>
</span><span id="DAG.DAGExecutor.__init__-1052"><a href="#DAG.DAGExecutor.__init__-1052"><span class="linenos">1052</span></a>                            <span class="n">_callable</span><span class="o">=</span><span class="nb">callable</span><span class="p">,</span>
</span><span id="DAG.DAGExecutor.__init__-1053"><a href="#DAG.DAGExecutor.__init__-1053"><span class="linenos">1053</span></a>                            <span class="n">_name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span><span id="DAG.DAGExecutor.__init__-1054"><a href="#DAG.DAGExecutor.__init__-1054"><span class="linenos">1054</span></a>                            <span class="n">_args</span><span class="o">=</span><span class="n">args</span><span class="p">,</span>
</span><span id="DAG.DAGExecutor.__init__-1055"><a href="#DAG.DAGExecutor.__init__-1055"><span class="linenos">1055</span></a>                            <span class="n">_kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="DAG.DAGExecutor.__init__-1056"><a href="#DAG.DAGExecutor.__init__-1056"><span class="linenos">1056</span></a>                            <span class="n">_verbose</span><span class="o">=</span><span class="n">verbose</span>
</span><span id="DAG.DAGExecutor.__init__-1057"><a href="#DAG.DAGExecutor.__init__-1057"><span class="linenos">1057</span></a>                        <span class="p">)</span>
</span><span id="DAG.DAGExecutor.__init__-1058"><a href="#DAG.DAGExecutor.__init__-1058"><span class="linenos">1058</span></a>
</span><span id="DAG.DAGExecutor.__init__-1059"><a href="#DAG.DAGExecutor.__init__-1059"><span class="linenos">1059</span></a>                <span class="c1"># Submit root nodes</span>
</span><span id="DAG.DAGExecutor.__init__-1060"><a href="#DAG.DAGExecutor.__init__-1060"><span class="linenos">1060</span></a>                <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">roots</span><span class="p">:</span>
</span><span id="DAG.DAGExecutor.__init__-1061"><a href="#DAG.DAGExecutor.__init__-1061"><span class="linenos">1061</span></a>                    <span class="n">refs</span><span class="p">[</span><span class="n">event</span><span class="p">]</span> <span class="o">=</span> <span class="n">Submit</span><span class="p">(</span>
</span><span id="DAG.DAGExecutor.__init__-1062"><a href="#DAG.DAGExecutor.__init__-1062"><span class="linenos">1062</span></a>                        <span class="n">event</span><span class="p">,</span>
</span><span id="DAG.DAGExecutor.__init__-1063"><a href="#DAG.DAGExecutor.__init__-1063"><span class="linenos">1063</span></a>                        <span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">event</span><span class="p">][</span><span class="s1">&#39;callable&#39;</span><span class="p">],</span>
</span><span id="DAG.DAGExecutor.__init__-1064"><a href="#DAG.DAGExecutor.__init__-1064"><span class="linenos">1064</span></a>                        <span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">event</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
</span><span id="DAG.DAGExecutor.__init__-1065"><a href="#DAG.DAGExecutor.__init__-1065"><span class="linenos">1065</span></a>                        <span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">event</span><span class="p">][</span><span class="s1">&#39;args&#39;</span><span class="p">],</span>
</span><span id="DAG.DAGExecutor.__init__-1066"><a href="#DAG.DAGExecutor.__init__-1066"><span class="linenos">1066</span></a>                        <span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">event</span><span class="p">][</span><span class="s1">&#39;kwargs&#39;</span><span class="p">]</span>
</span><span id="DAG.DAGExecutor.__init__-1067"><a href="#DAG.DAGExecutor.__init__-1067"><span class="linenos">1067</span></a>                    <span class="p">)</span>
</span><span id="DAG.DAGExecutor.__init__-1068"><a href="#DAG.DAGExecutor.__init__-1068"><span class="linenos">1068</span></a>                    <span class="n">started</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
</span><span id="DAG.DAGExecutor.__init__-1069"><a href="#DAG.DAGExecutor.__init__-1069"><span class="linenos">1069</span></a>
</span><span id="DAG.DAGExecutor.__init__-1070"><a href="#DAG.DAGExecutor.__init__-1070"><span class="linenos">1070</span></a>                <span class="c1"># Process futures as they complete (no busy-wait)</span>
</span><span id="DAG.DAGExecutor.__init__-1071"><a href="#DAG.DAGExecutor.__init__-1071"><span class="linenos">1071</span></a>                <span class="n">pending</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">refs</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</span><span id="DAG.DAGExecutor.__init__-1072"><a href="#DAG.DAGExecutor.__init__-1072"><span class="linenos">1072</span></a>                <span class="n">future_to_event</span> <span class="o">=</span> <span class="p">{</span><span class="n">v</span><span class="p">:</span> <span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">refs</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
</span><span id="DAG.DAGExecutor.__init__-1073"><a href="#DAG.DAGExecutor.__init__-1073"><span class="linenos">1073</span></a>
</span><span id="DAG.DAGExecutor.__init__-1074"><a href="#DAG.DAGExecutor.__init__-1074"><span class="linenos">1074</span></a>                <span class="k">while</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">complete</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">failed</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">skipped</span><span class="p">))</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">graph</span><span class="p">):</span>
</span><span id="DAG.DAGExecutor.__init__-1075"><a href="#DAG.DAGExecutor.__init__-1075"><span class="linenos">1075</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="n">pending</span><span class="p">:</span>
</span><span id="DAG.DAGExecutor.__init__-1076"><a href="#DAG.DAGExecutor.__init__-1076"><span class="linenos">1076</span></a>                        <span class="k">break</span>
</span><span id="DAG.DAGExecutor.__init__-1077"><a href="#DAG.DAGExecutor.__init__-1077"><span class="linenos">1077</span></a>
</span><span id="DAG.DAGExecutor.__init__-1078"><a href="#DAG.DAGExecutor.__init__-1078"><span class="linenos">1078</span></a>                    <span class="c1"># Wait for at least one future to complete</span>
</span><span id="DAG.DAGExecutor.__init__-1079"><a href="#DAG.DAGExecutor.__init__-1079"><span class="linenos">1079</span></a>                    <span class="n">done</span><span class="p">,</span> <span class="n">pending</span> <span class="o">=</span> <span class="n">_futures</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="n">pending</span><span class="p">,</span> <span class="n">return_when</span><span class="o">=</span><span class="n">_futures</span><span class="o">.</span><span class="n">FIRST_COMPLETED</span><span class="p">)</span>
</span><span id="DAG.DAGExecutor.__init__-1080"><a href="#DAG.DAGExecutor.__init__-1080"><span class="linenos">1080</span></a>
</span><span id="DAG.DAGExecutor.__init__-1081"><a href="#DAG.DAGExecutor.__init__-1081"><span class="linenos">1081</span></a>                    <span class="k">for</span> <span class="n">future</span> <span class="ow">in</span> <span class="n">done</span><span class="p">:</span>
</span><span id="DAG.DAGExecutor.__init__-1082"><a href="#DAG.DAGExecutor.__init__-1082"><span class="linenos">1082</span></a>                        <span class="n">event</span> <span class="o">=</span> <span class="n">future_to_event</span><span class="p">[</span><span class="n">future</span><span class="p">]</span>
</span><span id="DAG.DAGExecutor.__init__-1083"><a href="#DAG.DAGExecutor.__init__-1083"><span class="linenos">1083</span></a>
</span><span id="DAG.DAGExecutor.__init__-1084"><a href="#DAG.DAGExecutor.__init__-1084"><span class="linenos">1084</span></a>                        <span class="k">if</span> <span class="n">future</span><span class="o">.</span><span class="n">exception</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DAG.DAGExecutor.__init__-1085"><a href="#DAG.DAGExecutor.__init__-1085"><span class="linenos">1085</span></a>                            <span class="k">try</span><span class="p">:</span>
</span><span id="DAG.DAGExecutor.__init__-1086"><a href="#DAG.DAGExecutor.__init__-1086"><span class="linenos">1086</span></a>                                <span class="k">raise</span> <span class="n">future</span><span class="o">.</span><span class="n">exception</span><span class="p">()</span>  <span class="c1"># type: ignore</span>
</span><span id="DAG.DAGExecutor.__init__-1087"><a href="#DAG.DAGExecutor.__init__-1087"><span class="linenos">1087</span></a>                            <span class="k">except</span><span class="p">:</span>
</span><span id="DAG.DAGExecutor.__init__-1088"><a href="#DAG.DAGExecutor.__init__-1088"><span class="linenos">1088</span></a>                                <span class="k">if</span> <span class="n">print_exc</span><span class="p">:</span>
</span><span id="DAG.DAGExecutor.__init__-1089"><a href="#DAG.DAGExecutor.__init__-1089"><span class="linenos">1089</span></a>                                    <span class="n">_traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
</span><span id="DAG.DAGExecutor.__init__-1090"><a href="#DAG.DAGExecutor.__init__-1090"><span class="linenos">1090</span></a>
</span><span id="DAG.DAGExecutor.__init__-1091"><a href="#DAG.DAGExecutor.__init__-1091"><span class="linenos">1091</span></a>                                <span class="k">if</span> <span class="n">retry</span><span class="p">[</span><span class="n">event</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="DAG.DAGExecutor.__init__-1092"><a href="#DAG.DAGExecutor.__init__-1092"><span class="linenos">1092</span></a>                                    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="DAG.DAGExecutor.__init__-1093"><a href="#DAG.DAGExecutor.__init__-1093"><span class="linenos">1093</span></a>                                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Event </span><span class="si">{</span><span class="n">event</span><span class="si">}</span><span class="s2"> exited with exception, retrying...&quot;</span><span class="p">)</span>
</span><span id="DAG.DAGExecutor.__init__-1094"><a href="#DAG.DAGExecutor.__init__-1094"><span class="linenos">1094</span></a>                                    <span class="n">new_future</span> <span class="o">=</span> <span class="n">Submit</span><span class="p">(</span>
</span><span id="DAG.DAGExecutor.__init__-1095"><a href="#DAG.DAGExecutor.__init__-1095"><span class="linenos">1095</span></a>                                        <span class="n">event</span><span class="p">,</span>
</span><span id="DAG.DAGExecutor.__init__-1096"><a href="#DAG.DAGExecutor.__init__-1096"><span class="linenos">1096</span></a>                                        <span class="nb">callable</span><span class="o">=</span><span class="n">retry</span><span class="p">[</span><span class="n">event</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;callable&#39;</span><span class="p">],</span>
</span><span id="DAG.DAGExecutor.__init__-1097"><a href="#DAG.DAGExecutor.__init__-1097"><span class="linenos">1097</span></a>                                        <span class="n">name</span><span class="o">=</span><span class="n">retry</span><span class="p">[</span><span class="n">event</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
</span><span id="DAG.DAGExecutor.__init__-1098"><a href="#DAG.DAGExecutor.__init__-1098"><span class="linenos">1098</span></a>                                        <span class="n">args</span><span class="o">=</span><span class="n">retry</span><span class="p">[</span><span class="n">event</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;args&#39;</span><span class="p">],</span>
</span><span id="DAG.DAGExecutor.__init__-1099"><a href="#DAG.DAGExecutor.__init__-1099"><span class="linenos">1099</span></a>                                        <span class="n">kwargs</span><span class="o">=</span><span class="n">retry</span><span class="p">[</span><span class="n">event</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;kwargs&#39;</span><span class="p">]</span>
</span><span id="DAG.DAGExecutor.__init__-1100"><a href="#DAG.DAGExecutor.__init__-1100"><span class="linenos">1100</span></a>                                    <span class="p">)</span>
</span><span id="DAG.DAGExecutor.__init__-1101"><a href="#DAG.DAGExecutor.__init__-1101"><span class="linenos">1101</span></a>                                    <span class="n">refs</span><span class="p">[</span><span class="n">event</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_future</span>
</span><span id="DAG.DAGExecutor.__init__-1102"><a href="#DAG.DAGExecutor.__init__-1102"><span class="linenos">1102</span></a>                                    <span class="n">pending</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">new_future</span><span class="p">)</span>
</span><span id="DAG.DAGExecutor.__init__-1103"><a href="#DAG.DAGExecutor.__init__-1103"><span class="linenos">1103</span></a>                                    <span class="n">future_to_event</span><span class="p">[</span><span class="n">new_future</span><span class="p">]</span> <span class="o">=</span> <span class="n">event</span>
</span><span id="DAG.DAGExecutor.__init__-1104"><a href="#DAG.DAGExecutor.__init__-1104"><span class="linenos">1104</span></a>                                    <span class="k">continue</span>
</span><span id="DAG.DAGExecutor.__init__-1105"><a href="#DAG.DAGExecutor.__init__-1105"><span class="linenos">1105</span></a>
</span><span id="DAG.DAGExecutor.__init__-1106"><a href="#DAG.DAGExecutor.__init__-1106"><span class="linenos">1106</span></a>                                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="DAG.DAGExecutor.__init__-1107"><a href="#DAG.DAGExecutor.__init__-1107"><span class="linenos">1107</span></a>                                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Event </span><span class="si">{</span><span class="n">event</span><span class="si">}</span><span class="s2"> exited with exception...&quot;</span><span class="p">)</span>
</span><span id="DAG.DAGExecutor.__init__-1108"><a href="#DAG.DAGExecutor.__init__-1108"><span class="linenos">1108</span></a>                                <span class="n">failed</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
</span><span id="DAG.DAGExecutor.__init__-1109"><a href="#DAG.DAGExecutor.__init__-1109"><span class="linenos">1109</span></a>                                <span class="n">skipping</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="DAG.DAGExecutor.__init__-1110"><a href="#DAG.DAGExecutor.__init__-1110"><span class="linenos">1110</span></a>                                    <span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">out_edges</span><span class="p">(</span><span class="n">event</span><span class="p">))</span>
</span><span id="DAG.DAGExecutor.__init__-1111"><a href="#DAG.DAGExecutor.__init__-1111"><span class="linenos">1111</span></a>                                    <span class="k">if</span> <span class="ow">not</span> <span class="n">_edges</span><span class="o">.</span><span class="n">continue_on_failure</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">e</span><span class="p">])</span>
</span><span id="DAG.DAGExecutor.__init__-1112"><a href="#DAG.DAGExecutor.__init__-1112"><span class="linenos">1112</span></a>                                <span class="p">]</span>
</span><span id="DAG.DAGExecutor.__init__-1113"><a href="#DAG.DAGExecutor.__init__-1113"><span class="linenos">1113</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="DAG.DAGExecutor.__init__-1114"><a href="#DAG.DAGExecutor.__init__-1114"><span class="linenos">1114</span></a>                            <span class="n">complete</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
</span><span id="DAG.DAGExecutor.__init__-1115"><a href="#DAG.DAGExecutor.__init__-1115"><span class="linenos">1115</span></a>                            <span class="n">skipping</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="DAG.DAGExecutor.__init__-1116"><a href="#DAG.DAGExecutor.__init__-1116"><span class="linenos">1116</span></a>                                <span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">out_edges</span><span class="p">(</span><span class="n">event</span><span class="p">))</span>
</span><span id="DAG.DAGExecutor.__init__-1117"><a href="#DAG.DAGExecutor.__init__-1117"><span class="linenos">1117</span></a>                                <span class="k">if</span> <span class="ow">not</span> <span class="n">_edges</span><span class="o">.</span><span class="n">continue_on_success</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">e</span><span class="p">])</span>
</span><span id="DAG.DAGExecutor.__init__-1118"><a href="#DAG.DAGExecutor.__init__-1118"><span class="linenos">1118</span></a>                            <span class="p">]</span>
</span><span id="DAG.DAGExecutor.__init__-1119"><a href="#DAG.DAGExecutor.__init__-1119"><span class="linenos">1119</span></a>
</span><span id="DAG.DAGExecutor.__init__-1120"><a href="#DAG.DAGExecutor.__init__-1120"><span class="linenos">1120</span></a>                        <span class="n">skipped</span> <span class="o">=</span> <span class="n">skipped</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">skipping</span><span class="p">)</span>
</span><span id="DAG.DAGExecutor.__init__-1121"><a href="#DAG.DAGExecutor.__init__-1121"><span class="linenos">1121</span></a>                        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">skipping</span><span class="p">:</span>
</span><span id="DAG.DAGExecutor.__init__-1122"><a href="#DAG.DAGExecutor.__init__-1122"><span class="linenos">1122</span></a>                            <span class="n">skipped</span> <span class="o">=</span> <span class="n">skipped</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">_nx</span><span class="o">.</span><span class="n">descendants</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
</span><span id="DAG.DAGExecutor.__init__-1123"><a href="#DAG.DAGExecutor.__init__-1123"><span class="linenos">1123</span></a>
</span><span id="DAG.DAGExecutor.__init__-1124"><a href="#DAG.DAGExecutor.__init__-1124"><span class="linenos">1124</span></a>                        <span class="n">carryon</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">successors</span><span class="p">(</span><span class="n">event</span><span class="p">))</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">skipped</span><span class="p">)</span>
</span><span id="DAG.DAGExecutor.__init__-1125"><a href="#DAG.DAGExecutor.__init__-1125"><span class="linenos">1125</span></a>                        <span class="n">starting</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="DAG.DAGExecutor.__init__-1126"><a href="#DAG.DAGExecutor.__init__-1126"><span class="linenos">1126</span></a>                            <span class="n">successor</span> <span class="k">for</span> <span class="n">successor</span> <span class="ow">in</span> <span class="n">carryon</span>
</span><span id="DAG.DAGExecutor.__init__-1127"><a href="#DAG.DAGExecutor.__init__-1127"><span class="linenos">1127</span></a>                            <span class="k">if</span> <span class="n">run_conditions_met</span><span class="p">(</span><span class="n">successor</span><span class="p">)</span>
</span><span id="DAG.DAGExecutor.__init__-1128"><a href="#DAG.DAGExecutor.__init__-1128"><span class="linenos">1128</span></a>                        <span class="p">]</span>
</span><span id="DAG.DAGExecutor.__init__-1129"><a href="#DAG.DAGExecutor.__init__-1129"><span class="linenos">1129</span></a>
</span><span id="DAG.DAGExecutor.__init__-1130"><a href="#DAG.DAGExecutor.__init__-1130"><span class="linenos">1130</span></a>                        <span class="k">for</span> <span class="n">successor</span> <span class="ow">in</span> <span class="n">starting</span><span class="p">:</span>
</span><span id="DAG.DAGExecutor.__init__-1131"><a href="#DAG.DAGExecutor.__init__-1131"><span class="linenos">1131</span></a>                            <span class="n">_args</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="DAG.DAGExecutor.__init__-1132"><a href="#DAG.DAGExecutor.__init__-1132"><span class="linenos">1132</span></a>                                <span class="n">a</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">_xcoms</span><span class="o">.</span><span class="n">Promise</span><span class="p">)</span> <span class="k">else</span> <span class="n">refs</span><span class="p">[</span><span class="n">_T</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">key</span><span class="p">)]</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
</span><span id="DAG.DAGExecutor.__init__-1133"><a href="#DAG.DAGExecutor.__init__-1133"><span class="linenos">1133</span></a>                                <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">successor</span><span class="p">][</span><span class="s1">&#39;args&#39;</span><span class="p">]</span>
</span><span id="DAG.DAGExecutor.__init__-1134"><a href="#DAG.DAGExecutor.__init__-1134"><span class="linenos">1134</span></a>                            <span class="p">]</span>
</span><span id="DAG.DAGExecutor.__init__-1135"><a href="#DAG.DAGExecutor.__init__-1135"><span class="linenos">1135</span></a>                            <span class="n">_kwargs</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="DAG.DAGExecutor.__init__-1136"><a href="#DAG.DAGExecutor.__init__-1136"><span class="linenos">1136</span></a>                                <span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">_xcoms</span><span class="o">.</span><span class="n">Promise</span><span class="p">)</span> <span class="k">else</span> <span class="n">refs</span><span class="p">[</span><span class="n">_T</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">key</span><span class="p">)]</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
</span><span id="DAG.DAGExecutor.__init__-1137"><a href="#DAG.DAGExecutor.__init__-1137"><span class="linenos">1137</span></a>                                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">successor</span><span class="p">][</span><span class="s1">&#39;kwargs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="DAG.DAGExecutor.__init__-1138"><a href="#DAG.DAGExecutor.__init__-1138"><span class="linenos">1138</span></a>                            <span class="p">}</span>
</span><span id="DAG.DAGExecutor.__init__-1139"><a href="#DAG.DAGExecutor.__init__-1139"><span class="linenos">1139</span></a>                            <span class="n">new_future</span> <span class="o">=</span> <span class="n">Submit</span><span class="p">(</span>
</span><span id="DAG.DAGExecutor.__init__-1140"><a href="#DAG.DAGExecutor.__init__-1140"><span class="linenos">1140</span></a>                                <span class="n">successor</span><span class="p">,</span>
</span><span id="DAG.DAGExecutor.__init__-1141"><a href="#DAG.DAGExecutor.__init__-1141"><span class="linenos">1141</span></a>                                <span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">successor</span><span class="p">][</span><span class="s1">&#39;callable&#39;</span><span class="p">],</span>
</span><span id="DAG.DAGExecutor.__init__-1142"><a href="#DAG.DAGExecutor.__init__-1142"><span class="linenos">1142</span></a>                                <span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">successor</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
</span><span id="DAG.DAGExecutor.__init__-1143"><a href="#DAG.DAGExecutor.__init__-1143"><span class="linenos">1143</span></a>                                <span class="n">_args</span><span class="p">,</span>
</span><span id="DAG.DAGExecutor.__init__-1144"><a href="#DAG.DAGExecutor.__init__-1144"><span class="linenos">1144</span></a>                                <span class="n">_kwargs</span>
</span><span id="DAG.DAGExecutor.__init__-1145"><a href="#DAG.DAGExecutor.__init__-1145"><span class="linenos">1145</span></a>                            <span class="p">)</span>
</span><span id="DAG.DAGExecutor.__init__-1146"><a href="#DAG.DAGExecutor.__init__-1146"><span class="linenos">1146</span></a>                            <span class="n">refs</span><span class="p">[</span><span class="n">successor</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_future</span>
</span><span id="DAG.DAGExecutor.__init__-1147"><a href="#DAG.DAGExecutor.__init__-1147"><span class="linenos">1147</span></a>                            <span class="n">pending</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">new_future</span><span class="p">)</span>
</span><span id="DAG.DAGExecutor.__init__-1148"><a href="#DAG.DAGExecutor.__init__-1148"><span class="linenos">1148</span></a>                            <span class="n">future_to_event</span><span class="p">[</span><span class="n">new_future</span><span class="p">]</span> <span class="o">=</span> <span class="n">successor</span>
</span><span id="DAG.DAGExecutor.__init__-1149"><a href="#DAG.DAGExecutor.__init__-1149"><span class="linenos">1149</span></a>                            <span class="n">started</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">successor</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                </section>
                <section id="Condition">
                            <input id="Condition-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Condition</span><wbr>(<span class="base">enum.IntEnum</span>):

                <label class="view-source-button" for="Condition-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Condition"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Condition-12"><a href="#Condition-12"><span class="linenos">12</span></a><span class="k">class</span><span class="w"> </span><span class="nc">Condition</span><span class="p">(</span><span class="n">_enum</span><span class="o">.</span><span class="n">IntEnum</span><span class="p">):</span>
</span><span id="Condition-13"><a href="#Condition-13"><span class="linenos">13</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Represents edge condition for a node execution, based on outcome(s) of predecessor(s).&quot;&quot;&quot;</span>
</span><span id="Condition-14"><a href="#Condition-14"><span class="linenos">14</span></a>    <span class="n">Success</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Condition-15"><a href="#Condition-15"><span class="linenos">15</span></a>    <span class="n">Failure</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Condition-16"><a href="#Condition-16"><span class="linenos">16</span></a>    <span class="n">AnyCase</span> <span class="o">=</span> <span class="mi">3</span>
</span></pre></div>


            <div class="docstring"><p>Represents edge condition for a node execution, based on outcome(s) of predecessor(s).</p>
</div>


                            <div id="Condition.Success" class="classattr">
                                <div class="attr variable">
            <span class="name">Success</span>        =
<span class="default_value">&lt;<a href="#Condition.Success">Condition.Success</a>: 0&gt;</span>

        
    </div>
    <a class="headerlink" href="#Condition.Success"></a>
    
    

                            </div>
                            <div id="Condition.Failure" class="classattr">
                                <div class="attr variable">
            <span class="name">Failure</span>        =
<span class="default_value">&lt;<a href="#Condition.Failure">Condition.Failure</a>: 1&gt;</span>

        
    </div>
    <a class="headerlink" href="#Condition.Failure"></a>
    
    

                            </div>
                            <div id="Condition.AnyCase" class="classattr">
                                <div class="attr variable">
            <span class="name">AnyCase</span>        =
<span class="default_value">&lt;<a href="#Condition.AnyCase">Condition.AnyCase</a>: 3&gt;</span>

        
    </div>
    <a class="headerlink" href="#Condition.AnyCase"></a>
    
    

                            </div>
                </section>
                <section id="QueueDAG">
                            <input id="QueueDAG-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">QueueDAG</span><wbr>(<span class="base"><a href="#DAG">DAG</a></span>):

                <label class="view-source-button" for="QueueDAG-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#QueueDAG"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="QueueDAG-1151"><a href="#QueueDAG-1151"><span class="linenos">1151</span></a><span class="k">class</span><span class="w"> </span><span class="nc">QueueDAG</span><span class="p">(</span><span class="n">DAG</span><span class="p">):</span>
</span><span id="QueueDAG-1152"><a href="#QueueDAG-1152"><span class="linenos">1152</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="QueueDAG-1153"><a href="#QueueDAG-1153"><span class="linenos">1153</span></a><span class="sd">    Directed Acyclic Graph used to queue and execute Pythonic callables in parallel,</span>
</span><span id="QueueDAG-1154"><a href="#QueueDAG-1154"><span class="linenos">1154</span></a><span class="sd">    while stringing the outputs of those callables in linear sequences.</span>
</span><span id="QueueDAG-1155"><a href="#QueueDAG-1155"><span class="linenos">1155</span></a>
</span><span id="QueueDAG-1156"><a href="#QueueDAG-1156"><span class="linenos">1156</span></a><span class="sd">    Queue DAG nodes are repeated until the DAG executor completes or is killed, depending on the</span>
</span><span id="QueueDAG-1157"><a href="#QueueDAG-1157"><span class="linenos">1157</span></a><span class="sd">    behavior of root nodes to determine if and/or when the DAG run has been completed.</span>
</span><span id="QueueDAG-1158"><a href="#QueueDAG-1158"><span class="linenos">1158</span></a>
</span><span id="QueueDAG-1159"><a href="#QueueDAG-1159"><span class="linenos">1159</span></a><span class="sd">    Root nodes will be re-executed until culled by one of two conditions:</span>
</span><span id="QueueDAG-1160"><a href="#QueueDAG-1160"><span class="linenos">1160</span></a><span class="sd">    1. A max number of iterations has been completed, or</span>
</span><span id="QueueDAG-1161"><a href="#QueueDAG-1161"><span class="linenos">1161</span></a><span class="sd">    2. The output of the root node&#39;s callable matches a lambda halt_condition.</span>
</span><span id="QueueDAG-1162"><a href="#QueueDAG-1162"><span class="linenos">1162</span></a>
</span><span id="QueueDAG-1163"><a href="#QueueDAG-1163"><span class="linenos">1163</span></a><span class="sd">    Both conditions can be set at run-time.</span>
</span><span id="QueueDAG-1164"><a href="#QueueDAG-1164"><span class="linenos">1164</span></a>
</span><span id="QueueDAG-1165"><a href="#QueueDAG-1165"><span class="linenos">1165</span></a><span class="sd">    QueueDAG can be nested inside a standard webber.DAG by passing qdag.execute as a callable.</span>
</span><span id="QueueDAG-1166"><a href="#QueueDAG-1166"><span class="linenos">1166</span></a><span class="sd">    Benchmarks show moderate overhead of 1.3-2.5x (~1-2ms fixed cost) when nested, due to the</span>
</span><span id="QueueDAG-1167"><a href="#QueueDAG-1167"><span class="linenos">1167</span></a><span class="sd">    outer DAG&#39;s ThreadPoolExecutor setup and task wrapper infrastructure. This is well within</span>
</span><span id="QueueDAG-1168"><a href="#QueueDAG-1168"><span class="linenos">1168</span></a><span class="sd">    acceptable millisecond-scale latency for most real-time applications.</span>
</span><span id="QueueDAG-1169"><a href="#QueueDAG-1169"><span class="linenos">1169</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="QueueDAG-1170"><a href="#QueueDAG-1170"><span class="linenos">1170</span></a>
</span><span id="QueueDAG-1171"><a href="#QueueDAG-1171"><span class="linenos">1171</span></a>    <span class="n">conditions</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_T</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="QueueDAG-1172"><a href="#QueueDAG-1172"><span class="linenos">1172</span></a>
</span><span id="QueueDAG-1173"><a href="#QueueDAG-1173"><span class="linenos">1173</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="QueueDAG-1174"><a href="#QueueDAG-1174"><span class="linenos">1174</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="QueueDAG-1175"><a href="#QueueDAG-1175"><span class="linenos">1175</span></a>
</span><span id="QueueDAG-1176"><a href="#QueueDAG-1176"><span class="linenos">1176</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="QueueDAG-1177"><a href="#QueueDAG-1177"><span class="linenos">1177</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="QueueDAG-1178"><a href="#QueueDAG-1178"><span class="linenos">1178</span></a><span class="sd">        Adds a callable with positional and keyword arguments to the DAG&#39;s underlying graph.</span>
</span><span id="QueueDAG-1179"><a href="#QueueDAG-1179"><span class="linenos">1179</span></a><span class="sd">        On success, return unique identifier for the new node.</span>
</span><span id="QueueDAG-1180"><a href="#QueueDAG-1180"><span class="linenos">1180</span></a><span class="sd">        </span>
</span><span id="QueueDAG-1181"><a href="#QueueDAG-1181"><span class="linenos">1181</span></a><span class="sd">        Reserved key-words are used for Queue DAG definitions:</span>
</span><span id="QueueDAG-1182"><a href="#QueueDAG-1182"><span class="linenos">1182</span></a><span class="sd">        </span>
</span><span id="QueueDAG-1183"><a href="#QueueDAG-1183"><span class="linenos">1183</span></a><span class="sd">        - halt_condition: Lambda function used to halt repeated execution of a Queue DAG node that is independent of other callables.</span>
</span><span id="QueueDAG-1184"><a href="#QueueDAG-1184"><span class="linenos">1184</span></a>
</span><span id="QueueDAG-1185"><a href="#QueueDAG-1185"><span class="linenos">1185</span></a><span class="sd">        \t halt_condition = (lambda output: output == None) </span>
</span><span id="QueueDAG-1186"><a href="#QueueDAG-1186"><span class="linenos">1186</span></a>
</span><span id="QueueDAG-1187"><a href="#QueueDAG-1187"><span class="linenos">1187</span></a><span class="sd">        - iterator: Discrete number of times that Queue DAG node should be executed. Meant to be mutually-exclusive of halt_condition argument.</span>
</span><span id="QueueDAG-1188"><a href="#QueueDAG-1188"><span class="linenos">1188</span></a>
</span><span id="QueueDAG-1189"><a href="#QueueDAG-1189"><span class="linenos">1189</span></a><span class="sd">        - max_iter: Maximum number of times that Queue DAG node should be executed. Meant for use with halt_condition in order to prevent forever loop.</span>
</span><span id="QueueDAG-1190"><a href="#QueueDAG-1190"><span class="linenos">1190</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="QueueDAG-1191"><a href="#QueueDAG-1191"><span class="linenos">1191</span></a>        <span class="n">halt_condition</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;halt_condition&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="QueueDAG-1192"><a href="#QueueDAG-1192"><span class="linenos">1192</span></a>        <span class="n">iterator</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;iterator&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="QueueDAG-1193"><a href="#QueueDAG-1193"><span class="linenos">1193</span></a>        <span class="n">max_iter</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;max_iter&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="QueueDAG-1194"><a href="#QueueDAG-1194"><span class="linenos">1194</span></a>
</span><span id="QueueDAG-1195"><a href="#QueueDAG-1195"><span class="linenos">1195</span></a>        <span class="n">return_val</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="QueueDAG-1196"><a href="#QueueDAG-1196"><span class="linenos">1196</span></a>        
</span><span id="QueueDAG-1197"><a href="#QueueDAG-1197"><span class="linenos">1197</span></a>        <span class="k">if</span> <span class="n">max_iter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="QueueDAG-1198"><a href="#QueueDAG-1198"><span class="linenos">1198</span></a>            <span class="n">iter_limit</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">max_iter</span><span class="p">)</span>
</span><span id="QueueDAG-1199"><a href="#QueueDAG-1199"><span class="linenos">1199</span></a>        <span class="k">elif</span> <span class="n">iterator</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="QueueDAG-1200"><a href="#QueueDAG-1200"><span class="linenos">1200</span></a>            <span class="n">iter_limit</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">iterator</span><span class="p">)</span>
</span><span id="QueueDAG-1201"><a href="#QueueDAG-1201"><span class="linenos">1201</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="QueueDAG-1202"><a href="#QueueDAG-1202"><span class="linenos">1202</span></a>            <span class="n">iter_limit</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="QueueDAG-1203"><a href="#QueueDAG-1203"><span class="linenos">1203</span></a>        
</span><span id="QueueDAG-1204"><a href="#QueueDAG-1204"><span class="linenos">1204</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">conditions</span><span class="p">[</span><span class="n">return_val</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="QueueDAG-1205"><a href="#QueueDAG-1205"><span class="linenos">1205</span></a>            <span class="s1">&#39;halt_condition&#39;</span><span class="p">:</span> <span class="n">halt_condition</span><span class="p">,</span>
</span><span id="QueueDAG-1206"><a href="#QueueDAG-1206"><span class="linenos">1206</span></a>            <span class="s1">&#39;iter_limit&#39;</span><span class="p">:</span> <span class="n">iter_limit</span>
</span><span id="QueueDAG-1207"><a href="#QueueDAG-1207"><span class="linenos">1207</span></a>        <span class="p">}</span>
</span><span id="QueueDAG-1208"><a href="#QueueDAG-1208"><span class="linenos">1208</span></a>
</span><span id="QueueDAG-1209"><a href="#QueueDAG-1209"><span class="linenos">1209</span></a>        <span class="k">return</span> <span class="n">return_val</span>
</span><span id="QueueDAG-1210"><a href="#QueueDAG-1210"><span class="linenos">1210</span></a>        
</span><span id="QueueDAG-1211"><a href="#QueueDAG-1211"><span class="linenos">1211</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_edge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">u_of_edge</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_T</span><span class="o">.</span><span class="n">Callable</span><span class="p">],</span> <span class="n">v_of_edge</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_T</span><span class="o">.</span><span class="n">Callable</span><span class="p">],</span> <span class="n">continue_on</span><span class="p">:</span> <span class="n">Condition</span> <span class="o">=</span> <span class="n">Condition</span><span class="o">.</span><span class="n">Success</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_T</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
</span><span id="QueueDAG-1212"><a href="#QueueDAG-1212"><span class="linenos">1212</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="QueueDAG-1213"><a href="#QueueDAG-1213"><span class="linenos">1213</span></a><span class="sd">        Adds an edge between nodes in the Queue DAG&#39;s underlying graph.</span>
</span><span id="QueueDAG-1214"><a href="#QueueDAG-1214"><span class="linenos">1214</span></a><span class="sd">        Queue DAG nodes may have a maximum of one child and one parent worker.</span>
</span><span id="QueueDAG-1215"><a href="#QueueDAG-1215"><span class="linenos">1215</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="QueueDAG-1216"><a href="#QueueDAG-1216"><span class="linenos">1216</span></a>        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="p">(</span><span class="n">u_of_edge</span><span class="p">,</span> <span class="n">v_of_edge</span><span class="p">):</span>
</span><span id="QueueDAG-1217"><a href="#QueueDAG-1217"><span class="linenos">1217</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="QueueDAG-1218"><a href="#QueueDAG-1218"><span class="linenos">1218</span></a>                <span class="n">node_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_id</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
</span><span id="QueueDAG-1219"><a href="#QueueDAG-1219"><span class="linenos">1219</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="QueueDAG-1220"><a href="#QueueDAG-1220"><span class="linenos">1220</span></a>                <span class="k">continue</span>
</span><span id="QueueDAG-1221"><a href="#QueueDAG-1221"><span class="linenos">1221</span></a>        
</span><span id="QueueDAG-1222"><a href="#QueueDAG-1222"><span class="linenos">1222</span></a>            <span class="nb">filter</span> <span class="o">=</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="n">e</span><span class="o">.</span><span class="n">parent</span> <span class="o">==</span> <span class="n">node_id</span><span class="p">)</span> <span class="k">if</span> <span class="n">node</span> <span class="o">==</span> <span class="n">u_of_edge</span> <span class="k">else</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="n">e</span><span class="o">.</span><span class="n">child</span> <span class="o">==</span> <span class="n">node_id</span><span class="p">)</span>
</span><span id="QueueDAG-1223"><a href="#QueueDAG-1223"><span class="linenos">1223</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="QueueDAG-1224"><a href="#QueueDAG-1224"><span class="linenos">1224</span></a>                <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filter_edges</span><span class="p">(</span><span class="nb">filter</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="QueueDAG-1225"><a href="#QueueDAG-1225"><span class="linenos">1225</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="QueueDAG-1226"><a href="#QueueDAG-1226"><span class="linenos">1226</span></a>                <span class="n">e</span><span class="o">.</span><span class="n">add_note</span><span class="p">(</span><span class="s2">&quot;Queue DAG nodes may have a maximum of one child and one parent worker.&quot;</span><span class="p">)</span>
</span><span id="QueueDAG-1227"><a href="#QueueDAG-1227"><span class="linenos">1227</span></a>                <span class="k">raise</span> <span class="n">e</span>
</span><span id="QueueDAG-1228"><a href="#QueueDAG-1228"><span class="linenos">1228</span></a>
</span><span id="QueueDAG-1229"><a href="#QueueDAG-1229"><span class="linenos">1229</span></a>        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">u_of_edge</span><span class="p">,</span> <span class="n">v_of_edge</span><span class="p">,</span> <span class="n">continue_on</span><span class="p">)</span>
</span><span id="QueueDAG-1230"><a href="#QueueDAG-1230"><span class="linenos">1230</span></a>
</span><span id="QueueDAG-1231"><a href="#QueueDAG-1231"><span class="linenos">1231</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">promises</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">,</span> <span class="n">return_ref</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">print_exc</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_T</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="QueueDAG-1232"><a href="#QueueDAG-1232"><span class="linenos">1232</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="QueueDAG-1233"><a href="#QueueDAG-1233"><span class="linenos">1233</span></a><span class="sd">        Basic wrapper for execution of the DAG&#39;s underlying callables.</span>
</span><span id="QueueDAG-1234"><a href="#QueueDAG-1234"><span class="linenos">1234</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="QueueDAG-1235"><a href="#QueueDAG-1235"><span class="linenos">1235</span></a>        <span class="n">queues</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_q</span><span class="o">.</span><span class="n">LifoQueue</span><span class="p">[</span><span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="QueueDAG-1236"><a href="#QueueDAG-1236"><span class="linenos">1236</span></a>        <span class="n">processes</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_futures</span><span class="o">.</span><span class="n">Future</span><span class="p">[</span><span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="QueueDAG-1237"><a href="#QueueDAG-1237"><span class="linenos">1237</span></a>        <span class="n">join</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="QueueDAG-1238"><a href="#QueueDAG-1238"><span class="linenos">1238</span></a>        <span class="n">end_proc</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="QueueDAG-1239"><a href="#QueueDAG-1239"><span class="linenos">1239</span></a>
</span><span id="QueueDAG-1240"><a href="#QueueDAG-1240"><span class="linenos">1240</span></a>        <span class="n">_promises</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">_it</span><span class="o">.</span><span class="n">pairwise</span><span class="p">(</span><span class="n">promises</span><span class="p">)</span> <span class="p">}</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">promises</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">{}</span>
</span><span id="QueueDAG-1241"><a href="#QueueDAG-1241"><span class="linenos">1241</span></a>
</span><span id="QueueDAG-1242"><a href="#QueueDAG-1242"><span class="linenos">1242</span></a>        <span class="k">with</span> <span class="n">_TaskLogger</span><span class="p">(</span><span class="s2">&quot;root&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">_</span><span class="p">:</span>
</span><span id="QueueDAG-1243"><a href="#QueueDAG-1243"><span class="linenos">1243</span></a>
</span><span id="QueueDAG-1244"><a href="#QueueDAG-1244"><span class="linenos">1244</span></a>            <span class="c1"># Skip execution if there are no callables in scope.</span>
</span><span id="QueueDAG-1245"><a href="#QueueDAG-1245"><span class="linenos">1245</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="QueueDAG-1246"><a href="#QueueDAG-1246"><span class="linenos">1246</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Given DAG has no callables in scope. Skipping execution...&#39;</span><span class="p">)</span>
</span><span id="QueueDAG-1247"><a href="#QueueDAG-1247"><span class="linenos">1247</span></a>                <span class="k">return</span>
</span><span id="QueueDAG-1248"><a href="#QueueDAG-1248"><span class="linenos">1248</span></a>
</span><span id="QueueDAG-1249"><a href="#QueueDAG-1249"><span class="linenos">1249</span></a>            <span class="k">with</span> <span class="n">_futures</span><span class="o">.</span><span class="n">ThreadPoolExecutor</span><span class="p">()</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
</span><span id="QueueDAG-1250"><a href="#QueueDAG-1250"><span class="linenos">1250</span></a>
</span><span id="QueueDAG-1251"><a href="#QueueDAG-1251"><span class="linenos">1251</span></a>                <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">:</span>
</span><span id="QueueDAG-1252"><a href="#QueueDAG-1252"><span class="linenos">1252</span></a>                    <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
</span><span id="QueueDAG-1253"><a href="#QueueDAG-1253"><span class="linenos">1253</span></a>                    <span class="n">queues</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">_q</span><span class="o">.</span><span class="n">LifoQueue</span><span class="p">()</span>
</span><span id="QueueDAG-1254"><a href="#QueueDAG-1254"><span class="linenos">1254</span></a>                    <span class="n">node</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
</span><span id="QueueDAG-1255"><a href="#QueueDAG-1255"><span class="linenos">1255</span></a>                        <span class="s1">&#39;callable&#39;</span><span class="p">:</span> <span class="n">_queue</span><span class="o">.</span><span class="n">_worker</span><span class="p">,</span>
</span><span id="QueueDAG-1256"><a href="#QueueDAG-1256"><span class="linenos">1256</span></a>                        <span class="s1">&#39;args&#39;</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">(),</span>
</span><span id="QueueDAG-1257"><a href="#QueueDAG-1257"><span class="linenos">1257</span></a>                        <span class="s1">&#39;kwargs&#39;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="QueueDAG-1258"><a href="#QueueDAG-1258"><span class="linenos">1258</span></a>                            <span class="s1">&#39;work&#39;</span><span class="p">:</span> <span class="n">node</span><span class="o">.</span><span class="n">callable</span><span class="p">,</span>
</span><span id="QueueDAG-1259"><a href="#QueueDAG-1259"><span class="linenos">1259</span></a>                            <span class="s1">&#39;args&#39;</span><span class="p">:</span> <span class="n">node</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="s1">&#39;kwargs&#39;</span><span class="p">:</span> <span class="n">node</span><span class="o">.</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="QueueDAG-1260"><a href="#QueueDAG-1260"><span class="linenos">1260</span></a>                            <span class="s1">&#39;promises&#39;</span><span class="p">:</span> <span class="n">_promises</span><span class="p">,</span>
</span><span id="QueueDAG-1261"><a href="#QueueDAG-1261"><span class="linenos">1261</span></a>                            <span class="s1">&#39;print_exc&#39;</span><span class="p">:</span> <span class="n">print_exc</span><span class="p">,</span>
</span><span id="QueueDAG-1262"><a href="#QueueDAG-1262"><span class="linenos">1262</span></a>                            <span class="s1">&#39;halt_condition&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">conditions</span><span class="p">[</span><span class="nb">id</span><span class="p">][</span><span class="s1">&#39;halt_condition&#39;</span><span class="p">],</span>
</span><span id="QueueDAG-1263"><a href="#QueueDAG-1263"><span class="linenos">1263</span></a>                            <span class="s1">&#39;iter_limit&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">conditions</span><span class="p">[</span><span class="nb">id</span><span class="p">][</span><span class="s1">&#39;iter_limit&#39;</span><span class="p">],</span>
</span><span id="QueueDAG-1264"><a href="#QueueDAG-1264"><span class="linenos">1264</span></a>                            <span class="s1">&#39;out_queue&#39;</span><span class="p">:</span> <span class="n">queues</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
</span><span id="QueueDAG-1265"><a href="#QueueDAG-1265"><span class="linenos">1265</span></a>                        <span class="p">}</span>
</span><span id="QueueDAG-1266"><a href="#QueueDAG-1266"><span class="linenos">1266</span></a>                    <span class="p">})</span>
</span><span id="QueueDAG-1267"><a href="#QueueDAG-1267"><span class="linenos">1267</span></a>                    <span class="n">processes</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span>
</span><span id="QueueDAG-1268"><a href="#QueueDAG-1268"><span class="linenos">1268</span></a>                        <span class="n">_event_wrapper</span><span class="p">,</span>
</span><span id="QueueDAG-1269"><a href="#QueueDAG-1269"><span class="linenos">1269</span></a>                        <span class="n">_callable</span><span class="o">=</span><span class="n">node</span><span class="p">[</span><span class="s1">&#39;callable&#39;</span><span class="p">],</span>
</span><span id="QueueDAG-1270"><a href="#QueueDAG-1270"><span class="linenos">1270</span></a>                        <span class="n">_name</span><span class="o">=</span><span class="n">node</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
</span><span id="QueueDAG-1271"><a href="#QueueDAG-1271"><span class="linenos">1271</span></a>                        <span class="n">_args</span><span class="o">=</span><span class="n">node</span><span class="p">[</span><span class="s1">&#39;args&#39;</span><span class="p">],</span>
</span><span id="QueueDAG-1272"><a href="#QueueDAG-1272"><span class="linenos">1272</span></a>                        <span class="n">_kwargs</span><span class="o">=</span><span class="n">node</span><span class="p">[</span><span class="s1">&#39;kwargs&#39;</span><span class="p">]</span>
</span><span id="QueueDAG-1273"><a href="#QueueDAG-1273"><span class="linenos">1273</span></a>                    <span class="p">)</span>
</span><span id="QueueDAG-1274"><a href="#QueueDAG-1274"><span class="linenos">1274</span></a>                
</span><span id="QueueDAG-1275"><a href="#QueueDAG-1275"><span class="linenos">1275</span></a>                <span class="k">for</span> <span class="n">parent_id</span><span class="p">,</span> <span class="nb">id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">:</span>
</span><span id="QueueDAG-1276"><a href="#QueueDAG-1276"><span class="linenos">1276</span></a>                    <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
</span><span id="QueueDAG-1277"><a href="#QueueDAG-1277"><span class="linenos">1277</span></a>                    <span class="n">queues</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">_q</span><span class="o">.</span><span class="n">LifoQueue</span><span class="p">()</span>
</span><span id="QueueDAG-1278"><a href="#QueueDAG-1278"><span class="linenos">1278</span></a>                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">successors</span><span class="p">(</span><span class="nb">id</span><span class="p">)))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="QueueDAG-1279"><a href="#QueueDAG-1279"><span class="linenos">1279</span></a>                        <span class="n">end_proc</span> <span class="o">=</span> <span class="nb">id</span>
</span><span id="QueueDAG-1280"><a href="#QueueDAG-1280"><span class="linenos">1280</span></a>                    <span class="n">node</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
</span><span id="QueueDAG-1281"><a href="#QueueDAG-1281"><span class="linenos">1281</span></a>                        <span class="s1">&#39;callable&#39;</span><span class="p">:</span> <span class="n">_queue</span><span class="o">.</span><span class="n">_worker</span><span class="p">,</span>
</span><span id="QueueDAG-1282"><a href="#QueueDAG-1282"><span class="linenos">1282</span></a>                        <span class="s1">&#39;args&#39;</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">(),</span>
</span><span id="QueueDAG-1283"><a href="#QueueDAG-1283"><span class="linenos">1283</span></a>                        <span class="s1">&#39;kwargs&#39;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="QueueDAG-1284"><a href="#QueueDAG-1284"><span class="linenos">1284</span></a>                            <span class="s1">&#39;work&#39;</span><span class="p">:</span> <span class="n">node</span><span class="o">.</span><span class="n">callable</span><span class="p">,</span>
</span><span id="QueueDAG-1285"><a href="#QueueDAG-1285"><span class="linenos">1285</span></a>                            <span class="s1">&#39;args&#39;</span><span class="p">:</span> <span class="n">node</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="s1">&#39;kwargs&#39;</span><span class="p">:</span> <span class="n">node</span><span class="o">.</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="QueueDAG-1286"><a href="#QueueDAG-1286"><span class="linenos">1286</span></a>                            <span class="s1">&#39;promises&#39;</span><span class="p">:</span> <span class="n">_promises</span><span class="p">,</span>
</span><span id="QueueDAG-1287"><a href="#QueueDAG-1287"><span class="linenos">1287</span></a>                            <span class="s1">&#39;print_exc&#39;</span><span class="p">:</span> <span class="n">print_exc</span><span class="p">,</span>
</span><span id="QueueDAG-1288"><a href="#QueueDAG-1288"><span class="linenos">1288</span></a>                            <span class="s1">&#39;parent_id&#39;</span><span class="p">:</span> <span class="n">parent_id</span><span class="p">,</span>
</span><span id="QueueDAG-1289"><a href="#QueueDAG-1289"><span class="linenos">1289</span></a>                            <span class="s1">&#39;parent_process&#39;</span><span class="p">:</span> <span class="n">processes</span><span class="p">[</span><span class="n">parent_id</span><span class="p">],</span>
</span><span id="QueueDAG-1290"><a href="#QueueDAG-1290"><span class="linenos">1290</span></a>                            <span class="s1">&#39;in_queue&#39;</span><span class="p">:</span> <span class="n">queues</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">parent_id</span><span class="p">),</span>
</span><span id="QueueDAG-1291"><a href="#QueueDAG-1291"><span class="linenos">1291</span></a>                            <span class="s1">&#39;out_queue&#39;</span><span class="p">:</span> <span class="n">queues</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
</span><span id="QueueDAG-1292"><a href="#QueueDAG-1292"><span class="linenos">1292</span></a>                        <span class="p">}</span>
</span><span id="QueueDAG-1293"><a href="#QueueDAG-1293"><span class="linenos">1293</span></a>                    <span class="p">})</span>
</span><span id="QueueDAG-1294"><a href="#QueueDAG-1294"><span class="linenos">1294</span></a>                    <span class="n">processes</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span>
</span><span id="QueueDAG-1295"><a href="#QueueDAG-1295"><span class="linenos">1295</span></a>                        <span class="n">_event_wrapper</span><span class="p">,</span>
</span><span id="QueueDAG-1296"><a href="#QueueDAG-1296"><span class="linenos">1296</span></a>                        <span class="n">_callable</span><span class="o">=</span><span class="n">node</span><span class="p">[</span><span class="s1">&#39;callable&#39;</span><span class="p">],</span>
</span><span id="QueueDAG-1297"><a href="#QueueDAG-1297"><span class="linenos">1297</span></a>                        <span class="n">_name</span><span class="o">=</span><span class="n">node</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
</span><span id="QueueDAG-1298"><a href="#QueueDAG-1298"><span class="linenos">1298</span></a>                        <span class="n">_args</span><span class="o">=</span><span class="n">node</span><span class="p">[</span><span class="s1">&#39;args&#39;</span><span class="p">],</span>
</span><span id="QueueDAG-1299"><a href="#QueueDAG-1299"><span class="linenos">1299</span></a>                        <span class="n">_kwargs</span><span class="o">=</span><span class="n">node</span><span class="p">[</span><span class="s1">&#39;kwargs&#39;</span><span class="p">]</span>
</span><span id="QueueDAG-1300"><a href="#QueueDAG-1300"><span class="linenos">1300</span></a>                    <span class="p">)</span>
</span><span id="QueueDAG-1301"><a href="#QueueDAG-1301"><span class="linenos">1301</span></a>
</span><span id="QueueDAG-1302"><a href="#QueueDAG-1302"><span class="linenos">1302</span></a>            <span class="c1"># For single-node DAGs with no edges, end_proc is the root node</span>
</span><span id="QueueDAG-1303"><a href="#QueueDAG-1303"><span class="linenos">1303</span></a>            <span class="k">if</span> <span class="n">end_proc</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="QueueDAG-1304"><a href="#QueueDAG-1304"><span class="linenos">1304</span></a>                <span class="n">end_proc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="QueueDAG-1305"><a href="#QueueDAG-1305"><span class="linenos">1305</span></a>
</span><span id="QueueDAG-1306"><a href="#QueueDAG-1306"><span class="linenos">1306</span></a>            <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">join</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">):</span>
</span><span id="QueueDAG-1307"><a href="#QueueDAG-1307"><span class="linenos">1307</span></a>                <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
</span><span id="QueueDAG-1308"><a href="#QueueDAG-1308"><span class="linenos">1308</span></a>                    <span class="k">if</span> <span class="n">processes</span><span class="p">[</span><span class="n">node</span><span class="p">]</span><span class="o">.</span><span class="n">done</span><span class="p">():</span>
</span><span id="QueueDAG-1309"><a href="#QueueDAG-1309"><span class="linenos">1309</span></a>                        <span class="n">join</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
</span><span id="QueueDAG-1310"><a href="#QueueDAG-1310"><span class="linenos">1310</span></a>
</span><span id="QueueDAG-1311"><a href="#QueueDAG-1311"><span class="linenos">1311</span></a>            <span class="n">return_val</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="QueueDAG-1312"><a href="#QueueDAG-1312"><span class="linenos">1312</span></a>            <span class="k">if</span> <span class="n">end_proc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">end_proc</span> <span class="ow">in</span> <span class="n">queues</span><span class="p">:</span>
</span><span id="QueueDAG-1313"><a href="#QueueDAG-1313"><span class="linenos">1313</span></a>                <span class="k">while</span> <span class="ow">not</span> <span class="n">queues</span><span class="p">[</span><span class="n">end_proc</span><span class="p">]</span><span class="o">.</span><span class="n">empty</span><span class="p">():</span>
</span><span id="QueueDAG-1314"><a href="#QueueDAG-1314"><span class="linenos">1314</span></a>                    <span class="n">return_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">queues</span><span class="p">[</span><span class="n">end_proc</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">())</span>
</span><span id="QueueDAG-1315"><a href="#QueueDAG-1315"><span class="linenos">1315</span></a>
</span><span id="QueueDAG-1316"><a href="#QueueDAG-1316"><span class="linenos">1316</span></a>            <span class="k">return</span> <span class="n">return_val</span>
</span></pre></div>


            <div class="docstring"><p>Directed Acyclic Graph used to queue and execute Pythonic callables in parallel,
while stringing the outputs of those callables in linear sequences.</p>

<p>Queue DAG nodes are repeated until the DAG executor completes or is killed, depending on the
behavior of root nodes to determine if and/or when the DAG run has been completed.</p>

<p>Root nodes will be re-executed until culled by one of two conditions:</p>

<ol>
<li>A max number of iterations has been completed, or</li>
<li>The output of the root node's callable matches a lambda halt_condition.</li>
</ol>

<p>Both conditions can be set at run-time.</p>

<p>QueueDAG can be nested inside a standard <a href="#DAG">webber.DAG</a> by passing qdag.execute as a callable.
Benchmarks show moderate overhead of 1.3-2.5x (~1-2ms fixed cost) when nested, due to the
outer DAG's ThreadPoolExecutor setup and task wrapper infrastructure. This is well within
acceptable millisecond-scale latency for most real-time applications.</p>
</div>


                            <div id="QueueDAG.conditions" class="classattr">
                                <div class="attr variable">
            <span class="name">conditions</span><span class="annotation">: Dict[str, Dict[str, Any]]</span>        =
<span class="default_value">{}</span>

        
    </div>
    <a class="headerlink" href="#QueueDAG.conditions"></a>
    
    

                            </div>
                            <div id="QueueDAG.add_node" class="classattr">
                                        <input id="QueueDAG.add_node-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_node</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">node</span><span class="p">:</span> <span class="n">Any</span>, </span><span class="param"><span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="QueueDAG.add_node-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#QueueDAG.add_node"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="QueueDAG.add_node-1176"><a href="#QueueDAG.add_node-1176"><span class="linenos">1176</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="QueueDAG.add_node-1177"><a href="#QueueDAG.add_node-1177"><span class="linenos">1177</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="QueueDAG.add_node-1178"><a href="#QueueDAG.add_node-1178"><span class="linenos">1178</span></a><span class="sd">        Adds a callable with positional and keyword arguments to the DAG&#39;s underlying graph.</span>
</span><span id="QueueDAG.add_node-1179"><a href="#QueueDAG.add_node-1179"><span class="linenos">1179</span></a><span class="sd">        On success, return unique identifier for the new node.</span>
</span><span id="QueueDAG.add_node-1180"><a href="#QueueDAG.add_node-1180"><span class="linenos">1180</span></a><span class="sd">        </span>
</span><span id="QueueDAG.add_node-1181"><a href="#QueueDAG.add_node-1181"><span class="linenos">1181</span></a><span class="sd">        Reserved key-words are used for Queue DAG definitions:</span>
</span><span id="QueueDAG.add_node-1182"><a href="#QueueDAG.add_node-1182"><span class="linenos">1182</span></a><span class="sd">        </span>
</span><span id="QueueDAG.add_node-1183"><a href="#QueueDAG.add_node-1183"><span class="linenos">1183</span></a><span class="sd">        - halt_condition: Lambda function used to halt repeated execution of a Queue DAG node that is independent of other callables.</span>
</span><span id="QueueDAG.add_node-1184"><a href="#QueueDAG.add_node-1184"><span class="linenos">1184</span></a>
</span><span id="QueueDAG.add_node-1185"><a href="#QueueDAG.add_node-1185"><span class="linenos">1185</span></a><span class="sd">        \t halt_condition = (lambda output: output == None) </span>
</span><span id="QueueDAG.add_node-1186"><a href="#QueueDAG.add_node-1186"><span class="linenos">1186</span></a>
</span><span id="QueueDAG.add_node-1187"><a href="#QueueDAG.add_node-1187"><span class="linenos">1187</span></a><span class="sd">        - iterator: Discrete number of times that Queue DAG node should be executed. Meant to be mutually-exclusive of halt_condition argument.</span>
</span><span id="QueueDAG.add_node-1188"><a href="#QueueDAG.add_node-1188"><span class="linenos">1188</span></a>
</span><span id="QueueDAG.add_node-1189"><a href="#QueueDAG.add_node-1189"><span class="linenos">1189</span></a><span class="sd">        - max_iter: Maximum number of times that Queue DAG node should be executed. Meant for use with halt_condition in order to prevent forever loop.</span>
</span><span id="QueueDAG.add_node-1190"><a href="#QueueDAG.add_node-1190"><span class="linenos">1190</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="QueueDAG.add_node-1191"><a href="#QueueDAG.add_node-1191"><span class="linenos">1191</span></a>        <span class="n">halt_condition</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;halt_condition&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="QueueDAG.add_node-1192"><a href="#QueueDAG.add_node-1192"><span class="linenos">1192</span></a>        <span class="n">iterator</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;iterator&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="QueueDAG.add_node-1193"><a href="#QueueDAG.add_node-1193"><span class="linenos">1193</span></a>        <span class="n">max_iter</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;max_iter&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="QueueDAG.add_node-1194"><a href="#QueueDAG.add_node-1194"><span class="linenos">1194</span></a>
</span><span id="QueueDAG.add_node-1195"><a href="#QueueDAG.add_node-1195"><span class="linenos">1195</span></a>        <span class="n">return_val</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="QueueDAG.add_node-1196"><a href="#QueueDAG.add_node-1196"><span class="linenos">1196</span></a>        
</span><span id="QueueDAG.add_node-1197"><a href="#QueueDAG.add_node-1197"><span class="linenos">1197</span></a>        <span class="k">if</span> <span class="n">max_iter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="QueueDAG.add_node-1198"><a href="#QueueDAG.add_node-1198"><span class="linenos">1198</span></a>            <span class="n">iter_limit</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">max_iter</span><span class="p">)</span>
</span><span id="QueueDAG.add_node-1199"><a href="#QueueDAG.add_node-1199"><span class="linenos">1199</span></a>        <span class="k">elif</span> <span class="n">iterator</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="QueueDAG.add_node-1200"><a href="#QueueDAG.add_node-1200"><span class="linenos">1200</span></a>            <span class="n">iter_limit</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">iterator</span><span class="p">)</span>
</span><span id="QueueDAG.add_node-1201"><a href="#QueueDAG.add_node-1201"><span class="linenos">1201</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="QueueDAG.add_node-1202"><a href="#QueueDAG.add_node-1202"><span class="linenos">1202</span></a>            <span class="n">iter_limit</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="QueueDAG.add_node-1203"><a href="#QueueDAG.add_node-1203"><span class="linenos">1203</span></a>        
</span><span id="QueueDAG.add_node-1204"><a href="#QueueDAG.add_node-1204"><span class="linenos">1204</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">conditions</span><span class="p">[</span><span class="n">return_val</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="QueueDAG.add_node-1205"><a href="#QueueDAG.add_node-1205"><span class="linenos">1205</span></a>            <span class="s1">&#39;halt_condition&#39;</span><span class="p">:</span> <span class="n">halt_condition</span><span class="p">,</span>
</span><span id="QueueDAG.add_node-1206"><a href="#QueueDAG.add_node-1206"><span class="linenos">1206</span></a>            <span class="s1">&#39;iter_limit&#39;</span><span class="p">:</span> <span class="n">iter_limit</span>
</span><span id="QueueDAG.add_node-1207"><a href="#QueueDAG.add_node-1207"><span class="linenos">1207</span></a>        <span class="p">}</span>
</span><span id="QueueDAG.add_node-1208"><a href="#QueueDAG.add_node-1208"><span class="linenos">1208</span></a>
</span><span id="QueueDAG.add_node-1209"><a href="#QueueDAG.add_node-1209"><span class="linenos">1209</span></a>        <span class="k">return</span> <span class="n">return_val</span>
</span></pre></div>


            <div class="docstring"><p>Adds a callable with positional and keyword arguments to the DAG's underlying graph.
On success, return unique identifier for the new node.</p>

<p>Reserved key-words are used for Queue DAG definitions:</p>

<ul>
<li><p>halt_condition: Lambda function used to halt repeated execution of a Queue DAG node that is independent of other callables.</p>

<pre><code> halt_condition = (lambda output: output == None)
</code></pre></li>
<li><p>iterator: Discrete number of times that Queue DAG node should be executed. Meant to be mutually-exclusive of halt_condition argument.</p></li>
<li><p>max_iter: Maximum number of times that Queue DAG node should be executed. Meant for use with halt_condition in order to prevent forever loop.</p></li>
</ul>
</div>


                            </div>
                            <div id="QueueDAG.add_edge" class="classattr">
                                        <input id="QueueDAG.add_edge-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_edge</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">u_of_edge</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Callable</span><span class="p">]</span>,</span><span class="param">	<span class="n">v_of_edge</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Callable</span><span class="p">]</span>,</span><span class="param">	<span class="n">continue_on</span><span class="p">:</span> <span class="n"><a href="#Condition">Condition</a></span> <span class="o">=</span> <span class="o">&lt;</span><span class="n"><a href="#Condition.Success">Condition.Success</a></span><span class="p">:</span> <span class="mi">0</span><span class="o">&gt;</span></span><span class="return-annotation">) -> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="QueueDAG.add_edge-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#QueueDAG.add_edge"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="QueueDAG.add_edge-1211"><a href="#QueueDAG.add_edge-1211"><span class="linenos">1211</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_edge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">u_of_edge</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_T</span><span class="o">.</span><span class="n">Callable</span><span class="p">],</span> <span class="n">v_of_edge</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_T</span><span class="o">.</span><span class="n">Callable</span><span class="p">],</span> <span class="n">continue_on</span><span class="p">:</span> <span class="n">Condition</span> <span class="o">=</span> <span class="n">Condition</span><span class="o">.</span><span class="n">Success</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_T</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
</span><span id="QueueDAG.add_edge-1212"><a href="#QueueDAG.add_edge-1212"><span class="linenos">1212</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="QueueDAG.add_edge-1213"><a href="#QueueDAG.add_edge-1213"><span class="linenos">1213</span></a><span class="sd">        Adds an edge between nodes in the Queue DAG&#39;s underlying graph.</span>
</span><span id="QueueDAG.add_edge-1214"><a href="#QueueDAG.add_edge-1214"><span class="linenos">1214</span></a><span class="sd">        Queue DAG nodes may have a maximum of one child and one parent worker.</span>
</span><span id="QueueDAG.add_edge-1215"><a href="#QueueDAG.add_edge-1215"><span class="linenos">1215</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="QueueDAG.add_edge-1216"><a href="#QueueDAG.add_edge-1216"><span class="linenos">1216</span></a>        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="p">(</span><span class="n">u_of_edge</span><span class="p">,</span> <span class="n">v_of_edge</span><span class="p">):</span>
</span><span id="QueueDAG.add_edge-1217"><a href="#QueueDAG.add_edge-1217"><span class="linenos">1217</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="QueueDAG.add_edge-1218"><a href="#QueueDAG.add_edge-1218"><span class="linenos">1218</span></a>                <span class="n">node_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_id</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
</span><span id="QueueDAG.add_edge-1219"><a href="#QueueDAG.add_edge-1219"><span class="linenos">1219</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="QueueDAG.add_edge-1220"><a href="#QueueDAG.add_edge-1220"><span class="linenos">1220</span></a>                <span class="k">continue</span>
</span><span id="QueueDAG.add_edge-1221"><a href="#QueueDAG.add_edge-1221"><span class="linenos">1221</span></a>        
</span><span id="QueueDAG.add_edge-1222"><a href="#QueueDAG.add_edge-1222"><span class="linenos">1222</span></a>            <span class="nb">filter</span> <span class="o">=</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="n">e</span><span class="o">.</span><span class="n">parent</span> <span class="o">==</span> <span class="n">node_id</span><span class="p">)</span> <span class="k">if</span> <span class="n">node</span> <span class="o">==</span> <span class="n">u_of_edge</span> <span class="k">else</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="n">e</span><span class="o">.</span><span class="n">child</span> <span class="o">==</span> <span class="n">node_id</span><span class="p">)</span>
</span><span id="QueueDAG.add_edge-1223"><a href="#QueueDAG.add_edge-1223"><span class="linenos">1223</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="QueueDAG.add_edge-1224"><a href="#QueueDAG.add_edge-1224"><span class="linenos">1224</span></a>                <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filter_edges</span><span class="p">(</span><span class="nb">filter</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="QueueDAG.add_edge-1225"><a href="#QueueDAG.add_edge-1225"><span class="linenos">1225</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="QueueDAG.add_edge-1226"><a href="#QueueDAG.add_edge-1226"><span class="linenos">1226</span></a>                <span class="n">e</span><span class="o">.</span><span class="n">add_note</span><span class="p">(</span><span class="s2">&quot;Queue DAG nodes may have a maximum of one child and one parent worker.&quot;</span><span class="p">)</span>
</span><span id="QueueDAG.add_edge-1227"><a href="#QueueDAG.add_edge-1227"><span class="linenos">1227</span></a>                <span class="k">raise</span> <span class="n">e</span>
</span><span id="QueueDAG.add_edge-1228"><a href="#QueueDAG.add_edge-1228"><span class="linenos">1228</span></a>
</span><span id="QueueDAG.add_edge-1229"><a href="#QueueDAG.add_edge-1229"><span class="linenos">1229</span></a>        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">u_of_edge</span><span class="p">,</span> <span class="n">v_of_edge</span><span class="p">,</span> <span class="n">continue_on</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Adds an edge between nodes in the Queue DAG's underlying graph.
Queue DAG nodes may have a maximum of one child and one parent worker.</p>
</div>


                            </div>
                            <div id="QueueDAG.execute" class="classattr">
                                        <input id="QueueDAG.execute-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">execute</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="o">*</span><span class="n">promises</span><span class="p">:</span> <span class="n">Any</span>,</span><span class="param">	<span class="n">return_ref</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">print_exc</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="QueueDAG.execute-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#QueueDAG.execute"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="QueueDAG.execute-1231"><a href="#QueueDAG.execute-1231"><span class="linenos">1231</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">promises</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">,</span> <span class="n">return_ref</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">print_exc</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_T</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="QueueDAG.execute-1232"><a href="#QueueDAG.execute-1232"><span class="linenos">1232</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="QueueDAG.execute-1233"><a href="#QueueDAG.execute-1233"><span class="linenos">1233</span></a><span class="sd">        Basic wrapper for execution of the DAG&#39;s underlying callables.</span>
</span><span id="QueueDAG.execute-1234"><a href="#QueueDAG.execute-1234"><span class="linenos">1234</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="QueueDAG.execute-1235"><a href="#QueueDAG.execute-1235"><span class="linenos">1235</span></a>        <span class="n">queues</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_q</span><span class="o">.</span><span class="n">LifoQueue</span><span class="p">[</span><span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="QueueDAG.execute-1236"><a href="#QueueDAG.execute-1236"><span class="linenos">1236</span></a>        <span class="n">processes</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_futures</span><span class="o">.</span><span class="n">Future</span><span class="p">[</span><span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="QueueDAG.execute-1237"><a href="#QueueDAG.execute-1237"><span class="linenos">1237</span></a>        <span class="n">join</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="QueueDAG.execute-1238"><a href="#QueueDAG.execute-1238"><span class="linenos">1238</span></a>        <span class="n">end_proc</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="QueueDAG.execute-1239"><a href="#QueueDAG.execute-1239"><span class="linenos">1239</span></a>
</span><span id="QueueDAG.execute-1240"><a href="#QueueDAG.execute-1240"><span class="linenos">1240</span></a>        <span class="n">_promises</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">_it</span><span class="o">.</span><span class="n">pairwise</span><span class="p">(</span><span class="n">promises</span><span class="p">)</span> <span class="p">}</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">promises</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">{}</span>
</span><span id="QueueDAG.execute-1241"><a href="#QueueDAG.execute-1241"><span class="linenos">1241</span></a>
</span><span id="QueueDAG.execute-1242"><a href="#QueueDAG.execute-1242"><span class="linenos">1242</span></a>        <span class="k">with</span> <span class="n">_TaskLogger</span><span class="p">(</span><span class="s2">&quot;root&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">_</span><span class="p">:</span>
</span><span id="QueueDAG.execute-1243"><a href="#QueueDAG.execute-1243"><span class="linenos">1243</span></a>
</span><span id="QueueDAG.execute-1244"><a href="#QueueDAG.execute-1244"><span class="linenos">1244</span></a>            <span class="c1"># Skip execution if there are no callables in scope.</span>
</span><span id="QueueDAG.execute-1245"><a href="#QueueDAG.execute-1245"><span class="linenos">1245</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="QueueDAG.execute-1246"><a href="#QueueDAG.execute-1246"><span class="linenos">1246</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Given DAG has no callables in scope. Skipping execution...&#39;</span><span class="p">)</span>
</span><span id="QueueDAG.execute-1247"><a href="#QueueDAG.execute-1247"><span class="linenos">1247</span></a>                <span class="k">return</span>
</span><span id="QueueDAG.execute-1248"><a href="#QueueDAG.execute-1248"><span class="linenos">1248</span></a>
</span><span id="QueueDAG.execute-1249"><a href="#QueueDAG.execute-1249"><span class="linenos">1249</span></a>            <span class="k">with</span> <span class="n">_futures</span><span class="o">.</span><span class="n">ThreadPoolExecutor</span><span class="p">()</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
</span><span id="QueueDAG.execute-1250"><a href="#QueueDAG.execute-1250"><span class="linenos">1250</span></a>
</span><span id="QueueDAG.execute-1251"><a href="#QueueDAG.execute-1251"><span class="linenos">1251</span></a>                <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">:</span>
</span><span id="QueueDAG.execute-1252"><a href="#QueueDAG.execute-1252"><span class="linenos">1252</span></a>                    <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
</span><span id="QueueDAG.execute-1253"><a href="#QueueDAG.execute-1253"><span class="linenos">1253</span></a>                    <span class="n">queues</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">_q</span><span class="o">.</span><span class="n">LifoQueue</span><span class="p">()</span>
</span><span id="QueueDAG.execute-1254"><a href="#QueueDAG.execute-1254"><span class="linenos">1254</span></a>                    <span class="n">node</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
</span><span id="QueueDAG.execute-1255"><a href="#QueueDAG.execute-1255"><span class="linenos">1255</span></a>                        <span class="s1">&#39;callable&#39;</span><span class="p">:</span> <span class="n">_queue</span><span class="o">.</span><span class="n">_worker</span><span class="p">,</span>
</span><span id="QueueDAG.execute-1256"><a href="#QueueDAG.execute-1256"><span class="linenos">1256</span></a>                        <span class="s1">&#39;args&#39;</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">(),</span>
</span><span id="QueueDAG.execute-1257"><a href="#QueueDAG.execute-1257"><span class="linenos">1257</span></a>                        <span class="s1">&#39;kwargs&#39;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="QueueDAG.execute-1258"><a href="#QueueDAG.execute-1258"><span class="linenos">1258</span></a>                            <span class="s1">&#39;work&#39;</span><span class="p">:</span> <span class="n">node</span><span class="o">.</span><span class="n">callable</span><span class="p">,</span>
</span><span id="QueueDAG.execute-1259"><a href="#QueueDAG.execute-1259"><span class="linenos">1259</span></a>                            <span class="s1">&#39;args&#39;</span><span class="p">:</span> <span class="n">node</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="s1">&#39;kwargs&#39;</span><span class="p">:</span> <span class="n">node</span><span class="o">.</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="QueueDAG.execute-1260"><a href="#QueueDAG.execute-1260"><span class="linenos">1260</span></a>                            <span class="s1">&#39;promises&#39;</span><span class="p">:</span> <span class="n">_promises</span><span class="p">,</span>
</span><span id="QueueDAG.execute-1261"><a href="#QueueDAG.execute-1261"><span class="linenos">1261</span></a>                            <span class="s1">&#39;print_exc&#39;</span><span class="p">:</span> <span class="n">print_exc</span><span class="p">,</span>
</span><span id="QueueDAG.execute-1262"><a href="#QueueDAG.execute-1262"><span class="linenos">1262</span></a>                            <span class="s1">&#39;halt_condition&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">conditions</span><span class="p">[</span><span class="nb">id</span><span class="p">][</span><span class="s1">&#39;halt_condition&#39;</span><span class="p">],</span>
</span><span id="QueueDAG.execute-1263"><a href="#QueueDAG.execute-1263"><span class="linenos">1263</span></a>                            <span class="s1">&#39;iter_limit&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">conditions</span><span class="p">[</span><span class="nb">id</span><span class="p">][</span><span class="s1">&#39;iter_limit&#39;</span><span class="p">],</span>
</span><span id="QueueDAG.execute-1264"><a href="#QueueDAG.execute-1264"><span class="linenos">1264</span></a>                            <span class="s1">&#39;out_queue&#39;</span><span class="p">:</span> <span class="n">queues</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
</span><span id="QueueDAG.execute-1265"><a href="#QueueDAG.execute-1265"><span class="linenos">1265</span></a>                        <span class="p">}</span>
</span><span id="QueueDAG.execute-1266"><a href="#QueueDAG.execute-1266"><span class="linenos">1266</span></a>                    <span class="p">})</span>
</span><span id="QueueDAG.execute-1267"><a href="#QueueDAG.execute-1267"><span class="linenos">1267</span></a>                    <span class="n">processes</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span>
</span><span id="QueueDAG.execute-1268"><a href="#QueueDAG.execute-1268"><span class="linenos">1268</span></a>                        <span class="n">_event_wrapper</span><span class="p">,</span>
</span><span id="QueueDAG.execute-1269"><a href="#QueueDAG.execute-1269"><span class="linenos">1269</span></a>                        <span class="n">_callable</span><span class="o">=</span><span class="n">node</span><span class="p">[</span><span class="s1">&#39;callable&#39;</span><span class="p">],</span>
</span><span id="QueueDAG.execute-1270"><a href="#QueueDAG.execute-1270"><span class="linenos">1270</span></a>                        <span class="n">_name</span><span class="o">=</span><span class="n">node</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
</span><span id="QueueDAG.execute-1271"><a href="#QueueDAG.execute-1271"><span class="linenos">1271</span></a>                        <span class="n">_args</span><span class="o">=</span><span class="n">node</span><span class="p">[</span><span class="s1">&#39;args&#39;</span><span class="p">],</span>
</span><span id="QueueDAG.execute-1272"><a href="#QueueDAG.execute-1272"><span class="linenos">1272</span></a>                        <span class="n">_kwargs</span><span class="o">=</span><span class="n">node</span><span class="p">[</span><span class="s1">&#39;kwargs&#39;</span><span class="p">]</span>
</span><span id="QueueDAG.execute-1273"><a href="#QueueDAG.execute-1273"><span class="linenos">1273</span></a>                    <span class="p">)</span>
</span><span id="QueueDAG.execute-1274"><a href="#QueueDAG.execute-1274"><span class="linenos">1274</span></a>                
</span><span id="QueueDAG.execute-1275"><a href="#QueueDAG.execute-1275"><span class="linenos">1275</span></a>                <span class="k">for</span> <span class="n">parent_id</span><span class="p">,</span> <span class="nb">id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">:</span>
</span><span id="QueueDAG.execute-1276"><a href="#QueueDAG.execute-1276"><span class="linenos">1276</span></a>                    <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
</span><span id="QueueDAG.execute-1277"><a href="#QueueDAG.execute-1277"><span class="linenos">1277</span></a>                    <span class="n">queues</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">_q</span><span class="o">.</span><span class="n">LifoQueue</span><span class="p">()</span>
</span><span id="QueueDAG.execute-1278"><a href="#QueueDAG.execute-1278"><span class="linenos">1278</span></a>                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">successors</span><span class="p">(</span><span class="nb">id</span><span class="p">)))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="QueueDAG.execute-1279"><a href="#QueueDAG.execute-1279"><span class="linenos">1279</span></a>                        <span class="n">end_proc</span> <span class="o">=</span> <span class="nb">id</span>
</span><span id="QueueDAG.execute-1280"><a href="#QueueDAG.execute-1280"><span class="linenos">1280</span></a>                    <span class="n">node</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
</span><span id="QueueDAG.execute-1281"><a href="#QueueDAG.execute-1281"><span class="linenos">1281</span></a>                        <span class="s1">&#39;callable&#39;</span><span class="p">:</span> <span class="n">_queue</span><span class="o">.</span><span class="n">_worker</span><span class="p">,</span>
</span><span id="QueueDAG.execute-1282"><a href="#QueueDAG.execute-1282"><span class="linenos">1282</span></a>                        <span class="s1">&#39;args&#39;</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">(),</span>
</span><span id="QueueDAG.execute-1283"><a href="#QueueDAG.execute-1283"><span class="linenos">1283</span></a>                        <span class="s1">&#39;kwargs&#39;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="QueueDAG.execute-1284"><a href="#QueueDAG.execute-1284"><span class="linenos">1284</span></a>                            <span class="s1">&#39;work&#39;</span><span class="p">:</span> <span class="n">node</span><span class="o">.</span><span class="n">callable</span><span class="p">,</span>
</span><span id="QueueDAG.execute-1285"><a href="#QueueDAG.execute-1285"><span class="linenos">1285</span></a>                            <span class="s1">&#39;args&#39;</span><span class="p">:</span> <span class="n">node</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="s1">&#39;kwargs&#39;</span><span class="p">:</span> <span class="n">node</span><span class="o">.</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="QueueDAG.execute-1286"><a href="#QueueDAG.execute-1286"><span class="linenos">1286</span></a>                            <span class="s1">&#39;promises&#39;</span><span class="p">:</span> <span class="n">_promises</span><span class="p">,</span>
</span><span id="QueueDAG.execute-1287"><a href="#QueueDAG.execute-1287"><span class="linenos">1287</span></a>                            <span class="s1">&#39;print_exc&#39;</span><span class="p">:</span> <span class="n">print_exc</span><span class="p">,</span>
</span><span id="QueueDAG.execute-1288"><a href="#QueueDAG.execute-1288"><span class="linenos">1288</span></a>                            <span class="s1">&#39;parent_id&#39;</span><span class="p">:</span> <span class="n">parent_id</span><span class="p">,</span>
</span><span id="QueueDAG.execute-1289"><a href="#QueueDAG.execute-1289"><span class="linenos">1289</span></a>                            <span class="s1">&#39;parent_process&#39;</span><span class="p">:</span> <span class="n">processes</span><span class="p">[</span><span class="n">parent_id</span><span class="p">],</span>
</span><span id="QueueDAG.execute-1290"><a href="#QueueDAG.execute-1290"><span class="linenos">1290</span></a>                            <span class="s1">&#39;in_queue&#39;</span><span class="p">:</span> <span class="n">queues</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">parent_id</span><span class="p">),</span>
</span><span id="QueueDAG.execute-1291"><a href="#QueueDAG.execute-1291"><span class="linenos">1291</span></a>                            <span class="s1">&#39;out_queue&#39;</span><span class="p">:</span> <span class="n">queues</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
</span><span id="QueueDAG.execute-1292"><a href="#QueueDAG.execute-1292"><span class="linenos">1292</span></a>                        <span class="p">}</span>
</span><span id="QueueDAG.execute-1293"><a href="#QueueDAG.execute-1293"><span class="linenos">1293</span></a>                    <span class="p">})</span>
</span><span id="QueueDAG.execute-1294"><a href="#QueueDAG.execute-1294"><span class="linenos">1294</span></a>                    <span class="n">processes</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span>
</span><span id="QueueDAG.execute-1295"><a href="#QueueDAG.execute-1295"><span class="linenos">1295</span></a>                        <span class="n">_event_wrapper</span><span class="p">,</span>
</span><span id="QueueDAG.execute-1296"><a href="#QueueDAG.execute-1296"><span class="linenos">1296</span></a>                        <span class="n">_callable</span><span class="o">=</span><span class="n">node</span><span class="p">[</span><span class="s1">&#39;callable&#39;</span><span class="p">],</span>
</span><span id="QueueDAG.execute-1297"><a href="#QueueDAG.execute-1297"><span class="linenos">1297</span></a>                        <span class="n">_name</span><span class="o">=</span><span class="n">node</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
</span><span id="QueueDAG.execute-1298"><a href="#QueueDAG.execute-1298"><span class="linenos">1298</span></a>                        <span class="n">_args</span><span class="o">=</span><span class="n">node</span><span class="p">[</span><span class="s1">&#39;args&#39;</span><span class="p">],</span>
</span><span id="QueueDAG.execute-1299"><a href="#QueueDAG.execute-1299"><span class="linenos">1299</span></a>                        <span class="n">_kwargs</span><span class="o">=</span><span class="n">node</span><span class="p">[</span><span class="s1">&#39;kwargs&#39;</span><span class="p">]</span>
</span><span id="QueueDAG.execute-1300"><a href="#QueueDAG.execute-1300"><span class="linenos">1300</span></a>                    <span class="p">)</span>
</span><span id="QueueDAG.execute-1301"><a href="#QueueDAG.execute-1301"><span class="linenos">1301</span></a>
</span><span id="QueueDAG.execute-1302"><a href="#QueueDAG.execute-1302"><span class="linenos">1302</span></a>            <span class="c1"># For single-node DAGs with no edges, end_proc is the root node</span>
</span><span id="QueueDAG.execute-1303"><a href="#QueueDAG.execute-1303"><span class="linenos">1303</span></a>            <span class="k">if</span> <span class="n">end_proc</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="QueueDAG.execute-1304"><a href="#QueueDAG.execute-1304"><span class="linenos">1304</span></a>                <span class="n">end_proc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="QueueDAG.execute-1305"><a href="#QueueDAG.execute-1305"><span class="linenos">1305</span></a>
</span><span id="QueueDAG.execute-1306"><a href="#QueueDAG.execute-1306"><span class="linenos">1306</span></a>            <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">join</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">):</span>
</span><span id="QueueDAG.execute-1307"><a href="#QueueDAG.execute-1307"><span class="linenos">1307</span></a>                <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
</span><span id="QueueDAG.execute-1308"><a href="#QueueDAG.execute-1308"><span class="linenos">1308</span></a>                    <span class="k">if</span> <span class="n">processes</span><span class="p">[</span><span class="n">node</span><span class="p">]</span><span class="o">.</span><span class="n">done</span><span class="p">():</span>
</span><span id="QueueDAG.execute-1309"><a href="#QueueDAG.execute-1309"><span class="linenos">1309</span></a>                        <span class="n">join</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
</span><span id="QueueDAG.execute-1310"><a href="#QueueDAG.execute-1310"><span class="linenos">1310</span></a>
</span><span id="QueueDAG.execute-1311"><a href="#QueueDAG.execute-1311"><span class="linenos">1311</span></a>            <span class="n">return_val</span><span class="p">:</span> <span class="n">_T</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">_T</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="QueueDAG.execute-1312"><a href="#QueueDAG.execute-1312"><span class="linenos">1312</span></a>            <span class="k">if</span> <span class="n">end_proc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">end_proc</span> <span class="ow">in</span> <span class="n">queues</span><span class="p">:</span>
</span><span id="QueueDAG.execute-1313"><a href="#QueueDAG.execute-1313"><span class="linenos">1313</span></a>                <span class="k">while</span> <span class="ow">not</span> <span class="n">queues</span><span class="p">[</span><span class="n">end_proc</span><span class="p">]</span><span class="o">.</span><span class="n">empty</span><span class="p">():</span>
</span><span id="QueueDAG.execute-1314"><a href="#QueueDAG.execute-1314"><span class="linenos">1314</span></a>                    <span class="n">return_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">queues</span><span class="p">[</span><span class="n">end_proc</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">())</span>
</span><span id="QueueDAG.execute-1315"><a href="#QueueDAG.execute-1315"><span class="linenos">1315</span></a>
</span><span id="QueueDAG.execute-1316"><a href="#QueueDAG.execute-1316"><span class="linenos">1316</span></a>            <span class="k">return</span> <span class="n">return_val</span>
</span></pre></div>


            <div class="docstring"><p>Basic wrapper for execution of the DAG's underlying callables.</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#DAG">DAG</a></dt>
                                <dd id="QueueDAG.graph" class="variable"><a href="#DAG.graph">graph</a></dd>
                <dd id="QueueDAG.remove_node" class="function"><a href="#DAG.remove_node">remove_node</a></dd>
                <dd id="QueueDAG.remove_edge" class="function"><a href="#DAG.remove_edge">remove_edge</a></dd>
                <dd id="QueueDAG.update_edges" class="function"><a href="#DAG.update_edges">update_edges</a></dd>
                <dd id="QueueDAG.relabel_node" class="function"><a href="#DAG.relabel_node">relabel_node</a></dd>
                <dd id="QueueDAG.update_nodes" class="function"><a href="#DAG.update_nodes">update_nodes</a></dd>
                <dd id="QueueDAG.get_edges" class="function"><a href="#DAG.get_edges">get_edges</a></dd>
                <dd id="QueueDAG.get_edge" class="function"><a href="#DAG.get_edge">get_edge</a></dd>
                <dd id="QueueDAG.get_node" class="function"><a href="#DAG.get_node">get_node</a></dd>
                <dd id="QueueDAG.get_nodes" class="function"><a href="#DAG.get_nodes">get_nodes</a></dd>
                <dd id="QueueDAG.filter_nodes" class="function"><a href="#DAG.filter_nodes">filter_nodes</a></dd>
                <dd id="QueueDAG.filter_edges" class="function"><a href="#DAG.filter_edges">filter_edges</a></dd>
                <dd id="QueueDAG.retry_node" class="function"><a href="#DAG.retry_node">retry_node</a></dd>
                <dd id="QueueDAG.skip_node" class="function"><a href="#DAG.skip_node">skip_node</a></dd>
                <dd id="QueueDAG.critical_path" class="function"><a href="#DAG.critical_path">critical_path</a></dd>
                <dd id="QueueDAG.visualize" class="function"><a href="#DAG.visualize">visualize</a></dd>
                <dd id="QueueDAG.root" class="variable"><a href="#DAG.root">root</a></dd>
                <dd id="QueueDAG.nodes" class="variable"><a href="#DAG.nodes">nodes</a></dd>
                <dd id="QueueDAG.node_id" class="function"><a href="#DAG.node_id">node_id</a></dd>
                <dd id="QueueDAG.resolve_promise" class="function"><a href="#DAG.resolve_promise">resolve_promise</a></dd>
                <dd id="QueueDAG.DAGExecutor" class="class"><a href="#DAG.DAGExecutor">DAGExecutor</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>